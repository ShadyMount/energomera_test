(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const _ of document.querySelectorAll('link[rel="modulepreload"]'))f(_);new MutationObserver(_=>{for(const v of _)if(v.type==="childList")for(const C of v.addedNodes)C.tagName==="LINK"&&C.rel==="modulepreload"&&f(C)}).observe(document,{childList:!0,subtree:!0});function l(_){const v={};return _.integrity&&(v.integrity=_.integrity),_.referrerpolicy&&(v.referrerPolicy=_.referrerpolicy),_.crossorigin==="use-credentials"?v.credentials="include":_.crossorigin==="anonymous"?v.credentials="omit":v.credentials="same-origin",v}function f(_){if(_.ep)return;_.ep=!0;const v=l(_);fetch(_.href,v)}})();var Ew=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Tw(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var nd={},kw={get exports(){return nd},set exports(n){nd=n}},Id={},qe={},Cw={get exports(){return qe},set exports(n){qe=n}},At={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pc=Symbol.for("react.element"),Iw=Symbol.for("react.portal"),zw=Symbol.for("react.fragment"),Aw=Symbol.for("react.strict_mode"),Mw=Symbol.for("react.profiler"),Pw=Symbol.for("react.provider"),Dw=Symbol.for("react.context"),Lw=Symbol.for("react.forward_ref"),Rw=Symbol.for("react.suspense"),Bw=Symbol.for("react.memo"),Fw=Symbol.for("react.lazy"),Ky=Symbol.iterator;function Ow(n){return n===null||typeof n!="object"?null:(n=Ky&&n[Ky]||n["@@iterator"],typeof n=="function"?n:null)}var gv={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},yv=Object.assign,_v={};function Tl(n,o,l){this.props=n,this.context=o,this.refs=_v,this.updater=l||gv}Tl.prototype.isReactComponent={};Tl.prototype.setState=function(n,o){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,o,"setState")};Tl.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function vv(){}vv.prototype=Tl.prototype;function Am(n,o,l){this.props=n,this.context=o,this.refs=_v,this.updater=l||gv}var Mm=Am.prototype=new vv;Mm.constructor=Am;yv(Mm,Tl.prototype);Mm.isPureReactComponent=!0;var Yy=Array.isArray,xv=Object.prototype.hasOwnProperty,Pm={current:null},wv={key:!0,ref:!0,__self:!0,__source:!0};function bv(n,o,l){var f,_={},v=null,C=null;if(o!=null)for(f in o.ref!==void 0&&(C=o.ref),o.key!==void 0&&(v=""+o.key),o)xv.call(o,f)&&!wv.hasOwnProperty(f)&&(_[f]=o[f]);var u=arguments.length-2;if(u===1)_.children=l;else if(1<u){for(var O=Array(u),Z=0;Z<u;Z++)O[Z]=arguments[Z+2];_.children=O}if(n&&n.defaultProps)for(f in u=n.defaultProps,u)_[f]===void 0&&(_[f]=u[f]);return{$$typeof:pc,type:n,key:v,ref:C,props:_,_owner:Pm.current}}function Nw(n,o){return{$$typeof:pc,type:n.type,key:o,ref:n.ref,props:n.props,_owner:n._owner}}function Dm(n){return typeof n=="object"&&n!==null&&n.$$typeof===pc}function Uw(n){var o={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(l){return o[l]})}var Jy=/\/+/g;function Hp(n,o){return typeof n=="object"&&n!==null&&n.key!=null?Uw(""+n.key):o.toString(36)}function Gh(n,o,l,f,_){var v=typeof n;(v==="undefined"||v==="boolean")&&(n=null);var C=!1;if(n===null)C=!0;else switch(v){case"string":case"number":C=!0;break;case"object":switch(n.$$typeof){case pc:case Iw:C=!0}}if(C)return C=n,_=_(C),n=f===""?"."+Hp(C,0):f,Yy(_)?(l="",n!=null&&(l=n.replace(Jy,"$&/")+"/"),Gh(_,o,l,"",function(Z){return Z})):_!=null&&(Dm(_)&&(_=Nw(_,l+(!_.key||C&&C.key===_.key?"":(""+_.key).replace(Jy,"$&/")+"/")+n)),o.push(_)),1;if(C=0,f=f===""?".":f+":",Yy(n))for(var u=0;u<n.length;u++){v=n[u];var O=f+Hp(v,u);C+=Gh(v,o,l,O,_)}else if(O=Ow(n),typeof O=="function")for(n=O.call(n),u=0;!(v=n.next()).done;)v=v.value,O=f+Hp(v,u++),C+=Gh(v,o,l,O,_);else if(v==="object")throw o=String(n),Error("Objects are not valid as a React child (found: "+(o==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":o)+"). If you meant to render a collection of children, use an array instead.");return C}function kh(n,o,l){if(n==null)return n;var f=[],_=0;return Gh(n,f,"","",function(v){return o.call(l,v,_++)}),f}function Vw(n){if(n._status===-1){var o=n._result;o=o(),o.then(function(l){(n._status===0||n._status===-1)&&(n._status=1,n._result=l)},function(l){(n._status===0||n._status===-1)&&(n._status=2,n._result=l)}),n._status===-1&&(n._status=0,n._result=o)}if(n._status===1)return n._result.default;throw n._result}var Fr={current:null},Zh={transition:null},$w={ReactCurrentDispatcher:Fr,ReactCurrentBatchConfig:Zh,ReactCurrentOwner:Pm};At.Children={map:kh,forEach:function(n,o,l){kh(n,function(){o.apply(this,arguments)},l)},count:function(n){var o=0;return kh(n,function(){o++}),o},toArray:function(n){return kh(n,function(o){return o})||[]},only:function(n){if(!Dm(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};At.Component=Tl;At.Fragment=zw;At.Profiler=Mw;At.PureComponent=Am;At.StrictMode=Aw;At.Suspense=Rw;At.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=$w;At.cloneElement=function(n,o,l){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var f=yv({},n.props),_=n.key,v=n.ref,C=n._owner;if(o!=null){if(o.ref!==void 0&&(v=o.ref,C=Pm.current),o.key!==void 0&&(_=""+o.key),n.type&&n.type.defaultProps)var u=n.type.defaultProps;for(O in o)xv.call(o,O)&&!wv.hasOwnProperty(O)&&(f[O]=o[O]===void 0&&u!==void 0?u[O]:o[O])}var O=arguments.length-2;if(O===1)f.children=l;else if(1<O){u=Array(O);for(var Z=0;Z<O;Z++)u[Z]=arguments[Z+2];f.children=u}return{$$typeof:pc,type:n.type,key:_,ref:v,props:f,_owner:C}};At.createContext=function(n){return n={$$typeof:Dw,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:Pw,_context:n},n.Consumer=n};At.createElement=bv;At.createFactory=function(n){var o=bv.bind(null,n);return o.type=n,o};At.createRef=function(){return{current:null}};At.forwardRef=function(n){return{$$typeof:Lw,render:n}};At.isValidElement=Dm;At.lazy=function(n){return{$$typeof:Fw,_payload:{_status:-1,_result:n},_init:Vw}};At.memo=function(n,o){return{$$typeof:Bw,type:n,compare:o===void 0?null:o}};At.startTransition=function(n){var o=Zh.transition;Zh.transition={};try{n()}finally{Zh.transition=o}};At.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};At.useCallback=function(n,o){return Fr.current.useCallback(n,o)};At.useContext=function(n){return Fr.current.useContext(n)};At.useDebugValue=function(){};At.useDeferredValue=function(n){return Fr.current.useDeferredValue(n)};At.useEffect=function(n,o){return Fr.current.useEffect(n,o)};At.useId=function(){return Fr.current.useId()};At.useImperativeHandle=function(n,o,l){return Fr.current.useImperativeHandle(n,o,l)};At.useInsertionEffect=function(n,o){return Fr.current.useInsertionEffect(n,o)};At.useLayoutEffect=function(n,o){return Fr.current.useLayoutEffect(n,o)};At.useMemo=function(n,o){return Fr.current.useMemo(n,o)};At.useReducer=function(n,o,l){return Fr.current.useReducer(n,o,l)};At.useRef=function(n){return Fr.current.useRef(n)};At.useState=function(n){return Fr.current.useState(n)};At.useSyncExternalStore=function(n,o,l){return Fr.current.useSyncExternalStore(n,o,l)};At.useTransition=function(){return Fr.current.useTransition()};At.version="18.2.0";(function(n){n.exports=At})(Cw);const Lm=Tw(qe);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var jw=qe,Gw=Symbol.for("react.element"),Zw=Symbol.for("react.fragment"),qw=Object.prototype.hasOwnProperty,Ww=jw.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Xw={key:!0,ref:!0,__self:!0,__source:!0};function Sv(n,o,l){var f,_={},v=null,C=null;l!==void 0&&(v=""+l),o.key!==void 0&&(v=""+o.key),o.ref!==void 0&&(C=o.ref);for(f in o)qw.call(o,f)&&!Xw.hasOwnProperty(f)&&(_[f]=o[f]);if(n&&n.defaultProps)for(f in o=n.defaultProps,o)_[f]===void 0&&(_[f]=o[f]);return{$$typeof:Gw,type:n,key:v,ref:C,props:_,_owner:Ww.current}}Id.Fragment=Zw;Id.jsx=Sv;Id.jsxs=Sv;(function(n){n.exports=Id})(kw);const $i=nd.jsx,Hw=nd.jsxs;var zf={},Wu={},Kw={get exports(){return Wu},set exports(n){Wu=n}},ui={},Af={},Yw={get exports(){return Af},set exports(n){Af=n}},Ev={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function o(Ne,st){var ut=Ne.length;Ne.push(st);e:for(;0<ut;){var Pt=ut-1>>>1,qt=Ne[Pt];if(0<_(qt,st))Ne[Pt]=st,Ne[ut]=qt,ut=Pt;else break e}}function l(Ne){return Ne.length===0?null:Ne[0]}function f(Ne){if(Ne.length===0)return null;var st=Ne[0],ut=Ne.pop();if(ut!==st){Ne[0]=ut;e:for(var Pt=0,qt=Ne.length,fr=qt>>>1;Pt<fr;){var Yn=2*(Pt+1)-1,Jn=Ne[Yn],pn=Yn+1,sr=Ne[pn];if(0>_(Jn,ut))pn<qt&&0>_(sr,Jn)?(Ne[Pt]=sr,Ne[pn]=ut,Pt=pn):(Ne[Pt]=Jn,Ne[Yn]=ut,Pt=Yn);else if(pn<qt&&0>_(sr,ut))Ne[Pt]=sr,Ne[pn]=ut,Pt=pn;else break e}}return st}function _(Ne,st){var ut=Ne.sortIndex-st.sortIndex;return ut!==0?ut:Ne.id-st.id}if(typeof performance=="object"&&typeof performance.now=="function"){var v=performance;n.unstable_now=function(){return v.now()}}else{var C=Date,u=C.now();n.unstable_now=function(){return C.now()-u}}var O=[],Z=[],ue=1,te=null,q=3,Ae=!1,Ce=!1,we=!1,xt=typeof setTimeout=="function"?setTimeout:null,se=typeof clearTimeout=="function"?clearTimeout:null,Q=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function ae(Ne){for(var st=l(Z);st!==null;){if(st.callback===null)f(Z);else if(st.startTime<=Ne)f(Z),st.sortIndex=st.expirationTime,o(O,st);else break;st=l(Z)}}function ke(Ne){if(we=!1,ae(Ne),!Ce)if(l(O)!==null)Ce=!0,ot(Me);else{var st=l(Z);st!==null&&Tn(ke,st.startTime-Ne)}}function Me(Ne,st){Ce=!1,we&&(we=!1,se(He),He=-1),Ae=!0;var ut=q;try{for(ae(st),te=l(O);te!==null&&(!(te.expirationTime>st)||Ne&&!Wt());){var Pt=te.callback;if(typeof Pt=="function"){te.callback=null,q=te.priorityLevel;var qt=Pt(te.expirationTime<=st);st=n.unstable_now(),typeof qt=="function"?te.callback=qt:te===l(O)&&f(O),ae(st)}else f(O);te=l(O)}if(te!==null)var fr=!0;else{var Yn=l(Z);Yn!==null&&Tn(ke,Yn.startTime-st),fr=!1}return fr}finally{te=null,q=ut,Ae=!1}}var ze=!1,je=null,He=-1,Mt=5,ht=-1;function Wt(){return!(n.unstable_now()-ht<Mt)}function En(){if(je!==null){var Ne=n.unstable_now();ht=Ne;var st=!0;try{st=je(!0,Ne)}finally{st?yn():(ze=!1,je=null)}}else ze=!1}var yn;if(typeof Q=="function")yn=function(){Q(En)};else if(typeof MessageChannel<"u"){var Kn=new MessageChannel,_n=Kn.port2;Kn.port1.onmessage=En,yn=function(){_n.postMessage(null)}}else yn=function(){xt(En,0)};function ot(Ne){je=Ne,ze||(ze=!0,yn())}function Tn(Ne,st){He=xt(function(){Ne(n.unstable_now())},st)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Ne){Ne.callback=null},n.unstable_continueExecution=function(){Ce||Ae||(Ce=!0,ot(Me))},n.unstable_forceFrameRate=function(Ne){0>Ne||125<Ne?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Mt=0<Ne?Math.floor(1e3/Ne):5},n.unstable_getCurrentPriorityLevel=function(){return q},n.unstable_getFirstCallbackNode=function(){return l(O)},n.unstable_next=function(Ne){switch(q){case 1:case 2:case 3:var st=3;break;default:st=q}var ut=q;q=st;try{return Ne()}finally{q=ut}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Ne,st){switch(Ne){case 1:case 2:case 3:case 4:case 5:break;default:Ne=3}var ut=q;q=Ne;try{return st()}finally{q=ut}},n.unstable_scheduleCallback=function(Ne,st,ut){var Pt=n.unstable_now();switch(typeof ut=="object"&&ut!==null?(ut=ut.delay,ut=typeof ut=="number"&&0<ut?Pt+ut:Pt):ut=Pt,Ne){case 1:var qt=-1;break;case 2:qt=250;break;case 5:qt=1073741823;break;case 4:qt=1e4;break;default:qt=5e3}return qt=ut+qt,Ne={id:ue++,callback:st,priorityLevel:Ne,startTime:ut,expirationTime:qt,sortIndex:-1},ut>Pt?(Ne.sortIndex=ut,o(Z,Ne),l(O)===null&&Ne===l(Z)&&(we?(se(He),He=-1):we=!0,Tn(ke,ut-Pt))):(Ne.sortIndex=qt,o(O,Ne),Ce||Ae||(Ce=!0,ot(Me))),Ne},n.unstable_shouldYield=Wt,n.unstable_wrapCallback=function(Ne){var st=q;return function(){var ut=q;q=st;try{return Ne.apply(this,arguments)}finally{q=ut}}}})(Ev);(function(n){n.exports=Ev})(Yw);/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Tv=qe,li=Af;function Pe(n){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+n,l=1;l<arguments.length;l++)o+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+n+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var kv=new Set,Xu={};function _a(n,o){gl(n,o),gl(n+"Capture",o)}function gl(n,o){for(Xu[n]=o,n=0;n<o.length;n++)kv.add(o[n])}var Ro=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Mf=Object.prototype.hasOwnProperty,Jw=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,Qy={},e_={};function Qw(n){return Mf.call(e_,n)?!0:Mf.call(Qy,n)?!1:Jw.test(n)?e_[n]=!0:(Qy[n]=!0,!1)}function eb(n,o,l,f){if(l!==null&&l.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return f?!1:l!==null?!l.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function tb(n,o,l,f){if(o===null||typeof o>"u"||eb(n,o,l,f))return!0;if(f)return!1;if(l!==null)switch(l.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function Or(n,o,l,f,_,v,C){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=f,this.attributeNamespace=_,this.mustUseProperty=l,this.propertyName=n,this.type=o,this.sanitizeURL=v,this.removeEmptyString=C}var pr={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){pr[n]=new Or(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var o=n[0];pr[o]=new Or(o,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){pr[n]=new Or(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){pr[n]=new Or(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){pr[n]=new Or(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){pr[n]=new Or(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){pr[n]=new Or(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){pr[n]=new Or(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){pr[n]=new Or(n,5,!1,n.toLowerCase(),null,!1,!1)});var Rm=/[\-:]([a-z])/g;function Bm(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var o=n.replace(Rm,Bm);pr[o]=new Or(o,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var o=n.replace(Rm,Bm);pr[o]=new Or(o,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var o=n.replace(Rm,Bm);pr[o]=new Or(o,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){pr[n]=new Or(n,1,!1,n.toLowerCase(),null,!1,!1)});pr.xlinkHref=new Or("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){pr[n]=new Or(n,1,!1,n.toLowerCase(),null,!0,!0)});function Fm(n,o,l,f){var _=pr.hasOwnProperty(o)?pr[o]:null;(_!==null?_.type!==0:f||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(tb(o,l,_,f)&&(l=null),f||_===null?Qw(o)&&(l===null?n.removeAttribute(o):n.setAttribute(o,""+l)):_.mustUseProperty?n[_.propertyName]=l===null?_.type===3?!1:"":l:(o=_.attributeName,f=_.attributeNamespace,l===null?n.removeAttribute(o):(_=_.type,l=_===3||_===4&&l===!0?"":""+l,f?n.setAttributeNS(f,o,l):n.setAttribute(o,l))))}var No=Tv.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,Ch=Symbol.for("react.element"),Ja=Symbol.for("react.portal"),Qa=Symbol.for("react.fragment"),Om=Symbol.for("react.strict_mode"),Pf=Symbol.for("react.profiler"),Cv=Symbol.for("react.provider"),Iv=Symbol.for("react.context"),Nm=Symbol.for("react.forward_ref"),Df=Symbol.for("react.suspense"),Lf=Symbol.for("react.suspense_list"),Um=Symbol.for("react.memo"),us=Symbol.for("react.lazy"),zv=Symbol.for("react.offscreen"),t_=Symbol.iterator;function ku(n){return n===null||typeof n!="object"?null:(n=t_&&n[t_]||n["@@iterator"],typeof n=="function"?n:null)}var Sn=Object.assign,Kp;function Lu(n){if(Kp===void 0)try{throw Error()}catch(l){var o=l.stack.trim().match(/\n( *(at )?)/);Kp=o&&o[1]||""}return`
`+Kp+n}var Yp=!1;function Jp(n,o){if(!n||Yp)return"";Yp=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(Z){var f=Z}Reflect.construct(n,[],o)}else{try{o.call()}catch(Z){f=Z}n.call(o.prototype)}else{try{throw Error()}catch(Z){f=Z}n()}}catch(Z){if(Z&&f&&typeof Z.stack=="string"){for(var _=Z.stack.split(`
`),v=f.stack.split(`
`),C=_.length-1,u=v.length-1;1<=C&&0<=u&&_[C]!==v[u];)u--;for(;1<=C&&0<=u;C--,u--)if(_[C]!==v[u]){if(C!==1||u!==1)do if(C--,u--,0>u||_[C]!==v[u]){var O=`
`+_[C].replace(" at new "," at ");return n.displayName&&O.includes("<anonymous>")&&(O=O.replace("<anonymous>",n.displayName)),O}while(1<=C&&0<=u);break}}}finally{Yp=!1,Error.prepareStackTrace=l}return(n=n?n.displayName||n.name:"")?Lu(n):""}function nb(n){switch(n.tag){case 5:return Lu(n.type);case 16:return Lu("Lazy");case 13:return Lu("Suspense");case 19:return Lu("SuspenseList");case 0:case 2:case 15:return n=Jp(n.type,!1),n;case 11:return n=Jp(n.type.render,!1),n;case 1:return n=Jp(n.type,!0),n;default:return""}}function Rf(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Qa:return"Fragment";case Ja:return"Portal";case Pf:return"Profiler";case Om:return"StrictMode";case Df:return"Suspense";case Lf:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case Iv:return(n.displayName||"Context")+".Consumer";case Cv:return(n._context.displayName||"Context")+".Provider";case Nm:var o=n.render;return n=n.displayName,n||(n=o.displayName||o.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case Um:return o=n.displayName||null,o!==null?o:Rf(n.type)||"Memo";case us:o=n._payload,n=n._init;try{return Rf(n(o))}catch{}}return null}function rb(n){var o=n.type;switch(n.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=o.render,n=n.displayName||n.name||"",o.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return Rf(o);case 8:return o===Om?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function Es(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function Av(n){var o=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function ib(n){var o=Av(n)?"checked":"value",l=Object.getOwnPropertyDescriptor(n.constructor.prototype,o),f=""+n[o];if(!n.hasOwnProperty(o)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var _=l.get,v=l.set;return Object.defineProperty(n,o,{configurable:!0,get:function(){return _.call(this)},set:function(C){f=""+C,v.call(this,C)}}),Object.defineProperty(n,o,{enumerable:l.enumerable}),{getValue:function(){return f},setValue:function(C){f=""+C},stopTracking:function(){n._valueTracker=null,delete n[o]}}}}function Ih(n){n._valueTracker||(n._valueTracker=ib(n))}function Mv(n){if(!n)return!1;var o=n._valueTracker;if(!o)return!0;var l=o.getValue(),f="";return n&&(f=Av(n)?n.checked?"true":"false":n.value),n=f,n!==l?(o.setValue(n),!0):!1}function rd(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function Bf(n,o){var l=o.checked;return Sn({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??n._wrapperState.initialChecked})}function n_(n,o){var l=o.defaultValue==null?"":o.defaultValue,f=o.checked!=null?o.checked:o.defaultChecked;l=Es(o.value!=null?o.value:l),n._wrapperState={initialChecked:f,initialValue:l,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Pv(n,o){o=o.checked,o!=null&&Fm(n,"checked",o,!1)}function Ff(n,o){Pv(n,o);var l=Es(o.value),f=o.type;if(l!=null)f==="number"?(l===0&&n.value===""||n.value!=l)&&(n.value=""+l):n.value!==""+l&&(n.value=""+l);else if(f==="submit"||f==="reset"){n.removeAttribute("value");return}o.hasOwnProperty("value")?Of(n,o.type,l):o.hasOwnProperty("defaultValue")&&Of(n,o.type,Es(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(n.defaultChecked=!!o.defaultChecked)}function r_(n,o,l){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var f=o.type;if(!(f!=="submit"&&f!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+n._wrapperState.initialValue,l||o===n.value||(n.value=o),n.defaultValue=o}l=n.name,l!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,l!==""&&(n.name=l)}function Of(n,o,l){(o!=="number"||rd(n.ownerDocument)!==n)&&(l==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+l&&(n.defaultValue=""+l))}var Ru=Array.isArray;function cl(n,o,l,f){if(n=n.options,o){o={};for(var _=0;_<l.length;_++)o["$"+l[_]]=!0;for(l=0;l<n.length;l++)_=o.hasOwnProperty("$"+n[l].value),n[l].selected!==_&&(n[l].selected=_),_&&f&&(n[l].defaultSelected=!0)}else{for(l=""+Es(l),o=null,_=0;_<n.length;_++){if(n[_].value===l){n[_].selected=!0,f&&(n[_].defaultSelected=!0);return}o!==null||n[_].disabled||(o=n[_])}o!==null&&(o.selected=!0)}}function Nf(n,o){if(o.dangerouslySetInnerHTML!=null)throw Error(Pe(91));return Sn({},o,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function i_(n,o){var l=o.value;if(l==null){if(l=o.children,o=o.defaultValue,l!=null){if(o!=null)throw Error(Pe(92));if(Ru(l)){if(1<l.length)throw Error(Pe(93));l=l[0]}o=l}o==null&&(o=""),l=o}n._wrapperState={initialValue:Es(l)}}function Dv(n,o){var l=Es(o.value),f=Es(o.defaultValue);l!=null&&(l=""+l,l!==n.value&&(n.value=l),o.defaultValue==null&&n.defaultValue!==l&&(n.defaultValue=l)),f!=null&&(n.defaultValue=""+f)}function o_(n){var o=n.textContent;o===n._wrapperState.initialValue&&o!==""&&o!==null&&(n.value=o)}function Lv(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Uf(n,o){return n==null||n==="http://www.w3.org/1999/xhtml"?Lv(o):n==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var zh,Rv=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,l,f,_){MSApp.execUnsafeLocalFunction(function(){return n(o,l,f,_)})}:n}(function(n,o){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=o;else{for(zh=zh||document.createElement("div"),zh.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=zh.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;o.firstChild;)n.appendChild(o.firstChild)}});function Hu(n,o){if(o){var l=n.firstChild;if(l&&l===n.lastChild&&l.nodeType===3){l.nodeValue=o;return}}n.textContent=o}var Ou={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},ob=["Webkit","ms","Moz","O"];Object.keys(Ou).forEach(function(n){ob.forEach(function(o){o=o+n.charAt(0).toUpperCase()+n.substring(1),Ou[o]=Ou[n]})});function Bv(n,o,l){return o==null||typeof o=="boolean"||o===""?"":l||typeof o!="number"||o===0||Ou.hasOwnProperty(n)&&Ou[n]?(""+o).trim():o+"px"}function Fv(n,o){n=n.style;for(var l in o)if(o.hasOwnProperty(l)){var f=l.indexOf("--")===0,_=Bv(l,o[l],f);l==="float"&&(l="cssFloat"),f?n.setProperty(l,_):n[l]=_}}var sb=Sn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Vf(n,o){if(o){if(sb[n]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(Pe(137,n));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(Pe(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(Pe(61))}if(o.style!=null&&typeof o.style!="object")throw Error(Pe(62))}}function $f(n,o){if(n.indexOf("-")===-1)return typeof o.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var jf=null;function Vm(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var Gf=null,hl=null,dl=null;function s_(n){if(n=gc(n)){if(typeof Gf!="function")throw Error(Pe(280));var o=n.stateNode;o&&(o=Dd(o),Gf(n.stateNode,n.type,o))}}function Ov(n){hl?dl?dl.push(n):dl=[n]:hl=n}function Nv(){if(hl){var n=hl,o=dl;if(dl=hl=null,s_(n),o)for(n=0;n<o.length;n++)s_(o[n])}}function Uv(n,o){return n(o)}function Vv(){}var Qp=!1;function $v(n,o,l){if(Qp)return n(o,l);Qp=!0;try{return Uv(n,o,l)}finally{Qp=!1,(hl!==null||dl!==null)&&(Vv(),Nv())}}function Ku(n,o){var l=n.stateNode;if(l===null)return null;var f=Dd(l);if(f===null)return null;l=f[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(f=!f.disabled)||(n=n.type,f=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!f;break e;default:n=!1}if(n)return null;if(l&&typeof l!="function")throw Error(Pe(231,o,typeof l));return l}var Zf=!1;if(Ro)try{var Cu={};Object.defineProperty(Cu,"passive",{get:function(){Zf=!0}}),window.addEventListener("test",Cu,Cu),window.removeEventListener("test",Cu,Cu)}catch{Zf=!1}function ab(n,o,l,f,_,v,C,u,O){var Z=Array.prototype.slice.call(arguments,3);try{o.apply(l,Z)}catch(ue){this.onError(ue)}}var Nu=!1,id=null,od=!1,qf=null,lb={onError:function(n){Nu=!0,id=n}};function ub(n,o,l,f,_,v,C,u,O){Nu=!1,id=null,ab.apply(lb,arguments)}function cb(n,o,l,f,_,v,C,u,O){if(ub.apply(this,arguments),Nu){if(Nu){var Z=id;Nu=!1,id=null}else throw Error(Pe(198));od||(od=!0,qf=Z)}}function va(n){var o=n,l=n;if(n.alternate)for(;o.return;)o=o.return;else{n=o;do o=n,o.flags&4098&&(l=o.return),n=o.return;while(n)}return o.tag===3?l:null}function jv(n){if(n.tag===13){var o=n.memoizedState;if(o===null&&(n=n.alternate,n!==null&&(o=n.memoizedState)),o!==null)return o.dehydrated}return null}function a_(n){if(va(n)!==n)throw Error(Pe(188))}function hb(n){var o=n.alternate;if(!o){if(o=va(n),o===null)throw Error(Pe(188));return o!==n?null:n}for(var l=n,f=o;;){var _=l.return;if(_===null)break;var v=_.alternate;if(v===null){if(f=_.return,f!==null){l=f;continue}break}if(_.child===v.child){for(v=_.child;v;){if(v===l)return a_(_),n;if(v===f)return a_(_),o;v=v.sibling}throw Error(Pe(188))}if(l.return!==f.return)l=_,f=v;else{for(var C=!1,u=_.child;u;){if(u===l){C=!0,l=_,f=v;break}if(u===f){C=!0,f=_,l=v;break}u=u.sibling}if(!C){for(u=v.child;u;){if(u===l){C=!0,l=v,f=_;break}if(u===f){C=!0,f=v,l=_;break}u=u.sibling}if(!C)throw Error(Pe(189))}}if(l.alternate!==f)throw Error(Pe(190))}if(l.tag!==3)throw Error(Pe(188));return l.stateNode.current===l?n:o}function Gv(n){return n=hb(n),n!==null?Zv(n):null}function Zv(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var o=Zv(n);if(o!==null)return o;n=n.sibling}return null}var qv=li.unstable_scheduleCallback,l_=li.unstable_cancelCallback,db=li.unstable_shouldYield,pb=li.unstable_requestPaint,Rn=li.unstable_now,fb=li.unstable_getCurrentPriorityLevel,$m=li.unstable_ImmediatePriority,Wv=li.unstable_UserBlockingPriority,sd=li.unstable_NormalPriority,mb=li.unstable_LowPriority,Xv=li.unstable_IdlePriority,zd=null,ao=null;function gb(n){if(ao&&typeof ao.onCommitFiberRoot=="function")try{ao.onCommitFiberRoot(zd,n,void 0,(n.current.flags&128)===128)}catch{}}var ji=Math.clz32?Math.clz32:vb,yb=Math.log,_b=Math.LN2;function vb(n){return n>>>=0,n===0?32:31-(yb(n)/_b|0)|0}var Ah=64,Mh=4194304;function Bu(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ad(n,o){var l=n.pendingLanes;if(l===0)return 0;var f=0,_=n.suspendedLanes,v=n.pingedLanes,C=l&268435455;if(C!==0){var u=C&~_;u!==0?f=Bu(u):(v&=C,v!==0&&(f=Bu(v)))}else C=l&~_,C!==0?f=Bu(C):v!==0&&(f=Bu(v));if(f===0)return 0;if(o!==0&&o!==f&&!(o&_)&&(_=f&-f,v=o&-o,_>=v||_===16&&(v&4194240)!==0))return o;if(f&4&&(f|=l&16),o=n.entangledLanes,o!==0)for(n=n.entanglements,o&=f;0<o;)l=31-ji(o),_=1<<l,f|=n[l],o&=~_;return f}function xb(n,o){switch(n){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function wb(n,o){for(var l=n.suspendedLanes,f=n.pingedLanes,_=n.expirationTimes,v=n.pendingLanes;0<v;){var C=31-ji(v),u=1<<C,O=_[C];O===-1?(!(u&l)||u&f)&&(_[C]=xb(u,o)):O<=o&&(n.expiredLanes|=u),v&=~u}}function Wf(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function Hv(){var n=Ah;return Ah<<=1,!(Ah&4194240)&&(Ah=64),n}function ef(n){for(var o=[],l=0;31>l;l++)o.push(n);return o}function fc(n,o,l){n.pendingLanes|=o,o!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,o=31-ji(o),n[o]=l}function bb(n,o){var l=n.pendingLanes&~o;n.pendingLanes=o,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=o,n.mutableReadLanes&=o,n.entangledLanes&=o,o=n.entanglements;var f=n.eventTimes;for(n=n.expirationTimes;0<l;){var _=31-ji(l),v=1<<_;o[_]=0,f[_]=-1,n[_]=-1,l&=~v}}function jm(n,o){var l=n.entangledLanes|=o;for(n=n.entanglements;l;){var f=31-ji(l),_=1<<f;_&o|n[f]&o&&(n[f]|=o),l&=~_}}var Ht=0;function Kv(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var Yv,Gm,Jv,Qv,ex,Xf=!1,Ph=[],gs=null,ys=null,_s=null,Yu=new Map,Ju=new Map,hs=[],Sb="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function u_(n,o){switch(n){case"focusin":case"focusout":gs=null;break;case"dragenter":case"dragleave":ys=null;break;case"mouseover":case"mouseout":_s=null;break;case"pointerover":case"pointerout":Yu.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ju.delete(o.pointerId)}}function Iu(n,o,l,f,_,v){return n===null||n.nativeEvent!==v?(n={blockedOn:o,domEventName:l,eventSystemFlags:f,nativeEvent:v,targetContainers:[_]},o!==null&&(o=gc(o),o!==null&&Gm(o)),n):(n.eventSystemFlags|=f,o=n.targetContainers,_!==null&&o.indexOf(_)===-1&&o.push(_),n)}function Eb(n,o,l,f,_){switch(o){case"focusin":return gs=Iu(gs,n,o,l,f,_),!0;case"dragenter":return ys=Iu(ys,n,o,l,f,_),!0;case"mouseover":return _s=Iu(_s,n,o,l,f,_),!0;case"pointerover":var v=_.pointerId;return Yu.set(v,Iu(Yu.get(v)||null,n,o,l,f,_)),!0;case"gotpointercapture":return v=_.pointerId,Ju.set(v,Iu(Ju.get(v)||null,n,o,l,f,_)),!0}return!1}function tx(n){var o=la(n.target);if(o!==null){var l=va(o);if(l!==null){if(o=l.tag,o===13){if(o=jv(l),o!==null){n.blockedOn=o,ex(n.priority,function(){Jv(l)});return}}else if(o===3&&l.stateNode.current.memoizedState.isDehydrated){n.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}n.blockedOn=null}function qh(n){if(n.blockedOn!==null)return!1;for(var o=n.targetContainers;0<o.length;){var l=Hf(n.domEventName,n.eventSystemFlags,o[0],n.nativeEvent);if(l===null){l=n.nativeEvent;var f=new l.constructor(l.type,l);jf=f,l.target.dispatchEvent(f),jf=null}else return o=gc(l),o!==null&&Gm(o),n.blockedOn=l,!1;o.shift()}return!0}function c_(n,o,l){qh(n)&&l.delete(o)}function Tb(){Xf=!1,gs!==null&&qh(gs)&&(gs=null),ys!==null&&qh(ys)&&(ys=null),_s!==null&&qh(_s)&&(_s=null),Yu.forEach(c_),Ju.forEach(c_)}function zu(n,o){n.blockedOn===o&&(n.blockedOn=null,Xf||(Xf=!0,li.unstable_scheduleCallback(li.unstable_NormalPriority,Tb)))}function Qu(n){function o(_){return zu(_,n)}if(0<Ph.length){zu(Ph[0],n);for(var l=1;l<Ph.length;l++){var f=Ph[l];f.blockedOn===n&&(f.blockedOn=null)}}for(gs!==null&&zu(gs,n),ys!==null&&zu(ys,n),_s!==null&&zu(_s,n),Yu.forEach(o),Ju.forEach(o),l=0;l<hs.length;l++)f=hs[l],f.blockedOn===n&&(f.blockedOn=null);for(;0<hs.length&&(l=hs[0],l.blockedOn===null);)tx(l),l.blockedOn===null&&hs.shift()}var pl=No.ReactCurrentBatchConfig,ld=!0;function kb(n,o,l,f){var _=Ht,v=pl.transition;pl.transition=null;try{Ht=1,Zm(n,o,l,f)}finally{Ht=_,pl.transition=v}}function Cb(n,o,l,f){var _=Ht,v=pl.transition;pl.transition=null;try{Ht=4,Zm(n,o,l,f)}finally{Ht=_,pl.transition=v}}function Zm(n,o,l,f){if(ld){var _=Hf(n,o,l,f);if(_===null)hf(n,o,f,ud,l),u_(n,f);else if(Eb(_,n,o,l,f))f.stopPropagation();else if(u_(n,f),o&4&&-1<Sb.indexOf(n)){for(;_!==null;){var v=gc(_);if(v!==null&&Yv(v),v=Hf(n,o,l,f),v===null&&hf(n,o,f,ud,l),v===_)break;_=v}_!==null&&f.stopPropagation()}else hf(n,o,f,null,l)}}var ud=null;function Hf(n,o,l,f){if(ud=null,n=Vm(f),n=la(n),n!==null)if(o=va(n),o===null)n=null;else if(l=o.tag,l===13){if(n=jv(o),n!==null)return n;n=null}else if(l===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;n=null}else o!==n&&(n=null);return ud=n,null}function nx(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(fb()){case $m:return 1;case Wv:return 4;case sd:case mb:return 16;case Xv:return 536870912;default:return 16}default:return 16}}var ps=null,qm=null,Wh=null;function rx(){if(Wh)return Wh;var n,o=qm,l=o.length,f,_="value"in ps?ps.value:ps.textContent,v=_.length;for(n=0;n<l&&o[n]===_[n];n++);var C=l-n;for(f=1;f<=C&&o[l-f]===_[v-f];f++);return Wh=_.slice(n,1<f?1-f:void 0)}function Xh(n){var o=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&o===13&&(n=13)):n=o,n===10&&(n=13),32<=n||n===13?n:0}function Dh(){return!0}function h_(){return!1}function ci(n){function o(l,f,_,v,C){this._reactName=l,this._targetInst=_,this.type=f,this.nativeEvent=v,this.target=C,this.currentTarget=null;for(var u in n)n.hasOwnProperty(u)&&(l=n[u],this[u]=l?l(v):v[u]);return this.isDefaultPrevented=(v.defaultPrevented!=null?v.defaultPrevented:v.returnValue===!1)?Dh:h_,this.isPropagationStopped=h_,this}return Sn(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Dh)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Dh)},persist:function(){},isPersistent:Dh}),o}var kl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Wm=ci(kl),mc=Sn({},kl,{view:0,detail:0}),Ib=ci(mc),tf,nf,Au,Ad=Sn({},mc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Xm,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Au&&(Au&&n.type==="mousemove"?(tf=n.screenX-Au.screenX,nf=n.screenY-Au.screenY):nf=tf=0,Au=n),tf)},movementY:function(n){return"movementY"in n?n.movementY:nf}}),d_=ci(Ad),zb=Sn({},Ad,{dataTransfer:0}),Ab=ci(zb),Mb=Sn({},mc,{relatedTarget:0}),rf=ci(Mb),Pb=Sn({},kl,{animationName:0,elapsedTime:0,pseudoElement:0}),Db=ci(Pb),Lb=Sn({},kl,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),Rb=ci(Lb),Bb=Sn({},kl,{data:0}),p_=ci(Bb),Fb={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Ob={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Nb={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Ub(n){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(n):(n=Nb[n])?!!o[n]:!1}function Xm(){return Ub}var Vb=Sn({},mc,{key:function(n){if(n.key){var o=Fb[n.key]||n.key;if(o!=="Unidentified")return o}return n.type==="keypress"?(n=Xh(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?Ob[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Xm,charCode:function(n){return n.type==="keypress"?Xh(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?Xh(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),$b=ci(Vb),jb=Sn({},Ad,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),f_=ci(jb),Gb=Sn({},mc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Xm}),Zb=ci(Gb),qb=Sn({},kl,{propertyName:0,elapsedTime:0,pseudoElement:0}),Wb=ci(qb),Xb=Sn({},Ad,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),Hb=ci(Xb),Kb=[9,13,27,32],Hm=Ro&&"CompositionEvent"in window,Uu=null;Ro&&"documentMode"in document&&(Uu=document.documentMode);var Yb=Ro&&"TextEvent"in window&&!Uu,ix=Ro&&(!Hm||Uu&&8<Uu&&11>=Uu),m_=String.fromCharCode(32),g_=!1;function ox(n,o){switch(n){case"keyup":return Kb.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sx(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var el=!1;function Jb(n,o){switch(n){case"compositionend":return sx(o);case"keypress":return o.which!==32?null:(g_=!0,m_);case"textInput":return n=o.data,n===m_&&g_?null:n;default:return null}}function Qb(n,o){if(el)return n==="compositionend"||!Hm&&ox(n,o)?(n=rx(),Wh=qm=ps=null,el=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return ix&&o.locale!=="ko"?null:o.data;default:return null}}var e2={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function y_(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o==="input"?!!e2[n.type]:o==="textarea"}function ax(n,o,l,f){Ov(f),o=cd(o,"onChange"),0<o.length&&(l=new Wm("onChange","change",null,l,f),n.push({event:l,listeners:o}))}var Vu=null,ec=null;function t2(n){_x(n,0)}function Md(n){var o=rl(n);if(Mv(o))return n}function n2(n,o){if(n==="change")return o}var lx=!1;if(Ro){var of;if(Ro){var sf="oninput"in document;if(!sf){var __=document.createElement("div");__.setAttribute("oninput","return;"),sf=typeof __.oninput=="function"}of=sf}else of=!1;lx=of&&(!document.documentMode||9<document.documentMode)}function v_(){Vu&&(Vu.detachEvent("onpropertychange",ux),ec=Vu=null)}function ux(n){if(n.propertyName==="value"&&Md(ec)){var o=[];ax(o,ec,n,Vm(n)),$v(t2,o)}}function r2(n,o,l){n==="focusin"?(v_(),Vu=o,ec=l,Vu.attachEvent("onpropertychange",ux)):n==="focusout"&&v_()}function i2(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Md(ec)}function o2(n,o){if(n==="click")return Md(o)}function s2(n,o){if(n==="input"||n==="change")return Md(o)}function a2(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var Zi=typeof Object.is=="function"?Object.is:a2;function tc(n,o){if(Zi(n,o))return!0;if(typeof n!="object"||n===null||typeof o!="object"||o===null)return!1;var l=Object.keys(n),f=Object.keys(o);if(l.length!==f.length)return!1;for(f=0;f<l.length;f++){var _=l[f];if(!Mf.call(o,_)||!Zi(n[_],o[_]))return!1}return!0}function x_(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function w_(n,o){var l=x_(n);n=0;for(var f;l;){if(l.nodeType===3){if(f=n+l.textContent.length,n<=o&&f>=o)return{node:l,offset:o-n};n=f}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=x_(l)}}function cx(n,o){return n&&o?n===o?!0:n&&n.nodeType===3?!1:o&&o.nodeType===3?cx(n,o.parentNode):"contains"in n?n.contains(o):n.compareDocumentPosition?!!(n.compareDocumentPosition(o)&16):!1:!1}function hx(){for(var n=window,o=rd();o instanceof n.HTMLIFrameElement;){try{var l=typeof o.contentWindow.location.href=="string"}catch{l=!1}if(l)n=o.contentWindow;else break;o=rd(n.document)}return o}function Km(n){var o=n&&n.nodeName&&n.nodeName.toLowerCase();return o&&(o==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||o==="textarea"||n.contentEditable==="true")}function l2(n){var o=hx(),l=n.focusedElem,f=n.selectionRange;if(o!==l&&l&&l.ownerDocument&&cx(l.ownerDocument.documentElement,l)){if(f!==null&&Km(l)){if(o=f.start,n=f.end,n===void 0&&(n=o),"selectionStart"in l)l.selectionStart=o,l.selectionEnd=Math.min(n,l.value.length);else if(n=(o=l.ownerDocument||document)&&o.defaultView||window,n.getSelection){n=n.getSelection();var _=l.textContent.length,v=Math.min(f.start,_);f=f.end===void 0?v:Math.min(f.end,_),!n.extend&&v>f&&(_=f,f=v,v=_),_=w_(l,v);var C=w_(l,f);_&&C&&(n.rangeCount!==1||n.anchorNode!==_.node||n.anchorOffset!==_.offset||n.focusNode!==C.node||n.focusOffset!==C.offset)&&(o=o.createRange(),o.setStart(_.node,_.offset),n.removeAllRanges(),v>f?(n.addRange(o),n.extend(C.node,C.offset)):(o.setEnd(C.node,C.offset),n.addRange(o)))}}for(o=[],n=l;n=n.parentNode;)n.nodeType===1&&o.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<o.length;l++)n=o[l],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var u2=Ro&&"documentMode"in document&&11>=document.documentMode,tl=null,Kf=null,$u=null,Yf=!1;function b_(n,o,l){var f=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;Yf||tl==null||tl!==rd(f)||(f=tl,"selectionStart"in f&&Km(f)?f={start:f.selectionStart,end:f.selectionEnd}:(f=(f.ownerDocument&&f.ownerDocument.defaultView||window).getSelection(),f={anchorNode:f.anchorNode,anchorOffset:f.anchorOffset,focusNode:f.focusNode,focusOffset:f.focusOffset}),$u&&tc($u,f)||($u=f,f=cd(Kf,"onSelect"),0<f.length&&(o=new Wm("onSelect","select",null,o,l),n.push({event:o,listeners:f}),o.target=tl)))}function Lh(n,o){var l={};return l[n.toLowerCase()]=o.toLowerCase(),l["Webkit"+n]="webkit"+o,l["Moz"+n]="moz"+o,l}var nl={animationend:Lh("Animation","AnimationEnd"),animationiteration:Lh("Animation","AnimationIteration"),animationstart:Lh("Animation","AnimationStart"),transitionend:Lh("Transition","TransitionEnd")},af={},dx={};Ro&&(dx=document.createElement("div").style,"AnimationEvent"in window||(delete nl.animationend.animation,delete nl.animationiteration.animation,delete nl.animationstart.animation),"TransitionEvent"in window||delete nl.transitionend.transition);function Pd(n){if(af[n])return af[n];if(!nl[n])return n;var o=nl[n],l;for(l in o)if(o.hasOwnProperty(l)&&l in dx)return af[n]=o[l];return n}var px=Pd("animationend"),fx=Pd("animationiteration"),mx=Pd("animationstart"),gx=Pd("transitionend"),yx=new Map,S_="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cs(n,o){yx.set(n,o),_a(o,[n])}for(var lf=0;lf<S_.length;lf++){var uf=S_[lf],c2=uf.toLowerCase(),h2=uf[0].toUpperCase()+uf.slice(1);Cs(c2,"on"+h2)}Cs(px,"onAnimationEnd");Cs(fx,"onAnimationIteration");Cs(mx,"onAnimationStart");Cs("dblclick","onDoubleClick");Cs("focusin","onFocus");Cs("focusout","onBlur");Cs(gx,"onTransitionEnd");gl("onMouseEnter",["mouseout","mouseover"]);gl("onMouseLeave",["mouseout","mouseover"]);gl("onPointerEnter",["pointerout","pointerover"]);gl("onPointerLeave",["pointerout","pointerover"]);_a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));_a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));_a("onBeforeInput",["compositionend","keypress","textInput","paste"]);_a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));_a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));_a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),d2=new Set("cancel close invalid load scroll toggle".split(" ").concat(Fu));function E_(n,o,l){var f=n.type||"unknown-event";n.currentTarget=l,cb(f,o,void 0,n),n.currentTarget=null}function _x(n,o){o=(o&4)!==0;for(var l=0;l<n.length;l++){var f=n[l],_=f.event;f=f.listeners;e:{var v=void 0;if(o)for(var C=f.length-1;0<=C;C--){var u=f[C],O=u.instance,Z=u.currentTarget;if(u=u.listener,O!==v&&_.isPropagationStopped())break e;E_(_,u,Z),v=O}else for(C=0;C<f.length;C++){if(u=f[C],O=u.instance,Z=u.currentTarget,u=u.listener,O!==v&&_.isPropagationStopped())break e;E_(_,u,Z),v=O}}}if(od)throw n=qf,od=!1,qf=null,n}function hn(n,o){var l=o[nm];l===void 0&&(l=o[nm]=new Set);var f=n+"__bubble";l.has(f)||(vx(o,n,2,!1),l.add(f))}function cf(n,o,l){var f=0;o&&(f|=4),vx(l,n,f,o)}var Rh="_reactListening"+Math.random().toString(36).slice(2);function nc(n){if(!n[Rh]){n[Rh]=!0,kv.forEach(function(l){l!=="selectionchange"&&(d2.has(l)||cf(l,!1,n),cf(l,!0,n))});var o=n.nodeType===9?n:n.ownerDocument;o===null||o[Rh]||(o[Rh]=!0,cf("selectionchange",!1,o))}}function vx(n,o,l,f){switch(nx(o)){case 1:var _=kb;break;case 4:_=Cb;break;default:_=Zm}l=_.bind(null,o,l,n),_=void 0,!Zf||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(_=!0),f?_!==void 0?n.addEventListener(o,l,{capture:!0,passive:_}):n.addEventListener(o,l,!0):_!==void 0?n.addEventListener(o,l,{passive:_}):n.addEventListener(o,l,!1)}function hf(n,o,l,f,_){var v=f;if(!(o&1)&&!(o&2)&&f!==null)e:for(;;){if(f===null)return;var C=f.tag;if(C===3||C===4){var u=f.stateNode.containerInfo;if(u===_||u.nodeType===8&&u.parentNode===_)break;if(C===4)for(C=f.return;C!==null;){var O=C.tag;if((O===3||O===4)&&(O=C.stateNode.containerInfo,O===_||O.nodeType===8&&O.parentNode===_))return;C=C.return}for(;u!==null;){if(C=la(u),C===null)return;if(O=C.tag,O===5||O===6){f=v=C;continue e}u=u.parentNode}}f=f.return}$v(function(){var Z=v,ue=Vm(l),te=[];e:{var q=yx.get(n);if(q!==void 0){var Ae=Wm,Ce=n;switch(n){case"keypress":if(Xh(l)===0)break e;case"keydown":case"keyup":Ae=$b;break;case"focusin":Ce="focus",Ae=rf;break;case"focusout":Ce="blur",Ae=rf;break;case"beforeblur":case"afterblur":Ae=rf;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ae=d_;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ae=Ab;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ae=Zb;break;case px:case fx:case mx:Ae=Db;break;case gx:Ae=Wb;break;case"scroll":Ae=Ib;break;case"wheel":Ae=Hb;break;case"copy":case"cut":case"paste":Ae=Rb;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ae=f_}var we=(o&4)!==0,xt=!we&&n==="scroll",se=we?q!==null?q+"Capture":null:q;we=[];for(var Q=Z,ae;Q!==null;){ae=Q;var ke=ae.stateNode;if(ae.tag===5&&ke!==null&&(ae=ke,se!==null&&(ke=Ku(Q,se),ke!=null&&we.push(rc(Q,ke,ae)))),xt)break;Q=Q.return}0<we.length&&(q=new Ae(q,Ce,null,l,ue),te.push({event:q,listeners:we}))}}if(!(o&7)){e:{if(q=n==="mouseover"||n==="pointerover",Ae=n==="mouseout"||n==="pointerout",q&&l!==jf&&(Ce=l.relatedTarget||l.fromElement)&&(la(Ce)||Ce[Bo]))break e;if((Ae||q)&&(q=ue.window===ue?ue:(q=ue.ownerDocument)?q.defaultView||q.parentWindow:window,Ae?(Ce=l.relatedTarget||l.toElement,Ae=Z,Ce=Ce?la(Ce):null,Ce!==null&&(xt=va(Ce),Ce!==xt||Ce.tag!==5&&Ce.tag!==6)&&(Ce=null)):(Ae=null,Ce=Z),Ae!==Ce)){if(we=d_,ke="onMouseLeave",se="onMouseEnter",Q="mouse",(n==="pointerout"||n==="pointerover")&&(we=f_,ke="onPointerLeave",se="onPointerEnter",Q="pointer"),xt=Ae==null?q:rl(Ae),ae=Ce==null?q:rl(Ce),q=new we(ke,Q+"leave",Ae,l,ue),q.target=xt,q.relatedTarget=ae,ke=null,la(ue)===Z&&(we=new we(se,Q+"enter",Ce,l,ue),we.target=ae,we.relatedTarget=xt,ke=we),xt=ke,Ae&&Ce)t:{for(we=Ae,se=Ce,Q=0,ae=we;ae;ae=Ya(ae))Q++;for(ae=0,ke=se;ke;ke=Ya(ke))ae++;for(;0<Q-ae;)we=Ya(we),Q--;for(;0<ae-Q;)se=Ya(se),ae--;for(;Q--;){if(we===se||se!==null&&we===se.alternate)break t;we=Ya(we),se=Ya(se)}we=null}else we=null;Ae!==null&&T_(te,q,Ae,we,!1),Ce!==null&&xt!==null&&T_(te,xt,Ce,we,!0)}}e:{if(q=Z?rl(Z):window,Ae=q.nodeName&&q.nodeName.toLowerCase(),Ae==="select"||Ae==="input"&&q.type==="file")var Me=n2;else if(y_(q))if(lx)Me=s2;else{Me=i2;var ze=r2}else(Ae=q.nodeName)&&Ae.toLowerCase()==="input"&&(q.type==="checkbox"||q.type==="radio")&&(Me=o2);if(Me&&(Me=Me(n,Z))){ax(te,Me,l,ue);break e}ze&&ze(n,q,Z),n==="focusout"&&(ze=q._wrapperState)&&ze.controlled&&q.type==="number"&&Of(q,"number",q.value)}switch(ze=Z?rl(Z):window,n){case"focusin":(y_(ze)||ze.contentEditable==="true")&&(tl=ze,Kf=Z,$u=null);break;case"focusout":$u=Kf=tl=null;break;case"mousedown":Yf=!0;break;case"contextmenu":case"mouseup":case"dragend":Yf=!1,b_(te,l,ue);break;case"selectionchange":if(u2)break;case"keydown":case"keyup":b_(te,l,ue)}var je;if(Hm)e:{switch(n){case"compositionstart":var He="onCompositionStart";break e;case"compositionend":He="onCompositionEnd";break e;case"compositionupdate":He="onCompositionUpdate";break e}He=void 0}else el?ox(n,l)&&(He="onCompositionEnd"):n==="keydown"&&l.keyCode===229&&(He="onCompositionStart");He&&(ix&&l.locale!=="ko"&&(el||He!=="onCompositionStart"?He==="onCompositionEnd"&&el&&(je=rx()):(ps=ue,qm="value"in ps?ps.value:ps.textContent,el=!0)),ze=cd(Z,He),0<ze.length&&(He=new p_(He,n,null,l,ue),te.push({event:He,listeners:ze}),je?He.data=je:(je=sx(l),je!==null&&(He.data=je)))),(je=Yb?Jb(n,l):Qb(n,l))&&(Z=cd(Z,"onBeforeInput"),0<Z.length&&(ue=new p_("onBeforeInput","beforeinput",null,l,ue),te.push({event:ue,listeners:Z}),ue.data=je))}_x(te,o)})}function rc(n,o,l){return{instance:n,listener:o,currentTarget:l}}function cd(n,o){for(var l=o+"Capture",f=[];n!==null;){var _=n,v=_.stateNode;_.tag===5&&v!==null&&(_=v,v=Ku(n,l),v!=null&&f.unshift(rc(n,v,_)),v=Ku(n,o),v!=null&&f.push(rc(n,v,_))),n=n.return}return f}function Ya(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function T_(n,o,l,f,_){for(var v=o._reactName,C=[];l!==null&&l!==f;){var u=l,O=u.alternate,Z=u.stateNode;if(O!==null&&O===f)break;u.tag===5&&Z!==null&&(u=Z,_?(O=Ku(l,v),O!=null&&C.unshift(rc(l,O,u))):_||(O=Ku(l,v),O!=null&&C.push(rc(l,O,u)))),l=l.return}C.length!==0&&n.push({event:o,listeners:C})}var p2=/\r\n?/g,f2=/\u0000|\uFFFD/g;function k_(n){return(typeof n=="string"?n:""+n).replace(p2,`
`).replace(f2,"")}function Bh(n,o,l){if(o=k_(o),k_(n)!==o&&l)throw Error(Pe(425))}function hd(){}var Jf=null,Qf=null;function em(n,o){return n==="textarea"||n==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var tm=typeof setTimeout=="function"?setTimeout:void 0,m2=typeof clearTimeout=="function"?clearTimeout:void 0,C_=typeof Promise=="function"?Promise:void 0,g2=typeof queueMicrotask=="function"?queueMicrotask:typeof C_<"u"?function(n){return C_.resolve(null).then(n).catch(y2)}:tm;function y2(n){setTimeout(function(){throw n})}function df(n,o){var l=o,f=0;do{var _=l.nextSibling;if(n.removeChild(l),_&&_.nodeType===8)if(l=_.data,l==="/$"){if(f===0){n.removeChild(_),Qu(o);return}f--}else l!=="$"&&l!=="$?"&&l!=="$!"||f++;l=_}while(l);Qu(o)}function vs(n){for(;n!=null;n=n.nextSibling){var o=n.nodeType;if(o===1||o===3)break;if(o===8){if(o=n.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return n}function I_(n){n=n.previousSibling;for(var o=0;n;){if(n.nodeType===8){var l=n.data;if(l==="$"||l==="$!"||l==="$?"){if(o===0)return n;o--}else l==="/$"&&o++}n=n.previousSibling}return null}var Cl=Math.random().toString(36).slice(2),so="__reactFiber$"+Cl,ic="__reactProps$"+Cl,Bo="__reactContainer$"+Cl,nm="__reactEvents$"+Cl,_2="__reactListeners$"+Cl,v2="__reactHandles$"+Cl;function la(n){var o=n[so];if(o)return o;for(var l=n.parentNode;l;){if(o=l[Bo]||l[so]){if(l=o.alternate,o.child!==null||l!==null&&l.child!==null)for(n=I_(n);n!==null;){if(l=n[so])return l;n=I_(n)}return o}n=l,l=n.parentNode}return null}function gc(n){return n=n[so]||n[Bo],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function rl(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error(Pe(33))}function Dd(n){return n[ic]||null}var rm=[],il=-1;function Is(n){return{current:n}}function dn(n){0>il||(n.current=rm[il],rm[il]=null,il--)}function ln(n,o){il++,rm[il]=n.current,n.current=o}var Ts={},Er=Is(Ts),Xr=Is(!1),pa=Ts;function yl(n,o){var l=n.type.contextTypes;if(!l)return Ts;var f=n.stateNode;if(f&&f.__reactInternalMemoizedUnmaskedChildContext===o)return f.__reactInternalMemoizedMaskedChildContext;var _={},v;for(v in l)_[v]=o[v];return f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=o,n.__reactInternalMemoizedMaskedChildContext=_),_}function Hr(n){return n=n.childContextTypes,n!=null}function dd(){dn(Xr),dn(Er)}function z_(n,o,l){if(Er.current!==Ts)throw Error(Pe(168));ln(Er,o),ln(Xr,l)}function xx(n,o,l){var f=n.stateNode;if(o=o.childContextTypes,typeof f.getChildContext!="function")return l;f=f.getChildContext();for(var _ in f)if(!(_ in o))throw Error(Pe(108,rb(n)||"Unknown",_));return Sn({},l,f)}function pd(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Ts,pa=Er.current,ln(Er,n),ln(Xr,Xr.current),!0}function A_(n,o,l){var f=n.stateNode;if(!f)throw Error(Pe(169));l?(n=xx(n,o,pa),f.__reactInternalMemoizedMergedChildContext=n,dn(Xr),dn(Er),ln(Er,n)):dn(Xr),ln(Xr,l)}var zo=null,Ld=!1,pf=!1;function wx(n){zo===null?zo=[n]:zo.push(n)}function x2(n){Ld=!0,wx(n)}function zs(){if(!pf&&zo!==null){pf=!0;var n=0,o=Ht;try{var l=zo;for(Ht=1;n<l.length;n++){var f=l[n];do f=f(!0);while(f!==null)}zo=null,Ld=!1}catch(_){throw zo!==null&&(zo=zo.slice(n+1)),qv($m,zs),_}finally{Ht=o,pf=!1}}return null}var ol=[],sl=0,fd=null,md=0,_i=[],vi=0,fa=null,Po=1,Do="";function sa(n,o){ol[sl++]=md,ol[sl++]=fd,fd=n,md=o}function bx(n,o,l){_i[vi++]=Po,_i[vi++]=Do,_i[vi++]=fa,fa=n;var f=Po;n=Do;var _=32-ji(f)-1;f&=~(1<<_),l+=1;var v=32-ji(o)+_;if(30<v){var C=_-_%5;v=(f&(1<<C)-1).toString(32),f>>=C,_-=C,Po=1<<32-ji(o)+_|l<<_|f,Do=v+n}else Po=1<<v|l<<_|f,Do=n}function Ym(n){n.return!==null&&(sa(n,1),bx(n,1,0))}function Jm(n){for(;n===fd;)fd=ol[--sl],ol[sl]=null,md=ol[--sl],ol[sl]=null;for(;n===fa;)fa=_i[--vi],_i[vi]=null,Do=_i[--vi],_i[vi]=null,Po=_i[--vi],_i[vi]=null}var ai=null,si=null,gn=!1,Ui=null;function Sx(n,o){var l=wi(5,null,null,0);l.elementType="DELETED",l.stateNode=o,l.return=n,o=n.deletions,o===null?(n.deletions=[l],n.flags|=16):o.push(l)}function M_(n,o){switch(n.tag){case 5:var l=n.type;return o=o.nodeType!==1||l.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(n.stateNode=o,ai=n,si=vs(o.firstChild),!0):!1;case 6:return o=n.pendingProps===""||o.nodeType!==3?null:o,o!==null?(n.stateNode=o,ai=n,si=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(l=fa!==null?{id:Po,overflow:Do}:null,n.memoizedState={dehydrated:o,treeContext:l,retryLane:1073741824},l=wi(18,null,null,0),l.stateNode=o,l.return=n,n.child=l,ai=n,si=null,!0):!1;default:return!1}}function im(n){return(n.mode&1)!==0&&(n.flags&128)===0}function om(n){if(gn){var o=si;if(o){var l=o;if(!M_(n,o)){if(im(n))throw Error(Pe(418));o=vs(l.nextSibling);var f=ai;o&&M_(n,o)?Sx(f,l):(n.flags=n.flags&-4097|2,gn=!1,ai=n)}}else{if(im(n))throw Error(Pe(418));n.flags=n.flags&-4097|2,gn=!1,ai=n}}}function P_(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;ai=n}function Fh(n){if(n!==ai)return!1;if(!gn)return P_(n),gn=!0,!1;var o;if((o=n.tag!==3)&&!(o=n.tag!==5)&&(o=n.type,o=o!=="head"&&o!=="body"&&!em(n.type,n.memoizedProps)),o&&(o=si)){if(im(n))throw Ex(),Error(Pe(418));for(;o;)Sx(n,o),o=vs(o.nextSibling)}if(P_(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error(Pe(317));e:{for(n=n.nextSibling,o=0;n;){if(n.nodeType===8){var l=n.data;if(l==="/$"){if(o===0){si=vs(n.nextSibling);break e}o--}else l!=="$"&&l!=="$!"&&l!=="$?"||o++}n=n.nextSibling}si=null}}else si=ai?vs(n.stateNode.nextSibling):null;return!0}function Ex(){for(var n=si;n;)n=vs(n.nextSibling)}function _l(){si=ai=null,gn=!1}function Qm(n){Ui===null?Ui=[n]:Ui.push(n)}var w2=No.ReactCurrentBatchConfig;function Oi(n,o){if(n&&n.defaultProps){o=Sn({},o),n=n.defaultProps;for(var l in n)o[l]===void 0&&(o[l]=n[l]);return o}return o}var gd=Is(null),yd=null,al=null,eg=null;function tg(){eg=al=yd=null}function ng(n){var o=gd.current;dn(gd),n._currentValue=o}function sm(n,o,l){for(;n!==null;){var f=n.alternate;if((n.childLanes&o)!==o?(n.childLanes|=o,f!==null&&(f.childLanes|=o)):f!==null&&(f.childLanes&o)!==o&&(f.childLanes|=o),n===l)break;n=n.return}}function fl(n,o){yd=n,eg=al=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&o&&(Wr=!0),n.firstContext=null)}function Si(n){var o=n._currentValue;if(eg!==n)if(n={context:n,memoizedValue:o,next:null},al===null){if(yd===null)throw Error(Pe(308));al=n,yd.dependencies={lanes:0,firstContext:n}}else al=al.next=n;return o}var ua=null;function rg(n){ua===null?ua=[n]:ua.push(n)}function Tx(n,o,l,f){var _=o.interleaved;return _===null?(l.next=l,rg(o)):(l.next=_.next,_.next=l),o.interleaved=l,Fo(n,f)}function Fo(n,o){n.lanes|=o;var l=n.alternate;for(l!==null&&(l.lanes|=o),l=n,n=n.return;n!==null;)n.childLanes|=o,l=n.alternate,l!==null&&(l.childLanes|=o),l=n,n=n.return;return l.tag===3?l.stateNode:null}var cs=!1;function ig(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function kx(n,o){n=n.updateQueue,o.updateQueue===n&&(o.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function Lo(n,o){return{eventTime:n,lane:o,tag:0,payload:null,callback:null,next:null}}function xs(n,o,l){var f=n.updateQueue;if(f===null)return null;if(f=f.shared,Nt&2){var _=f.pending;return _===null?o.next=o:(o.next=_.next,_.next=o),f.pending=o,Fo(n,l)}return _=f.interleaved,_===null?(o.next=o,rg(f)):(o.next=_.next,_.next=o),f.interleaved=o,Fo(n,l)}function Hh(n,o,l){if(o=o.updateQueue,o!==null&&(o=o.shared,(l&4194240)!==0)){var f=o.lanes;f&=n.pendingLanes,l|=f,o.lanes=l,jm(n,l)}}function D_(n,o){var l=n.updateQueue,f=n.alternate;if(f!==null&&(f=f.updateQueue,l===f)){var _=null,v=null;if(l=l.firstBaseUpdate,l!==null){do{var C={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};v===null?_=v=C:v=v.next=C,l=l.next}while(l!==null);v===null?_=v=o:v=v.next=o}else _=v=o;l={baseState:f.baseState,firstBaseUpdate:_,lastBaseUpdate:v,shared:f.shared,effects:f.effects},n.updateQueue=l;return}n=l.lastBaseUpdate,n===null?l.firstBaseUpdate=o:n.next=o,l.lastBaseUpdate=o}function _d(n,o,l,f){var _=n.updateQueue;cs=!1;var v=_.firstBaseUpdate,C=_.lastBaseUpdate,u=_.shared.pending;if(u!==null){_.shared.pending=null;var O=u,Z=O.next;O.next=null,C===null?v=Z:C.next=Z,C=O;var ue=n.alternate;ue!==null&&(ue=ue.updateQueue,u=ue.lastBaseUpdate,u!==C&&(u===null?ue.firstBaseUpdate=Z:u.next=Z,ue.lastBaseUpdate=O))}if(v!==null){var te=_.baseState;C=0,ue=Z=O=null,u=v;do{var q=u.lane,Ae=u.eventTime;if((f&q)===q){ue!==null&&(ue=ue.next={eventTime:Ae,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var Ce=n,we=u;switch(q=o,Ae=l,we.tag){case 1:if(Ce=we.payload,typeof Ce=="function"){te=Ce.call(Ae,te,q);break e}te=Ce;break e;case 3:Ce.flags=Ce.flags&-65537|128;case 0:if(Ce=we.payload,q=typeof Ce=="function"?Ce.call(Ae,te,q):Ce,q==null)break e;te=Sn({},te,q);break e;case 2:cs=!0}}u.callback!==null&&u.lane!==0&&(n.flags|=64,q=_.effects,q===null?_.effects=[u]:q.push(u))}else Ae={eventTime:Ae,lane:q,tag:u.tag,payload:u.payload,callback:u.callback,next:null},ue===null?(Z=ue=Ae,O=te):ue=ue.next=Ae,C|=q;if(u=u.next,u===null){if(u=_.shared.pending,u===null)break;q=u,u=q.next,q.next=null,_.lastBaseUpdate=q,_.shared.pending=null}}while(1);if(ue===null&&(O=te),_.baseState=O,_.firstBaseUpdate=Z,_.lastBaseUpdate=ue,o=_.shared.interleaved,o!==null){_=o;do C|=_.lane,_=_.next;while(_!==o)}else v===null&&(_.shared.lanes=0);ga|=C,n.lanes=C,n.memoizedState=te}}function L_(n,o,l){if(n=o.effects,o.effects=null,n!==null)for(o=0;o<n.length;o++){var f=n[o],_=f.callback;if(_!==null){if(f.callback=null,f=l,typeof _!="function")throw Error(Pe(191,_));_.call(f)}}}var Cx=new Tv.Component().refs;function am(n,o,l,f){o=n.memoizedState,l=l(f,o),l=l==null?o:Sn({},o,l),n.memoizedState=l,n.lanes===0&&(n.updateQueue.baseState=l)}var Rd={isMounted:function(n){return(n=n._reactInternals)?va(n)===n:!1},enqueueSetState:function(n,o,l){n=n._reactInternals;var f=Br(),_=bs(n),v=Lo(f,_);v.payload=o,l!=null&&(v.callback=l),o=xs(n,v,_),o!==null&&(Gi(o,n,_,f),Hh(o,n,_))},enqueueReplaceState:function(n,o,l){n=n._reactInternals;var f=Br(),_=bs(n),v=Lo(f,_);v.tag=1,v.payload=o,l!=null&&(v.callback=l),o=xs(n,v,_),o!==null&&(Gi(o,n,_,f),Hh(o,n,_))},enqueueForceUpdate:function(n,o){n=n._reactInternals;var l=Br(),f=bs(n),_=Lo(l,f);_.tag=2,o!=null&&(_.callback=o),o=xs(n,_,f),o!==null&&(Gi(o,n,f,l),Hh(o,n,f))}};function R_(n,o,l,f,_,v,C){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(f,v,C):o.prototype&&o.prototype.isPureReactComponent?!tc(l,f)||!tc(_,v):!0}function Ix(n,o,l){var f=!1,_=Ts,v=o.contextType;return typeof v=="object"&&v!==null?v=Si(v):(_=Hr(o)?pa:Er.current,f=o.contextTypes,v=(f=f!=null)?yl(n,_):Ts),o=new o(l,v),n.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Rd,n.stateNode=o,o._reactInternals=n,f&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=_,n.__reactInternalMemoizedMaskedChildContext=v),o}function B_(n,o,l,f){n=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(l,f),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(l,f),o.state!==n&&Rd.enqueueReplaceState(o,o.state,null)}function lm(n,o,l,f){var _=n.stateNode;_.props=l,_.state=n.memoizedState,_.refs=Cx,ig(n);var v=o.contextType;typeof v=="object"&&v!==null?_.context=Si(v):(v=Hr(o)?pa:Er.current,_.context=yl(n,v)),_.state=n.memoizedState,v=o.getDerivedStateFromProps,typeof v=="function"&&(am(n,o,v,l),_.state=n.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof _.getSnapshotBeforeUpdate=="function"||typeof _.UNSAFE_componentWillMount!="function"&&typeof _.componentWillMount!="function"||(o=_.state,typeof _.componentWillMount=="function"&&_.componentWillMount(),typeof _.UNSAFE_componentWillMount=="function"&&_.UNSAFE_componentWillMount(),o!==_.state&&Rd.enqueueReplaceState(_,_.state,null),_d(n,l,_,f),_.state=n.memoizedState),typeof _.componentDidMount=="function"&&(n.flags|=4194308)}function Mu(n,o,l){if(n=l.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(Pe(309));var f=l.stateNode}if(!f)throw Error(Pe(147,n));var _=f,v=""+n;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===v?o.ref:(o=function(C){var u=_.refs;u===Cx&&(u=_.refs={}),C===null?delete u[v]:u[v]=C},o._stringRef=v,o)}if(typeof n!="string")throw Error(Pe(284));if(!l._owner)throw Error(Pe(290,n))}return n}function Oh(n,o){throw n=Object.prototype.toString.call(o),Error(Pe(31,n==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":n))}function F_(n){var o=n._init;return o(n._payload)}function zx(n){function o(se,Q){if(n){var ae=se.deletions;ae===null?(se.deletions=[Q],se.flags|=16):ae.push(Q)}}function l(se,Q){if(!n)return null;for(;Q!==null;)o(se,Q),Q=Q.sibling;return null}function f(se,Q){for(se=new Map;Q!==null;)Q.key!==null?se.set(Q.key,Q):se.set(Q.index,Q),Q=Q.sibling;return se}function _(se,Q){return se=Ss(se,Q),se.index=0,se.sibling=null,se}function v(se,Q,ae){return se.index=ae,n?(ae=se.alternate,ae!==null?(ae=ae.index,ae<Q?(se.flags|=2,Q):ae):(se.flags|=2,Q)):(se.flags|=1048576,Q)}function C(se){return n&&se.alternate===null&&(se.flags|=2),se}function u(se,Q,ae,ke){return Q===null||Q.tag!==6?(Q=xf(ae,se.mode,ke),Q.return=se,Q):(Q=_(Q,ae),Q.return=se,Q)}function O(se,Q,ae,ke){var Me=ae.type;return Me===Qa?ue(se,Q,ae.props.children,ke,ae.key):Q!==null&&(Q.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===us&&F_(Me)===Q.type)?(ke=_(Q,ae.props),ke.ref=Mu(se,Q,ae),ke.return=se,ke):(ke=td(ae.type,ae.key,ae.props,null,se.mode,ke),ke.ref=Mu(se,Q,ae),ke.return=se,ke)}function Z(se,Q,ae,ke){return Q===null||Q.tag!==4||Q.stateNode.containerInfo!==ae.containerInfo||Q.stateNode.implementation!==ae.implementation?(Q=wf(ae,se.mode,ke),Q.return=se,Q):(Q=_(Q,ae.children||[]),Q.return=se,Q)}function ue(se,Q,ae,ke,Me){return Q===null||Q.tag!==7?(Q=da(ae,se.mode,ke,Me),Q.return=se,Q):(Q=_(Q,ae),Q.return=se,Q)}function te(se,Q,ae){if(typeof Q=="string"&&Q!==""||typeof Q=="number")return Q=xf(""+Q,se.mode,ae),Q.return=se,Q;if(typeof Q=="object"&&Q!==null){switch(Q.$$typeof){case Ch:return ae=td(Q.type,Q.key,Q.props,null,se.mode,ae),ae.ref=Mu(se,null,Q),ae.return=se,ae;case Ja:return Q=wf(Q,se.mode,ae),Q.return=se,Q;case us:var ke=Q._init;return te(se,ke(Q._payload),ae)}if(Ru(Q)||ku(Q))return Q=da(Q,se.mode,ae,null),Q.return=se,Q;Oh(se,Q)}return null}function q(se,Q,ae,ke){var Me=Q!==null?Q.key:null;if(typeof ae=="string"&&ae!==""||typeof ae=="number")return Me!==null?null:u(se,Q,""+ae,ke);if(typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case Ch:return ae.key===Me?O(se,Q,ae,ke):null;case Ja:return ae.key===Me?Z(se,Q,ae,ke):null;case us:return Me=ae._init,q(se,Q,Me(ae._payload),ke)}if(Ru(ae)||ku(ae))return Me!==null?null:ue(se,Q,ae,ke,null);Oh(se,ae)}return null}function Ae(se,Q,ae,ke,Me){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return se=se.get(ae)||null,u(Q,se,""+ke,Me);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case Ch:return se=se.get(ke.key===null?ae:ke.key)||null,O(Q,se,ke,Me);case Ja:return se=se.get(ke.key===null?ae:ke.key)||null,Z(Q,se,ke,Me);case us:var ze=ke._init;return Ae(se,Q,ae,ze(ke._payload),Me)}if(Ru(ke)||ku(ke))return se=se.get(ae)||null,ue(Q,se,ke,Me,null);Oh(Q,ke)}return null}function Ce(se,Q,ae,ke){for(var Me=null,ze=null,je=Q,He=Q=0,Mt=null;je!==null&&He<ae.length;He++){je.index>He?(Mt=je,je=null):Mt=je.sibling;var ht=q(se,je,ae[He],ke);if(ht===null){je===null&&(je=Mt);break}n&&je&&ht.alternate===null&&o(se,je),Q=v(ht,Q,He),ze===null?Me=ht:ze.sibling=ht,ze=ht,je=Mt}if(He===ae.length)return l(se,je),gn&&sa(se,He),Me;if(je===null){for(;He<ae.length;He++)je=te(se,ae[He],ke),je!==null&&(Q=v(je,Q,He),ze===null?Me=je:ze.sibling=je,ze=je);return gn&&sa(se,He),Me}for(je=f(se,je);He<ae.length;He++)Mt=Ae(je,se,He,ae[He],ke),Mt!==null&&(n&&Mt.alternate!==null&&je.delete(Mt.key===null?He:Mt.key),Q=v(Mt,Q,He),ze===null?Me=Mt:ze.sibling=Mt,ze=Mt);return n&&je.forEach(function(Wt){return o(se,Wt)}),gn&&sa(se,He),Me}function we(se,Q,ae,ke){var Me=ku(ae);if(typeof Me!="function")throw Error(Pe(150));if(ae=Me.call(ae),ae==null)throw Error(Pe(151));for(var ze=Me=null,je=Q,He=Q=0,Mt=null,ht=ae.next();je!==null&&!ht.done;He++,ht=ae.next()){je.index>He?(Mt=je,je=null):Mt=je.sibling;var Wt=q(se,je,ht.value,ke);if(Wt===null){je===null&&(je=Mt);break}n&&je&&Wt.alternate===null&&o(se,je),Q=v(Wt,Q,He),ze===null?Me=Wt:ze.sibling=Wt,ze=Wt,je=Mt}if(ht.done)return l(se,je),gn&&sa(se,He),Me;if(je===null){for(;!ht.done;He++,ht=ae.next())ht=te(se,ht.value,ke),ht!==null&&(Q=v(ht,Q,He),ze===null?Me=ht:ze.sibling=ht,ze=ht);return gn&&sa(se,He),Me}for(je=f(se,je);!ht.done;He++,ht=ae.next())ht=Ae(je,se,He,ht.value,ke),ht!==null&&(n&&ht.alternate!==null&&je.delete(ht.key===null?He:ht.key),Q=v(ht,Q,He),ze===null?Me=ht:ze.sibling=ht,ze=ht);return n&&je.forEach(function(En){return o(se,En)}),gn&&sa(se,He),Me}function xt(se,Q,ae,ke){if(typeof ae=="object"&&ae!==null&&ae.type===Qa&&ae.key===null&&(ae=ae.props.children),typeof ae=="object"&&ae!==null){switch(ae.$$typeof){case Ch:e:{for(var Me=ae.key,ze=Q;ze!==null;){if(ze.key===Me){if(Me=ae.type,Me===Qa){if(ze.tag===7){l(se,ze.sibling),Q=_(ze,ae.props.children),Q.return=se,se=Q;break e}}else if(ze.elementType===Me||typeof Me=="object"&&Me!==null&&Me.$$typeof===us&&F_(Me)===ze.type){l(se,ze.sibling),Q=_(ze,ae.props),Q.ref=Mu(se,ze,ae),Q.return=se,se=Q;break e}l(se,ze);break}else o(se,ze);ze=ze.sibling}ae.type===Qa?(Q=da(ae.props.children,se.mode,ke,ae.key),Q.return=se,se=Q):(ke=td(ae.type,ae.key,ae.props,null,se.mode,ke),ke.ref=Mu(se,Q,ae),ke.return=se,se=ke)}return C(se);case Ja:e:{for(ze=ae.key;Q!==null;){if(Q.key===ze)if(Q.tag===4&&Q.stateNode.containerInfo===ae.containerInfo&&Q.stateNode.implementation===ae.implementation){l(se,Q.sibling),Q=_(Q,ae.children||[]),Q.return=se,se=Q;break e}else{l(se,Q);break}else o(se,Q);Q=Q.sibling}Q=wf(ae,se.mode,ke),Q.return=se,se=Q}return C(se);case us:return ze=ae._init,xt(se,Q,ze(ae._payload),ke)}if(Ru(ae))return Ce(se,Q,ae,ke);if(ku(ae))return we(se,Q,ae,ke);Oh(se,ae)}return typeof ae=="string"&&ae!==""||typeof ae=="number"?(ae=""+ae,Q!==null&&Q.tag===6?(l(se,Q.sibling),Q=_(Q,ae),Q.return=se,se=Q):(l(se,Q),Q=xf(ae,se.mode,ke),Q.return=se,se=Q),C(se)):l(se,Q)}return xt}var vl=zx(!0),Ax=zx(!1),yc={},lo=Is(yc),oc=Is(yc),sc=Is(yc);function ca(n){if(n===yc)throw Error(Pe(174));return n}function og(n,o){switch(ln(sc,o),ln(oc,n),ln(lo,yc),n=o.nodeType,n){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Uf(null,"");break;default:n=n===8?o.parentNode:o,o=n.namespaceURI||null,n=n.tagName,o=Uf(o,n)}dn(lo),ln(lo,o)}function xl(){dn(lo),dn(oc),dn(sc)}function Mx(n){ca(sc.current);var o=ca(lo.current),l=Uf(o,n.type);o!==l&&(ln(oc,n),ln(lo,l))}function sg(n){oc.current===n&&(dn(lo),dn(oc))}var wn=Is(0);function vd(n){for(var o=n;o!==null;){if(o.tag===13){var l=o.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if(o.flags&128)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var ff=[];function ag(){for(var n=0;n<ff.length;n++)ff[n]._workInProgressVersionPrimary=null;ff.length=0}var Kh=No.ReactCurrentDispatcher,mf=No.ReactCurrentBatchConfig,ma=0,bn=null,Xn=null,ir=null,xd=!1,ju=!1,ac=0,b2=0;function wr(){throw Error(Pe(321))}function lg(n,o){if(o===null)return!1;for(var l=0;l<o.length&&l<n.length;l++)if(!Zi(n[l],o[l]))return!1;return!0}function ug(n,o,l,f,_,v){if(ma=v,bn=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Kh.current=n===null||n.memoizedState===null?k2:C2,n=l(f,_),ju){v=0;do{if(ju=!1,ac=0,25<=v)throw Error(Pe(301));v+=1,ir=Xn=null,o.updateQueue=null,Kh.current=I2,n=l(f,_)}while(ju)}if(Kh.current=wd,o=Xn!==null&&Xn.next!==null,ma=0,ir=Xn=bn=null,xd=!1,o)throw Error(Pe(300));return n}function cg(){var n=ac!==0;return ac=0,n}function oo(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ir===null?bn.memoizedState=ir=n:ir=ir.next=n,ir}function Ei(){if(Xn===null){var n=bn.alternate;n=n!==null?n.memoizedState:null}else n=Xn.next;var o=ir===null?bn.memoizedState:ir.next;if(o!==null)ir=o,Xn=n;else{if(n===null)throw Error(Pe(310));Xn=n,n={memoizedState:Xn.memoizedState,baseState:Xn.baseState,baseQueue:Xn.baseQueue,queue:Xn.queue,next:null},ir===null?bn.memoizedState=ir=n:ir=ir.next=n}return ir}function lc(n,o){return typeof o=="function"?o(n):o}function gf(n){var o=Ei(),l=o.queue;if(l===null)throw Error(Pe(311));l.lastRenderedReducer=n;var f=Xn,_=f.baseQueue,v=l.pending;if(v!==null){if(_!==null){var C=_.next;_.next=v.next,v.next=C}f.baseQueue=_=v,l.pending=null}if(_!==null){v=_.next,f=f.baseState;var u=C=null,O=null,Z=v;do{var ue=Z.lane;if((ma&ue)===ue)O!==null&&(O=O.next={lane:0,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null}),f=Z.hasEagerState?Z.eagerState:n(f,Z.action);else{var te={lane:ue,action:Z.action,hasEagerState:Z.hasEagerState,eagerState:Z.eagerState,next:null};O===null?(u=O=te,C=f):O=O.next=te,bn.lanes|=ue,ga|=ue}Z=Z.next}while(Z!==null&&Z!==v);O===null?C=f:O.next=u,Zi(f,o.memoizedState)||(Wr=!0),o.memoizedState=f,o.baseState=C,o.baseQueue=O,l.lastRenderedState=f}if(n=l.interleaved,n!==null){_=n;do v=_.lane,bn.lanes|=v,ga|=v,_=_.next;while(_!==n)}else _===null&&(l.lanes=0);return[o.memoizedState,l.dispatch]}function yf(n){var o=Ei(),l=o.queue;if(l===null)throw Error(Pe(311));l.lastRenderedReducer=n;var f=l.dispatch,_=l.pending,v=o.memoizedState;if(_!==null){l.pending=null;var C=_=_.next;do v=n(v,C.action),C=C.next;while(C!==_);Zi(v,o.memoizedState)||(Wr=!0),o.memoizedState=v,o.baseQueue===null&&(o.baseState=v),l.lastRenderedState=v}return[v,f]}function Px(){}function Dx(n,o){var l=bn,f=Ei(),_=o(),v=!Zi(f.memoizedState,_);if(v&&(f.memoizedState=_,Wr=!0),f=f.queue,hg(Bx.bind(null,l,f,n),[n]),f.getSnapshot!==o||v||ir!==null&&ir.memoizedState.tag&1){if(l.flags|=2048,uc(9,Rx.bind(null,l,f,_,o),void 0,null),or===null)throw Error(Pe(349));ma&30||Lx(l,o,_)}return _}function Lx(n,o,l){n.flags|=16384,n={getSnapshot:o,value:l},o=bn.updateQueue,o===null?(o={lastEffect:null,stores:null},bn.updateQueue=o,o.stores=[n]):(l=o.stores,l===null?o.stores=[n]:l.push(n))}function Rx(n,o,l,f){o.value=l,o.getSnapshot=f,Fx(o)&&Ox(n)}function Bx(n,o,l){return l(function(){Fx(o)&&Ox(n)})}function Fx(n){var o=n.getSnapshot;n=n.value;try{var l=o();return!Zi(n,l)}catch{return!0}}function Ox(n){var o=Fo(n,1);o!==null&&Gi(o,n,1,-1)}function O_(n){var o=oo();return typeof n=="function"&&(n=n()),o.memoizedState=o.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:lc,lastRenderedState:n},o.queue=n,n=n.dispatch=T2.bind(null,bn,n),[o.memoizedState,n]}function uc(n,o,l,f){return n={tag:n,create:o,destroy:l,deps:f,next:null},o=bn.updateQueue,o===null?(o={lastEffect:null,stores:null},bn.updateQueue=o,o.lastEffect=n.next=n):(l=o.lastEffect,l===null?o.lastEffect=n.next=n:(f=l.next,l.next=n,n.next=f,o.lastEffect=n)),n}function Nx(){return Ei().memoizedState}function Yh(n,o,l,f){var _=oo();bn.flags|=n,_.memoizedState=uc(1|o,l,void 0,f===void 0?null:f)}function Bd(n,o,l,f){var _=Ei();f=f===void 0?null:f;var v=void 0;if(Xn!==null){var C=Xn.memoizedState;if(v=C.destroy,f!==null&&lg(f,C.deps)){_.memoizedState=uc(o,l,v,f);return}}bn.flags|=n,_.memoizedState=uc(1|o,l,v,f)}function N_(n,o){return Yh(8390656,8,n,o)}function hg(n,o){return Bd(2048,8,n,o)}function Ux(n,o){return Bd(4,2,n,o)}function Vx(n,o){return Bd(4,4,n,o)}function $x(n,o){if(typeof o=="function")return n=n(),o(n),function(){o(null)};if(o!=null)return n=n(),o.current=n,function(){o.current=null}}function jx(n,o,l){return l=l!=null?l.concat([n]):null,Bd(4,4,$x.bind(null,o,n),l)}function dg(){}function Gx(n,o){var l=Ei();o=o===void 0?null:o;var f=l.memoizedState;return f!==null&&o!==null&&lg(o,f[1])?f[0]:(l.memoizedState=[n,o],n)}function Zx(n,o){var l=Ei();o=o===void 0?null:o;var f=l.memoizedState;return f!==null&&o!==null&&lg(o,f[1])?f[0]:(n=n(),l.memoizedState=[n,o],n)}function qx(n,o,l){return ma&21?(Zi(l,o)||(l=Hv(),bn.lanes|=l,ga|=l,n.baseState=!0),o):(n.baseState&&(n.baseState=!1,Wr=!0),n.memoizedState=l)}function S2(n,o){var l=Ht;Ht=l!==0&&4>l?l:4,n(!0);var f=mf.transition;mf.transition={};try{n(!1),o()}finally{Ht=l,mf.transition=f}}function Wx(){return Ei().memoizedState}function E2(n,o,l){var f=bs(n);if(l={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null},Xx(n))Hx(o,l);else if(l=Tx(n,o,l,f),l!==null){var _=Br();Gi(l,n,f,_),Kx(l,o,f)}}function T2(n,o,l){var f=bs(n),_={lane:f,action:l,hasEagerState:!1,eagerState:null,next:null};if(Xx(n))Hx(o,_);else{var v=n.alternate;if(n.lanes===0&&(v===null||v.lanes===0)&&(v=o.lastRenderedReducer,v!==null))try{var C=o.lastRenderedState,u=v(C,l);if(_.hasEagerState=!0,_.eagerState=u,Zi(u,C)){var O=o.interleaved;O===null?(_.next=_,rg(o)):(_.next=O.next,O.next=_),o.interleaved=_;return}}catch{}finally{}l=Tx(n,o,_,f),l!==null&&(_=Br(),Gi(l,n,f,_),Kx(l,o,f))}}function Xx(n){var o=n.alternate;return n===bn||o!==null&&o===bn}function Hx(n,o){ju=xd=!0;var l=n.pending;l===null?o.next=o:(o.next=l.next,l.next=o),n.pending=o}function Kx(n,o,l){if(l&4194240){var f=o.lanes;f&=n.pendingLanes,l|=f,o.lanes=l,jm(n,l)}}var wd={readContext:Si,useCallback:wr,useContext:wr,useEffect:wr,useImperativeHandle:wr,useInsertionEffect:wr,useLayoutEffect:wr,useMemo:wr,useReducer:wr,useRef:wr,useState:wr,useDebugValue:wr,useDeferredValue:wr,useTransition:wr,useMutableSource:wr,useSyncExternalStore:wr,useId:wr,unstable_isNewReconciler:!1},k2={readContext:Si,useCallback:function(n,o){return oo().memoizedState=[n,o===void 0?null:o],n},useContext:Si,useEffect:N_,useImperativeHandle:function(n,o,l){return l=l!=null?l.concat([n]):null,Yh(4194308,4,$x.bind(null,o,n),l)},useLayoutEffect:function(n,o){return Yh(4194308,4,n,o)},useInsertionEffect:function(n,o){return Yh(4,2,n,o)},useMemo:function(n,o){var l=oo();return o=o===void 0?null:o,n=n(),l.memoizedState=[n,o],n},useReducer:function(n,o,l){var f=oo();return o=l!==void 0?l(o):o,f.memoizedState=f.baseState=o,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:o},f.queue=n,n=n.dispatch=E2.bind(null,bn,n),[f.memoizedState,n]},useRef:function(n){var o=oo();return n={current:n},o.memoizedState=n},useState:O_,useDebugValue:dg,useDeferredValue:function(n){return oo().memoizedState=n},useTransition:function(){var n=O_(!1),o=n[0];return n=S2.bind(null,n[1]),oo().memoizedState=n,[o,n]},useMutableSource:function(){},useSyncExternalStore:function(n,o,l){var f=bn,_=oo();if(gn){if(l===void 0)throw Error(Pe(407));l=l()}else{if(l=o(),or===null)throw Error(Pe(349));ma&30||Lx(f,o,l)}_.memoizedState=l;var v={value:l,getSnapshot:o};return _.queue=v,N_(Bx.bind(null,f,v,n),[n]),f.flags|=2048,uc(9,Rx.bind(null,f,v,l,o),void 0,null),l},useId:function(){var n=oo(),o=or.identifierPrefix;if(gn){var l=Do,f=Po;l=(f&~(1<<32-ji(f)-1)).toString(32)+l,o=":"+o+"R"+l,l=ac++,0<l&&(o+="H"+l.toString(32)),o+=":"}else l=b2++,o=":"+o+"r"+l.toString(32)+":";return n.memoizedState=o},unstable_isNewReconciler:!1},C2={readContext:Si,useCallback:Gx,useContext:Si,useEffect:hg,useImperativeHandle:jx,useInsertionEffect:Ux,useLayoutEffect:Vx,useMemo:Zx,useReducer:gf,useRef:Nx,useState:function(){return gf(lc)},useDebugValue:dg,useDeferredValue:function(n){var o=Ei();return qx(o,Xn.memoizedState,n)},useTransition:function(){var n=gf(lc)[0],o=Ei().memoizedState;return[n,o]},useMutableSource:Px,useSyncExternalStore:Dx,useId:Wx,unstable_isNewReconciler:!1},I2={readContext:Si,useCallback:Gx,useContext:Si,useEffect:hg,useImperativeHandle:jx,useInsertionEffect:Ux,useLayoutEffect:Vx,useMemo:Zx,useReducer:yf,useRef:Nx,useState:function(){return yf(lc)},useDebugValue:dg,useDeferredValue:function(n){var o=Ei();return Xn===null?o.memoizedState=n:qx(o,Xn.memoizedState,n)},useTransition:function(){var n=yf(lc)[0],o=Ei().memoizedState;return[n,o]},useMutableSource:Px,useSyncExternalStore:Dx,useId:Wx,unstable_isNewReconciler:!1};function wl(n,o){try{var l="",f=o;do l+=nb(f),f=f.return;while(f);var _=l}catch(v){_=`
Error generating stack: `+v.message+`
`+v.stack}return{value:n,source:o,stack:_,digest:null}}function _f(n,o,l){return{value:n,source:null,stack:l??null,digest:o??null}}function um(n,o){try{console.error(o.value)}catch(l){setTimeout(function(){throw l})}}var z2=typeof WeakMap=="function"?WeakMap:Map;function Yx(n,o,l){l=Lo(-1,l),l.tag=3,l.payload={element:null};var f=o.value;return l.callback=function(){Sd||(Sd=!0,vm=f),um(n,o)},l}function Jx(n,o,l){l=Lo(-1,l),l.tag=3;var f=n.type.getDerivedStateFromError;if(typeof f=="function"){var _=o.value;l.payload=function(){return f(_)},l.callback=function(){um(n,o)}}var v=n.stateNode;return v!==null&&typeof v.componentDidCatch=="function"&&(l.callback=function(){um(n,o),typeof f!="function"&&(ws===null?ws=new Set([this]):ws.add(this));var C=o.stack;this.componentDidCatch(o.value,{componentStack:C!==null?C:""})}),l}function U_(n,o,l){var f=n.pingCache;if(f===null){f=n.pingCache=new z2;var _=new Set;f.set(o,_)}else _=f.get(o),_===void 0&&(_=new Set,f.set(o,_));_.has(l)||(_.add(l),n=j2.bind(null,n,o,l),o.then(n,n))}function V_(n){do{var o;if((o=n.tag===13)&&(o=n.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return n;n=n.return}while(n!==null);return null}function $_(n,o,l,f,_){return n.mode&1?(n.flags|=65536,n.lanes=_,n):(n===o?n.flags|=65536:(n.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(o=Lo(-1,1),o.tag=2,xs(l,o,1))),l.lanes|=1),n)}var A2=No.ReactCurrentOwner,Wr=!1;function Rr(n,o,l,f){o.child=n===null?Ax(o,null,l,f):vl(o,n.child,l,f)}function j_(n,o,l,f,_){l=l.render;var v=o.ref;return fl(o,_),f=ug(n,o,l,f,v,_),l=cg(),n!==null&&!Wr?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~_,Oo(n,o,_)):(gn&&l&&Ym(o),o.flags|=1,Rr(n,o,f,_),o.child)}function G_(n,o,l,f,_){if(n===null){var v=l.type;return typeof v=="function"&&!xg(v)&&v.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(o.tag=15,o.type=v,Qx(n,o,v,f,_)):(n=td(l.type,null,f,o,o.mode,_),n.ref=o.ref,n.return=o,o.child=n)}if(v=n.child,!(n.lanes&_)){var C=v.memoizedProps;if(l=l.compare,l=l!==null?l:tc,l(C,f)&&n.ref===o.ref)return Oo(n,o,_)}return o.flags|=1,n=Ss(v,f),n.ref=o.ref,n.return=o,o.child=n}function Qx(n,o,l,f,_){if(n!==null){var v=n.memoizedProps;if(tc(v,f)&&n.ref===o.ref)if(Wr=!1,o.pendingProps=f=v,(n.lanes&_)!==0)n.flags&131072&&(Wr=!0);else return o.lanes=n.lanes,Oo(n,o,_)}return cm(n,o,l,f,_)}function e0(n,o,l){var f=o.pendingProps,_=f.children,v=n!==null?n.memoizedState:null;if(f.mode==="hidden")if(!(o.mode&1))o.memoizedState={baseLanes:0,cachePool:null,transitions:null},ln(ul,oi),oi|=l;else{if(!(l&1073741824))return n=v!==null?v.baseLanes|l:l,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:n,cachePool:null,transitions:null},o.updateQueue=null,ln(ul,oi),oi|=n,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},f=v!==null?v.baseLanes:l,ln(ul,oi),oi|=f}else v!==null?(f=v.baseLanes|l,o.memoizedState=null):f=l,ln(ul,oi),oi|=f;return Rr(n,o,_,l),o.child}function t0(n,o){var l=o.ref;(n===null&&l!==null||n!==null&&n.ref!==l)&&(o.flags|=512,o.flags|=2097152)}function cm(n,o,l,f,_){var v=Hr(l)?pa:Er.current;return v=yl(o,v),fl(o,_),l=ug(n,o,l,f,v,_),f=cg(),n!==null&&!Wr?(o.updateQueue=n.updateQueue,o.flags&=-2053,n.lanes&=~_,Oo(n,o,_)):(gn&&f&&Ym(o),o.flags|=1,Rr(n,o,l,_),o.child)}function Z_(n,o,l,f,_){if(Hr(l)){var v=!0;pd(o)}else v=!1;if(fl(o,_),o.stateNode===null)Jh(n,o),Ix(o,l,f),lm(o,l,f,_),f=!0;else if(n===null){var C=o.stateNode,u=o.memoizedProps;C.props=u;var O=C.context,Z=l.contextType;typeof Z=="object"&&Z!==null?Z=Si(Z):(Z=Hr(l)?pa:Er.current,Z=yl(o,Z));var ue=l.getDerivedStateFromProps,te=typeof ue=="function"||typeof C.getSnapshotBeforeUpdate=="function";te||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(u!==f||O!==Z)&&B_(o,C,f,Z),cs=!1;var q=o.memoizedState;C.state=q,_d(o,f,C,_),O=o.memoizedState,u!==f||q!==O||Xr.current||cs?(typeof ue=="function"&&(am(o,l,ue,f),O=o.memoizedState),(u=cs||R_(o,l,u,f,q,O,Z))?(te||typeof C.UNSAFE_componentWillMount!="function"&&typeof C.componentWillMount!="function"||(typeof C.componentWillMount=="function"&&C.componentWillMount(),typeof C.UNSAFE_componentWillMount=="function"&&C.UNSAFE_componentWillMount()),typeof C.componentDidMount=="function"&&(o.flags|=4194308)):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=f,o.memoizedState=O),C.props=f,C.state=O,C.context=Z,f=u):(typeof C.componentDidMount=="function"&&(o.flags|=4194308),f=!1)}else{C=o.stateNode,kx(n,o),u=o.memoizedProps,Z=o.type===o.elementType?u:Oi(o.type,u),C.props=Z,te=o.pendingProps,q=C.context,O=l.contextType,typeof O=="object"&&O!==null?O=Si(O):(O=Hr(l)?pa:Er.current,O=yl(o,O));var Ae=l.getDerivedStateFromProps;(ue=typeof Ae=="function"||typeof C.getSnapshotBeforeUpdate=="function")||typeof C.UNSAFE_componentWillReceiveProps!="function"&&typeof C.componentWillReceiveProps!="function"||(u!==te||q!==O)&&B_(o,C,f,O),cs=!1,q=o.memoizedState,C.state=q,_d(o,f,C,_);var Ce=o.memoizedState;u!==te||q!==Ce||Xr.current||cs?(typeof Ae=="function"&&(am(o,l,Ae,f),Ce=o.memoizedState),(Z=cs||R_(o,l,Z,f,q,Ce,O)||!1)?(ue||typeof C.UNSAFE_componentWillUpdate!="function"&&typeof C.componentWillUpdate!="function"||(typeof C.componentWillUpdate=="function"&&C.componentWillUpdate(f,Ce,O),typeof C.UNSAFE_componentWillUpdate=="function"&&C.UNSAFE_componentWillUpdate(f,Ce,O)),typeof C.componentDidUpdate=="function"&&(o.flags|=4),typeof C.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof C.componentDidUpdate!="function"||u===n.memoizedProps&&q===n.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&q===n.memoizedState||(o.flags|=1024),o.memoizedProps=f,o.memoizedState=Ce),C.props=f,C.state=Ce,C.context=O,f=Z):(typeof C.componentDidUpdate!="function"||u===n.memoizedProps&&q===n.memoizedState||(o.flags|=4),typeof C.getSnapshotBeforeUpdate!="function"||u===n.memoizedProps&&q===n.memoizedState||(o.flags|=1024),f=!1)}return hm(n,o,l,f,v,_)}function hm(n,o,l,f,_,v){t0(n,o);var C=(o.flags&128)!==0;if(!f&&!C)return _&&A_(o,l,!1),Oo(n,o,v);f=o.stateNode,A2.current=o;var u=C&&typeof l.getDerivedStateFromError!="function"?null:f.render();return o.flags|=1,n!==null&&C?(o.child=vl(o,n.child,null,v),o.child=vl(o,null,u,v)):Rr(n,o,u,v),o.memoizedState=f.state,_&&A_(o,l,!0),o.child}function n0(n){var o=n.stateNode;o.pendingContext?z_(n,o.pendingContext,o.pendingContext!==o.context):o.context&&z_(n,o.context,!1),og(n,o.containerInfo)}function q_(n,o,l,f,_){return _l(),Qm(_),o.flags|=256,Rr(n,o,l,f),o.child}var dm={dehydrated:null,treeContext:null,retryLane:0};function pm(n){return{baseLanes:n,cachePool:null,transitions:null}}function r0(n,o,l){var f=o.pendingProps,_=wn.current,v=!1,C=(o.flags&128)!==0,u;if((u=C)||(u=n!==null&&n.memoizedState===null?!1:(_&2)!==0),u?(v=!0,o.flags&=-129):(n===null||n.memoizedState!==null)&&(_|=1),ln(wn,_&1),n===null)return om(o),n=o.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(o.mode&1?n.data==="$!"?o.lanes=8:o.lanes=1073741824:o.lanes=1,null):(C=f.children,n=f.fallback,v?(f=o.mode,v=o.child,C={mode:"hidden",children:C},!(f&1)&&v!==null?(v.childLanes=0,v.pendingProps=C):v=Nd(C,f,0,null),n=da(n,f,l,null),v.return=o,n.return=o,v.sibling=n,o.child=v,o.child.memoizedState=pm(l),o.memoizedState=dm,n):pg(o,C));if(_=n.memoizedState,_!==null&&(u=_.dehydrated,u!==null))return M2(n,o,C,f,u,_,l);if(v){v=f.fallback,C=o.mode,_=n.child,u=_.sibling;var O={mode:"hidden",children:f.children};return!(C&1)&&o.child!==_?(f=o.child,f.childLanes=0,f.pendingProps=O,o.deletions=null):(f=Ss(_,O),f.subtreeFlags=_.subtreeFlags&14680064),u!==null?v=Ss(u,v):(v=da(v,C,l,null),v.flags|=2),v.return=o,f.return=o,f.sibling=v,o.child=f,f=v,v=o.child,C=n.child.memoizedState,C=C===null?pm(l):{baseLanes:C.baseLanes|l,cachePool:null,transitions:C.transitions},v.memoizedState=C,v.childLanes=n.childLanes&~l,o.memoizedState=dm,f}return v=n.child,n=v.sibling,f=Ss(v,{mode:"visible",children:f.children}),!(o.mode&1)&&(f.lanes=l),f.return=o,f.sibling=null,n!==null&&(l=o.deletions,l===null?(o.deletions=[n],o.flags|=16):l.push(n)),o.child=f,o.memoizedState=null,f}function pg(n,o){return o=Nd({mode:"visible",children:o},n.mode,0,null),o.return=n,n.child=o}function Nh(n,o,l,f){return f!==null&&Qm(f),vl(o,n.child,null,l),n=pg(o,o.pendingProps.children),n.flags|=2,o.memoizedState=null,n}function M2(n,o,l,f,_,v,C){if(l)return o.flags&256?(o.flags&=-257,f=_f(Error(Pe(422))),Nh(n,o,C,f)):o.memoizedState!==null?(o.child=n.child,o.flags|=128,null):(v=f.fallback,_=o.mode,f=Nd({mode:"visible",children:f.children},_,0,null),v=da(v,_,C,null),v.flags|=2,f.return=o,v.return=o,f.sibling=v,o.child=f,o.mode&1&&vl(o,n.child,null,C),o.child.memoizedState=pm(C),o.memoizedState=dm,v);if(!(o.mode&1))return Nh(n,o,C,null);if(_.data==="$!"){if(f=_.nextSibling&&_.nextSibling.dataset,f)var u=f.dgst;return f=u,v=Error(Pe(419)),f=_f(v,f,void 0),Nh(n,o,C,f)}if(u=(C&n.childLanes)!==0,Wr||u){if(f=or,f!==null){switch(C&-C){case 4:_=2;break;case 16:_=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:_=32;break;case 536870912:_=268435456;break;default:_=0}_=_&(f.suspendedLanes|C)?0:_,_!==0&&_!==v.retryLane&&(v.retryLane=_,Fo(n,_),Gi(f,n,_,-1))}return vg(),f=_f(Error(Pe(421))),Nh(n,o,C,f)}return _.data==="$?"?(o.flags|=128,o.child=n.child,o=G2.bind(null,n),_._reactRetry=o,null):(n=v.treeContext,si=vs(_.nextSibling),ai=o,gn=!0,Ui=null,n!==null&&(_i[vi++]=Po,_i[vi++]=Do,_i[vi++]=fa,Po=n.id,Do=n.overflow,fa=o),o=pg(o,f.children),o.flags|=4096,o)}function W_(n,o,l){n.lanes|=o;var f=n.alternate;f!==null&&(f.lanes|=o),sm(n.return,o,l)}function vf(n,o,l,f,_){var v=n.memoizedState;v===null?n.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:f,tail:l,tailMode:_}:(v.isBackwards=o,v.rendering=null,v.renderingStartTime=0,v.last=f,v.tail=l,v.tailMode=_)}function i0(n,o,l){var f=o.pendingProps,_=f.revealOrder,v=f.tail;if(Rr(n,o,f.children,l),f=wn.current,f&2)f=f&1|2,o.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=o.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&W_(n,l,o);else if(n.tag===19)W_(n,l,o);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===o)break e;for(;n.sibling===null;){if(n.return===null||n.return===o)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}f&=1}if(ln(wn,f),!(o.mode&1))o.memoizedState=null;else switch(_){case"forwards":for(l=o.child,_=null;l!==null;)n=l.alternate,n!==null&&vd(n)===null&&(_=l),l=l.sibling;l=_,l===null?(_=o.child,o.child=null):(_=l.sibling,l.sibling=null),vf(o,!1,_,l,v);break;case"backwards":for(l=null,_=o.child,o.child=null;_!==null;){if(n=_.alternate,n!==null&&vd(n)===null){o.child=_;break}n=_.sibling,_.sibling=l,l=_,_=n}vf(o,!0,l,null,v);break;case"together":vf(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Jh(n,o){!(o.mode&1)&&n!==null&&(n.alternate=null,o.alternate=null,o.flags|=2)}function Oo(n,o,l){if(n!==null&&(o.dependencies=n.dependencies),ga|=o.lanes,!(l&o.childLanes))return null;if(n!==null&&o.child!==n.child)throw Error(Pe(153));if(o.child!==null){for(n=o.child,l=Ss(n,n.pendingProps),o.child=l,l.return=o;n.sibling!==null;)n=n.sibling,l=l.sibling=Ss(n,n.pendingProps),l.return=o;l.sibling=null}return o.child}function P2(n,o,l){switch(o.tag){case 3:n0(o),_l();break;case 5:Mx(o);break;case 1:Hr(o.type)&&pd(o);break;case 4:og(o,o.stateNode.containerInfo);break;case 10:var f=o.type._context,_=o.memoizedProps.value;ln(gd,f._currentValue),f._currentValue=_;break;case 13:if(f=o.memoizedState,f!==null)return f.dehydrated!==null?(ln(wn,wn.current&1),o.flags|=128,null):l&o.child.childLanes?r0(n,o,l):(ln(wn,wn.current&1),n=Oo(n,o,l),n!==null?n.sibling:null);ln(wn,wn.current&1);break;case 19:if(f=(l&o.childLanes)!==0,n.flags&128){if(f)return i0(n,o,l);o.flags|=128}if(_=o.memoizedState,_!==null&&(_.rendering=null,_.tail=null,_.lastEffect=null),ln(wn,wn.current),f)break;return null;case 22:case 23:return o.lanes=0,e0(n,o,l)}return Oo(n,o,l)}var o0,fm,s0,a0;o0=function(n,o){for(var l=o.child;l!==null;){if(l.tag===5||l.tag===6)n.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===o)break;for(;l.sibling===null;){if(l.return===null||l.return===o)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};fm=function(){};s0=function(n,o,l,f){var _=n.memoizedProps;if(_!==f){n=o.stateNode,ca(lo.current);var v=null;switch(l){case"input":_=Bf(n,_),f=Bf(n,f),v=[];break;case"select":_=Sn({},_,{value:void 0}),f=Sn({},f,{value:void 0}),v=[];break;case"textarea":_=Nf(n,_),f=Nf(n,f),v=[];break;default:typeof _.onClick!="function"&&typeof f.onClick=="function"&&(n.onclick=hd)}Vf(l,f);var C;l=null;for(Z in _)if(!f.hasOwnProperty(Z)&&_.hasOwnProperty(Z)&&_[Z]!=null)if(Z==="style"){var u=_[Z];for(C in u)u.hasOwnProperty(C)&&(l||(l={}),l[C]="")}else Z!=="dangerouslySetInnerHTML"&&Z!=="children"&&Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&Z!=="autoFocus"&&(Xu.hasOwnProperty(Z)?v||(v=[]):(v=v||[]).push(Z,null));for(Z in f){var O=f[Z];if(u=_!=null?_[Z]:void 0,f.hasOwnProperty(Z)&&O!==u&&(O!=null||u!=null))if(Z==="style")if(u){for(C in u)!u.hasOwnProperty(C)||O&&O.hasOwnProperty(C)||(l||(l={}),l[C]="");for(C in O)O.hasOwnProperty(C)&&u[C]!==O[C]&&(l||(l={}),l[C]=O[C])}else l||(v||(v=[]),v.push(Z,l)),l=O;else Z==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,u=u?u.__html:void 0,O!=null&&u!==O&&(v=v||[]).push(Z,O)):Z==="children"?typeof O!="string"&&typeof O!="number"||(v=v||[]).push(Z,""+O):Z!=="suppressContentEditableWarning"&&Z!=="suppressHydrationWarning"&&(Xu.hasOwnProperty(Z)?(O!=null&&Z==="onScroll"&&hn("scroll",n),v||u===O||(v=[])):(v=v||[]).push(Z,O))}l&&(v=v||[]).push("style",l);var Z=v;(o.updateQueue=Z)&&(o.flags|=4)}};a0=function(n,o,l,f){l!==f&&(o.flags|=4)};function Pu(n,o){if(!gn)switch(n.tailMode){case"hidden":o=n.tail;for(var l=null;o!==null;)o.alternate!==null&&(l=o),o=o.sibling;l===null?n.tail=null:l.sibling=null;break;case"collapsed":l=n.tail;for(var f=null;l!==null;)l.alternate!==null&&(f=l),l=l.sibling;f===null?o||n.tail===null?n.tail=null:n.tail.sibling=null:f.sibling=null}}function br(n){var o=n.alternate!==null&&n.alternate.child===n.child,l=0,f=0;if(o)for(var _=n.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags&14680064,f|=_.flags&14680064,_.return=n,_=_.sibling;else for(_=n.child;_!==null;)l|=_.lanes|_.childLanes,f|=_.subtreeFlags,f|=_.flags,_.return=n,_=_.sibling;return n.subtreeFlags|=f,n.childLanes=l,o}function D2(n,o,l){var f=o.pendingProps;switch(Jm(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return br(o),null;case 1:return Hr(o.type)&&dd(),br(o),null;case 3:return f=o.stateNode,xl(),dn(Xr),dn(Er),ag(),f.pendingContext&&(f.context=f.pendingContext,f.pendingContext=null),(n===null||n.child===null)&&(Fh(o)?o.flags|=4:n===null||n.memoizedState.isDehydrated&&!(o.flags&256)||(o.flags|=1024,Ui!==null&&(bm(Ui),Ui=null))),fm(n,o),br(o),null;case 5:sg(o);var _=ca(sc.current);if(l=o.type,n!==null&&o.stateNode!=null)s0(n,o,l,f,_),n.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!f){if(o.stateNode===null)throw Error(Pe(166));return br(o),null}if(n=ca(lo.current),Fh(o)){f=o.stateNode,l=o.type;var v=o.memoizedProps;switch(f[so]=o,f[ic]=v,n=(o.mode&1)!==0,l){case"dialog":hn("cancel",f),hn("close",f);break;case"iframe":case"object":case"embed":hn("load",f);break;case"video":case"audio":for(_=0;_<Fu.length;_++)hn(Fu[_],f);break;case"source":hn("error",f);break;case"img":case"image":case"link":hn("error",f),hn("load",f);break;case"details":hn("toggle",f);break;case"input":n_(f,v),hn("invalid",f);break;case"select":f._wrapperState={wasMultiple:!!v.multiple},hn("invalid",f);break;case"textarea":i_(f,v),hn("invalid",f)}Vf(l,v),_=null;for(var C in v)if(v.hasOwnProperty(C)){var u=v[C];C==="children"?typeof u=="string"?f.textContent!==u&&(v.suppressHydrationWarning!==!0&&Bh(f.textContent,u,n),_=["children",u]):typeof u=="number"&&f.textContent!==""+u&&(v.suppressHydrationWarning!==!0&&Bh(f.textContent,u,n),_=["children",""+u]):Xu.hasOwnProperty(C)&&u!=null&&C==="onScroll"&&hn("scroll",f)}switch(l){case"input":Ih(f),r_(f,v,!0);break;case"textarea":Ih(f),o_(f);break;case"select":case"option":break;default:typeof v.onClick=="function"&&(f.onclick=hd)}f=_,o.updateQueue=f,f!==null&&(o.flags|=4)}else{C=_.nodeType===9?_:_.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=Lv(l)),n==="http://www.w3.org/1999/xhtml"?l==="script"?(n=C.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof f.is=="string"?n=C.createElement(l,{is:f.is}):(n=C.createElement(l),l==="select"&&(C=n,f.multiple?C.multiple=!0:f.size&&(C.size=f.size))):n=C.createElementNS(n,l),n[so]=o,n[ic]=f,o0(n,o,!1,!1),o.stateNode=n;e:{switch(C=$f(l,f),l){case"dialog":hn("cancel",n),hn("close",n),_=f;break;case"iframe":case"object":case"embed":hn("load",n),_=f;break;case"video":case"audio":for(_=0;_<Fu.length;_++)hn(Fu[_],n);_=f;break;case"source":hn("error",n),_=f;break;case"img":case"image":case"link":hn("error",n),hn("load",n),_=f;break;case"details":hn("toggle",n),_=f;break;case"input":n_(n,f),_=Bf(n,f),hn("invalid",n);break;case"option":_=f;break;case"select":n._wrapperState={wasMultiple:!!f.multiple},_=Sn({},f,{value:void 0}),hn("invalid",n);break;case"textarea":i_(n,f),_=Nf(n,f),hn("invalid",n);break;default:_=f}Vf(l,_),u=_;for(v in u)if(u.hasOwnProperty(v)){var O=u[v];v==="style"?Fv(n,O):v==="dangerouslySetInnerHTML"?(O=O?O.__html:void 0,O!=null&&Rv(n,O)):v==="children"?typeof O=="string"?(l!=="textarea"||O!=="")&&Hu(n,O):typeof O=="number"&&Hu(n,""+O):v!=="suppressContentEditableWarning"&&v!=="suppressHydrationWarning"&&v!=="autoFocus"&&(Xu.hasOwnProperty(v)?O!=null&&v==="onScroll"&&hn("scroll",n):O!=null&&Fm(n,v,O,C))}switch(l){case"input":Ih(n),r_(n,f,!1);break;case"textarea":Ih(n),o_(n);break;case"option":f.value!=null&&n.setAttribute("value",""+Es(f.value));break;case"select":n.multiple=!!f.multiple,v=f.value,v!=null?cl(n,!!f.multiple,v,!1):f.defaultValue!=null&&cl(n,!!f.multiple,f.defaultValue,!0);break;default:typeof _.onClick=="function"&&(n.onclick=hd)}switch(l){case"button":case"input":case"select":case"textarea":f=!!f.autoFocus;break e;case"img":f=!0;break e;default:f=!1}}f&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return br(o),null;case 6:if(n&&o.stateNode!=null)a0(n,o,n.memoizedProps,f);else{if(typeof f!="string"&&o.stateNode===null)throw Error(Pe(166));if(l=ca(sc.current),ca(lo.current),Fh(o)){if(f=o.stateNode,l=o.memoizedProps,f[so]=o,(v=f.nodeValue!==l)&&(n=ai,n!==null))switch(n.tag){case 3:Bh(f.nodeValue,l,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&Bh(f.nodeValue,l,(n.mode&1)!==0)}v&&(o.flags|=4)}else f=(l.nodeType===9?l:l.ownerDocument).createTextNode(f),f[so]=o,o.stateNode=f}return br(o),null;case 13:if(dn(wn),f=o.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(gn&&si!==null&&o.mode&1&&!(o.flags&128))Ex(),_l(),o.flags|=98560,v=!1;else if(v=Fh(o),f!==null&&f.dehydrated!==null){if(n===null){if(!v)throw Error(Pe(318));if(v=o.memoizedState,v=v!==null?v.dehydrated:null,!v)throw Error(Pe(317));v[so]=o}else _l(),!(o.flags&128)&&(o.memoizedState=null),o.flags|=4;br(o),v=!1}else Ui!==null&&(bm(Ui),Ui=null),v=!0;if(!v)return o.flags&65536?o:null}return o.flags&128?(o.lanes=l,o):(f=f!==null,f!==(n!==null&&n.memoizedState!==null)&&f&&(o.child.flags|=8192,o.mode&1&&(n===null||wn.current&1?Hn===0&&(Hn=3):vg())),o.updateQueue!==null&&(o.flags|=4),br(o),null);case 4:return xl(),fm(n,o),n===null&&nc(o.stateNode.containerInfo),br(o),null;case 10:return ng(o.type._context),br(o),null;case 17:return Hr(o.type)&&dd(),br(o),null;case 19:if(dn(wn),v=o.memoizedState,v===null)return br(o),null;if(f=(o.flags&128)!==0,C=v.rendering,C===null)if(f)Pu(v,!1);else{if(Hn!==0||n!==null&&n.flags&128)for(n=o.child;n!==null;){if(C=vd(n),C!==null){for(o.flags|=128,Pu(v,!1),f=C.updateQueue,f!==null&&(o.updateQueue=f,o.flags|=4),o.subtreeFlags=0,f=l,l=o.child;l!==null;)v=l,n=f,v.flags&=14680066,C=v.alternate,C===null?(v.childLanes=0,v.lanes=n,v.child=null,v.subtreeFlags=0,v.memoizedProps=null,v.memoizedState=null,v.updateQueue=null,v.dependencies=null,v.stateNode=null):(v.childLanes=C.childLanes,v.lanes=C.lanes,v.child=C.child,v.subtreeFlags=0,v.deletions=null,v.memoizedProps=C.memoizedProps,v.memoizedState=C.memoizedState,v.updateQueue=C.updateQueue,v.type=C.type,n=C.dependencies,v.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),l=l.sibling;return ln(wn,wn.current&1|2),o.child}n=n.sibling}v.tail!==null&&Rn()>bl&&(o.flags|=128,f=!0,Pu(v,!1),o.lanes=4194304)}else{if(!f)if(n=vd(C),n!==null){if(o.flags|=128,f=!0,l=n.updateQueue,l!==null&&(o.updateQueue=l,o.flags|=4),Pu(v,!0),v.tail===null&&v.tailMode==="hidden"&&!C.alternate&&!gn)return br(o),null}else 2*Rn()-v.renderingStartTime>bl&&l!==1073741824&&(o.flags|=128,f=!0,Pu(v,!1),o.lanes=4194304);v.isBackwards?(C.sibling=o.child,o.child=C):(l=v.last,l!==null?l.sibling=C:o.child=C,v.last=C)}return v.tail!==null?(o=v.tail,v.rendering=o,v.tail=o.sibling,v.renderingStartTime=Rn(),o.sibling=null,l=wn.current,ln(wn,f?l&1|2:l&1),o):(br(o),null);case 22:case 23:return _g(),f=o.memoizedState!==null,n!==null&&n.memoizedState!==null!==f&&(o.flags|=8192),f&&o.mode&1?oi&1073741824&&(br(o),o.subtreeFlags&6&&(o.flags|=8192)):br(o),null;case 24:return null;case 25:return null}throw Error(Pe(156,o.tag))}function L2(n,o){switch(Jm(o),o.tag){case 1:return Hr(o.type)&&dd(),n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 3:return xl(),dn(Xr),dn(Er),ag(),n=o.flags,n&65536&&!(n&128)?(o.flags=n&-65537|128,o):null;case 5:return sg(o),null;case 13:if(dn(wn),n=o.memoizedState,n!==null&&n.dehydrated!==null){if(o.alternate===null)throw Error(Pe(340));_l()}return n=o.flags,n&65536?(o.flags=n&-65537|128,o):null;case 19:return dn(wn),null;case 4:return xl(),null;case 10:return ng(o.type._context),null;case 22:case 23:return _g(),null;case 24:return null;default:return null}}var Uh=!1,Sr=!1,R2=typeof WeakSet=="function"?WeakSet:Set,nt=null;function ll(n,o){var l=n.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(f){An(n,o,f)}else l.current=null}function mm(n,o,l){try{l()}catch(f){An(n,o,f)}}var X_=!1;function B2(n,o){if(Jf=ld,n=hx(),Km(n)){if("selectionStart"in n)var l={start:n.selectionStart,end:n.selectionEnd};else e:{l=(l=n.ownerDocument)&&l.defaultView||window;var f=l.getSelection&&l.getSelection();if(f&&f.rangeCount!==0){l=f.anchorNode;var _=f.anchorOffset,v=f.focusNode;f=f.focusOffset;try{l.nodeType,v.nodeType}catch{l=null;break e}var C=0,u=-1,O=-1,Z=0,ue=0,te=n,q=null;t:for(;;){for(var Ae;te!==l||_!==0&&te.nodeType!==3||(u=C+_),te!==v||f!==0&&te.nodeType!==3||(O=C+f),te.nodeType===3&&(C+=te.nodeValue.length),(Ae=te.firstChild)!==null;)q=te,te=Ae;for(;;){if(te===n)break t;if(q===l&&++Z===_&&(u=C),q===v&&++ue===f&&(O=C),(Ae=te.nextSibling)!==null)break;te=q,q=te.parentNode}te=Ae}l=u===-1||O===-1?null:{start:u,end:O}}else l=null}l=l||{start:0,end:0}}else l=null;for(Qf={focusedElem:n,selectionRange:l},ld=!1,nt=o;nt!==null;)if(o=nt,n=o.child,(o.subtreeFlags&1028)!==0&&n!==null)n.return=o,nt=n;else for(;nt!==null;){o=nt;try{var Ce=o.alternate;if(o.flags&1024)switch(o.tag){case 0:case 11:case 15:break;case 1:if(Ce!==null){var we=Ce.memoizedProps,xt=Ce.memoizedState,se=o.stateNode,Q=se.getSnapshotBeforeUpdate(o.elementType===o.type?we:Oi(o.type,we),xt);se.__reactInternalSnapshotBeforeUpdate=Q}break;case 3:var ae=o.stateNode.containerInfo;ae.nodeType===1?ae.textContent="":ae.nodeType===9&&ae.documentElement&&ae.removeChild(ae.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(Pe(163))}}catch(ke){An(o,o.return,ke)}if(n=o.sibling,n!==null){n.return=o.return,nt=n;break}nt=o.return}return Ce=X_,X_=!1,Ce}function Gu(n,o,l){var f=o.updateQueue;if(f=f!==null?f.lastEffect:null,f!==null){var _=f=f.next;do{if((_.tag&n)===n){var v=_.destroy;_.destroy=void 0,v!==void 0&&mm(o,l,v)}_=_.next}while(_!==f)}}function Fd(n,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var l=o=o.next;do{if((l.tag&n)===n){var f=l.create;l.destroy=f()}l=l.next}while(l!==o)}}function gm(n){var o=n.ref;if(o!==null){var l=n.stateNode;switch(n.tag){case 5:n=l;break;default:n=l}typeof o=="function"?o(n):o.current=n}}function l0(n){var o=n.alternate;o!==null&&(n.alternate=null,l0(o)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(o=n.stateNode,o!==null&&(delete o[so],delete o[ic],delete o[nm],delete o[_2],delete o[v2])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function u0(n){return n.tag===5||n.tag===3||n.tag===4}function H_(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||u0(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function ym(n,o,l){var f=n.tag;if(f===5||f===6)n=n.stateNode,o?l.nodeType===8?l.parentNode.insertBefore(n,o):l.insertBefore(n,o):(l.nodeType===8?(o=l.parentNode,o.insertBefore(n,l)):(o=l,o.appendChild(n)),l=l._reactRootContainer,l!=null||o.onclick!==null||(o.onclick=hd));else if(f!==4&&(n=n.child,n!==null))for(ym(n,o,l),n=n.sibling;n!==null;)ym(n,o,l),n=n.sibling}function _m(n,o,l){var f=n.tag;if(f===5||f===6)n=n.stateNode,o?l.insertBefore(n,o):l.appendChild(n);else if(f!==4&&(n=n.child,n!==null))for(_m(n,o,l),n=n.sibling;n!==null;)_m(n,o,l),n=n.sibling}var hr=null,Ni=!1;function ls(n,o,l){for(l=l.child;l!==null;)c0(n,o,l),l=l.sibling}function c0(n,o,l){if(ao&&typeof ao.onCommitFiberUnmount=="function")try{ao.onCommitFiberUnmount(zd,l)}catch{}switch(l.tag){case 5:Sr||ll(l,o);case 6:var f=hr,_=Ni;hr=null,ls(n,o,l),hr=f,Ni=_,hr!==null&&(Ni?(n=hr,l=l.stateNode,n.nodeType===8?n.parentNode.removeChild(l):n.removeChild(l)):hr.removeChild(l.stateNode));break;case 18:hr!==null&&(Ni?(n=hr,l=l.stateNode,n.nodeType===8?df(n.parentNode,l):n.nodeType===1&&df(n,l),Qu(n)):df(hr,l.stateNode));break;case 4:f=hr,_=Ni,hr=l.stateNode.containerInfo,Ni=!0,ls(n,o,l),hr=f,Ni=_;break;case 0:case 11:case 14:case 15:if(!Sr&&(f=l.updateQueue,f!==null&&(f=f.lastEffect,f!==null))){_=f=f.next;do{var v=_,C=v.destroy;v=v.tag,C!==void 0&&(v&2||v&4)&&mm(l,o,C),_=_.next}while(_!==f)}ls(n,o,l);break;case 1:if(!Sr&&(ll(l,o),f=l.stateNode,typeof f.componentWillUnmount=="function"))try{f.props=l.memoizedProps,f.state=l.memoizedState,f.componentWillUnmount()}catch(u){An(l,o,u)}ls(n,o,l);break;case 21:ls(n,o,l);break;case 22:l.mode&1?(Sr=(f=Sr)||l.memoizedState!==null,ls(n,o,l),Sr=f):ls(n,o,l);break;default:ls(n,o,l)}}function K_(n){var o=n.updateQueue;if(o!==null){n.updateQueue=null;var l=n.stateNode;l===null&&(l=n.stateNode=new R2),o.forEach(function(f){var _=Z2.bind(null,n,f);l.has(f)||(l.add(f),f.then(_,_))})}}function Fi(n,o){var l=o.deletions;if(l!==null)for(var f=0;f<l.length;f++){var _=l[f];try{var v=n,C=o,u=C;e:for(;u!==null;){switch(u.tag){case 5:hr=u.stateNode,Ni=!1;break e;case 3:hr=u.stateNode.containerInfo,Ni=!0;break e;case 4:hr=u.stateNode.containerInfo,Ni=!0;break e}u=u.return}if(hr===null)throw Error(Pe(160));c0(v,C,_),hr=null,Ni=!1;var O=_.alternate;O!==null&&(O.return=null),_.return=null}catch(Z){An(_,o,Z)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)h0(o,n),o=o.sibling}function h0(n,o){var l=n.alternate,f=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Fi(o,n),io(n),f&4){try{Gu(3,n,n.return),Fd(3,n)}catch(we){An(n,n.return,we)}try{Gu(5,n,n.return)}catch(we){An(n,n.return,we)}}break;case 1:Fi(o,n),io(n),f&512&&l!==null&&ll(l,l.return);break;case 5:if(Fi(o,n),io(n),f&512&&l!==null&&ll(l,l.return),n.flags&32){var _=n.stateNode;try{Hu(_,"")}catch(we){An(n,n.return,we)}}if(f&4&&(_=n.stateNode,_!=null)){var v=n.memoizedProps,C=l!==null?l.memoizedProps:v,u=n.type,O=n.updateQueue;if(n.updateQueue=null,O!==null)try{u==="input"&&v.type==="radio"&&v.name!=null&&Pv(_,v),$f(u,C);var Z=$f(u,v);for(C=0;C<O.length;C+=2){var ue=O[C],te=O[C+1];ue==="style"?Fv(_,te):ue==="dangerouslySetInnerHTML"?Rv(_,te):ue==="children"?Hu(_,te):Fm(_,ue,te,Z)}switch(u){case"input":Ff(_,v);break;case"textarea":Dv(_,v);break;case"select":var q=_._wrapperState.wasMultiple;_._wrapperState.wasMultiple=!!v.multiple;var Ae=v.value;Ae!=null?cl(_,!!v.multiple,Ae,!1):q!==!!v.multiple&&(v.defaultValue!=null?cl(_,!!v.multiple,v.defaultValue,!0):cl(_,!!v.multiple,v.multiple?[]:"",!1))}_[ic]=v}catch(we){An(n,n.return,we)}}break;case 6:if(Fi(o,n),io(n),f&4){if(n.stateNode===null)throw Error(Pe(162));_=n.stateNode,v=n.memoizedProps;try{_.nodeValue=v}catch(we){An(n,n.return,we)}}break;case 3:if(Fi(o,n),io(n),f&4&&l!==null&&l.memoizedState.isDehydrated)try{Qu(o.containerInfo)}catch(we){An(n,n.return,we)}break;case 4:Fi(o,n),io(n);break;case 13:Fi(o,n),io(n),_=n.child,_.flags&8192&&(v=_.memoizedState!==null,_.stateNode.isHidden=v,!v||_.alternate!==null&&_.alternate.memoizedState!==null||(gg=Rn())),f&4&&K_(n);break;case 22:if(ue=l!==null&&l.memoizedState!==null,n.mode&1?(Sr=(Z=Sr)||ue,Fi(o,n),Sr=Z):Fi(o,n),io(n),f&8192){if(Z=n.memoizedState!==null,(n.stateNode.isHidden=Z)&&!ue&&n.mode&1)for(nt=n,ue=n.child;ue!==null;){for(te=nt=ue;nt!==null;){switch(q=nt,Ae=q.child,q.tag){case 0:case 11:case 14:case 15:Gu(4,q,q.return);break;case 1:ll(q,q.return);var Ce=q.stateNode;if(typeof Ce.componentWillUnmount=="function"){f=q,l=q.return;try{o=f,Ce.props=o.memoizedProps,Ce.state=o.memoizedState,Ce.componentWillUnmount()}catch(we){An(f,l,we)}}break;case 5:ll(q,q.return);break;case 22:if(q.memoizedState!==null){J_(te);continue}}Ae!==null?(Ae.return=q,nt=Ae):J_(te)}ue=ue.sibling}e:for(ue=null,te=n;;){if(te.tag===5){if(ue===null){ue=te;try{_=te.stateNode,Z?(v=_.style,typeof v.setProperty=="function"?v.setProperty("display","none","important"):v.display="none"):(u=te.stateNode,O=te.memoizedProps.style,C=O!=null&&O.hasOwnProperty("display")?O.display:null,u.style.display=Bv("display",C))}catch(we){An(n,n.return,we)}}}else if(te.tag===6){if(ue===null)try{te.stateNode.nodeValue=Z?"":te.memoizedProps}catch(we){An(n,n.return,we)}}else if((te.tag!==22&&te.tag!==23||te.memoizedState===null||te===n)&&te.child!==null){te.child.return=te,te=te.child;continue}if(te===n)break e;for(;te.sibling===null;){if(te.return===null||te.return===n)break e;ue===te&&(ue=null),te=te.return}ue===te&&(ue=null),te.sibling.return=te.return,te=te.sibling}}break;case 19:Fi(o,n),io(n),f&4&&K_(n);break;case 21:break;default:Fi(o,n),io(n)}}function io(n){var o=n.flags;if(o&2){try{e:{for(var l=n.return;l!==null;){if(u0(l)){var f=l;break e}l=l.return}throw Error(Pe(160))}switch(f.tag){case 5:var _=f.stateNode;f.flags&32&&(Hu(_,""),f.flags&=-33);var v=H_(n);_m(n,v,_);break;case 3:case 4:var C=f.stateNode.containerInfo,u=H_(n);ym(n,u,C);break;default:throw Error(Pe(161))}}catch(O){An(n,n.return,O)}n.flags&=-3}o&4096&&(n.flags&=-4097)}function F2(n,o,l){nt=n,d0(n)}function d0(n,o,l){for(var f=(n.mode&1)!==0;nt!==null;){var _=nt,v=_.child;if(_.tag===22&&f){var C=_.memoizedState!==null||Uh;if(!C){var u=_.alternate,O=u!==null&&u.memoizedState!==null||Sr;u=Uh;var Z=Sr;if(Uh=C,(Sr=O)&&!Z)for(nt=_;nt!==null;)C=nt,O=C.child,C.tag===22&&C.memoizedState!==null?Q_(_):O!==null?(O.return=C,nt=O):Q_(_);for(;v!==null;)nt=v,d0(v),v=v.sibling;nt=_,Uh=u,Sr=Z}Y_(n)}else _.subtreeFlags&8772&&v!==null?(v.return=_,nt=v):Y_(n)}}function Y_(n){for(;nt!==null;){var o=nt;if(o.flags&8772){var l=o.alternate;try{if(o.flags&8772)switch(o.tag){case 0:case 11:case 15:Sr||Fd(5,o);break;case 1:var f=o.stateNode;if(o.flags&4&&!Sr)if(l===null)f.componentDidMount();else{var _=o.elementType===o.type?l.memoizedProps:Oi(o.type,l.memoizedProps);f.componentDidUpdate(_,l.memoizedState,f.__reactInternalSnapshotBeforeUpdate)}var v=o.updateQueue;v!==null&&L_(o,v,f);break;case 3:var C=o.updateQueue;if(C!==null){if(l=null,o.child!==null)switch(o.child.tag){case 5:l=o.child.stateNode;break;case 1:l=o.child.stateNode}L_(o,C,l)}break;case 5:var u=o.stateNode;if(l===null&&o.flags&4){l=u;var O=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":O.autoFocus&&l.focus();break;case"img":O.src&&(l.src=O.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var Z=o.alternate;if(Z!==null){var ue=Z.memoizedState;if(ue!==null){var te=ue.dehydrated;te!==null&&Qu(te)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(Pe(163))}Sr||o.flags&512&&gm(o)}catch(q){An(o,o.return,q)}}if(o===n){nt=null;break}if(l=o.sibling,l!==null){l.return=o.return,nt=l;break}nt=o.return}}function J_(n){for(;nt!==null;){var o=nt;if(o===n){nt=null;break}var l=o.sibling;if(l!==null){l.return=o.return,nt=l;break}nt=o.return}}function Q_(n){for(;nt!==null;){var o=nt;try{switch(o.tag){case 0:case 11:case 15:var l=o.return;try{Fd(4,o)}catch(O){An(o,l,O)}break;case 1:var f=o.stateNode;if(typeof f.componentDidMount=="function"){var _=o.return;try{f.componentDidMount()}catch(O){An(o,_,O)}}var v=o.return;try{gm(o)}catch(O){An(o,v,O)}break;case 5:var C=o.return;try{gm(o)}catch(O){An(o,C,O)}}}catch(O){An(o,o.return,O)}if(o===n){nt=null;break}var u=o.sibling;if(u!==null){u.return=o.return,nt=u;break}nt=o.return}}var O2=Math.ceil,bd=No.ReactCurrentDispatcher,fg=No.ReactCurrentOwner,bi=No.ReactCurrentBatchConfig,Nt=0,or=null,Gn=null,dr=0,oi=0,ul=Is(0),Hn=0,cc=null,ga=0,Od=0,mg=0,Zu=null,qr=null,gg=0,bl=1/0,Io=null,Sd=!1,vm=null,ws=null,Vh=!1,fs=null,Ed=0,qu=0,xm=null,Qh=-1,ed=0;function Br(){return Nt&6?Rn():Qh!==-1?Qh:Qh=Rn()}function bs(n){return n.mode&1?Nt&2&&dr!==0?dr&-dr:w2.transition!==null?(ed===0&&(ed=Hv()),ed):(n=Ht,n!==0||(n=window.event,n=n===void 0?16:nx(n.type)),n):1}function Gi(n,o,l,f){if(50<qu)throw qu=0,xm=null,Error(Pe(185));fc(n,l,f),(!(Nt&2)||n!==or)&&(n===or&&(!(Nt&2)&&(Od|=l),Hn===4&&ds(n,dr)),Kr(n,f),l===1&&Nt===0&&!(o.mode&1)&&(bl=Rn()+500,Ld&&zs()))}function Kr(n,o){var l=n.callbackNode;wb(n,o);var f=ad(n,n===or?dr:0);if(f===0)l!==null&&l_(l),n.callbackNode=null,n.callbackPriority=0;else if(o=f&-f,n.callbackPriority!==o){if(l!=null&&l_(l),o===1)n.tag===0?x2(ev.bind(null,n)):wx(ev.bind(null,n)),g2(function(){!(Nt&6)&&zs()}),l=null;else{switch(Kv(f)){case 1:l=$m;break;case 4:l=Wv;break;case 16:l=sd;break;case 536870912:l=Xv;break;default:l=sd}l=x0(l,p0.bind(null,n))}n.callbackPriority=o,n.callbackNode=l}}function p0(n,o){if(Qh=-1,ed=0,Nt&6)throw Error(Pe(327));var l=n.callbackNode;if(ml()&&n.callbackNode!==l)return null;var f=ad(n,n===or?dr:0);if(f===0)return null;if(f&30||f&n.expiredLanes||o)o=Td(n,f);else{o=f;var _=Nt;Nt|=2;var v=m0();(or!==n||dr!==o)&&(Io=null,bl=Rn()+500,ha(n,o));do try{V2();break}catch(u){f0(n,u)}while(1);tg(),bd.current=v,Nt=_,Gn!==null?o=0:(or=null,dr=0,o=Hn)}if(o!==0){if(o===2&&(_=Wf(n),_!==0&&(f=_,o=wm(n,_))),o===1)throw l=cc,ha(n,0),ds(n,f),Kr(n,Rn()),l;if(o===6)ds(n,f);else{if(_=n.current.alternate,!(f&30)&&!N2(_)&&(o=Td(n,f),o===2&&(v=Wf(n),v!==0&&(f=v,o=wm(n,v))),o===1))throw l=cc,ha(n,0),ds(n,f),Kr(n,Rn()),l;switch(n.finishedWork=_,n.finishedLanes=f,o){case 0:case 1:throw Error(Pe(345));case 2:aa(n,qr,Io);break;case 3:if(ds(n,f),(f&130023424)===f&&(o=gg+500-Rn(),10<o)){if(ad(n,0)!==0)break;if(_=n.suspendedLanes,(_&f)!==f){Br(),n.pingedLanes|=n.suspendedLanes&_;break}n.timeoutHandle=tm(aa.bind(null,n,qr,Io),o);break}aa(n,qr,Io);break;case 4:if(ds(n,f),(f&4194240)===f)break;for(o=n.eventTimes,_=-1;0<f;){var C=31-ji(f);v=1<<C,C=o[C],C>_&&(_=C),f&=~v}if(f=_,f=Rn()-f,f=(120>f?120:480>f?480:1080>f?1080:1920>f?1920:3e3>f?3e3:4320>f?4320:1960*O2(f/1960))-f,10<f){n.timeoutHandle=tm(aa.bind(null,n,qr,Io),f);break}aa(n,qr,Io);break;case 5:aa(n,qr,Io);break;default:throw Error(Pe(329))}}}return Kr(n,Rn()),n.callbackNode===l?p0.bind(null,n):null}function wm(n,o){var l=Zu;return n.current.memoizedState.isDehydrated&&(ha(n,o).flags|=256),n=Td(n,o),n!==2&&(o=qr,qr=l,o!==null&&bm(o)),n}function bm(n){qr===null?qr=n:qr.push.apply(qr,n)}function N2(n){for(var o=n;;){if(o.flags&16384){var l=o.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var f=0;f<l.length;f++){var _=l[f],v=_.getSnapshot;_=_.value;try{if(!Zi(v(),_))return!1}catch{return!1}}}if(l=o.child,o.subtreeFlags&16384&&l!==null)l.return=o,o=l;else{if(o===n)break;for(;o.sibling===null;){if(o.return===null||o.return===n)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function ds(n,o){for(o&=~mg,o&=~Od,n.suspendedLanes|=o,n.pingedLanes&=~o,n=n.expirationTimes;0<o;){var l=31-ji(o),f=1<<l;n[l]=-1,o&=~f}}function ev(n){if(Nt&6)throw Error(Pe(327));ml();var o=ad(n,0);if(!(o&1))return Kr(n,Rn()),null;var l=Td(n,o);if(n.tag!==0&&l===2){var f=Wf(n);f!==0&&(o=f,l=wm(n,f))}if(l===1)throw l=cc,ha(n,0),ds(n,o),Kr(n,Rn()),l;if(l===6)throw Error(Pe(345));return n.finishedWork=n.current.alternate,n.finishedLanes=o,aa(n,qr,Io),Kr(n,Rn()),null}function yg(n,o){var l=Nt;Nt|=1;try{return n(o)}finally{Nt=l,Nt===0&&(bl=Rn()+500,Ld&&zs())}}function ya(n){fs!==null&&fs.tag===0&&!(Nt&6)&&ml();var o=Nt;Nt|=1;var l=bi.transition,f=Ht;try{if(bi.transition=null,Ht=1,n)return n()}finally{Ht=f,bi.transition=l,Nt=o,!(Nt&6)&&zs()}}function _g(){oi=ul.current,dn(ul)}function ha(n,o){n.finishedWork=null,n.finishedLanes=0;var l=n.timeoutHandle;if(l!==-1&&(n.timeoutHandle=-1,m2(l)),Gn!==null)for(l=Gn.return;l!==null;){var f=l;switch(Jm(f),f.tag){case 1:f=f.type.childContextTypes,f!=null&&dd();break;case 3:xl(),dn(Xr),dn(Er),ag();break;case 5:sg(f);break;case 4:xl();break;case 13:dn(wn);break;case 19:dn(wn);break;case 10:ng(f.type._context);break;case 22:case 23:_g()}l=l.return}if(or=n,Gn=n=Ss(n.current,null),dr=oi=o,Hn=0,cc=null,mg=Od=ga=0,qr=Zu=null,ua!==null){for(o=0;o<ua.length;o++)if(l=ua[o],f=l.interleaved,f!==null){l.interleaved=null;var _=f.next,v=l.pending;if(v!==null){var C=v.next;v.next=_,f.next=C}l.pending=f}ua=null}return n}function f0(n,o){do{var l=Gn;try{if(tg(),Kh.current=wd,xd){for(var f=bn.memoizedState;f!==null;){var _=f.queue;_!==null&&(_.pending=null),f=f.next}xd=!1}if(ma=0,ir=Xn=bn=null,ju=!1,ac=0,fg.current=null,l===null||l.return===null){Hn=1,cc=o,Gn=null;break}e:{var v=n,C=l.return,u=l,O=o;if(o=dr,u.flags|=32768,O!==null&&typeof O=="object"&&typeof O.then=="function"){var Z=O,ue=u,te=ue.tag;if(!(ue.mode&1)&&(te===0||te===11||te===15)){var q=ue.alternate;q?(ue.updateQueue=q.updateQueue,ue.memoizedState=q.memoizedState,ue.lanes=q.lanes):(ue.updateQueue=null,ue.memoizedState=null)}var Ae=V_(C);if(Ae!==null){Ae.flags&=-257,$_(Ae,C,u,v,o),Ae.mode&1&&U_(v,Z,o),o=Ae,O=Z;var Ce=o.updateQueue;if(Ce===null){var we=new Set;we.add(O),o.updateQueue=we}else Ce.add(O);break e}else{if(!(o&1)){U_(v,Z,o),vg();break e}O=Error(Pe(426))}}else if(gn&&u.mode&1){var xt=V_(C);if(xt!==null){!(xt.flags&65536)&&(xt.flags|=256),$_(xt,C,u,v,o),Qm(wl(O,u));break e}}v=O=wl(O,u),Hn!==4&&(Hn=2),Zu===null?Zu=[v]:Zu.push(v),v=C;do{switch(v.tag){case 3:v.flags|=65536,o&=-o,v.lanes|=o;var se=Yx(v,O,o);D_(v,se);break e;case 1:u=O;var Q=v.type,ae=v.stateNode;if(!(v.flags&128)&&(typeof Q.getDerivedStateFromError=="function"||ae!==null&&typeof ae.componentDidCatch=="function"&&(ws===null||!ws.has(ae)))){v.flags|=65536,o&=-o,v.lanes|=o;var ke=Jx(v,u,o);D_(v,ke);break e}}v=v.return}while(v!==null)}y0(l)}catch(Me){o=Me,Gn===l&&l!==null&&(Gn=l=l.return);continue}break}while(1)}function m0(){var n=bd.current;return bd.current=wd,n===null?wd:n}function vg(){(Hn===0||Hn===3||Hn===2)&&(Hn=4),or===null||!(ga&268435455)&&!(Od&268435455)||ds(or,dr)}function Td(n,o){var l=Nt;Nt|=2;var f=m0();(or!==n||dr!==o)&&(Io=null,ha(n,o));do try{U2();break}catch(_){f0(n,_)}while(1);if(tg(),Nt=l,bd.current=f,Gn!==null)throw Error(Pe(261));return or=null,dr=0,Hn}function U2(){for(;Gn!==null;)g0(Gn)}function V2(){for(;Gn!==null&&!db();)g0(Gn)}function g0(n){var o=v0(n.alternate,n,oi);n.memoizedProps=n.pendingProps,o===null?y0(n):Gn=o,fg.current=null}function y0(n){var o=n;do{var l=o.alternate;if(n=o.return,o.flags&32768){if(l=L2(l,o),l!==null){l.flags&=32767,Gn=l;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Hn=6,Gn=null;return}}else if(l=D2(l,o,oi),l!==null){Gn=l;return}if(o=o.sibling,o!==null){Gn=o;return}Gn=o=n}while(o!==null);Hn===0&&(Hn=5)}function aa(n,o,l){var f=Ht,_=bi.transition;try{bi.transition=null,Ht=1,$2(n,o,l,f)}finally{bi.transition=_,Ht=f}return null}function $2(n,o,l,f){do ml();while(fs!==null);if(Nt&6)throw Error(Pe(327));l=n.finishedWork;var _=n.finishedLanes;if(l===null)return null;if(n.finishedWork=null,n.finishedLanes=0,l===n.current)throw Error(Pe(177));n.callbackNode=null,n.callbackPriority=0;var v=l.lanes|l.childLanes;if(bb(n,v),n===or&&(Gn=or=null,dr=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Vh||(Vh=!0,x0(sd,function(){return ml(),null})),v=(l.flags&15990)!==0,l.subtreeFlags&15990||v){v=bi.transition,bi.transition=null;var C=Ht;Ht=1;var u=Nt;Nt|=4,fg.current=null,B2(n,l),h0(l,n),l2(Qf),ld=!!Jf,Qf=Jf=null,n.current=l,F2(l),pb(),Nt=u,Ht=C,bi.transition=v}else n.current=l;if(Vh&&(Vh=!1,fs=n,Ed=_),v=n.pendingLanes,v===0&&(ws=null),gb(l.stateNode),Kr(n,Rn()),o!==null)for(f=n.onRecoverableError,l=0;l<o.length;l++)_=o[l],f(_.value,{componentStack:_.stack,digest:_.digest});if(Sd)throw Sd=!1,n=vm,vm=null,n;return Ed&1&&n.tag!==0&&ml(),v=n.pendingLanes,v&1?n===xm?qu++:(qu=0,xm=n):qu=0,zs(),null}function ml(){if(fs!==null){var n=Kv(Ed),o=bi.transition,l=Ht;try{if(bi.transition=null,Ht=16>n?16:n,fs===null)var f=!1;else{if(n=fs,fs=null,Ed=0,Nt&6)throw Error(Pe(331));var _=Nt;for(Nt|=4,nt=n.current;nt!==null;){var v=nt,C=v.child;if(nt.flags&16){var u=v.deletions;if(u!==null){for(var O=0;O<u.length;O++){var Z=u[O];for(nt=Z;nt!==null;){var ue=nt;switch(ue.tag){case 0:case 11:case 15:Gu(8,ue,v)}var te=ue.child;if(te!==null)te.return=ue,nt=te;else for(;nt!==null;){ue=nt;var q=ue.sibling,Ae=ue.return;if(l0(ue),ue===Z){nt=null;break}if(q!==null){q.return=Ae,nt=q;break}nt=Ae}}}var Ce=v.alternate;if(Ce!==null){var we=Ce.child;if(we!==null){Ce.child=null;do{var xt=we.sibling;we.sibling=null,we=xt}while(we!==null)}}nt=v}}if(v.subtreeFlags&2064&&C!==null)C.return=v,nt=C;else e:for(;nt!==null;){if(v=nt,v.flags&2048)switch(v.tag){case 0:case 11:case 15:Gu(9,v,v.return)}var se=v.sibling;if(se!==null){se.return=v.return,nt=se;break e}nt=v.return}}var Q=n.current;for(nt=Q;nt!==null;){C=nt;var ae=C.child;if(C.subtreeFlags&2064&&ae!==null)ae.return=C,nt=ae;else e:for(C=Q;nt!==null;){if(u=nt,u.flags&2048)try{switch(u.tag){case 0:case 11:case 15:Fd(9,u)}}catch(Me){An(u,u.return,Me)}if(u===C){nt=null;break e}var ke=u.sibling;if(ke!==null){ke.return=u.return,nt=ke;break e}nt=u.return}}if(Nt=_,zs(),ao&&typeof ao.onPostCommitFiberRoot=="function")try{ao.onPostCommitFiberRoot(zd,n)}catch{}f=!0}return f}finally{Ht=l,bi.transition=o}}return!1}function tv(n,o,l){o=wl(l,o),o=Yx(n,o,1),n=xs(n,o,1),o=Br(),n!==null&&(fc(n,1,o),Kr(n,o))}function An(n,o,l){if(n.tag===3)tv(n,n,l);else for(;o!==null;){if(o.tag===3){tv(o,n,l);break}else if(o.tag===1){var f=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof f.componentDidCatch=="function"&&(ws===null||!ws.has(f))){n=wl(l,n),n=Jx(o,n,1),o=xs(o,n,1),n=Br(),o!==null&&(fc(o,1,n),Kr(o,n));break}}o=o.return}}function j2(n,o,l){var f=n.pingCache;f!==null&&f.delete(o),o=Br(),n.pingedLanes|=n.suspendedLanes&l,or===n&&(dr&l)===l&&(Hn===4||Hn===3&&(dr&130023424)===dr&&500>Rn()-gg?ha(n,0):mg|=l),Kr(n,o)}function _0(n,o){o===0&&(n.mode&1?(o=Mh,Mh<<=1,!(Mh&130023424)&&(Mh=4194304)):o=1);var l=Br();n=Fo(n,o),n!==null&&(fc(n,o,l),Kr(n,l))}function G2(n){var o=n.memoizedState,l=0;o!==null&&(l=o.retryLane),_0(n,l)}function Z2(n,o){var l=0;switch(n.tag){case 13:var f=n.stateNode,_=n.memoizedState;_!==null&&(l=_.retryLane);break;case 19:f=n.stateNode;break;default:throw Error(Pe(314))}f!==null&&f.delete(o),_0(n,l)}var v0;v0=function(n,o,l){if(n!==null)if(n.memoizedProps!==o.pendingProps||Xr.current)Wr=!0;else{if(!(n.lanes&l)&&!(o.flags&128))return Wr=!1,P2(n,o,l);Wr=!!(n.flags&131072)}else Wr=!1,gn&&o.flags&1048576&&bx(o,md,o.index);switch(o.lanes=0,o.tag){case 2:var f=o.type;Jh(n,o),n=o.pendingProps;var _=yl(o,Er.current);fl(o,l),_=ug(null,o,f,n,_,l);var v=cg();return o.flags|=1,typeof _=="object"&&_!==null&&typeof _.render=="function"&&_.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,Hr(f)?(v=!0,pd(o)):v=!1,o.memoizedState=_.state!==null&&_.state!==void 0?_.state:null,ig(o),_.updater=Rd,o.stateNode=_,_._reactInternals=o,lm(o,f,n,l),o=hm(null,o,f,!0,v,l)):(o.tag=0,gn&&v&&Ym(o),Rr(null,o,_,l),o=o.child),o;case 16:f=o.elementType;e:{switch(Jh(n,o),n=o.pendingProps,_=f._init,f=_(f._payload),o.type=f,_=o.tag=W2(f),n=Oi(f,n),_){case 0:o=cm(null,o,f,n,l);break e;case 1:o=Z_(null,o,f,n,l);break e;case 11:o=j_(null,o,f,n,l);break e;case 14:o=G_(null,o,f,Oi(f.type,n),l);break e}throw Error(Pe(306,f,""))}return o;case 0:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:Oi(f,_),cm(n,o,f,_,l);case 1:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:Oi(f,_),Z_(n,o,f,_,l);case 3:e:{if(n0(o),n===null)throw Error(Pe(387));f=o.pendingProps,v=o.memoizedState,_=v.element,kx(n,o),_d(o,f,null,l);var C=o.memoizedState;if(f=C.element,v.isDehydrated)if(v={element:f,isDehydrated:!1,cache:C.cache,pendingSuspenseBoundaries:C.pendingSuspenseBoundaries,transitions:C.transitions},o.updateQueue.baseState=v,o.memoizedState=v,o.flags&256){_=wl(Error(Pe(423)),o),o=q_(n,o,f,l,_);break e}else if(f!==_){_=wl(Error(Pe(424)),o),o=q_(n,o,f,l,_);break e}else for(si=vs(o.stateNode.containerInfo.firstChild),ai=o,gn=!0,Ui=null,l=Ax(o,null,f,l),o.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(_l(),f===_){o=Oo(n,o,l);break e}Rr(n,o,f,l)}o=o.child}return o;case 5:return Mx(o),n===null&&om(o),f=o.type,_=o.pendingProps,v=n!==null?n.memoizedProps:null,C=_.children,em(f,_)?C=null:v!==null&&em(f,v)&&(o.flags|=32),t0(n,o),Rr(n,o,C,l),o.child;case 6:return n===null&&om(o),null;case 13:return r0(n,o,l);case 4:return og(o,o.stateNode.containerInfo),f=o.pendingProps,n===null?o.child=vl(o,null,f,l):Rr(n,o,f,l),o.child;case 11:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:Oi(f,_),j_(n,o,f,_,l);case 7:return Rr(n,o,o.pendingProps,l),o.child;case 8:return Rr(n,o,o.pendingProps.children,l),o.child;case 12:return Rr(n,o,o.pendingProps.children,l),o.child;case 10:e:{if(f=o.type._context,_=o.pendingProps,v=o.memoizedProps,C=_.value,ln(gd,f._currentValue),f._currentValue=C,v!==null)if(Zi(v.value,C)){if(v.children===_.children&&!Xr.current){o=Oo(n,o,l);break e}}else for(v=o.child,v!==null&&(v.return=o);v!==null;){var u=v.dependencies;if(u!==null){C=v.child;for(var O=u.firstContext;O!==null;){if(O.context===f){if(v.tag===1){O=Lo(-1,l&-l),O.tag=2;var Z=v.updateQueue;if(Z!==null){Z=Z.shared;var ue=Z.pending;ue===null?O.next=O:(O.next=ue.next,ue.next=O),Z.pending=O}}v.lanes|=l,O=v.alternate,O!==null&&(O.lanes|=l),sm(v.return,l,o),u.lanes|=l;break}O=O.next}}else if(v.tag===10)C=v.type===o.type?null:v.child;else if(v.tag===18){if(C=v.return,C===null)throw Error(Pe(341));C.lanes|=l,u=C.alternate,u!==null&&(u.lanes|=l),sm(C,l,o),C=v.sibling}else C=v.child;if(C!==null)C.return=v;else for(C=v;C!==null;){if(C===o){C=null;break}if(v=C.sibling,v!==null){v.return=C.return,C=v;break}C=C.return}v=C}Rr(n,o,_.children,l),o=o.child}return o;case 9:return _=o.type,f=o.pendingProps.children,fl(o,l),_=Si(_),f=f(_),o.flags|=1,Rr(n,o,f,l),o.child;case 14:return f=o.type,_=Oi(f,o.pendingProps),_=Oi(f.type,_),G_(n,o,f,_,l);case 15:return Qx(n,o,o.type,o.pendingProps,l);case 17:return f=o.type,_=o.pendingProps,_=o.elementType===f?_:Oi(f,_),Jh(n,o),o.tag=1,Hr(f)?(n=!0,pd(o)):n=!1,fl(o,l),Ix(o,f,_),lm(o,f,_,l),hm(null,o,f,!0,n,l);case 19:return i0(n,o,l);case 22:return e0(n,o,l)}throw Error(Pe(156,o.tag))};function x0(n,o){return qv(n,o)}function q2(n,o,l,f){this.tag=n,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=f,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wi(n,o,l,f){return new q2(n,o,l,f)}function xg(n){return n=n.prototype,!(!n||!n.isReactComponent)}function W2(n){if(typeof n=="function")return xg(n)?1:0;if(n!=null){if(n=n.$$typeof,n===Nm)return 11;if(n===Um)return 14}return 2}function Ss(n,o){var l=n.alternate;return l===null?(l=wi(n.tag,o,n.key,n.mode),l.elementType=n.elementType,l.type=n.type,l.stateNode=n.stateNode,l.alternate=n,n.alternate=l):(l.pendingProps=o,l.type=n.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=n.flags&14680064,l.childLanes=n.childLanes,l.lanes=n.lanes,l.child=n.child,l.memoizedProps=n.memoizedProps,l.memoizedState=n.memoizedState,l.updateQueue=n.updateQueue,o=n.dependencies,l.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},l.sibling=n.sibling,l.index=n.index,l.ref=n.ref,l}function td(n,o,l,f,_,v){var C=2;if(f=n,typeof n=="function")xg(n)&&(C=1);else if(typeof n=="string")C=5;else e:switch(n){case Qa:return da(l.children,_,v,o);case Om:C=8,_|=8;break;case Pf:return n=wi(12,l,o,_|2),n.elementType=Pf,n.lanes=v,n;case Df:return n=wi(13,l,o,_),n.elementType=Df,n.lanes=v,n;case Lf:return n=wi(19,l,o,_),n.elementType=Lf,n.lanes=v,n;case zv:return Nd(l,_,v,o);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case Cv:C=10;break e;case Iv:C=9;break e;case Nm:C=11;break e;case Um:C=14;break e;case us:C=16,f=null;break e}throw Error(Pe(130,n==null?n:typeof n,""))}return o=wi(C,l,o,_),o.elementType=n,o.type=f,o.lanes=v,o}function da(n,o,l,f){return n=wi(7,n,f,o),n.lanes=l,n}function Nd(n,o,l,f){return n=wi(22,n,f,o),n.elementType=zv,n.lanes=l,n.stateNode={isHidden:!1},n}function xf(n,o,l){return n=wi(6,n,null,o),n.lanes=l,n}function wf(n,o,l){return o=wi(4,n.children!==null?n.children:[],n.key,o),o.lanes=l,o.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},o}function X2(n,o,l,f,_){this.tag=o,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=ef(0),this.expirationTimes=ef(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=ef(0),this.identifierPrefix=f,this.onRecoverableError=_,this.mutableSourceEagerHydrationData=null}function wg(n,o,l,f,_,v,C,u,O){return n=new X2(n,o,l,u,O),o===1?(o=1,v===!0&&(o|=8)):o=0,v=wi(3,null,null,o),n.current=v,v.stateNode=n,v.memoizedState={element:f,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},ig(v),n}function H2(n,o,l){var f=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ja,key:f==null?null:""+f,children:n,containerInfo:o,implementation:l}}function w0(n){if(!n)return Ts;n=n._reactInternals;e:{if(va(n)!==n||n.tag!==1)throw Error(Pe(170));var o=n;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(Hr(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(Pe(171))}if(n.tag===1){var l=n.type;if(Hr(l))return xx(n,l,o)}return o}function b0(n,o,l,f,_,v,C,u,O){return n=wg(l,f,!0,n,_,v,C,u,O),n.context=w0(null),l=n.current,f=Br(),_=bs(l),v=Lo(f,_),v.callback=o??null,xs(l,v,_),n.current.lanes=_,fc(n,_,f),Kr(n,f),n}function Ud(n,o,l,f){var _=o.current,v=Br(),C=bs(_);return l=w0(l),o.context===null?o.context=l:o.pendingContext=l,o=Lo(v,C),o.payload={element:n},f=f===void 0?null:f,f!==null&&(o.callback=f),n=xs(_,o,C),n!==null&&(Gi(n,_,C,v),Hh(n,_,C)),C}function kd(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function nv(n,o){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var l=n.retryLane;n.retryLane=l!==0&&l<o?l:o}}function bg(n,o){nv(n,o),(n=n.alternate)&&nv(n,o)}function K2(){return null}var S0=typeof reportError=="function"?reportError:function(n){console.error(n)};function Sg(n){this._internalRoot=n}Vd.prototype.render=Sg.prototype.render=function(n){var o=this._internalRoot;if(o===null)throw Error(Pe(409));Ud(n,o,null,null)};Vd.prototype.unmount=Sg.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var o=n.containerInfo;ya(function(){Ud(null,n,null,null)}),o[Bo]=null}};function Vd(n){this._internalRoot=n}Vd.prototype.unstable_scheduleHydration=function(n){if(n){var o=Qv();n={blockedOn:null,target:n,priority:o};for(var l=0;l<hs.length&&o!==0&&o<hs[l].priority;l++);hs.splice(l,0,n),l===0&&tx(n)}};function Eg(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function $d(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function rv(){}function Y2(n,o,l,f,_){if(_){if(typeof f=="function"){var v=f;f=function(){var Z=kd(C);v.call(Z)}}var C=b0(o,f,n,0,null,!1,!1,"",rv);return n._reactRootContainer=C,n[Bo]=C.current,nc(n.nodeType===8?n.parentNode:n),ya(),C}for(;_=n.lastChild;)n.removeChild(_);if(typeof f=="function"){var u=f;f=function(){var Z=kd(O);u.call(Z)}}var O=wg(n,0,!1,null,null,!1,!1,"",rv);return n._reactRootContainer=O,n[Bo]=O.current,nc(n.nodeType===8?n.parentNode:n),ya(function(){Ud(o,O,l,f)}),O}function jd(n,o,l,f,_){var v=l._reactRootContainer;if(v){var C=v;if(typeof _=="function"){var u=_;_=function(){var O=kd(C);u.call(O)}}Ud(o,C,n,_)}else C=Y2(l,o,n,_,f);return kd(C)}Yv=function(n){switch(n.tag){case 3:var o=n.stateNode;if(o.current.memoizedState.isDehydrated){var l=Bu(o.pendingLanes);l!==0&&(jm(o,l|1),Kr(o,Rn()),!(Nt&6)&&(bl=Rn()+500,zs()))}break;case 13:ya(function(){var f=Fo(n,1);if(f!==null){var _=Br();Gi(f,n,1,_)}}),bg(n,1)}};Gm=function(n){if(n.tag===13){var o=Fo(n,134217728);if(o!==null){var l=Br();Gi(o,n,134217728,l)}bg(n,134217728)}};Jv=function(n){if(n.tag===13){var o=bs(n),l=Fo(n,o);if(l!==null){var f=Br();Gi(l,n,o,f)}bg(n,o)}};Qv=function(){return Ht};ex=function(n,o){var l=Ht;try{return Ht=n,o()}finally{Ht=l}};Gf=function(n,o,l){switch(o){case"input":if(Ff(n,l),o=l.name,l.type==="radio"&&o!=null){for(l=n;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<l.length;o++){var f=l[o];if(f!==n&&f.form===n.form){var _=Dd(f);if(!_)throw Error(Pe(90));Mv(f),Ff(f,_)}}}break;case"textarea":Dv(n,l);break;case"select":o=l.value,o!=null&&cl(n,!!l.multiple,o,!1)}};Uv=yg;Vv=ya;var J2={usingClientEntryPoint:!1,Events:[gc,rl,Dd,Ov,Nv,yg]},Du={findFiberByHostInstance:la,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},Q2={bundleType:Du.bundleType,version:Du.version,rendererPackageName:Du.rendererPackageName,rendererConfig:Du.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:No.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=Gv(n),n===null?null:n.stateNode},findFiberByHostInstance:Du.findFiberByHostInstance||K2,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var $h=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!$h.isDisabled&&$h.supportsFiber)try{zd=$h.inject(Q2),ao=$h}catch{}}ui.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J2;ui.createPortal=function(n,o){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Eg(o))throw Error(Pe(200));return H2(n,o,null,l)};ui.createRoot=function(n,o){if(!Eg(n))throw Error(Pe(299));var l=!1,f="",_=S0;return o!=null&&(o.unstable_strictMode===!0&&(l=!0),o.identifierPrefix!==void 0&&(f=o.identifierPrefix),o.onRecoverableError!==void 0&&(_=o.onRecoverableError)),o=wg(n,1,!1,null,null,l,!1,f,_),n[Bo]=o.current,nc(n.nodeType===8?n.parentNode:n),new Sg(o)};ui.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var o=n._reactInternals;if(o===void 0)throw typeof n.render=="function"?Error(Pe(188)):(n=Object.keys(n).join(","),Error(Pe(268,n)));return n=Gv(o),n=n===null?null:n.stateNode,n};ui.flushSync=function(n){return ya(n)};ui.hydrate=function(n,o,l){if(!$d(o))throw Error(Pe(200));return jd(null,n,o,!0,l)};ui.hydrateRoot=function(n,o,l){if(!Eg(n))throw Error(Pe(405));var f=l!=null&&l.hydratedSources||null,_=!1,v="",C=S0;if(l!=null&&(l.unstable_strictMode===!0&&(_=!0),l.identifierPrefix!==void 0&&(v=l.identifierPrefix),l.onRecoverableError!==void 0&&(C=l.onRecoverableError)),o=b0(o,null,n,1,l??null,_,!1,v,C),n[Bo]=o.current,nc(n),f)for(n=0;n<f.length;n++)l=f[n],_=l._getVersion,_=_(l._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[l,_]:o.mutableSourceEagerHydrationData.push(l,_);return new Vd(o)};ui.render=function(n,o,l){if(!$d(o))throw Error(Pe(200));return jd(null,n,o,!1,l)};ui.unmountComponentAtNode=function(n){if(!$d(n))throw Error(Pe(40));return n._reactRootContainer?(ya(function(){jd(null,null,n,!1,function(){n._reactRootContainer=null,n[Bo]=null})}),!0):!1};ui.unstable_batchedUpdates=yg;ui.unstable_renderSubtreeIntoContainer=function(n,o,l,f){if(!$d(l))throw Error(Pe(200));if(n==null||n._reactInternals===void 0)throw Error(Pe(38));return jd(n,o,l,!1,f)};ui.version="18.2.0-next-9e3b772b8-20220608";(function(n){function o(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(o)}catch(l){console.error(l)}}o(),n.exports=ui})(Kw);var iv=Wu;zf.createRoot=iv.createRoot,zf.hydrateRoot=iv.hydrateRoot;const eS="modulepreload",tS=function(n){return"/energomera_test/"+n},ov={},nS=function(o,l,f){if(!l||l.length===0)return o();const _=document.getElementsByTagName("link");return Promise.all(l.map(v=>{if(v=tS(v),v in ov)return;ov[v]=!0;const C=v.endsWith(".css"),u=C?'[rel="stylesheet"]':"";if(!!f)for(let ue=_.length-1;ue>=0;ue--){const te=_[ue];if(te.href===v&&(!C||te.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${v}"]${u}`))return;const Z=document.createElement("link");if(Z.rel=C?"stylesheet":eS,C||(Z.as="script",Z.crossOrigin=""),Z.href=v,document.head.appendChild(Z),C)return new Promise((ue,te)=>{Z.addEventListener("load",ue),Z.addEventListener("error",()=>te(new Error(`Unable to preload CSS for ${v}`)))})})).then(()=>o())},rS=qe.createContext(null);function iS(n){const o=n.clone();return o.pixelsToGLUnits=n.pixelsToGLUnits,o}function sv(n){return{longitude:n.center.lng,latitude:n.center.lat,zoom:n.zoom,pitch:n.pitch,bearing:n.bearing,padding:n.padding}}function av(n,o){const l=o.viewState||o;let f=!1;if("longitude"in l&&"latitude"in l){const _=n.center;n.center=new _.constructor(l.longitude,l.latitude),f=f||_!==n.center}if("zoom"in l){const _=n.zoom;n.zoom=l.zoom,f=f||_!==n.zoom}if("bearing"in l){const _=n.bearing;n.bearing=l.bearing,f=f||_!==n.bearing}if("pitch"in l){const _=n.pitch;n.pitch=l.pitch,f=f||_!==n.pitch}return l.padding&&!n.isPaddingEqual(l.padding)&&(f=!0,n.padding=l.padding),f}const oS=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function lv(n){if(!n)return null;if(typeof n=="string"||("toJS"in n&&(n=n.toJS()),!n.layers))return n;const o={};for(const f of n.layers)o[f.id]=f;const l=n.layers.map(f=>{const _=o[f.ref];let v=null;if("interactive"in f&&(v={...f},delete v.interactive),_){v=v||{...f},delete v.ref;for(const C of oS)C in _&&(v[C]=_[C])}return v||f});return{...n,layers:l}}function sS(n,o){const l=Array.isArray(n)?n[0]:n?n.x:0,f=Array.isArray(n)?n[1]:n?n.y:0,_=Array.isArray(o)?o[0]:o?o.x:0,v=Array.isArray(o)?o[1]:o?o.y:0;return l===_&&f===v}function xi(n,o){if(n===o)return!0;if(!n||!o)return!1;if(Array.isArray(n)){if(!Array.isArray(o)||n.length!==o.length)return!1;for(let l=0;l<n.length;l++)if(!xi(n[l],o[l]))return!1;return!0}else if(Array.isArray(o))return!1;if(typeof n=="object"&&typeof o=="object"){const l=Object.keys(n),f=Object.keys(o);if(l.length!==f.length)return!1;for(const _ of l)if(!o.hasOwnProperty(_)||!xi(n[_],o[_]))return!1;return!0}return!1}const uv={mousedown:"onMouseDown",mouseup:"onMouseUp",mouseover:"onMouseOver",mousemove:"onMouseMove",click:"onClick",dblclick:"onDblClick",mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mouseout:"onMouseOut",contextmenu:"onContextMenu",touchstart:"onTouchStart",touchend:"onTouchEnd",touchmove:"onTouchMove",touchcancel:"onTouchCancel"},bf={movestart:"onMoveStart",move:"onMove",moveend:"onMoveEnd",dragstart:"onDragStart",drag:"onDrag",dragend:"onDragEnd",zoomstart:"onZoomStart",zoom:"onZoom",zoomend:"onZoomEnd",rotatestart:"onRotateStart",rotate:"onRotate",rotateend:"onRotateEnd",pitchstart:"onPitchStart",pitch:"onPitch",pitchend:"onPitchEnd"},cv={wheel:"onWheel",boxzoomstart:"onBoxZoomStart",boxzoomend:"onBoxZoomEnd",boxzoomcancel:"onBoxZoomCancel",resize:"onResize",load:"onLoad",render:"onRender",idle:"onIdle",remove:"onRemove",data:"onData",styledata:"onStyleData",sourcedata:"onSourceData",error:"onError"},aS=["minZoom","maxZoom","minPitch","maxPitch","maxBounds","projection","renderWorldCopies"],lS=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate","touchPitch"];class Sl{constructor(o,l,f){this._map=null,this._internalUpdate=!1,this._inRender=!1,this._hoveredFeatures=null,this._deferredEvents={move:!1,zoom:!1,pitch:!1,rotate:!1},this._onEvent=_=>{const v=this.props[cv[_.type]];v&&v(_)},this._onPointerEvent=_=>{(_.type==="mousemove"||_.type==="mouseout")&&this._updateHover(_);const v=this.props[uv[_.type]];if(v){if(this.props.interactiveLayerIds&&_.type!=="mouseover"&&_.type!=="mouseout"){const C=this._hoveredFeatures||this._map.queryRenderedFeatures(_.point,{layers:this.props.interactiveLayerIds});_.features=C}v(_),delete _.features}},this._onCameraEvent=_=>{if(!this._internalUpdate){const v=this.props[bf[_.type]];v&&v(_)}_.type in this._deferredEvents&&(this._deferredEvents[_.type]=!1)},this._MapClass=o,this.props=l,this._initialize(f)}get map(){return this._map}get transform(){return this._renderTransform}setProps(o){const l=this.props;this.props=o;const f=this._updateSettings(o,l);f&&this._createShadowTransform(this._map);const _=this._updateSize(o),v=this._updateViewState(o,!0);this._updateStyle(o,l),this._updateStyleComponents(o,l),this._updateHandlers(o,l),(f||_||v&&!this._map.isMoving())&&this.redraw()}static reuse(o,l){const f=Sl.savedMaps.pop();if(!f)return null;const _=f.map,v=_.getContainer();for(l.className=v.className;v.childNodes.length>0;)l.appendChild(v.childNodes[0]);_._container=l,f.setProps({...o,styleDiffing:!1}),_.resize();const{initialViewState:C}=o;return C&&(C.bounds?_.fitBounds(C.bounds,{...C.fitBoundsOptions,duration:0}):f._updateViewState(C,!1)),_.isStyleLoaded()?_.fire("load"):_.once("styledata",()=>_.fire("load")),f}_initialize(o){const{props:l}=this,f={...l,...l.initialViewState,accessToken:l.mapboxAccessToken||uS()||null,container:o,style:lv(l.mapStyle)},_=f.initialViewState||f.viewState||f;if(Object.assign(f,{center:[_.longitude||0,_.latitude||0],zoom:_.zoom||0,pitch:_.pitch||0,bearing:_.bearing||0}),l.gl){const Z=HTMLCanvasElement.prototype.getContext;HTMLCanvasElement.prototype.getContext=()=>(HTMLCanvasElement.prototype.getContext=Z,l.gl)}const v=new this._MapClass(f);_.padding&&v.setPadding(_.padding),l.cursor&&(v.getCanvas().style.cursor=l.cursor),this._createShadowTransform(v);const C=v._render;v._render=Z=>{this._inRender=!0,C.call(v,Z),this._inRender=!1};const u=v._renderTaskQueue.run;v._renderTaskQueue.run=Z=>{u.call(v._renderTaskQueue,Z),this._onBeforeRepaint()},v.on("render",()=>this._onAfterRepaint());const O=v.fire;v.fire=this._fireEvent.bind(this,O),v.on("resize",()=>{this._renderTransform.resize(v.transform.width,v.transform.height)}),v.on("styledata",()=>this._updateStyleComponents(this.props,{})),v.on("sourcedata",()=>this._updateStyleComponents(this.props,{}));for(const Z in uv)v.on(Z,this._onPointerEvent);for(const Z in bf)v.on(Z,this._onCameraEvent);for(const Z in cv)v.on(Z,this._onEvent);this._map=v}recycle(){const l=this.map.getContainer().querySelector("[mapboxgl-children]");l==null||l.remove(),Sl.savedMaps.push(this)}destroy(){this._map.remove()}redraw(){const o=this._map;!this._inRender&&o.style&&(o._frame&&(o._frame.cancel(),o._frame=null),o._render())}_createShadowTransform(o){const l=iS(o.transform);o.painter.transform=l,this._renderTransform=l}_updateSize(o){const{viewState:l}=o;if(l){const f=this._map;if(l.width!==f.transform.width||l.height!==f.transform.height)return f.resize(),!0}return!1}_updateViewState(o,l){if(this._internalUpdate)return!1;const f=this._map,_=this._renderTransform,{zoom:v,pitch:C,bearing:u}=_,O=f.isMoving();O&&(_.cameraElevationReference="sea");const Z=av(_,{...sv(f.transform),...o});if(O&&(_.cameraElevationReference="ground"),Z&&l){const ue=this._deferredEvents;ue.move=!0,ue.zoom||(ue.zoom=v!==_.zoom),ue.rotate||(ue.rotate=u!==_.bearing),ue.pitch||(ue.pitch=C!==_.pitch)}return O||av(f.transform,o),Z}_updateSettings(o,l){const f=this._map;let _=!1;for(const v of aS)v in o&&!xi(o[v],l[v])&&(_=!0,f[`set${v[0].toUpperCase()}${v.slice(1)}`](o[v]));return _}_updateStyle(o,l){if(o.cursor!==l.cursor&&(this._map.getCanvas().style.cursor=o.cursor),o.mapStyle!==l.mapStyle){const f={diff:o.styleDiffing};return"localIdeographFontFamily"in o&&(f.localIdeographFontFamily=o.localIdeographFontFamily),this._map.setStyle(lv(o.mapStyle),f),!0}return!1}_updateStyleComponents(o,l){const f=this._map;let _=!1;return f.style.loaded()&&("light"in o&&!xi(o.light,l.light)&&(_=!0,f.setLight(o.light)),"fog"in o&&!xi(o.fog,l.fog)&&(_=!0,f.setFog(o.fog)),"terrain"in o&&!xi(o.terrain,l.terrain)&&(!o.terrain||f.getSource(o.terrain.source))&&(_=!0,f.setTerrain(o.terrain))),_}_updateHandlers(o,l){const f=this._map;let _=!1;for(const v of lS){const C=o[v];xi(C,l[v])||(_=!0,C?f[v].enable(C):f[v].disable())}return _}_updateHover(o){var l;const{props:f}=this;if(f.interactiveLayerIds&&(f.onMouseMove||f.onMouseEnter||f.onMouseLeave)){const v=o.type,C=((l=this._hoveredFeatures)===null||l===void 0?void 0:l.length)>0;let u;if(v==="mousemove")try{u=this._map.queryRenderedFeatures(o.point,{layers:f.interactiveLayerIds})}catch{u=[]}else u=[];const O=u.length>0;!O&&C&&(o.type="mouseleave",this._onPointerEvent(o)),this._hoveredFeatures=u,O&&!C&&(o.type="mouseenter",this._onPointerEvent(o)),o.type=v}else this._hoveredFeatures=null}_fireEvent(o,l,f){const _=this._map,v=_.transform,C=typeof l=="string"?l:l.type;return C==="move"&&this._updateViewState(this.props,!1),C in bf&&(typeof l=="object"&&(l.viewState=sv(v)),this._map.isMoving())?(_.transform=this._renderTransform,o.call(_,l,f),_.transform=v,_):(o.call(_,l,f),_)}_onBeforeRepaint(){const o=this._map;this._internalUpdate=!0;for(const f in this._deferredEvents)this._deferredEvents[f]&&o.fire(f);this._internalUpdate=!1;const l=this._map.transform;this._map.transform=this._renderTransform,this._onAfterRepaint=()=>{this._map.transform=l}}}Sl.savedMaps=[];function uS(){let n=null;if(typeof location<"u"){const o=/access_token=([^&\/]*)/.exec(location.search);n=o&&o[1]}try{n=n||{}.MapboxAccessToken}catch{}try{n=n||{}.REACT_APP_MAPBOX_ACCESS_TOKEN}catch{}return n}const cS=["setMaxBounds","setMinZoom","setMaxZoom","setMinPitch","setMaxPitch","setRenderWorldCopies","setProjection","setStyle","addSource","removeSource","addLayer","removeLayer","setLayerZoomRange","setFilter","setPaintProperty","setLayoutProperty","setLight","setTerrain","setFog","remove"];function hS(n,o){if(!n)return null;const l=n.map,f={getMap:()=>l,getCenter:()=>n.transform.center,getZoom:()=>n.transform.zoom,getBearing:()=>n.transform.bearing,getPitch:()=>n.transform.pitch,getPadding:()=>n.transform.padding,getBounds:()=>n.transform.getBounds(),project:_=>n.transform.locationPoint(o.LngLat.convert(_)),unproject:_=>n.transform.pointLocation(o.Point.convert(_)),queryTerrainElevation:(_,v)=>{const C=l.transform;l.transform=n.transform;const u=l.queryTerrainElevation(_,v);return l.transform=C,u}};for(const _ of dS(l))!(_ in f)&&!cS.includes(_)&&(f[_]=l[_].bind(l));return f}function dS(n){const o=new Set;let l=n;for(;l;){for(const f of Object.getOwnPropertyNames(l))f[0]!=="_"&&typeof n[f]=="function"&&f!=="fire"&&f!=="setEventedParent"&&o.add(f);l=Object.getPrototypeOf(l)}return Array.from(o)}const pS=typeof document<"u"?qe.useLayoutEffect:qe.useEffect,fS=["baseApiUrl","maxParallelImageRequests","workerClass","workerCount","workerUrl"];function mS(n,o){for(const l of fS)l in o&&(n[l]=o[l]);o.RTLTextPlugin&&n.getRTLTextPluginStatus&&n.getRTLTextPluginStatus()==="unavailable"&&n.setRTLTextPlugin(o.RTLTextPlugin,l=>{l&&console.error(l)},!1)}const Il=qe.createContext(null),gS={minZoom:0,maxZoom:22,minPitch:0,maxPitch:60,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,mapStyle:{version:8,sources:{},layers:[]},styleDiffing:!0,projection:"mercator",renderWorldCopies:!0,onError:n=>console.error(n.error),RTLTextPlugin:"https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-rtl-text/v0.2.3/mapbox-gl-rtl-text.js"},Tg=qe.forwardRef((n,o)=>{const l=qe.useContext(rS),[f,_]=qe.useState(null),v=qe.useRef(),{current:C}=qe.useRef({mapLib:null,map:null});qe.useEffect(()=>{const O=n.mapLib;let Z=!0,ue;return Promise.resolve(O||nS(()=>import("./index-fc2e9253.js").then(te=>te.i),[])).then(te=>{if(Z){if(te.Map||(te=te.default),!te||!te.Map)throw new Error("Invalid mapLib");if(te.supported(n))mS(te,n),n.reuseMaps&&(ue=Sl.reuse(n,v.current)),ue||(ue=new Sl(te.Map,n,v.current)),C.map=hS(ue,te),C.mapLib=te,_(ue),l==null||l.onMapMount(C.map,n.id);else throw new Error("Map is not supported by this browser")}}).catch(te=>{n.onError({type:"error",target:null,originalEvent:null,error:te})}),()=>{Z=!1,ue&&(l==null||l.onMapUnmount(n.id),n.reuseMaps?ue.recycle():ue.destroy())}},[]),pS(()=>{f&&f.setProps(n)}),qe.useImperativeHandle(o,()=>C.map,[f]);const u=qe.useMemo(()=>({position:"relative",width:"100%",height:"100%",...n.style}),[n.style]);return qe.createElement("div",{id:n.id,ref:v,style:u},f&&qe.createElement(Il.Provider,{value:C},qe.createElement("div",{"mapboxgl-children":""},n.children)))});Tg.displayName="Map";Tg.defaultProps=gS;const yS=/box|flex|grid|column|lineHeight|fontWeight|opacity|order|tabSize|zIndex/;function xa(n,o){if(!n||!o)return;const l=n.style;for(const f in o){const _=o[f];Number.isFinite(_)&&!yS.test(f)?l[f]=`${_}px`:l[f]=_}}const _S={draggable:!1,popup:null,rotation:0,rotationAlignment:"auto",pitchAlignment:"auto"};function E0(n){const{map:o,mapLib:l}=qe.useContext(Il),f=qe.useRef({props:n});f.current.props=n;const _=qe.useMemo(()=>{let v=!1;qe.Children.forEach(n.children,O=>{O&&(v=!0)});const C={...n,element:v?document.createElement("div"):null},u=new l.Marker(C).setLngLat([n.longitude,n.latitude]);return u.getElement().addEventListener("click",O=>{var Z,ue;(ue=(Z=f.current.props).onClick)===null||ue===void 0||ue.call(Z,{type:"click",target:u,originalEvent:O})}),u.on("dragstart",O=>{var Z,ue;const te=O;te.lngLat=_.getLngLat(),(ue=(Z=f.current.props).onDragStart)===null||ue===void 0||ue.call(Z,te)}),u.on("drag",O=>{var Z,ue;const te=O;te.lngLat=_.getLngLat(),(ue=(Z=f.current.props).onDrag)===null||ue===void 0||ue.call(Z,te)}),u.on("dragend",O=>{var Z,ue;const te=O;te.lngLat=_.getLngLat(),(ue=(Z=f.current.props).onDragEnd)===null||ue===void 0||ue.call(Z,te)}),u},[]);return qe.useEffect(()=>(_.addTo(o.getMap()),()=>{_.remove()}),[]),qe.useEffect(()=>{xa(_.getElement(),n.style)},[n.style]),(_.getLngLat().lng!==n.longitude||_.getLngLat().lat!==n.latitude)&&_.setLngLat([n.longitude,n.latitude]),n.offset&&!sS(_.getOffset(),n.offset)&&_.setOffset(n.offset),_.isDraggable()!==n.draggable&&_.setDraggable(n.draggable),_.getRotation()!==n.rotation&&_.setRotation(n.rotation),_.getRotationAlignment()!==n.rotationAlignment&&_.setRotationAlignment(n.rotationAlignment),_.getPitchAlignment()!==n.pitchAlignment&&_.setPitchAlignment(n.pitchAlignment),_.getPopup()!==n.popup&&_.setPopup(n.popup),Wu.createPortal(n.children,_.getElement())}E0.defaultProps=_S;const vS=qe.memo(E0);function hv(n){return new Set(n?n.trim().split(/\s+/):[])}function xS(n){const{map:o,mapLib:l}=qe.useContext(Il),f=qe.useMemo(()=>document.createElement("div"),[]),_=qe.useRef({props:n});_.current.props=n;const v=qe.useMemo(()=>{const C={...n},u=new l.Popup(C).setLngLat([n.longitude,n.latitude]);return u.once("open",O=>{var Z,ue;(ue=(Z=_.current.props).onOpen)===null||ue===void 0||ue.call(Z,O)}),u},[]);if(qe.useEffect(()=>{const C=u=>{var O,Z;(Z=(O=_.current.props).onClose)===null||Z===void 0||Z.call(O,u)};return v.on("close",C),v.setDOMContent(f).addTo(o.getMap()),()=>{v.off("close",C),v.isOpen()&&v.remove()}},[]),qe.useEffect(()=>{xa(v.getElement(),n.style)},[n.style]),v.isOpen()&&((v.getLngLat().lng!==n.longitude||v.getLngLat().lat!==n.latitude)&&v.setLngLat([n.longitude,n.latitude]),n.offset&&!xi(v.options.offset,n.offset)&&v.setOffset(n.offset),(v.options.anchor!==n.anchor||v.options.maxWidth!==n.maxWidth)&&(v.options.anchor=n.anchor,v.setMaxWidth(n.maxWidth)),v.options.className!==n.className)){const C=hv(v.options.className),u=hv(n.className);for(const O of C)u.has(O)||v.removeClassName(O);for(const O of u)C.has(O)||v.addClassName(O);v.options.className=n.className}return Wu.createPortal(n.children,f)}qe.memo(xS);function _c(n,o,l,f){const _=qe.useContext(Il),v=qe.useMemo(()=>n(_),[]);return qe.useEffect(()=>{const C=f||l||o,u=typeof o=="function"&&typeof l=="function"?o:null,O=typeof l=="function"?l:typeof o=="function"?o:null,{map:Z}=_;return Z.hasControl(v)||(Z.addControl(v,C==null?void 0:C.position),u&&u(_)),()=>{O&&O(_),Z.hasControl(v)&&Z.removeControl(v)}},[]),v}function wS(n){const o=_c(({mapLib:l})=>new l.AttributionControl(n),{position:n.position});return qe.useEffect(()=>{xa(o._container,n.style)},[n.style]),null}qe.memo(wS);function bS(n){const o=_c(({mapLib:l})=>new l.FullscreenControl({container:n.containerId&&document.getElementById(n.containerId)}),{position:n.position});return qe.useEffect(()=>{xa(o._controlContainer,n.style)},[n.style]),null}qe.memo(bS);const T0=qe.forwardRef((n,o)=>{const l=qe.useRef({props:n}),f=_c(({mapLib:_})=>{const v=new _.GeolocateControl(n),C=v._setupUI;return v._setupUI=u=>{v._container.hasChildNodes()||C(u)},v.on("geolocate",u=>{var O,Z;(Z=(O=l.current.props).onGeolocate)===null||Z===void 0||Z.call(O,u)}),v.on("error",u=>{var O,Z;(Z=(O=l.current.props).onError)===null||Z===void 0||Z.call(O,u)}),v.on("outofmaxbounds",u=>{var O,Z;(Z=(O=l.current.props).onOutOfMaxBounds)===null||Z===void 0||Z.call(O,u)}),v.on("trackuserlocationstart",u=>{var O,Z;(Z=(O=l.current.props).onTrackUserLocationStart)===null||Z===void 0||Z.call(O,u)}),v.on("trackuserlocationend",u=>{var O,Z;(Z=(O=l.current.props).onTrackUserLocationEnd)===null||Z===void 0||Z.call(O,u)}),v},{position:n.position});return l.current.props=n,qe.useImperativeHandle(o,()=>({trigger:()=>f.trigger()}),[]),qe.useEffect(()=>{xa(f._container,n.style)},[n.style]),null});T0.displayName="GeolocateControl";qe.memo(T0);function SS(n){const o=_c(({mapLib:l})=>new l.NavigationControl(n),{position:n.position});return qe.useEffect(()=>{xa(o._container,n.style)},[n.style]),null}qe.memo(SS);const ES={unit:"metric",maxWidth:100};function k0(n){const o=_c(({mapLib:l})=>new l.ScaleControl(n),{position:n.position});return(o.options.unit!==n.unit||o.options.maxWidth!==n.maxWidth)&&(o.options.maxWidth=n.maxWidth,o.setUnit(n.unit)),qe.useEffect(()=>{xa(o._container,n.style)},[n.style]),null}k0.defaultProps=ES;qe.memo(k0);function Cd(n,o){if(!n)throw new Error(o)}let TS=0;function kS(n,o,l){if(n.style&&n.style._loaded){const f={...l};return delete f.id,delete f.children,n.addSource(o,f),n.getSource(o)}return null}function CS(n,o,l){Cd(o.id===l.id,"source id changed"),Cd(o.type===l.type,"source type changed");let f="",_=0;for(const C in o)C!=="children"&&C!=="id"&&!xi(l[C],o[C])&&(f=C,_++);if(!_)return;const v=o.type;if(v==="geojson")n.setData(o.data);else if(v==="image")n.updateImage({url:o.url,coordinates:o.coordinates});else if((v==="canvas"||v==="video")&&_===1&&f==="coordinates")n.setCoordinates(o.coordinates);else if(v==="vector"&&"setUrl"in n)switch(f){case"url":n.setUrl(o.url);break;case"tiles":n.setTiles(o.tiles);break}else console.warn(`Unable to update <Source> prop: ${f}`)}function IS(n){const o=qe.useContext(Il).map.getMap(),l=qe.useRef(n),[,f]=qe.useState(0),_=qe.useMemo(()=>n.id||`jsx-source-${TS++}`,[]);qe.useEffect(()=>{if(o){const C=()=>setTimeout(()=>f(u=>u+1),0);return o.on("styledata",C),C(),()=>{var u;if(o.off("styledata",C),o.style&&o.style._loaded&&o.getSource(_)){const O=(u=o.getStyle())===null||u===void 0?void 0:u.layers;if(O)for(const Z of O)Z.source===_&&o.removeLayer(Z.id);o.removeSource(_)}}}},[o]);let v=o&&o.style&&o.getSource(_);return v?CS(v,n,l.current):v=kS(o,_,n),l.current=n,v&&qe.Children.map(n.children,C=>C&&qe.cloneElement(C,{source:_}))||null}function zS(n,o,l,f){if(Cd(l.id===f.id,"layer id changed"),Cd(l.type===f.type,"layer type changed"),l.type==="custom"||f.type==="custom")return;const{layout:_={},paint:v={},filter:C,minzoom:u,maxzoom:O,beforeId:Z}=l;if(Z!==f.beforeId&&n.moveLayer(o,Z),_!==f.layout){const ue=f.layout||{};for(const te in _)xi(_[te],ue[te])||n.setLayoutProperty(o,te,_[te]);for(const te in ue)_.hasOwnProperty(te)||n.setLayoutProperty(o,te,void 0)}if(v!==f.paint){const ue=f.paint||{};for(const te in v)xi(v[te],ue[te])||n.setPaintProperty(o,te,v[te]);for(const te in ue)v.hasOwnProperty(te)||n.setPaintProperty(o,te,void 0)}xi(C,f.filter)||n.setFilter(o,C),(u!==f.minzoom||O!==f.maxzoom)&&n.setLayerZoomRange(o,u,O)}function AS(n,o,l){if(n.style&&n.style._loaded&&(!("source"in l)||n.getSource(l.source))){const f={...l,id:o};delete f.beforeId,n.addLayer(f,l.beforeId)}}let MS=0;function PS(n){const o=qe.useContext(Il).map.getMap(),l=qe.useRef(n),[,f]=qe.useState(0),_=qe.useMemo(()=>n.id||`jsx-layer-${MS++}`,[]);if(qe.useEffect(()=>{if(o){const C=()=>f(u=>u+1);return o.on("styledata",C),C(),()=>{o.off("styledata",C),o.style&&o.style._loaded&&o.getLayer(_)&&o.removeLayer(_)}}},[o]),o&&o.style&&o.getLayer(_))try{zS(o,_,n,l.current)}catch(C){console.warn(C)}else AS(o,_,n);return l.current=n,null}var Sm={},DS={get exports(){return Sm},set exports(n){Sm=n}};(function(n,o){(function(l,f){n.exports=f()})(Ew,function(){var l,f,_;function v(u,O){if(!l)l=O;else if(!f)f=O;else{var Z="var sharedChunk = {}; ("+l+")(sharedChunk); ("+f+")(sharedChunk);",ue={};l(ue),_=O(ue),typeof window<"u"&&(_.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}v(["exports"],function(u){var O=Z;function Z(r,e,i,a){this.cx=3*r,this.bx=3*(i-r)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(a-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=r,this.p1y=e,this.p2x=i,this.p2y=a}function ue(r,e,i,a){const d=new O(r,e,i,a);return function(m){return d.solve(m)}}Z.prototype={sampleCurveX:function(r){return((this.ax*r+this.bx)*r+this.cx)*r},sampleCurveY:function(r){return((this.ay*r+this.by)*r+this.cy)*r},sampleCurveDerivativeX:function(r){return(3*this.ax*r+2*this.bx)*r+this.cx},solveCurveX:function(r,e){if(e===void 0&&(e=1e-6),r<0)return 0;if(r>1)return 1;for(var i=r,a=0;a<8;a++){var d=this.sampleCurveX(i)-r;if(Math.abs(d)<e)return i;var m=this.sampleCurveDerivativeX(i);if(Math.abs(m)<1e-6)break;i-=d/m}var y=0,w=1;for(i=r,a=0;a<20&&(d=this.sampleCurveX(i),!(Math.abs(d-r)<e));a++)r>d?y=i:w=i,i=.5*(w-y)+y;return i},solve:function(r,e){return this.sampleCurveY(this.solveCurveX(r,e))}};const te=ue(.25,.1,.25,1);function q(r,e,i){return Math.min(i,Math.max(e,r))}function Ae(r,e,i){const a=i-e,d=((r-e)%a+a)%a+e;return d===e?i:d}function Ce(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}let we=1;function xt(r,e){r.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function se(r,e,i){const a={};for(const d in r)a[d]=e.call(i||this,r[d],d,r);return a}function Q(r,e,i){const a={};for(const d in r)e.call(i||this,r[d],d,r)&&(a[d]=r[d]);return a}function ae(r){return Array.isArray(r)?r.map(ae):typeof r=="object"&&r?se(r,ae):r}const ke={};function Me(r){ke[r]||(typeof console<"u"&&console.warn(r),ke[r]=!0)}function ze(r,e,i){return(i.y-r.y)*(e.x-r.x)>(e.y-r.y)*(i.x-r.x)}function je(r){let e=0;for(let i,a,d=0,m=r.length,y=m-1;d<m;y=d++)i=r[d],a=r[y],e+=(a.x-i.x)*(i.y+a.y);return e}function He(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Mt(r){const e={};if(r.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,d,m)=>{const y=d||m;return e[a]=!y||y.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let ht,Wt,En=null;function yn(r){if(En==null){const e=r.navigator?r.navigator.userAgent:null;En=!!r.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return En}function Kn(r){return typeof ImageBitmap<"u"&&r instanceof ImageBitmap}const _n={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(r){const e=requestAnimationFrame(r);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(r,e=0){const i=window.document.createElement("canvas"),a=i.getContext("2d");if(!a)throw new Error("failed to create canvas 2d context");return i.width=r.width,i.height=r.height,a.drawImage(r,0,0,r.width,r.height),a.getImageData(-e,-e,r.width+2*e,r.height+2*e)},resolveURL:r=>(ht||(ht=document.createElement("a")),ht.href=r,ht.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Wt==null&&(Wt=matchMedia("(prefers-reduced-motion: reduce)")),Wt.matches)}};var ot=Tn;function Tn(r,e){this.x=r,this.y=e}Tn.prototype={clone:function(){return new Tn(this.x,this.y)},add:function(r){return this.clone()._add(r)},sub:function(r){return this.clone()._sub(r)},multByPoint:function(r){return this.clone()._multByPoint(r)},divByPoint:function(r){return this.clone()._divByPoint(r)},mult:function(r){return this.clone()._mult(r)},div:function(r){return this.clone()._div(r)},rotate:function(r){return this.clone()._rotate(r)},rotateAround:function(r,e){return this.clone()._rotateAround(r,e)},matMult:function(r){return this.clone()._matMult(r)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(r){return this.x===r.x&&this.y===r.y},dist:function(r){return Math.sqrt(this.distSqr(r))},distSqr:function(r){var e=r.x-this.x,i=r.y-this.y;return e*e+i*i},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(r){return Math.atan2(this.y-r.y,this.x-r.x)},angleWith:function(r){return this.angleWithSep(r.x,r.y)},angleWithSep:function(r,e){return Math.atan2(this.x*e-this.y*r,this.x*r+this.y*e)},_matMult:function(r){var e=r[2]*this.x+r[3]*this.y;return this.x=r[0]*this.x+r[1]*this.y,this.y=e,this},_add:function(r){return this.x+=r.x,this.y+=r.y,this},_sub:function(r){return this.x-=r.x,this.y-=r.y,this},_mult:function(r){return this.x*=r,this.y*=r,this},_div:function(r){return this.x/=r,this.y/=r,this},_multByPoint:function(r){return this.x*=r.x,this.y*=r.y,this},_divByPoint:function(r){return this.x/=r.x,this.y/=r.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var r=this.y;return this.y=this.x,this.x=-r,this},_rotate:function(r){var e=Math.cos(r),i=Math.sin(r),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround:function(r,e){var i=Math.cos(r),a=Math.sin(r),d=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=d,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Tn.convert=function(r){return r instanceof Tn?r:Array.isArray(r)?new Tn(r[0],r[1]):r};const Ne={MAX_PARALLEL_IMAGE_REQUESTS:16,REGISTERED_PROTOCOLS:{}},st="mapbox-tiles";let ut,Pt,qt=500,fr=50;function Yn(){typeof caches>"u"||ut||(ut=caches.open(st))}let Jn=1/0;const pn={supported:!1,testSupport:function(r){!Rt&&Ut&&(Kt?un(r):sr=r)}};let sr,Ut,Rt=!1,Kt=!1;function un(r){const e=r.createTexture();r.bindTexture(r.TEXTURE_2D,e);try{if(r.texImage2D(r.TEXTURE_2D,0,r.RGBA,r.RGBA,r.UNSIGNED_BYTE,Ut),r.isContextLost())return;pn.supported=!0}catch{}r.deleteTexture(e),Rt=!0}typeof document<"u"&&(Ut=document.createElement("img"),Ut.onload=function(){sr&&un(sr),sr=null,Kt=!0},Ut.onerror=function(){Rt=!0,sr=null},Ut.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Yt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(Yt);class Mn extends Error{constructor(e,i,a,d){super(`AJAXError: ${i} (${e}): ${a}`),this.status=e,this.statusText=i,this.url=a,this.body=d}}const Nr=He()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href;function mr(r,e){const i=new AbortController,a=new Request(r.url,{method:r.method||"GET",body:r.body,credentials:r.credentials,headers:r.headers,referrer:Nr(),signal:i.signal});let d=!1,m=!1;return r.type==="json"&&a.headers.set("Accept","application/json"),((y,w,b)=>{if(m)return;const T=Date.now();fetch(a).then(z=>z.ok?((M,L,B)=>{(r.type==="arrayBuffer"?M.arrayBuffer():r.type==="json"?M.json():M.text()).then(F=>{m||(L&&B&&function(H,X,le){if(Yn(),!ut)return;const fe={status:X.status,statusText:X.statusText,headers:new Headers};X.headers.forEach((de,Se)=>fe.headers.set(Se,de));const oe=Mt(X.headers.get("Cache-Control")||"");oe["no-store"]||(oe["max-age"]&&fe.headers.set("Expires",new Date(le+1e3*oe["max-age"]).toUTCString()),new Date(fe.headers.get("Expires")).getTime()-le<42e4||function(de,Se){if(Pt===void 0)try{new Response(new ReadableStream),Pt=!0}catch{Pt=!1}Pt?Se(de.body):de.blob().then(Se)}(X,de=>{const Se=new Response(de,fe);Yn(),ut&&ut.then(be=>be.put(function(Xe){const Je=Xe.indexOf("?");return Je<0?Xe:Xe.slice(0,Je)}(H.url),Se)).catch(be=>Me(be.message))}))}(a,L,B),d=!0,e(null,F,M.headers.get("Cache-Control"),M.headers.get("Expires")))}).catch(F=>{m||e(new Error(F.message))})})(z,null,T):z.blob().then(M=>e(new Mn(z.status,z.statusText,r.url,M)))).catch(z=>{z.code!==20&&e(new Error(z.message))})})(),{cancel:()=>{m=!0,d||i.abort()}}}const Yr=function(r,e){if(/:\/\//.test(r.url)&&!/^https?:|^file:/.test(r.url)){if(He()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e);if(!He()){const a=r.url.substring(0,r.url.indexOf("://"));return(Ne.REGISTERED_PROTOCOLS[a]||mr)(r,e)}}if(!(/^file:/.test(i=r.url)||/^file:/.test(Nr())&&!/^\w+:/.test(i))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return mr(r,e);if(He()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",r,e,void 0,!0)}var i;return function(a,d){const m=new XMLHttpRequest;m.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(m.responseType="arraybuffer");for(const y in a.headers)m.setRequestHeader(y,a.headers[y]);return a.type==="json"&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials=a.credentials==="include",m.onerror=()=>{d(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||m.status===0)&&m.response!==null){let y=m.response;if(a.type==="json")try{y=JSON.parse(m.response)}catch(w){return d(w)}d(null,y,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else{const y=new Blob([m.response],{type:m.getResponseHeader("Content-Type")});d(new Mn(m.status,m.statusText,a.url,y))}},m.send(a.body),{cancel:()=>m.abort()}}(r,e)},Ti=function(r,e){return Yr(Ce(r,{type:"arrayBuffer"}),e)};function qi(r){const e=window.document.createElement("a");return e.href=r,e.protocol===window.document.location.protocol&&e.host===window.document.location.host}const St="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let cn,Bn;cn=[],Bn=0;const Ur=function(r,e){if(pn.supported&&(r.headers||(r.headers={}),r.headers.accept="image/webp,*/*"),Bn>=Ne.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:r,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return cn.push(m),m}Bn++;let i=!1;const a=()=>{if(!i)for(i=!0,Bn--;cn.length&&Bn<Ne.MAX_PARALLEL_IMAGE_REQUESTS;){const m=cn.shift(),{requestParameters:y,callback:w,cancelled:b}=m;b||(m.cancel=Ur(y,w).cancel)}},d=Ti(r,(m,y,w,b)=>{a(),m?e(m):y&&function(T,z){typeof createImageBitmap=="function"?function(M,L){const B=new Blob([new Uint8Array(M)],{type:"image/png"});createImageBitmap(B).then(F=>{L(null,F)}).catch(F=>{L(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(T,z):function(M,L){const B=new Image;B.onload=()=>{L(null,B),URL.revokeObjectURL(B.src),B.onload=null,window.requestAnimationFrame(()=>{B.src=St})},B.onerror=()=>L(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(M)],{type:"image/png"});B.src=M.byteLength?URL.createObjectURL(F):St}(T,z)}(y,(T,z)=>{T!=null?e(T):z!=null&&e(null,z,{cacheControl:w,expires:b})})});return{cancel:()=>{d.cancel(),a()}}};function As(r,e,i){i[r]&&i[r].indexOf(e)!==-1||(i[r]=i[r]||[],i[r].push(e))}function ki(r,e,i){if(i&&i[r]){const a=i[r].indexOf(e);a!==-1&&i[r].splice(a,1)}}class Ci{constructor(e,i={}){Ce(this,i),this.type=e}}class Uo extends Ci{constructor(e,i={}){super("error",Ce({error:e},i))}}class Ii{on(e,i){return this._listeners=this._listeners||{},As(e,i,this._listeners),this}off(e,i){return ki(e,i,this._listeners),ki(e,i,this._oneTimeListeners),this}once(e,i){return this._oneTimeListeners=this._oneTimeListeners||{},As(e,i,this._oneTimeListeners),this}fire(e,i){typeof e=="string"&&(e=new Ci(e,i||{}));const a=e.type;if(this.listens(a)){e.target=this;const d=this._listeners&&this._listeners[a]?this._listeners[a].slice():[];for(const w of d)w.call(this,e);const m=this._oneTimeListeners&&this._oneTimeListeners[a]?this._oneTimeListeners[a].slice():[];for(const w of m)ki(a,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&(Ce(e,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Uo&&console.error(e.error);return this}listens(e){return this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e)}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}var xe={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1},elevationOffset:{type:"number",default:450}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};class Fe{constructor(e,i,a,d){this.message=(e?`${e}: `:"")+a,d&&(this.identifier=d),i!=null&&i.__line__&&(this.line=i.__line__)}}function uo(r){const e=r.value;return e?[new Fe(r.key,e,"constants have been deprecated as of v8")]:[]}function Jr(r,...e){for(const i of e)for(const a in i)r[a]=i[a];return r}function kt(r){return r instanceof Number||r instanceof String||r instanceof Boolean?r.valueOf():r}function Vr(r){if(Array.isArray(r))return r.map(Vr);if(r instanceof Object&&!(r instanceof Number||r instanceof String||r instanceof Boolean)){const e={};for(const i in r)e[i]=Vr(r[i]);return e}return kt(r)}class Tr extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class kr{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,d]of i)this.bindings[a]=d}concat(e){return new kr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const Wi={kind:"null"},Le={kind:"number"},gt={kind:"string"},ft={kind:"boolean"},Zn={kind:"color"},Xi={kind:"object"},pt={kind:"value"},zi={kind:"collator"},Fn={kind:"formatted"},Vo={kind:"padding"},kn={kind:"resolvedImage"};function ar(r,e){return{kind:"array",itemType:r,N:e}}function Vt(r){if(r.kind==="array"){const e=Vt(r.itemType);return typeof r.N=="number"?`array<${e}, ${r.N}>`:r.itemType.kind==="value"?"array":`array<${e}>`}return r.kind}const $o=[Wi,Le,gt,ft,Zn,Fn,Xi,ar(pt),Vo,kn];function hi(r,e){if(e.kind==="error")return null;if(r.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!hi(r.itemType,e.itemType))&&(typeof r.N!="number"||r.N===e.N))return null}else{if(r.kind===e.kind)return null;if(r.kind==="value"){for(const i of $o)if(!hi(i,e))return null}}return`Expected ${Vt(r)} but found ${Vt(e)} instead.`}function co(r,e){return e.some(i=>i.kind===r.kind)}function ho(r,e){return e.some(i=>i==="null"?r===null:i==="array"?Array.isArray(r):i==="object"?r&&!Array.isArray(r)&&typeof r=="object":i===typeof r)}var jo,po={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function V(r){return(r=Math.round(r))<0?0:r>255?255:r}function I(r){return V(r[r.length-1]==="%"?parseFloat(r)/100*255:parseInt(r))}function P(r){return(e=r[r.length-1]==="%"?parseFloat(r)/100:parseFloat(r))<0?0:e>1?1:e;var e}function N(r,e,i){return i<0?i+=1:i>1&&(i-=1),6*i<1?r+(e-r)*i*6:2*i<1?e:3*i<2?r+(e-r)*(2/3-i)*6:r}try{jo={}.parseCSSColor=function(r){var e,i=r.replace(/ /g,"").toLowerCase();if(i in po)return po[i].slice();if(i[0]==="#")return i.length===4?(e=parseInt(i.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:i.length===7&&(e=parseInt(i.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var a=i.indexOf("("),d=i.indexOf(")");if(a!==-1&&d+1===i.length){var m=i.substr(0,a),y=i.substr(a+1,d-(a+1)).split(","),w=1;switch(m){case"rgba":if(y.length!==4)return null;w=P(y.pop());case"rgb":return y.length!==3?null:[I(y[0]),I(y[1]),I(y[2]),w];case"hsla":if(y.length!==4)return null;w=P(y.pop());case"hsl":if(y.length!==3)return null;var b=(parseFloat(y[0])%360+360)%360/360,T=P(y[1]),z=P(y[2]),M=z<=.5?z*(T+1):z+T-z*T,L=2*z-M;return[V(255*N(L,M,b+1/3)),V(255*N(L,M,b)),V(255*N(L,M,b-1/3)),w];default:return null}}return null}}catch{}class U{constructor(e,i,a,d=1){this.r=e,this.g=i,this.b=a,this.a=d}static parse(e){if(!e)return;if(e instanceof U)return e;if(typeof e!="string")return;const i=jo(e);return i?new U(i[0]/255*i[3],i[1]/255*i[3],i[2]/255*i[3],i[3]):void 0}toString(){const[e,i,a,d]=this.toArray();return`rgba(${Math.round(e)},${Math.round(i)},${Math.round(a)},${d})`}toArray(){const{r:e,g:i,b:a,a:d}=this;return d===0?[0,0,0,0]:[255*e/d,255*i/d,255*a/d,d]}}U.black=new U(0,0,0,1),U.white=new U(1,1,1,1),U.transparent=new U(0,0,0,0),U.red=new U(1,0,0,1);class K{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ne{constructor(e,i,a,d,m){this.text=e,this.image=i,this.scale=a,this.fontStack=d,this.textColor=m}}class J{constructor(e){this.sections=e}static fromString(e){return new J([new ne(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||e.image&&e.image.name.length!==0)}static factory(e){return e instanceof J?e:J.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}}class Y{constructor(e){this.values=e.slice()}static parse(e){if(e instanceof Y)return e;if(typeof e=="number")return new Y([e,e,e,e]);if(Array.isArray(e)&&!(e.length<1||e.length>4)){for(const i of e)if(typeof i!="number")return;switch(e.length){case 1:e=[e[0],e[0],e[0],e[0]];break;case 2:e=[e[0],e[1],e[0],e[1]];break;case 3:e=[e[0],e[1],e[2],e[1]]}return new Y(e)}}toString(){return JSON.stringify(this.values)}}class re{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new re({name:e,available:!1}):null}}function ge(r,e,i,a){return typeof r=="number"&&r>=0&&r<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[r,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[r,e,i,a]:[r,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ee(r){if(r===null||typeof r=="string"||typeof r=="boolean"||typeof r=="number"||r instanceof U||r instanceof K||r instanceof J||r instanceof Y||r instanceof re)return!0;if(Array.isArray(r)){for(const e of r)if(!Ee(e))return!1;return!0}if(typeof r=="object"){for(const e in r)if(!Ee(r[e]))return!1;return!0}return!1}function me(r){if(r===null)return Wi;if(typeof r=="string")return gt;if(typeof r=="boolean")return ft;if(typeof r=="number")return Le;if(r instanceof U)return Zn;if(r instanceof K)return zi;if(r instanceof J)return Fn;if(r instanceof Y)return Vo;if(r instanceof re)return kn;if(Array.isArray(r)){const e=r.length;let i;for(const a of r){const d=me(a);if(i){if(i===d)continue;i=pt;break}i=d}return ar(i||pt,e)}return Xi}function Ye(r){const e=typeof r;return r===null?"":e==="string"||e==="number"||e==="boolean"?String(r):r instanceof U||r instanceof J||r instanceof Y||r instanceof re?r.toString():JSON.stringify(r)}class Qe{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ee(e[1]))return i.error("invalid value");const a=e[1];let d=me(a);const m=i.expectedType;return d.kind!=="array"||d.N!==0||!m||m.kind!=="array"||typeof m.N=="number"&&m.N!==0||(d=m),new Qe(d,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class Ge{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const at={string:gt,number:Le,boolean:ft,object:Xi};class ct{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,d=1;const m=e[0];if(m==="array"){let w,b;if(e.length>2){const T=e[1];if(typeof T!="string"||!(T in at)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);w=at[T],d++}else w=pt;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],d++}a=ar(w,b)}else{if(!at[m])throw new Error(`Types doesn't contain name = ${m}`);a=at[m]}const y=[];for(;d<e.length;d++){const w=i.parse(e[d],d,pt);if(!w)return null;y.push(w)}return new ct(a,y)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!hi(this.type,me(a)))return a;if(i===this.args.length-1)throw new Ge(`Expected value to be of type ${Vt(this.type)}, but found ${Vt(me(a))} instead.`)}throw new Error}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const Ct={"to-boolean":ft,"to-color":Zn,"to-number":Le,"to-string":gt};class dt{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0];if(!Ct[a])throw new Error(`Can't parse ${a} as it is not part of the known types`);if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");const d=Ct[a],m=[];for(let y=1;y<e.length;y++){const w=i.parse(e[y],y,pt);if(!w)return null;m.push(w)}return new dt(d,m)}evaluate(e){if(this.type.kind==="boolean")return Boolean(this.args[0].evaluate(e));if(this.type.kind==="color"){let i,a;for(const d of this.args){if(i=d.evaluate(e),a=null,i instanceof U)return i;if(typeof i=="string"){const m=e.parseColor(i);if(m)return m}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:ge(i[0],i[1],i[2],i[3]),!a))return new U(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Ge(a||`Could not parse color from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}if(this.type.kind==="padding"){let i;for(const a of this.args){i=a.evaluate(e);const d=Y.parse(i);if(d)return d}throw new Ge(`Could not parse padding from value '${typeof i=="string"?i:JSON.stringify(i)}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const d=Number(i);if(!isNaN(d))return d}throw new Ge(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?J.fromString(Ye(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?re.fromString(Ye(this.args[0].evaluate(e))):Ye(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}const yt=["Unknown","Point","LineString","Polygon"];class It{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?yt[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=U.parse(e)),i}}class jt{constructor(e,i,a,d){this.name=e,this.type=i,this._evaluate=a,this.args=d}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}static parse(e,i){const a=e[0],d=jt.definitions[a];if(!d)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(d)?d[0]:d.type,y=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,w=y.filter(([T])=>!Array.isArray(T)||T.length===e.length-1);let b=null;for(const[T,z]of w){b=new qo(i.registry,i.path,null,i.scope);const M=[];let L=!1;for(let B=1;B<e.length;B++){const F=e[B],H=Array.isArray(T)?T[B-1]:T.type,X=b.parse(F,1+M.length,H);if(!X){L=!0;break}M.push(X)}if(!L)if(Array.isArray(T)&&T.length!==M.length)b.error(`Expected ${T.length} arguments, but found ${M.length} instead.`);else{for(let B=0;B<M.length;B++){const F=Array.isArray(T)?T[B]:T.type,H=M[B];b.concat(B+1).checkSubtype(F,H.type)}if(b.errors.length===0)return new jt(a,m,z,M)}}if(w.length===1)i.errors.push(...b.errors);else{const T=(w.length?w:y).map(([M])=>{return L=M,Array.isArray(L)?`(${L.map(Vt).join(", ")})`:`(${Vt(L.type)}...)`;var L}).join(" | "),z=[];for(let M=1;M<e.length;M++){const L=i.parse(e[M],1+z.length);if(!L)return null;z.push(Vt(L.type))}i.error(`Expected arguments of type ${T}, but found (${z.join(", ")}) instead.`)}return null}static register(e,i){jt.definitions=i;for(const a in i)e[a]=jt}}class On{constructor(e,i,a){this.type=zi,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const d=i.parse(a["case-sensitive"]!==void 0&&a["case-sensitive"],1,ft);if(!d)return null;const m=i.parse(a["diacritic-sensitive"]!==void 0&&a["diacritic-sensitive"],1,ft);if(!m)return null;let y=null;return a.locale&&(y=i.parse(a.locale,1,gt),!y)?null:new On(d,m,y)}evaluate(e){return new K(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}}const en=8192;function Qn(r,e){r[0]=Math.min(r[0],e[0]),r[1]=Math.min(r[1],e[1]),r[2]=Math.max(r[2],e[0]),r[3]=Math.max(r[3],e[1])}function Go(r,e){return!(r[0]<=e[0]||r[2]>=e[2]||r[1]<=e[1]||r[3]>=e[3])}function Ms(r,e){const i=(180+r[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r[1]*Math.PI/360)))/360,d=Math.pow(2,e.z);return[Math.round(i*d*en),Math.round(a*d*en)]}function Gt(r,e,i){const a=r[0]-e[0],d=r[1]-e[1],m=r[0]-i[0],y=r[1]-i[1];return a*y-m*d==0&&a*m<=0&&d*y<=0}function zl(r,e){let i=!1;for(let y=0,w=e.length;y<w;y++){const b=e[y];for(let T=0,z=b.length;T<z-1;T++){if(Gt(r,b[T],b[T+1]))return!1;(d=b[T])[1]>(a=r)[1]!=(m=b[T+1])[1]>a[1]&&a[0]<(m[0]-d[0])*(a[1]-d[1])/(m[1]-d[1])+d[0]&&(i=!i)}}var a,d,m;return i}function Al(r,e){for(let i=0;i<e.length;i++)if(zl(r,e[i]))return!0;return!1}function vc(r,e,i,a){const d=a[0]-i[0],m=a[1]-i[1],y=(r[0]-i[0])*m-d*(r[1]-i[1]),w=(e[0]-i[0])*m-d*(e[1]-i[1]);return y>0&&w<0||y<0&&w>0}function xc(r,e,i){for(const T of i)for(let z=0;z<T.length-1;++z)if((w=[(y=T[z+1])[0]-(m=T[z])[0],y[1]-m[1]])[0]*(b=[(d=e)[0]-(a=r)[0],d[1]-a[1]])[1]-w[1]*b[0]!=0&&vc(a,d,m,y)&&vc(m,y,a,d))return!0;var a,d,m,y,w,b;return!1}function Ml(r,e){for(let i=0;i<r.length;++i)if(!zl(r[i],e))return!1;for(let i=0;i<r.length-1;++i)if(xc(r[i],r[i+1],e))return!1;return!0}function Zd(r,e){for(let i=0;i<e.length;i++)if(Ml(r,e[i]))return!0;return!1}function wa(r,e,i){const a=[];for(let d=0;d<r.length;d++){const m=[];for(let y=0;y<r[d].length;y++){const w=Ms(r[d][y],i);Qn(e,w),m.push(w)}a.push(m)}return a}function Pl(r,e,i){const a=[];for(let d=0;d<r.length;d++){const m=wa(r[d],e,i);a.push(m)}return a}function wc(r,e,i,a){if(r[0]<i[0]||r[0]>i[2]){const d=.5*a;let m=r[0]-i[0]>d?-a:i[0]-r[0]>d?a:0;m===0&&(m=r[0]-i[2]>d?-a:i[2]-r[0]>d?a:0),r[0]+=m}Qn(e,r)}function bc(r,e,i,a){const d=Math.pow(2,a.z)*en,m=[a.x*en,a.y*en],y=[];for(const w of r)for(const b of w){const T=[b.x+m[0],b.y+m[1]];wc(T,e,i,d),y.push(T)}return y}function Sc(r,e,i,a){const d=Math.pow(2,a.z)*en,m=[a.x*en,a.y*en],y=[];for(const b of r){const T=[];for(const z of b){const M=[z.x+m[0],z.y+m[1]];Qn(e,M),T.push(M)}y.push(T)}if(e[2]-e[0]<=d/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const b of y)for(const T of b)wc(T,e,i,d)}var w;return y}class fo{constructor(e,i){this.type=ft,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ee(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let d=0;d<a.features.length;++d){const m=a.features[d].geometry.type;if(m==="Polygon"||m==="MultiPolygon")return new fo(a,a.features[d].geometry)}else if(a.type==="Feature"){const d=a.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new fo(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new fo(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const w=wa(a.coordinates,m,y),b=bc(i.geometry(),d,m,y);if(!Go(d,m))return!1;for(const T of b)if(!zl(T,w))return!1}if(a.type==="MultiPolygon"){const w=Pl(a.coordinates,m,y),b=bc(i.geometry(),d,m,y);if(!Go(d,m))return!1;for(const T of b)if(!Al(T,w))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const d=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],y=i.canonicalID();if(a.type==="Polygon"){const w=wa(a.coordinates,m,y),b=Sc(i.geometry(),d,m,y);if(!Go(d,m))return!1;for(const T of b)if(!Ml(T,w))return!1}if(a.type==="MultiPolygon"){const w=Pl(a.coordinates,m,y),b=Sc(i.geometry(),d,m,y);if(!Go(d,m))return!1;for(const T of b)if(!Zd(T,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}function Ps(r){if(r instanceof jt&&(r.name==="get"&&r.args.length===1||r.name==="feature-state"||r.name==="has"&&r.args.length===1||r.name==="properties"||r.name==="geometry-type"||r.name==="id"||/^filter-/.test(r.name))||r instanceof fo)return!1;let e=!0;return r.eachChild(i=>{e&&!Ps(i)&&(e=!1)}),e}function Zo(r){if(r instanceof jt&&r.name==="feature-state")return!1;let e=!0;return r.eachChild(i=>{e&&!Zo(i)&&(e=!1)}),e}function ba(r,e){if(r instanceof jt&&e.indexOf(r.name)>=0)return!1;let i=!0;return r.eachChild(a=>{i&&!ba(a,e)&&(i=!1)}),i}class Sa{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new Sa(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}}class qo{constructor(e,i=[],a,d=new kr,m=[]){this.registry=e,this.path=i,this.key=i.map(y=>`[${y}]`).join(""),this.scope=d,this.errors=m,this.expectedType=a}parse(e,i,a,d,m={}){return i?this.concat(i,a,d)._parse(e,m):this._parse(e,m)}_parse(e,i){function a(d,m,y){return y==="assert"?new ct(m,[d]):y==="coerce"?new dt(m,[d]):d}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=e[0];if(typeof d!="string")return this.error(`Expression name must be a string, but found ${typeof d} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[d];if(m){let y=m.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,b=y.type;if(w.kind!=="string"&&w.kind!=="number"&&w.kind!=="boolean"&&w.kind!=="object"&&w.kind!=="array"||b.kind!=="value")if(w.kind!=="color"&&w.kind!=="formatted"&&w.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string")if(w.kind!=="padding"||b.kind!=="value"&&b.kind!=="number"&&b.kind!=="array"){if(this.checkSubtype(w,b))return null}else y=a(y,w,i.typeAnnotation||"coerce");else y=a(y,w,i.typeAnnotation||"coerce");else y=a(y,w,i.typeAnnotation||"assert")}if(!(y instanceof Qe)&&y.type.kind!=="resolvedImage"&&Dl(y)){const w=new It;try{y=new Qe(y.type,y.evaluate(w))}catch(b){return this.error(b.message),null}}return y}return this.error(`Unknown expression "${d}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a){const d=typeof e=="number"?this.path.concat(e):this.path,m=a?this.scope.concat(a):this.scope;return new qo(this.registry,d,i||null,m,this.errors)}error(e,...i){const a=`${this.key}${i.map(d=>`[${d}]`).join("")}`;this.errors.push(new Tr(a,e))}checkSubtype(e,i){const a=hi(e,i);return a&&this.error(a),a}}function Dl(r){if(r instanceof Sa)return Dl(r.boundExpression);if(r instanceof jt&&r.name==="error"||r instanceof On||r instanceof fo)return!1;const e=r instanceof dt||r instanceof ct;let i=!0;return r.eachChild(a=>{i=e?i&&Dl(a):i&&a instanceof Qe}),!!i&&Ps(r)&&ba(r,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function Ea(r,e){const i=r.length-1;let a,d,m=0,y=i,w=0;for(;m<=y;)if(w=Math.floor((m+y)/2),a=r[w],d=r[w+1],a<=e){if(w===i||e<d)return w;m=w+1}else{if(!(a>e))throw new Ge("Input is not a number.");y=w-1}return 0}class Ds{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[d,m]of a)this.labels.push(d),this.outputs.push(m)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Le);if(!a)return null;const d=[];let m=null;i.expectedType&&i.expectedType.kind!=="value"&&(m=i.expectedType);for(let y=1;y<e.length;y+=2){const w=y===1?-1/0:e[y],b=e[y+1],T=y,z=y+1;if(typeof w!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(d.length&&d[d.length-1][0]>=w)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const M=i.parse(b,z,m);if(!M)return null;m=m||M.type,d.push([w,M])}return new Ds(m,a,d)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return a[0].evaluate(e);const m=i.length;return d>=i[m-1]?a[m-1].evaluate(e):a[Ea(i,d)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function tn(r,e,i){return r*(1-i)+e*i}var Ls=Object.freeze({__proto__:null,number:tn,color:function(r,e,i){return new U(tn(r.r,e.r,i),tn(r.g,e.g,i),tn(r.b,e.b,i),tn(r.a,e.a,i))},array:function(r,e,i){return r.map((a,d)=>tn(a,e[d],i))},padding:function(r,e,i){const a=r.values,d=e.values;return new Y([tn(a[0],d[0],i),tn(a[1],d[1],i),tn(a[2],d[2],i),tn(a[3],d[3],i)])}});const Ec=.95047,Tc=1.08883,Ll=4/29,Ta=6/29,kc=3*Ta*Ta,qd=Math.PI/180,Wd=180/Math.PI;function Rl(r){return r>.008856451679035631?Math.pow(r,1/3):r/kc+Ll}function Bl(r){return r>Ta?r*r*r:kc*(r-Ll)}function Fl(r){return 255*(r<=.0031308?12.92*r:1.055*Math.pow(r,1/2.4)-.055)}function Ol(r){return(r/=255)<=.04045?r/12.92:Math.pow((r+.055)/1.055,2.4)}function Dt(r){const e=Ol(r.r),i=Ol(r.g),a=Ol(r.b),d=Rl((.4124564*e+.3575761*i+.1804375*a)/Ec),m=Rl((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*m-16,a:500*(d-m),b:200*(m-Rl((.0193339*e+.119192*i+.9503041*a)/Tc)),alpha:r.a}}function Cc(r){let e=(r.l+16)/116,i=isNaN(r.a)?e:e+r.a/500,a=isNaN(r.b)?e:e-r.b/200;return e=1*Bl(e),i=Ec*Bl(i),a=Tc*Bl(a),new U(Fl(3.2404542*i-1.5371385*e-.4985314*a),Fl(-.969266*i+1.8760108*e+.041556*a),Fl(.0556434*i-.2040259*e+1.0572252*a),r.alpha)}function Xd(r,e,i){const a=e-r;return r+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Rs={forward:Dt,reverse:Cc,interpolate:function(r,e,i){return{l:tn(r.l,e.l,i),a:tn(r.a,e.a,i),b:tn(r.b,e.b,i),alpha:tn(r.alpha,e.alpha,i)}}},Bs={forward:function(r){const{l:e,a:i,b:a}=Dt(r),d=Math.atan2(a,i)*Wd;return{h:d<0?d+360:d,c:Math.sqrt(i*i+a*a),l:e,alpha:r.a}},reverse:function(r){const e=r.h*qd,i=r.c;return Cc({l:r.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:r.alpha})},interpolate:function(r,e,i){return{h:Xd(r.h,e.h,i),c:tn(r.c,e.c,i),l:tn(r.l,e.l,i),alpha:tn(r.alpha,e.alpha,i)}}};var Ic=Object.freeze({__proto__:null,lab:Rs,hcl:Bs});class Cr{constructor(e,i,a,d,m){this.type=e,this.operator=i,this.interpolation=a,this.input=d,this.labels=[],this.outputs=[];for(const[y,w]of m)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,i,a,d){let m=0;if(e.name==="exponential")m=Nl(i,e.base,a,d);else if(e.name==="linear")m=Nl(i,1,a,d);else if(e.name==="cubic-bezier"){const y=e.controlPoints;m=new O(y[0],y[1],y[2],y[3]).solve(Nl(i,1,a,d))}return m}static parse(e,i){let[a,d,m,...y]=e;if(!Array.isArray(d)||d.length===0)return i.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const T=d[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:T}}else{if(d[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const T=d.slice(1);if(T.length!==4||T.some(z=>typeof z!="number"||z<0||z>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:T}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(m=i.parse(m,2,Le),!m)return null;const w=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=Zn:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let T=0;T<y.length;T+=2){const z=y[T],M=y[T+1],L=T+3,B=T+4;if(typeof z!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(w.length&&w[w.length-1][0]>=z)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',L);const F=i.parse(M,B,b);if(!F)return null;b=b||F.type,w.push([z,F])}return b.kind==="number"||b.kind==="color"||b.kind==="padding"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Cr(b,a,d,m,w):i.error(`Type ${Vt(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const d=this.input.evaluate(e);if(d<=i[0])return a[0].evaluate(e);const m=i.length;if(d>=i[m-1])return a[m-1].evaluate(e);const y=Ea(i,d),w=Cr.interpolationFactor(this.interpolation,d,i[y],i[y+1]),b=a[y].evaluate(e),T=a[y+1].evaluate(e);return this.operator==="interpolate"?Ls[this.type.kind.toLowerCase()](b,T,w):this.operator==="interpolate-hcl"?Bs.reverse(Bs.interpolate(Bs.forward(b),Bs.forward(T),w)):Rs.reverse(Rs.interpolate(Rs.forward(b),Rs.forward(T),w))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}}function Nl(r,e,i,a){const d=a-i,m=r-i;return d===0?0:e===1?m/d:(Math.pow(e,m)-1)/(Math.pow(e,d)-1)}class ka{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const d=i.expectedType;d&&d.kind!=="value"&&(a=d);const m=[];for(const w of e.slice(1)){const b=i.parse(w,1+m.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,m.push(b)}if(!a)throw new Error("No output type");const y=d&&m.some(w=>hi(d,w.type));return new ka(y?pt:a,m)}evaluate(e){let i,a=null,d=0;for(const m of this.args)if(d++,a=m.evaluate(e),a&&a instanceof re&&!a.available&&(i||(i=a.name),a=null,d===this.args.length&&(a=i)),a!==null)break;return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}}class Ca{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let m=1;m<e.length-1;m+=2){const y=e[m];if(typeof y!="string")return i.error(`Expected string, but found ${typeof y} instead.`,m);if(/[^a-zA-Z0-9_]/.test(y))return i.error("Variable names must contain only alphanumeric characters or '_'.",m);const w=i.parse(e[m+1],m+1);if(!w)return null;a.push([y,w])}const d=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return d?new Ca(a,d):null}outputDefined(){return this.result.outputDefined()}}class Ul{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Le),d=i.parse(e[2],2,ar(i.expectedType||pt));return a&&d?new Ul(d.type.itemType,a,d):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Ge(`Array index out of bounds: ${i} < 0.`);if(i>=a.length)throw new Ge(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i!==Math.floor(i))throw new Ge(`Array index must be an integer, but found ${i} instead.`);return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}}class Vl{constructor(e,i){this.type=ft,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,pt),d=i.parse(e[2],2,pt);return a&&d?co(a.type,[ft,gt,Le,Wi,pt])?new Vl(a,d):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!a)return!1;if(!ho(i,["boolean","string","number","null"]))throw new Ge(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(me(i))} instead.`);if(!ho(a,["string","array"]))throw new Ge(`Expected second argument to be of type array or string, but found ${Vt(me(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}}class Ia{constructor(e,i,a){this.type=Le,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,pt),d=i.parse(e[2],2,pt);if(!a||!d)return null;if(!co(a.type,[ft,gt,Le,Wi,pt]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(a.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,Le);return m?new Ia(a,d,m):null}return new Ia(a,d)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!ho(i,["boolean","string","number","null"]))throw new Ge(`Expected first argument to be of type boolean, string, number or null, but found ${Vt(me(i))} instead.`);if(!ho(a,["string","array"]))throw new Ge(`Expected second argument to be of type array or string, but found ${Vt(me(a))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(e);return a.indexOf(i,d)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}}class $l{constructor(e,i,a,d,m,y){this.inputType=e,this.type=i,this.input=a,this.cases=d,this.outputs=m,this.otherwise=y}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,d;i.expectedType&&i.expectedType.kind!=="value"&&(d=i.expectedType);const m={},y=[];for(let T=2;T<e.length-1;T+=2){let z=e[T];const M=e[T+1];Array.isArray(z)||(z=[z]);const L=i.concat(T);if(z.length===0)return L.error("Expected at least one branch label.");for(const F of z){if(typeof F!="number"&&typeof F!="string")return L.error("Branch labels must be numbers or strings.");if(typeof F=="number"&&Math.abs(F)>Number.MAX_SAFE_INTEGER)return L.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof F=="number"&&Math.floor(F)!==F)return L.error("Numeric branch labels must be integer values.");if(a){if(L.checkSubtype(a,me(F)))return null}else a=me(F);if(m[String(F)]!==void 0)return L.error("Branch labels must be unique.");m[String(F)]=y.length}const B=i.parse(M,T,d);if(!B)return null;d=d||B.type,y.push(B)}const w=i.parse(e[1],1,pt);if(!w)return null;const b=i.parse(e[e.length-1],e.length-1,d);return b?w.type.kind!=="value"&&i.concat(1).checkSubtype(a,w.type)?null:new $l(a,d,w,m,y,b):null}evaluate(e){const i=this.input.evaluate(e);return(me(i)===this.inputType&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}}class jl{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const d=[];for(let y=1;y<e.length-1;y+=2){const w=i.parse(e[y],y,ft);if(!w)return null;const b=i.parse(e[y+1],y+1,a);if(!b)return null;d.push([w,b]),a=a||b.type}const m=i.parse(e[e.length-1],e.length-1,a);if(!m)return null;if(!a)throw new Error("Can't infer output type");return new jl(a,d,m)}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}}class za{constructor(e,i,a,d){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=d}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,pt),d=i.parse(e[2],2,Le);if(!a||!d)return null;if(!co(a.type,[ar(pt),gt,pt]))return i.error(`Expected first argument to be of type array or string, but found ${Vt(a.type)} instead`);if(e.length===4){const m=i.parse(e[3],3,Le);return m?new za(a.type,a,d,m):null}return new za(a.type,a,d)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!ho(i,["string","array"]))throw new Ge(`Expected first argument to be of type array or string, but found ${Vt(me(i))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(e);return i.slice(a,d)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}}function zc(r,e){return r==="=="||r==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function Ac(r,e,i,a){return a.compare(e,i)===0}function Wo(r,e,i){const a=r!=="=="&&r!=="!=";return class C0{constructor(m,y,w){this.type=ft,this.lhs=m,this.rhs=y,this.collator=w,this.hasUntypedArgument=m.type.kind==="value"||y.type.kind==="value"}static parse(m,y){if(m.length!==3&&m.length!==4)return y.error("Expected two or three arguments.");const w=m[0];let b=y.parse(m[1],1,pt);if(!b)return null;if(!zc(w,b.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${Vt(b.type)}'.`);let T=y.parse(m[2],2,pt);if(!T)return null;if(!zc(w,T.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${Vt(T.type)}'.`);if(b.type.kind!==T.type.kind&&b.type.kind!=="value"&&T.type.kind!=="value")return y.error(`Cannot compare types '${Vt(b.type)}' and '${Vt(T.type)}'.`);a&&(b.type.kind==="value"&&T.type.kind!=="value"?b=new ct(T.type,[b]):b.type.kind!=="value"&&T.type.kind==="value"&&(T=new ct(b.type,[T])));let z=null;if(m.length===4){if(b.type.kind!=="string"&&T.type.kind!=="string"&&b.type.kind!=="value"&&T.type.kind!=="value")return y.error("Cannot use collator to compare non-string types.");if(z=y.parse(m[3],3,zi),!z)return null}return new C0(b,T,z)}evaluate(m){const y=this.lhs.evaluate(m),w=this.rhs.evaluate(m);if(a&&this.hasUntypedArgument){const b=me(y),T=me(w);if(b.kind!==T.kind||b.kind!=="string"&&b.kind!=="number")throw new Ge(`Expected arguments for "${r}" to be (string, string) or (number, number), but found (${b.kind}, ${T.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=me(y),T=me(w);if(b.kind!=="string"||T.kind!=="string")return e(m,y,w)}return this.collator?i(m,y,w,this.collator.evaluate(m)):e(m,y,w)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}}}const Hd=Wo("==",function(r,e,i){return e===i},Ac),Kd=Wo("!=",function(r,e,i){return e!==i},function(r,e,i,a){return!Ac(0,e,i,a)}),Yd=Wo("<",function(r,e,i){return e<i},function(r,e,i,a){return a.compare(e,i)<0}),Jd=Wo(">",function(r,e,i){return e>i},function(r,e,i,a){return a.compare(e,i)>0}),Qd=Wo("<=",function(r,e,i){return e<=i},function(r,e,i,a){return a.compare(e,i)<=0}),ep=Wo(">=",function(r,e,i){return e>=i},function(r,e,i,a){return a.compare(e,i)>=0});class Gl{constructor(e,i,a,d,m){this.type=gt,this.number=e,this.locale=i,this.currency=a,this.minFractionDigits=d,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Le);if(!a)return null;const d=e[2];if(typeof d!="object"||Array.isArray(d))return i.error("NumberFormat options argument must be an object.");let m=null;if(d.locale&&(m=i.parse(d.locale,1,gt),!m))return null;let y=null;if(d.currency&&(y=i.parse(d.currency,1,gt),!y))return null;let w=null;if(d["min-fraction-digits"]&&(w=i.parse(d["min-fraction-digits"],1,Le),!w))return null;let b=null;return d["max-fraction-digits"]&&(b=i.parse(d["max-fraction-digits"],1,Le),!b)?null:new Gl(a,m,y,w,b)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}}class Aa{constructor(e){this.type=Fn,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const d=[];let m=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(m&&typeof w=="object"&&!Array.isArray(w)){m=!1;let b=null;if(w["font-scale"]&&(b=i.parse(w["font-scale"],1,Le),!b))return null;let T=null;if(w["text-font"]&&(T=i.parse(w["text-font"],1,ar(gt)),!T))return null;let z=null;if(w["text-color"]&&(z=i.parse(w["text-color"],1,Zn),!z))return null;const M=d[d.length-1];M.scale=b,M.font=T,M.textColor=z}else{const b=i.parse(e[y],1,pt);if(!b)return null;const T=b.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,d.push({content:b,scale:null,font:null,textColor:null})}}return new Aa(d)}evaluate(e){return new J(this.sections.map(i=>{const a=i.content.evaluate(e);return me(a)===kn?new ne("",a,null,null,null):new ne(Ye(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}}class Zl{constructor(e){this.type=kn,this.input=e}static parse(e,i){if(e.length!==2)return i.error("Expected two arguments.");const a=i.parse(e[1],1,gt);return a?new Zl(a):i.error("No image name provided.")}evaluate(e){const i=this.input.evaluate(e),a=re.fromString(i);return a&&e.availableImages&&(a.available=e.availableImages.indexOf(i)>-1),a}eachChild(e){e(this.input)}outputDefined(){return!1}}class ql{constructor(e){this.type=Le,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Vt(a.type)} instead.`):new ql(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Ge(`Expected value to be of type string or array, but found ${Vt(me(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}}const Xo={"==":Hd,"!=":Kd,">":Jd,"<":Yd,">=":ep,"<=":Qd,array:ct,at:Ul,boolean:ct,case:jl,coalesce:ka,collator:On,format:Aa,image:Zl,in:Vl,"index-of":Ia,interpolate:Cr,"interpolate-hcl":Cr,"interpolate-lab":Cr,length:ql,let:Ca,literal:Qe,match:$l,number:ct,"number-format":Gl,object:ct,slice:za,step:Ds,string:ct,"to-boolean":dt,"to-color":dt,"to-number":dt,"to-string":dt,var:Sa,within:fo};function Mc(r,[e,i,a,d]){e=e.evaluate(r),i=i.evaluate(r),a=a.evaluate(r);const m=d?d.evaluate(r):1,y=ge(e,i,a,m);if(y)throw new Ge(y);return new U(e/255*m,i/255*m,a/255*m,m)}function Pc(r,e){return r in e}function Ma(r,e){const i=e[r];return i===void 0?null:i}function mo(r){return{type:r}}function Dc(r){return{result:"success",value:r}}function Ho(r){return{result:"error",value:r}}function Jt(r){return r["property-type"]==="data-driven"||r["property-type"]==="cross-faded-data-driven"}function Lc(r){return!!r.expression&&r.expression.parameters.indexOf("zoom")>-1}function Et(r){return!!r.expression&&r.expression.interpolated}function Lt(r){return r instanceof Number?"number":r instanceof String?"string":r instanceof Boolean?"boolean":Array.isArray(r)?"array":r===null?"null":typeof r}function Xt(r){return typeof r=="object"&&r!==null&&!Array.isArray(r)}function nn(r){return r}function Fs(r,e){const i=e.type==="color",a=r.stops&&typeof r.stops[0][0]=="object",d=a||!(a||r.property!==void 0),m=r.type||(Et(e)?"exponential":"interval");if(i||e.type==="padding"){const T=i?U.parse:Y.parse;(r=Jr({},r)).stops&&(r.stops=r.stops.map(z=>[z[0],T(z[1])])),r.default=T(r.default?r.default:e.default)}if(r.colorSpace&&r.colorSpace!=="rgb"&&!Ic[r.colorSpace])throw new Error(`Unknown color space: ${r.colorSpace}`);let y,w,b;if(m==="exponential")y=Rc;else if(m==="interval")y=np;else if(m==="categorical"){y=tp,w=Object.create(null);for(const T of r.stops)w[T[0]]=T[1];b=typeof r.stops[0][0]}else{if(m!=="identity")throw new Error(`Unknown function type "${m}"`);y=rp}if(a){const T={},z=[];for(let B=0;B<r.stops.length;B++){const F=r.stops[B],H=F[0].zoom;T[H]===void 0&&(T[H]={zoom:H,type:r.type,property:r.property,default:r.default,stops:[]},z.push(H)),T[H].stops.push([F[0].value,F[1]])}const M=[];for(const B of z)M.push([T[B].zoom,Fs(T[B],e)]);const L={name:"linear"};return{kind:"composite",interpolationType:L,interpolationFactor:Cr.interpolationFactor.bind(void 0,L),zoomStops:M.map(B=>B[0]),evaluate:({zoom:B},F)=>Rc({stops:M,base:r.base},e,B).evaluate(B,F)}}if(d){const T=m==="exponential"?{name:"exponential",base:r.base!==void 0?r.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Cr.interpolationFactor.bind(void 0,T),zoomStops:r.stops.map(z=>z[0]),evaluate:({zoom:z})=>y(r,e,z,w,b)}}return{kind:"source",evaluate(T,z){const M=z&&z.properties?z.properties[r.property]:void 0;return M===void 0?Ko(r.default,e.default):y(r,e,M,w,b)}}}function Ko(r,e,i){return r!==void 0?r:e!==void 0?e:i!==void 0?i:void 0}function tp(r,e,i,a,d){return Ko(typeof i===d?a[i]:void 0,r.default,e.default)}function np(r,e,i){if(Lt(i)!=="number")return Ko(r.default,e.default);const a=r.stops.length;if(a===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[a-1][0])return r.stops[a-1][1];const d=Ea(r.stops.map(m=>m[0]),i);return r.stops[d][1]}function Rc(r,e,i){const a=r.base!==void 0?r.base:1;if(Lt(i)!=="number")return Ko(r.default,e.default);const d=r.stops.length;if(d===1||i<=r.stops[0][0])return r.stops[0][1];if(i>=r.stops[d-1][0])return r.stops[d-1][1];const m=Ea(r.stops.map(z=>z[0]),i),y=function(z,M,L,B){const F=B-L,H=z-L;return F===0?0:M===1?H/F:(Math.pow(M,H)-1)/(Math.pow(M,F)-1)}(i,a,r.stops[m][0],r.stops[m+1][0]),w=r.stops[m][1],b=r.stops[m+1][1];let T=Ls[e.type]||nn;if(r.colorSpace&&r.colorSpace!=="rgb"){const z=Ic[r.colorSpace];T=(M,L)=>z.reverse(z.interpolate(z.forward(M),z.forward(L),y))}return typeof w.evaluate=="function"?{evaluate(...z){const M=w.evaluate.apply(void 0,z),L=b.evaluate.apply(void 0,z);if(M!==void 0&&L!==void 0)return T(M,L,y)}}:T(w,b,y)}function rp(r,e,i){switch(e.type){case"color":i=U.parse(i);break;case"formatted":i=J.fromString(i.toString());break;case"resolvedImage":i=re.fromString(i.toString());break;case"padding":i=Y.parse(i);break;default:Lt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0)}return Ko(i,r.default,e.default)}jt.register(Xo,{error:[{kind:"error"},[gt],(r,[e])=>{throw new Ge(e.evaluate(r))}],typeof:[gt,[pt],(r,[e])=>Vt(me(e.evaluate(r)))],"to-rgba":[ar(Le,4),[Zn],(r,[e])=>e.evaluate(r).toArray()],rgb:[Zn,[Le,Le,Le],Mc],rgba:[Zn,[Le,Le,Le,Le],Mc],has:{type:ft,overloads:[[[gt],(r,[e])=>Pc(e.evaluate(r),r.properties())],[[gt,Xi],(r,[e,i])=>Pc(e.evaluate(r),i.evaluate(r))]]},get:{type:pt,overloads:[[[gt],(r,[e])=>Ma(e.evaluate(r),r.properties())],[[gt,Xi],(r,[e,i])=>Ma(e.evaluate(r),i.evaluate(r))]]},"feature-state":[pt,[gt],(r,[e])=>Ma(e.evaluate(r),r.featureState||{})],properties:[Xi,[],r=>r.properties()],"geometry-type":[gt,[],r=>r.geometryType()],id:[pt,[],r=>r.id()],zoom:[Le,[],r=>r.globals.zoom],"heatmap-density":[Le,[],r=>r.globals.heatmapDensity||0],"line-progress":[Le,[],r=>r.globals.lineProgress||0],accumulated:[pt,[],r=>r.globals.accumulated===void 0?null:r.globals.accumulated],"+":[Le,mo(Le),(r,e)=>{let i=0;for(const a of e)i+=a.evaluate(r);return i}],"*":[Le,mo(Le),(r,e)=>{let i=1;for(const a of e)i*=a.evaluate(r);return i}],"-":{type:Le,overloads:[[[Le,Le],(r,[e,i])=>e.evaluate(r)-i.evaluate(r)],[[Le],(r,[e])=>-e.evaluate(r)]]},"/":[Le,[Le,Le],(r,[e,i])=>e.evaluate(r)/i.evaluate(r)],"%":[Le,[Le,Le],(r,[e,i])=>e.evaluate(r)%i.evaluate(r)],ln2:[Le,[],()=>Math.LN2],pi:[Le,[],()=>Math.PI],e:[Le,[],()=>Math.E],"^":[Le,[Le,Le],(r,[e,i])=>Math.pow(e.evaluate(r),i.evaluate(r))],sqrt:[Le,[Le],(r,[e])=>Math.sqrt(e.evaluate(r))],log10:[Le,[Le],(r,[e])=>Math.log(e.evaluate(r))/Math.LN10],ln:[Le,[Le],(r,[e])=>Math.log(e.evaluate(r))],log2:[Le,[Le],(r,[e])=>Math.log(e.evaluate(r))/Math.LN2],sin:[Le,[Le],(r,[e])=>Math.sin(e.evaluate(r))],cos:[Le,[Le],(r,[e])=>Math.cos(e.evaluate(r))],tan:[Le,[Le],(r,[e])=>Math.tan(e.evaluate(r))],asin:[Le,[Le],(r,[e])=>Math.asin(e.evaluate(r))],acos:[Le,[Le],(r,[e])=>Math.acos(e.evaluate(r))],atan:[Le,[Le],(r,[e])=>Math.atan(e.evaluate(r))],min:[Le,mo(Le),(r,e)=>Math.min(...e.map(i=>i.evaluate(r)))],max:[Le,mo(Le),(r,e)=>Math.max(...e.map(i=>i.evaluate(r)))],abs:[Le,[Le],(r,[e])=>Math.abs(e.evaluate(r))],round:[Le,[Le],(r,[e])=>{const i=e.evaluate(r);return i<0?-Math.round(-i):Math.round(i)}],floor:[Le,[Le],(r,[e])=>Math.floor(e.evaluate(r))],ceil:[Le,[Le],(r,[e])=>Math.ceil(e.evaluate(r))],"filter-==":[ft,[gt,pt],(r,[e,i])=>r.properties()[e.value]===i.value],"filter-id-==":[ft,[pt],(r,[e])=>r.id()===e.value],"filter-type-==":[ft,[gt],(r,[e])=>r.geometryType()===e.value],"filter-<":[ft,[gt,pt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a<d}],"filter-id-<":[ft,[pt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[ft,[gt,pt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a>d}],"filter-id->":[ft,[pt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[ft,[gt,pt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a<=d}],"filter-id-<=":[ft,[pt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[ft,[gt,pt],(r,[e,i])=>{const a=r.properties()[e.value],d=i.value;return typeof a==typeof d&&a>=d}],"filter-id->=":[ft,[pt],(r,[e])=>{const i=r.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[ft,[pt],(r,[e])=>e.value in r.properties()],"filter-has-id":[ft,[],r=>r.id()!==null&&r.id()!==void 0],"filter-type-in":[ft,[ar(gt)],(r,[e])=>e.value.indexOf(r.geometryType())>=0],"filter-id-in":[ft,[ar(pt)],(r,[e])=>e.value.indexOf(r.id())>=0],"filter-in-small":[ft,[gt,ar(pt)],(r,[e,i])=>i.value.indexOf(r.properties()[e.value])>=0],"filter-in-large":[ft,[gt,ar(pt)],(r,[e,i])=>function(a,d,m,y){for(;m<=y;){const w=m+y>>1;if(d[w]===a)return!0;d[w]>a?y=w-1:m=w+1}return!1}(r.properties()[e.value],i.value,0,i.value.length-1)],all:{type:ft,overloads:[[[ft,ft],(r,[e,i])=>e.evaluate(r)&&i.evaluate(r)],[mo(ft),(r,e)=>{for(const i of e)if(!i.evaluate(r))return!1;return!0}]]},any:{type:ft,overloads:[[[ft,ft],(r,[e,i])=>e.evaluate(r)||i.evaluate(r)],[mo(ft),(r,e)=>{for(const i of e)if(i.evaluate(r))return!0;return!1}]]},"!":[ft,[ft],(r,[e])=>!e.evaluate(r)],"is-supported-script":[ft,[gt],(r,[e])=>{const i=r.globals&&r.globals.isSupportedScript;return!i||i(e.evaluate(r))}],upcase:[gt,[gt],(r,[e])=>e.evaluate(r).toUpperCase()],downcase:[gt,[gt],(r,[e])=>e.evaluate(r).toLowerCase()],concat:[gt,mo(pt),(r,e)=>e.map(i=>Ye(i.evaluate(r))).join("")],"resolved-locale":[gt,[zi],(r,[e])=>e.evaluate(r).resolvedLocale()]});class Pa{constructor(e,i){this.expression=e,this._warningHistory={},this._evaluator=new It,this._defaultValue=i?function(a){return a.type==="color"&&Xt(a.default)?new U(0,0,0,0):a.type==="color"?U.parse(a.default)||null:a.type==="padding"?Y.parse(a.default)||null:a.default===void 0?null:a.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null}evaluateWithoutErrorHandling(e,i,a,d,m,y){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,d,m,y){this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=d,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=y||null;try{const w=this.expression.evaluate(this._evaluator);if(w==null||typeof w=="number"&&w!=w)return this._defaultValue;if(this._enumValues&&!(w in this._enumValues))throw new Ge(`Expected value to be one of ${Object.keys(this._enumValues).map(b=>JSON.stringify(b)).join(", ")}, but found ${JSON.stringify(w)} instead.`);return w}catch(w){return this._warningHistory[w.message]||(this._warningHistory[w.message]=!0,typeof console<"u"&&console.warn(w.message)),this._defaultValue}}}function Os(r){return Array.isArray(r)&&r.length>0&&typeof r[0]=="string"&&r[0]in Xo}function Ns(r,e){const i=new qo(Xo,[],e?function(d){const m={color:Zn,string:gt,number:Le,enum:gt,boolean:ft,formatted:Fn,padding:Vo,resolvedImage:kn};return d.type==="array"?ar(m[d.value]||pt,d.length):m[d.type]}(e):void 0),a=i.parse(r,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return a?Dc(new Pa(a,e)):Ho(i.errors)}class Us{constructor(e,i){this.kind=e,this._styleExpression=i,this.isStateDependent=e!=="constant"&&!Zo(i.expression)}evaluateWithoutErrorHandling(e,i,a,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,d,m,y)}evaluate(e,i,a,d,m,y){return this._styleExpression.evaluate(e,i,a,d,m,y)}}class Wl{constructor(e,i,a,d){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Zo(i.expression),this.interpolationType=d}evaluateWithoutErrorHandling(e,i,a,d,m,y){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,d,m,y)}evaluate(e,i,a,d,m,y){return this._styleExpression.evaluate(e,i,a,d,m,y)}interpolationFactor(e,i,a){return this.interpolationType?Cr.interpolationFactor(this.interpolationType,e,i,a):0}}function Bc(r,e){const i=Ns(r,e);if(i.result==="error")return i;const a=i.value.expression,d=Ps(a);if(!d&&!Jt(e))return Ho([new Tr("","data expressions not supported")]);const m=ba(a,["zoom"]);if(!m&&!Lc(e))return Ho([new Tr("","zoom expressions not supported")]);const y=La(a);return y||m?y instanceof Tr?Ho([y]):y instanceof Cr&&!Et(e)?Ho([new Tr("",'"interpolate" expressions cannot be used with this property')]):Dc(y?new Wl(d?"camera":"composite",i.value,y.labels,y instanceof Cr?y.interpolation:void 0):new Us(d?"constant":"source",i.value)):Ho([new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Da{constructor(e,i){this._parameters=e,this._specification=i,Jr(this,Fs(this._parameters,this._specification))}static deserialize(e){return new Da(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function La(r){let e=null;if(r instanceof Ca)e=La(r.result);else if(r instanceof ka){for(const i of r.args)if(e=La(i),e)break}else(r instanceof Ds||r instanceof Cr)&&r.input instanceof jt&&r.input.name==="zoom"&&(e=r);return e instanceof Tr||r.eachChild(i=>{const a=La(i);a instanceof Tr?e=a:!e&&a?e=new Tr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&a&&e!==a&&(e=new Tr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}function Qr(r){const e=r.key,i=r.value,a=r.valueSpec||{},d=r.objectElementValidators||{},m=r.style,y=r.styleSpec;let w=[];const b=Lt(i);if(b!=="object")return[new Fe(e,i,`object expected, ${b} found`)];for(const T in i){const z=T.split(".")[0],M=a[z]||a["*"];let L;if(d[z])L=d[z];else if(a[z])L=zr;else if(d["*"])L=d["*"];else{if(!a["*"]){w.push(new Fe(e,i[T],`unknown property "${T}"`));continue}L=zr}w=w.concat(L({key:(e&&`${e}.`)+T,value:i[T],valueSpec:M,style:m,styleSpec:y,object:i,objectKey:T},i))}for(const T in a)d[T]||a[T].required&&a[T].default===void 0&&i[T]===void 0&&w.push(new Fe(e,i,`missing required property "${T}"`));return w}function Fc(r){const e=r.value,i=r.valueSpec,a=r.style,d=r.styleSpec,m=r.key,y=r.arrayElementValidator||zr;if(Lt(e)!=="array")return[new Fe(m,e,`array expected, ${Lt(e)} found`)];if(i.length&&e.length!==i.length)return[new Fe(m,e,`array length ${i.length} expected, length ${e.length} found`)];if(i["min-length"]&&e.length<i["min-length"])return[new Fe(m,e,`array length at least ${i["min-length"]} expected, length ${e.length} found`)];let w={type:i.value,values:i.values};d.$version<7&&(w.function=i.function),Lt(i.value)==="object"&&(w=i.value);let b=[];for(let T=0;T<e.length;T++)b=b.concat(y({array:e,arrayIndex:T,value:e[T],valueSpec:w,style:a,styleSpec:d,key:`${m}[${T}]`}));return b}function Xl(r){const e=r.key,i=r.value,a=r.valueSpec;let d=Lt(i);return d==="number"&&i!=i&&(d="NaN"),d!=="number"?[new Fe(e,i,`number expected, ${d} found`)]:"minimum"in a&&i<a.minimum?[new Fe(e,i,`${i} is less than the minimum value ${a.minimum}`)]:"maximum"in a&&i>a.maximum?[new Fe(e,i,`${i} is greater than the maximum value ${a.maximum}`)]:[]}function Oc(r){const e=r.valueSpec,i=kt(r.value.type);let a,d,m,y={};const w=i!=="categorical"&&r.value.property===void 0,b=!w,T=Lt(r.value.stops)==="array"&&Lt(r.value.stops[0])==="array"&&Lt(r.value.stops[0][0])==="object",z=Qr({key:r.key,value:r.value,valueSpec:r.styleSpec.function,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{stops:function(B){if(i==="identity")return[new Fe(B.key,B.value,'identity function may not have a "stops" property')];let F=[];const H=B.value;return F=F.concat(Fc({key:B.key,value:H,valueSpec:B.valueSpec,style:B.style,styleSpec:B.styleSpec,arrayElementValidator:M})),Lt(H)==="array"&&H.length===0&&F.push(new Fe(B.key,H,"array must have at least one stop")),F},default:function(B){return zr({key:B.key,value:B.value,valueSpec:e,style:B.style,styleSpec:B.styleSpec})}}});return i==="identity"&&w&&z.push(new Fe(r.key,r.value,'missing required property "property"')),i==="identity"||r.value.stops||z.push(new Fe(r.key,r.value,'missing required property "stops"')),i==="exponential"&&r.valueSpec.expression&&!Et(r.valueSpec)&&z.push(new Fe(r.key,r.value,"exponential functions not supported")),r.styleSpec.$version>=8&&(b&&!Jt(r.valueSpec)?z.push(new Fe(r.key,r.value,"property functions not supported")):w&&!Lc(r.valueSpec)&&z.push(new Fe(r.key,r.value,"zoom functions not supported"))),i!=="categorical"&&!T||r.value.property!==void 0||z.push(new Fe(r.key,r.value,'"property" property is required')),z;function M(B){let F=[];const H=B.value,X=B.key;if(Lt(H)!=="array")return[new Fe(X,H,`array expected, ${Lt(H)} found`)];if(H.length!==2)return[new Fe(X,H,`array length 2 expected, length ${H.length} found`)];if(T){if(Lt(H[0])!=="object")return[new Fe(X,H,`object expected, ${Lt(H[0])} found`)];if(H[0].zoom===void 0)return[new Fe(X,H,"object stop key must have zoom")];if(H[0].value===void 0)return[new Fe(X,H,"object stop key must have value")];if(m&&m>kt(H[0].zoom))return[new Fe(X,H[0].zoom,"stop zoom values must appear in ascending order")];kt(H[0].zoom)!==m&&(m=kt(H[0].zoom),d=void 0,y={}),F=F.concat(Qr({key:`${X}[0]`,value:H[0],valueSpec:{zoom:{}},style:B.style,styleSpec:B.styleSpec,objectElementValidators:{zoom:Xl,value:L}}))}else F=F.concat(L({key:`${X}[0]`,value:H[0],valueSpec:{},style:B.style,styleSpec:B.styleSpec},H));return Os(Vr(H[1]))?F.concat([new Fe(`${X}[1]`,H[1],"expressions are not allowed in function stops.")]):F.concat(zr({key:`${X}[1]`,value:H[1],valueSpec:e,style:B.style,styleSpec:B.styleSpec}))}function L(B,F){const H=Lt(B.value),X=kt(B.value),le=B.value!==null?B.value:F;if(a){if(H!==a)return[new Fe(B.key,le,`${H} stop domain type must match previous stop domain type ${a}`)]}else a=H;if(H!=="number"&&H!=="string"&&H!=="boolean")return[new Fe(B.key,le,"stop domain value must be a number, string, or boolean")];if(H!=="number"&&i!=="categorical"){let fe=`number expected, ${H} found`;return Jt(e)&&i===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Fe(B.key,le,fe)]}return i!=="categorical"||H!=="number"||isFinite(X)&&Math.floor(X)===X?i!=="categorical"&&H==="number"&&d!==void 0&&X<d?[new Fe(B.key,le,"stop domain values must appear in ascending order")]:(d=X,i==="categorical"&&X in y?[new Fe(B.key,le,"stop domain values must be unique")]:(y[X]=!0,[])):[new Fe(B.key,le,`integer expected, found ${X}`)]}}function go(r){const e=(r.expressionContext==="property"?Bc:Ns)(Vr(r.value),r.valueSpec);if(e.result==="error")return e.value.map(a=>new Fe(`${r.key}${a.key}`,r.value,a.message));const i=e.value.expression||e.value._styleExpression.expression;if(r.expressionContext==="property"&&r.propertyKey==="text-font"&&!i.outputDefined())return[new Fe(r.key,r.value,`Invalid data expression for "${r.propertyKey}". Output values must be contained as literals within the expression.`)];if(r.expressionContext==="property"&&r.propertyType==="layout"&&!Zo(i))return[new Fe(r.key,r.value,'"feature-state" data expressions are not supported with layout properties.')];if(r.expressionContext==="filter"&&!Zo(i))return[new Fe(r.key,r.value,'"feature-state" data expressions are not supported with filters.')];if(r.expressionContext&&r.expressionContext.indexOf("cluster")===0){if(!ba(i,["zoom","feature-state"]))return[new Fe(r.key,r.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(r.expressionContext==="cluster-initial"&&!Ps(i))return[new Fe(r.key,r.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Vs(r){const e=r.key,i=r.value,a=r.valueSpec,d=[];return Array.isArray(a.values)?a.values.indexOf(kt(i))===-1&&d.push(new Fe(e,i,`expected one of [${a.values.join(", ")}], ${JSON.stringify(i)} found`)):Object.keys(a.values).indexOf(kt(i))===-1&&d.push(new Fe(e,i,`expected one of [${Object.keys(a.values).join(", ")}], ${JSON.stringify(i)} found`)),d}function Yo(r){if(r===!0||r===!1)return!0;if(!Array.isArray(r)||r.length===0)return!1;switch(r[0]){case"has":return r.length>=2&&r[1]!=="$id"&&r[1]!=="$type";case"in":return r.length>=3&&(typeof r[1]!="string"||Array.isArray(r[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return r.length!==3||Array.isArray(r[1])||Array.isArray(r[2]);case"any":case"all":for(const e of r.slice(1))if(!Yo(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}const ip={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Ra(r){if(r==null)return{filter:()=>!0,needGeometry:!1};Yo(r)||(r=$s(r));const e=Ns(r,ip);if(e.result==="error")throw new Error(e.value.map(i=>`${i.key}: ${i.message}`).join(", "));return{filter:(i,a,d)=>e.value.evaluate(i,a,{},d),needGeometry:Uc(r)}}function Nc(r,e){return r<e?-1:r>e?1:0}function Uc(r){if(!Array.isArray(r))return!1;if(r[0]==="within")return!0;for(let e=1;e<r.length;e++)if(Uc(r[e]))return!0;return!1}function $s(r){if(!r)return!0;const e=r[0];return r.length<=1?e!=="any":e==="=="?Hl(r[1],r[2],"=="):e==="!="?Jo(Hl(r[1],r[2],"==")):e==="<"||e===">"||e==="<="||e===">="?Hl(r[1],r[2],e):e==="any"?(i=r.slice(1),["any"].concat(i.map($s))):e==="all"?["all"].concat(r.slice(1).map($s)):e==="none"?["all"].concat(r.slice(1).map($s).map(Jo)):e==="in"?Ba(r[1],r.slice(2)):e==="!in"?Jo(Ba(r[1],r.slice(2))):e==="has"?js(r[1]):e==="!has"?Jo(js(r[1])):e!=="within"||r;var i}function Hl(r,e,i){switch(r){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,r,e]}}function Ba(r,e){if(e.length===0)return!1;switch(r){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",r,["literal",e.sort(Nc)]]:["filter-in-small",r,["literal",e]]}}function js(r){switch(r){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",r]}}function Jo(r){return["!",r]}function Gs(r){return Yo(Vr(r.value))?go(Jr({},r,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Vc(r)}function Vc(r){const e=r.value,i=r.key;if(Lt(e)!=="array")return[new Fe(i,e,`array expected, ${Lt(e)} found`)];const a=r.styleSpec;let d,m=[];if(e.length<1)return[new Fe(i,e,"filter array must have at least 1 element")];switch(m=m.concat(Vs({key:`${i}[0]`,value:e[0],valueSpec:a.filter_operator,style:r.style,styleSpec:r.styleSpec})),kt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&kt(e[1])==="$type"&&m.push(new Fe(i,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":e.length!==3&&m.push(new Fe(i,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(d=Lt(e[1]),d!=="string"&&m.push(new Fe(`${i}[1]`,e[1],`string expected, ${d} found`)));for(let y=2;y<e.length;y++)d=Lt(e[y]),kt(e[1])==="$type"?m=m.concat(Vs({key:`${i}[${y}]`,value:e[y],valueSpec:a.geometry_type,style:r.style,styleSpec:r.styleSpec})):d!=="string"&&d!=="number"&&d!=="boolean"&&m.push(new Fe(`${i}[${y}]`,e[y],`string, number, or boolean expected, ${d} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)m=m.concat(Vc({key:`${i}[${y}]`,value:e[y],style:r.style,styleSpec:r.styleSpec}));break;case"has":case"!has":d=Lt(e[1]),e.length!==2?m.push(new Fe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="string"&&m.push(new Fe(`${i}[1]`,e[1],`string expected, ${d} found`));break;case"within":d=Lt(e[1]),e.length!==2?m.push(new Fe(i,e,`filter array for "${e[0]}" operator must have 2 elements`)):d!=="object"&&m.push(new Fe(`${i}[1]`,e[1],`object expected, ${d} found`))}return m}function Zs(r,e){const i=r.key,a=r.style,d=r.styleSpec,m=r.value,y=r.objectKey,w=d[`${e}_${r.layerType}`];if(!w)return[];const b=y.match(/^(.*)-transition$/);if(e==="paint"&&b&&w[b[1]]&&w[b[1]].transition)return zr({key:i,value:m,valueSpec:d.transition,style:a,styleSpec:d});const T=r.valueSpec||w[y];if(!T)return[new Fe(i,m,`unknown property "${y}"`)];let z;if(Lt(m)==="string"&&Jt(T)&&!T.tokens&&(z=/^{([^}]+)}$/.exec(m)))return[new Fe(i,m,`"${y}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(z[1])} }\`.`)];const M=[];return r.layerType==="symbol"&&(y==="text-field"&&a&&!a.glyphs&&M.push(new Fe(i,m,'use of "text-field" requires a style "glyphs" property')),y==="text-font"&&Xt(Vr(m))&&kt(m.type)==="identity"&&M.push(new Fe(i,m,'"text-font" does not support identity functions'))),M.concat(zr({key:r.key,value:m,valueSpec:T,style:a,styleSpec:d,expressionContext:"property",propertyType:e,propertyKey:y}))}function $c(r){return Zs(r,"paint")}function jc(r){return Zs(r,"layout")}function Gc(r){let e=[];const i=r.value,a=r.key,d=r.style,m=r.styleSpec;i.type||i.ref||e.push(new Fe(a,i,'either "type" or "ref" is required'));let y=kt(i.type);const w=kt(i.ref);if(i.id){const b=kt(i.id);for(let T=0;T<r.arrayIndex;T++){const z=d.layers[T];kt(z.id)===b&&e.push(new Fe(a,i.id,`duplicate layer id "${i.id}", previously used at line ${z.id.__line__}`))}}if("ref"in i){let b;["type","source","source-layer","filter","layout"].forEach(T=>{T in i&&e.push(new Fe(a,i[T],`"${T}" is prohibited for ref layers`))}),d.layers.forEach(T=>{kt(T.id)===w&&(b=T)}),b?b.ref?e.push(new Fe(a,i.ref,"ref cannot reference another ref layer")):y=kt(b.type):e.push(new Fe(a,i.ref,`ref layer "${w}" not found`))}else if(y!=="background")if(i.source){const b=d.sources&&d.sources[i.source],T=b&&kt(b.type);b?T==="vector"&&y==="raster"?e.push(new Fe(a,i.source,`layer "${i.id}" requires a raster source`)):T==="raster"&&y!=="raster"?e.push(new Fe(a,i.source,`layer "${i.id}" requires a vector source`)):T!=="vector"||i["source-layer"]?T==="raster-dem"&&y!=="hillshade"?e.push(new Fe(a,i.source,"raster-dem source can only be used with layer type 'hillshade'.")):y!=="line"||!i.paint||!i.paint["line-gradient"]||T==="geojson"&&b.lineMetrics||e.push(new Fe(a,i,`layer "${i.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Fe(a,i,`layer "${i.id}" must specify a "source-layer"`)):e.push(new Fe(a,i.source,`source "${i.source}" not found`))}else e.push(new Fe(a,i,'missing required property "source"'));return e=e.concat(Qr({key:a,value:i,valueSpec:m.layer,style:r.style,styleSpec:r.styleSpec,objectElementValidators:{"*":()=>[],type:()=>zr({key:`${a}.type`,value:i.type,valueSpec:m.layer.type,style:r.style,styleSpec:r.styleSpec,object:i,objectKey:"type"}),filter:Gs,layout:b=>Qr({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>jc(Jr({layerType:y},T))}}),paint:b=>Qr({layer:i,key:b.key,value:b.value,style:b.style,styleSpec:b.styleSpec,objectElementValidators:{"*":T=>$c(Jr({layerType:y},T))}})}})),e}function Qo(r){const e=r.value,i=r.key,a=Lt(e);return a!=="string"?[new Fe(i,e,`string expected, ${a} found`)]:[]}const Zc={promoteId:function({key:r,value:e}){if(Lt(e)==="string")return Qo({key:r,value:e});{const i=[];for(const a in e)i.push(...Qo({key:`${r}.${a}`,value:e[a]}));return i}}};function qs(r){const e=r.value,i=r.key,a=r.styleSpec,d=r.style;if(!e.type)return[new Fe(i,e,'"type" is required')];const m=kt(e.type);let y;switch(m){case"vector":case"raster":case"raster-dem":return y=Qr({key:i,value:e,valueSpec:a[`source_${m.replace("-","_")}`],style:r.style,styleSpec:a,objectElementValidators:Zc}),y;case"geojson":if(y=Qr({key:i,value:e,valueSpec:a.source_geojson,style:d,styleSpec:a,objectElementValidators:Zc}),e.cluster)for(const w in e.clusterProperties){const[b,T]=e.clusterProperties[w],z=typeof b=="string"?[b,["accumulated"],["get",w]]:b;y.push(...go({key:`${i}.${w}.map`,value:T,expressionContext:"cluster-map"})),y.push(...go({key:`${i}.${w}.reduce`,value:z,expressionContext:"cluster-reduce"}))}return y;case"video":return Qr({key:i,value:e,valueSpec:a.source_video,style:d,styleSpec:a});case"image":return Qr({key:i,value:e,valueSpec:a.source_image,style:d,styleSpec:a});case"canvas":return[new Fe(i,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vs({key:`${i}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:d,styleSpec:a})}}function Ws(r){const e=r.value,i=r.styleSpec,a=i.light,d=r.style;let m=[];const y=Lt(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Fe("light",e,`object expected, ${y} found`)]),m;for(const w in e){const b=w.match(/^(.*)-transition$/);m=m.concat(b&&a[b[1]]&&a[b[1]].transition?zr({key:w,value:e[w],valueSpec:i.transition,style:d,styleSpec:i}):a[w]?zr({key:w,value:e[w],valueSpec:a[w],style:d,styleSpec:i}):[new Fe(w,e[w],`unknown property "${w}"`)])}return m}function Ir(r){const e=r.value,i=r.styleSpec,a=i.terrain,d=r.style;let m=[];const y=Lt(e);if(e===void 0)return m;if(y!=="object")return m=m.concat([new Fe("terrain",e,`object expected, ${y} found`)]),m;for(const w in e)m=m.concat(a[w]?zr({key:w,value:e[w],valueSpec:a[w],style:d,styleSpec:i}):[new Fe(w,e[w],`unknown property "${w}"`)]);return m}const Xs={"*":()=>[],array:Fc,boolean:function(r){const e=r.value,i=r.key,a=Lt(e);return a!=="boolean"?[new Fe(i,e,`boolean expected, ${a} found`)]:[]},number:Xl,color:function(r){const e=r.key,i=r.value,a=Lt(i);return a!=="string"?[new Fe(e,i,`color expected, ${a} found`)]:jo(i)===null?[new Fe(e,i,`color expected, "${i}" found`)]:[]},constants:uo,enum:Vs,filter:Gs,function:Oc,layer:Gc,object:Qr,source:qs,light:Ws,terrain:Ir,string:Qo,formatted:function(r){return Qo(r).length===0?[]:go(r)},resolvedImage:function(r){return Qo(r).length===0?[]:go(r)},padding:function(r){const e=r.key,i=r.value;if(Lt(i)==="array"){if(i.length<1||i.length>4)return[new Fe(e,i,`padding requires 1 to 4 values; ${i.length} values found`)];const a={type:"number"};let d=[];for(let m=0;m<i.length;m++)d=d.concat(zr({key:`${e}[${m}]`,value:i[m],valueSpec:a}));return d}return Xl({key:e,value:i,valueSpec:{}})}};function zr(r){const e=r.value,i=r.valueSpec,a=r.styleSpec;return i.expression&&Xt(kt(e))?Oc(r):i.expression&&Os(Vr(e))?go(r):i.type&&Xs[i.type]?Xs[i.type](r):Qr(Jr({},r,{valueSpec:i.type?a[i.type]:i}))}function op(r){const e=r.value,i=r.key,a=Qo(r);return a.length||(e.indexOf("{fontstack}")===-1&&a.push(new Fe(i,e,'"glyphs" url must include a "{fontstack}" token')),e.indexOf("{range}")===-1&&a.push(new Fe(i,e,'"glyphs" url must include a "{range}" token'))),a}function Hi(r,e=xe){let i=[];return i=i.concat(zr({key:"",value:r,valueSpec:e.$root,styleSpec:e,style:r,objectElementValidators:{glyphs:op,"*":()=>[]}})),r.constants&&(i=i.concat(uo({key:"constants",value:r.constants,style:r,styleSpec:e}))),qc(i)}function qc(r){return[].concat(r).sort((e,i)=>e.line-i.line)}function Ai(r){return function(...e){return qc(r.apply(this,e))}}Hi.source=Ai(qs),Hi.light=Ai(Ws),Hi.terrain=Ai(Ir),Hi.layer=Ai(Gc),Hi.filter=Ai(Gs),Hi.paintProperty=Ai($c),Hi.layoutProperty=Ai(jc);const Hs=Hi,Kl=Hs.light,sp=Hs.paintProperty,ap=Hs.layoutProperty;function Fa(r,e){let i=!1;if(e&&e.length)for(const a of e)r.fire(new Uo(new Error(a.message))),i=!0;return i}class Ks{constructor(e,i,a){const d=this.cells=[];if(e instanceof ArrayBuffer){this.arrayBuffer=e;const y=new Int32Array(this.arrayBuffer);e=y[0],this.d=(i=y[1])+2*(a=y[2]);for(let b=0;b<this.d*this.d;b++){const T=y[3+b],z=y[3+b+1];d.push(T===z?null:y.subarray(T,z))}const w=y[3+d.length+1];this.keys=y.subarray(y[3+d.length],w),this.bboxes=y.subarray(w),this.insert=this._insertReadonly}else{this.d=i+2*a;for(let y=0;y<this.d*this.d;y++)d.push([]);this.keys=[],this.bboxes=[]}this.n=i,this.extent=e,this.padding=a,this.scale=i/e,this.uid=0;const m=a/i*e;this.min=-m,this.max=e+m}insert(e,i,a,d,m){this._forEachCell(i,a,d,m,this._insertCell,this.uid++,void 0,void 0),this.keys.push(e),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(d),this.bboxes.push(m)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(e,i,a,d,m,y){this.cells[m].push(y)}query(e,i,a,d,m){const y=this.min,w=this.max;if(e<=y&&i<=y&&w<=a&&w<=d&&!m)return Array.prototype.slice.call(this.keys);{const b=[];return this._forEachCell(e,i,a,d,this._queryCell,b,{},m),b}}_queryCell(e,i,a,d,m,y,w,b){const T=this.cells[m];if(T!==null){const z=this.keys,M=this.bboxes;for(let L=0;L<T.length;L++){const B=T[L];if(w[B]===void 0){const F=4*B;(b?b(M[F+0],M[F+1],M[F+2],M[F+3]):e<=M[F+2]&&i<=M[F+3]&&a>=M[F+0]&&d>=M[F+1])?(w[B]=!0,y.push(z[B])):w[B]=!1}}}}_forEachCell(e,i,a,d,m,y,w,b){const T=this._convertToCellCoord(e),z=this._convertToCellCoord(i),M=this._convertToCellCoord(a),L=this._convertToCellCoord(d);for(let B=T;B<=M;B++)for(let F=z;F<=L;F++){const H=this.d*F+B;if((!b||b(this._convertFromCellCoord(B),this._convertFromCellCoord(F),this._convertFromCellCoord(B+1),this._convertFromCellCoord(F+1)))&&m.call(this,e,i,a,d,H,y,w,b))return}}_convertFromCellCoord(e){return(e-this.padding)/this.scale}_convertToCellCoord(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const e=this.cells,i=3+this.cells.length+1+1;let a=0;for(let y=0;y<this.cells.length;y++)a+=this.cells[y].length;const d=new Int32Array(i+a+this.keys.length+this.bboxes.length);d[0]=this.extent,d[1]=this.n,d[2]=this.padding;let m=i;for(let y=0;y<e.length;y++){const w=e[y];d[3+y]=m,d.set(w,m),m+=w.length}return d[3+e.length]=m,d.set(this.keys,m),m+=this.keys.length,d[3+e.length+1]=m,d.set(this.bboxes,m),m+=this.bboxes.length,d.buffer}static serialize(e,i){const a=e.toArrayBuffer();return i&&i.push(a),{buffer:a}}static deserialize(e){return new Ks(e.buffer)}}const Mi={};function Ke(r,e,i={}){if(Mi[r])throw new Error(`${r} is already registered.`);Object.defineProperty(e,"_classRegistryKey",{value:r,writeable:!1}),Mi[r]={klass:e,omit:i.omit||[],shallow:i.shallow||[]}}Ke("Object",Object),Ke("TransferableGridIndex",Ks),Ke("Color",U),Ke("Error",Error),Ke("AJAXError",Mn),Ke("ResolvedImage",re),Ke("StylePropertyFunction",Da),Ke("StyleExpression",Pa,{omit:["_evaluator"]}),Ke("ZoomDependentExpression",Wl),Ke("ZoomConstantExpression",Us),Ke("CompoundExpression",jt,{omit:["_evaluate"]});for(const r in Xo)Xo[r]._classRegistryKey||Ke(`Expression_${r}`,Xo[r]);function Wc(r){return r&&typeof ArrayBuffer<"u"&&(r instanceof ArrayBuffer||r.constructor&&r.constructor.name==="ArrayBuffer")}function yo(r,e){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob)return r;if(Wc(r)||Kn(r))return e&&e.push(r),r;if(ArrayBuffer.isView(r)){const i=r;return e&&e.push(i.buffer),i}if(r instanceof ImageData)return e&&e.push(r.data.buffer),r;if(Array.isArray(r)){const i=[];for(const a of r)i.push(yo(a,e));return i}if(typeof r=="object"){const i=r.constructor,a=i._classRegistryKey;if(!a)throw new Error("can't serialize object of unregistered class");if(!Mi[a])throw new Error(`${a} is not registered.`);const d=i.serialize?i.serialize(r,e):{};if(i.serialize){if(e&&d===e[e.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const m in r){if(!r.hasOwnProperty(m)||Mi[a].omit.indexOf(m)>=0)continue;const y=r[m];d[m]=Mi[a].shallow.indexOf(m)>=0?y:yo(y,e)}r instanceof Error&&(d.message=r.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(d.$name=a),d}throw new Error("can't serialize object of type "+typeof r)}function Ki(r){if(r==null||typeof r=="boolean"||typeof r=="number"||typeof r=="string"||r instanceof Boolean||r instanceof Number||r instanceof String||r instanceof Date||r instanceof RegExp||r instanceof Blob||Wc(r)||Kn(r)||ArrayBuffer.isView(r)||r instanceof ImageData)return r;if(Array.isArray(r))return r.map(Ki);if(typeof r=="object"){const e=r.$name||"Object";if(!Mi[e])throw new Error(`can't deserialize unregistered class ${e}`);const{klass:i}=Mi[e];if(!i)throw new Error(`can't deserialize unregistered class ${e}`);if(i.deserialize)return i.deserialize(r);const a=Object.create(i.prototype);for(const d of Object.keys(r)){if(d==="$name")continue;const m=r[d];a[d]=Mi[e].shallow.indexOf(d)>=0?m:Ki(m)}return a}throw new Error("can't deserialize object of type "+typeof r)}class Yl{constructor(){this.first=!0}update(e,i){const a=Math.floor(e);return this.first?(this.first=!1,this.lastIntegerZoom=a,this.lastIntegerZoomTime=0,this.lastZoom=e,this.lastFloorZoom=a,!0):(this.lastFloorZoom>a?(this.lastIntegerZoom=a+1,this.lastIntegerZoomTime=i):this.lastFloorZoom<a&&(this.lastIntegerZoom=a,this.lastIntegerZoomTime=i),e!==this.lastZoom&&(this.lastZoom=e,this.lastFloorZoom=a,!0))}}const Ue={"Latin-1 Supplement":r=>r>=128&&r<=255,Arabic:r=>r>=1536&&r<=1791,"Arabic Supplement":r=>r>=1872&&r<=1919,"Arabic Extended-A":r=>r>=2208&&r<=2303,"Hangul Jamo":r=>r>=4352&&r<=4607,"Unified Canadian Aboriginal Syllabics":r=>r>=5120&&r<=5759,Khmer:r=>r>=6016&&r<=6143,"Unified Canadian Aboriginal Syllabics Extended":r=>r>=6320&&r<=6399,"General Punctuation":r=>r>=8192&&r<=8303,"Letterlike Symbols":r=>r>=8448&&r<=8527,"Number Forms":r=>r>=8528&&r<=8591,"Miscellaneous Technical":r=>r>=8960&&r<=9215,"Control Pictures":r=>r>=9216&&r<=9279,"Optical Character Recognition":r=>r>=9280&&r<=9311,"Enclosed Alphanumerics":r=>r>=9312&&r<=9471,"Geometric Shapes":r=>r>=9632&&r<=9727,"Miscellaneous Symbols":r=>r>=9728&&r<=9983,"Miscellaneous Symbols and Arrows":r=>r>=11008&&r<=11263,"CJK Radicals Supplement":r=>r>=11904&&r<=12031,"Kangxi Radicals":r=>r>=12032&&r<=12255,"Ideographic Description Characters":r=>r>=12272&&r<=12287,"CJK Symbols and Punctuation":r=>r>=12288&&r<=12351,Hiragana:r=>r>=12352&&r<=12447,Katakana:r=>r>=12448&&r<=12543,Bopomofo:r=>r>=12544&&r<=12591,"Hangul Compatibility Jamo":r=>r>=12592&&r<=12687,Kanbun:r=>r>=12688&&r<=12703,"Bopomofo Extended":r=>r>=12704&&r<=12735,"CJK Strokes":r=>r>=12736&&r<=12783,"Katakana Phonetic Extensions":r=>r>=12784&&r<=12799,"Enclosed CJK Letters and Months":r=>r>=12800&&r<=13055,"CJK Compatibility":r=>r>=13056&&r<=13311,"CJK Unified Ideographs Extension A":r=>r>=13312&&r<=19903,"Yijing Hexagram Symbols":r=>r>=19904&&r<=19967,"CJK Unified Ideographs":r=>r>=19968&&r<=40959,"Yi Syllables":r=>r>=40960&&r<=42127,"Yi Radicals":r=>r>=42128&&r<=42191,"Hangul Jamo Extended-A":r=>r>=43360&&r<=43391,"Hangul Syllables":r=>r>=44032&&r<=55215,"Hangul Jamo Extended-B":r=>r>=55216&&r<=55295,"Private Use Area":r=>r>=57344&&r<=63743,"CJK Compatibility Ideographs":r=>r>=63744&&r<=64255,"Arabic Presentation Forms-A":r=>r>=64336&&r<=65023,"Vertical Forms":r=>r>=65040&&r<=65055,"CJK Compatibility Forms":r=>r>=65072&&r<=65103,"Small Form Variants":r=>r>=65104&&r<=65135,"Arabic Presentation Forms-B":r=>r>=65136&&r<=65279,"Halfwidth and Fullwidth Forms":r=>r>=65280&&r<=65519};function Oa(r){for(const e of r)if(Ql(e.charCodeAt(0)))return!0;return!1}function lp(r){for(const e of r)if(!Jl(e.charCodeAt(0)))return!1;return!0}function Jl(r){return!(Ue.Arabic(r)||Ue["Arabic Supplement"](r)||Ue["Arabic Extended-A"](r)||Ue["Arabic Presentation Forms-A"](r)||Ue["Arabic Presentation Forms-B"](r))}function Ql(r){return!(r!==746&&r!==747&&(r<4352||!(Ue["Bopomofo Extended"](r)||Ue.Bopomofo(r)||Ue["CJK Compatibility Forms"](r)&&!(r>=65097&&r<=65103)||Ue["CJK Compatibility Ideographs"](r)||Ue["CJK Compatibility"](r)||Ue["CJK Radicals Supplement"](r)||Ue["CJK Strokes"](r)||!(!Ue["CJK Symbols and Punctuation"](r)||r>=12296&&r<=12305||r>=12308&&r<=12319||r===12336)||Ue["CJK Unified Ideographs Extension A"](r)||Ue["CJK Unified Ideographs"](r)||Ue["Enclosed CJK Letters and Months"](r)||Ue["Hangul Compatibility Jamo"](r)||Ue["Hangul Jamo Extended-A"](r)||Ue["Hangul Jamo Extended-B"](r)||Ue["Hangul Jamo"](r)||Ue["Hangul Syllables"](r)||Ue.Hiragana(r)||Ue["Ideographic Description Characters"](r)||Ue.Kanbun(r)||Ue["Kangxi Radicals"](r)||Ue["Katakana Phonetic Extensions"](r)||Ue.Katakana(r)&&r!==12540||!(!Ue["Halfwidth and Fullwidth Forms"](r)||r===65288||r===65289||r===65293||r>=65306&&r<=65310||r===65339||r===65341||r===65343||r>=65371&&r<=65503||r===65507||r>=65512&&r<=65519)||!(!Ue["Small Form Variants"](r)||r>=65112&&r<=65118||r>=65123&&r<=65126)||Ue["Unified Canadian Aboriginal Syllabics"](r)||Ue["Unified Canadian Aboriginal Syllabics Extended"](r)||Ue["Vertical Forms"](r)||Ue["Yijing Hexagram Symbols"](r)||Ue["Yi Syllables"](r)||Ue["Yi Radicals"](r))))}function Xc(r){return!(Ql(r)||function(e){return!!(Ue["Latin-1 Supplement"](e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||Ue["General Punctuation"](e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||Ue["Letterlike Symbols"](e)||Ue["Number Forms"](e)||Ue["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||Ue["Control Pictures"](e)&&e!==9251||Ue["Optical Character Recognition"](e)||Ue["Enclosed Alphanumerics"](e)||Ue["Geometric Shapes"](e)||Ue["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||Ue["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Ue["CJK Symbols and Punctuation"](e)||Ue.Katakana(e)||Ue["Private Use Area"](e)||Ue["CJK Compatibility Forms"](e)||Ue["Small Form Variants"](e)||Ue["Halfwidth and Fullwidth Forms"](e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(r))}function Hc(r){return r>=1424&&r<=2303||Ue["Arabic Presentation Forms-A"](r)||Ue["Arabic Presentation Forms-B"](r)}function up(r,e){return!(!e&&Hc(r)||r>=2304&&r<=3583||r>=3840&&r<=4255||Ue.Khmer(r))}function Kc(r){for(const e of r)if(Hc(e.charCodeAt(0)))return!0;return!1}const eu="deferred",tu="loading",nu="loaded";let ru=null,gr="unavailable",Yi=null;const Yc=function(r){r&&typeof r=="string"&&r.indexOf("NetworkError")>-1&&(gr="error"),ru&&ru(r)};function es(){iu.fire(new Ci("pluginStateChange",{pluginStatus:gr,pluginURL:Yi}))}const iu=new Ii,Ys=function(){return gr},Jc=function(){if(gr!==eu||!Yi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");gr=tu,es(),Yi&&Ti({url:Yi},r=>{r?Yc(r):(gr=nu,es())})},$r={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>gr===nu||$r.applyArabicShaping!=null,isLoading:()=>gr===tu,setState(r){if(!He())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");gr=r.pluginStatus,Yi=r.pluginURL},isParsed(){if(!He())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return $r.applyArabicShaping!=null&&$r.processBidirectionalText!=null&&$r.processStyledBidirectionalText!=null},getPluginURL(){if(!He())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Yi}};class rn{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.zoomHistory=i.zoomHistory,this.transition=i.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Yl,this.transition={})}isSupportedScript(e){return function(i,a){for(const d of i)if(!up(d.charCodeAt(0),a))return!1;return!0}(e,$r.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const e=this.zoom,i=e-Math.floor(e),a=this.crossFadingFactor();return e>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:i+(1-i)*a}:{fromScale:.5,toScale:1,t:1-(1-a)*i}}}class Js{constructor(e,i){this.property=e,this.value=i,this.expression=function(a,d){if(Xt(a))return new Da(a,d);if(Os(a)){const m=Bc(a,d);if(m.result==="error")throw new Error(m.value.map(y=>`${y.key}: ${y.message}`).join(", "));return m.value}{let m=a;return d.type==="color"&&typeof a=="string"?m=U.parse(a):d.type!=="padding"||typeof a!="number"&&!Array.isArray(a)||(m=Y.parse(a)),{kind:"constant",evaluate:()=>m}}}(i===void 0?e.specification.default:i,e.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a){return this.property.possiblyEvaluate(this,e,i,a)}}class Na{constructor(e){this.property=e,this.value=new Js(e,void 0)}transitioned(e,i){return new eh(this.property,this.value,i,Ce({},e.transition,this.transition),e.now)}untransitioned(){return new eh(this.property,this.value,null,{},0)}}class Qc{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ae(this._values[e].value.value)}setValue(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Na(this._values[e].property)),this._values[e].value=new Js(this._values[e].property,i===null?void 0:ae(i))}getTransition(e){return ae(this._values[e].transition)}setTransition(e,i){Object.prototype.hasOwnProperty.call(this._values,e)||(this._values[e]=new Na(this._values[e].property)),this._values[e].transition=ae(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const d=this.getTransition(i);d!==void 0&&(e[`${i}-transition`]=d)}return e}transitioned(e,i){const a=new th(this._properties);for(const d of Object.keys(this._values))a._values[d]=this._values[d].transitioned(e,i._values[d]);return a}untransitioned(){const e=new th(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}}class eh{constructor(e,i,a,d,m){this.property=e,this.value=i,this.begin=m+d.delay||0,this.end=this.begin+d.duration||0,e.specification.transition&&(d.delay||d.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const d=e.now||0,m=this.value.possiblyEvaluate(e,i,a),y=this.prior;if(y){if(d>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(d<this.begin)return y.possiblyEvaluate(e,i,a);{const w=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,i,a),m,function(b){if(b<=0)return 0;if(b>=1)return 1;const T=b*b,z=T*b;return 4*(b<.5?z:3*(b-T)+z-.75)}(w))}}return m}}class th{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const d=new Qs(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,i,a);return d}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class cp{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ae(this._values[e].value)}setValue(e,i){this._values[e]=new Js(this._values[e].property,i===null?void 0:ae(i))}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a){const d=new Qs(this._properties);for(const m of Object.keys(this._values))d._values[m]=this._values[m].possiblyEvaluate(e,i,a);return d}}class di{constructor(e,i,a){this.property=e,this.value=i,this.parameters=a}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,d){return this.property.evaluate(this.value,this.parameters,e,i,a,d)}}class Qs{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class et{constructor(e){this.specification=e}possiblyEvaluate(e,i){if(e.isDataDriven())throw new Error("Value should not be data driven");return e.expression.evaluate(i)}interpolate(e,i,a){const d=Ls[this.specification.type];return d?d(e,i,a):e}}class lt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,d){return new di(this,e.expression.kind==="constant"||e.expression.kind==="camera"?{kind:"constant",value:e.expression.evaluate(i,null,{},a,d)}:e.expression,i)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new di(this,{kind:"constant",value:void 0},e.parameters);const d=Ls[this.specification.type];return d?new di(this,{kind:"constant",value:d(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,d,m,y){return e.kind==="constant"?e.value:e.evaluate(i,a,d,m,y)}}class ts extends lt{possiblyEvaluate(e,i,a,d){if(e.value===void 0)return new di(this,{kind:"constant",value:void 0},i);if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},a,d),y=e.property.specification.type==="resolvedImage"&&typeof m!="string"?m.name:m,w=this._calculate(y,y,y,i);return new di(this,{kind:"constant",value:w},i)}if(e.expression.kind==="camera"){const m=this._calculate(e.expression.evaluate({zoom:i.zoom-1}),e.expression.evaluate({zoom:i.zoom}),e.expression.evaluate({zoom:i.zoom+1}),i);return new di(this,{kind:"constant",value:m},i)}return new di(this,e.expression,i)}evaluate(e,i,a,d,m,y){if(e.kind==="source"){const w=e.evaluate(i,a,d,m,y);return this._calculate(w,w,w,i)}return e.kind==="composite"?this._calculate(e.evaluate({zoom:Math.floor(i.zoom)-1},a,d),e.evaluate({zoom:Math.floor(i.zoom)},a,d),e.evaluate({zoom:Math.floor(i.zoom)+1},a,d),i):e.value}_calculate(e,i,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:a,to:i}}interpolate(e){return e}}class ou{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,d){if(e.value!==void 0){if(e.expression.kind==="constant"){const m=e.expression.evaluate(i,null,{},a,d);return this._calculate(m,m,m,i)}return this._calculate(e.expression.evaluate(new rn(Math.floor(i.zoom-1),i)),e.expression.evaluate(new rn(Math.floor(i.zoom),i)),e.expression.evaluate(new rn(Math.floor(i.zoom+1),i)),i)}}_calculate(e,i,a,d){return d.zoom>d.zoomHistory.lastIntegerZoom?{from:e,to:i}:{from:a,to:i}}interpolate(e){return e}}class Ji{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,d){return!!e.expression.evaluate(i,null,{},a,d)}interpolate(){return!1}}class qn{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const i in e){const a=e[i];a.specification.overridable&&this.overridableProperties.push(i);const d=this.defaultPropertyValues[i]=new Js(a,void 0),m=this.defaultTransitionablePropertyValues[i]=new Na(a);this.defaultTransitioningPropertyValues[i]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[i]=d.possiblyEvaluate({})}}}Ke("DataDrivenProperty",lt),Ke("DataConstantProperty",et),Ke("CrossFadedDataDrivenProperty",ts),Ke("CrossFadedProperty",ou),Ke("ColorRampProperty",Ji);const Qi="-transition";class pi extends Ii{constructor(e,i){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1},e.type!=="custom"&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type!=="background"&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),i.layout&&(this._unevaluatedLayout=new cp(i.layout)),i.paint)){this._transitionablePaint=new Qc(i.paint);for(const a in e.paint)this.setPaintProperty(a,e.paint[a],{validate:!1});for(const a in e.layout)this.setLayoutProperty(a,e.layout[a],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Qs(i.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i,a={}){i!=null&&this._validate(ap,`layers.${this.id}.layout.${e}`,e,i,a)||(e!=="visibility"?this._unevaluatedLayout.setValue(e,i):this.visibility=i)}getPaintProperty(e){return e.endsWith(Qi)?this._transitionablePaint.getTransition(e.slice(0,-Qi.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,i,a={}){if(i!=null&&this._validate(sp,`layers.${this.id}.paint.${e}`,e,i,a))return!1;if(e.endsWith(Qi))return this._transitionablePaint.setTransition(e.slice(0,-Qi.length),i||void 0),!1;{const d=this._transitionablePaint._values[e],m=d.property.specification["property-type"]==="cross-faded-data-driven",y=d.value.isDataDriven(),w=d.value;this._transitionablePaint.setValue(e,i),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value;return b.isDataDriven()||y||m||this._handleOverridablePaintPropertyUpdate(e,w,b)}}_handleSpecialPaintPropertyUpdate(e){}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){e.getCrossfadeParameters&&(this._crossfadeParameters=e.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Q(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}_validate(e,i,a,d,m={}){return(!m||m.validate!==!1)&&Fa(this,e.call(Hs,{key:i,layerType:this.type,objectKey:a,value:d,styleSpec:xe,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof di&&Jt(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}}const nh={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class eo{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class fn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,i){return e._trim(),i&&(e.isTransferred=!0,i.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function Cn(r,e=1){let i=0,a=0;return{members:r.map(d=>{const m=nh[d.type].BYTES_PER_ELEMENT,y=i=su(i,Math.max(e,m)),w=d.components||1;return a=Math.max(a,m),i+=m*w,{name:d.name,type:d.type,components:w,offset:y}}),size:su(i,Math.max(a,e)),alignment:e}}function su(r,e){return Math.ceil(r/e)*e}class _o extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const d=2*e;return this.int16[d+0]=i,this.int16[d+1]=a,e}}_o.prototype.bytesPerElement=4,Ke("StructArrayLayout2i4",_o);class h extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,d)}emplace(e,i,a,d,m){const y=4*e;return this.int16[y+0]=i,this.int16[y+1]=a,this.int16[y+2]=d,this.int16[y+3]=m,e}}h.prototype.bytesPerElement=8,Ke("StructArrayLayout4i8",h);class t extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,d,m,y)}emplace(e,i,a,d,m,y,w){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=y,this.int16[b+5]=w,e}}t.prototype.bytesPerElement=12,Ke("StructArrayLayout2i4i12",t);class s extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,d,m,y)}emplace(e,i,a,d,m,y,w){const b=4*e,T=8*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.uint8[T+4]=d,this.uint8[T+5]=m,this.uint8[T+6]=y,this.uint8[T+7]=w,e}}s.prototype.bytesPerElement=8,Ke("StructArrayLayout2i4ub8",s);class c extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const d=2*e;return this.float32[d+0]=i,this.float32[d+1]=a,e}}c.prototype.bytesPerElement=8,Ke("StructArrayLayout2f8",c);class p extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y,w,b,T,z){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,d,m,y,w,b,T,z)}emplace(e,i,a,d,m,y,w,b,T,z,M){const L=10*e;return this.uint16[L+0]=i,this.uint16[L+1]=a,this.uint16[L+2]=d,this.uint16[L+3]=m,this.uint16[L+4]=y,this.uint16[L+5]=w,this.uint16[L+6]=b,this.uint16[L+7]=T,this.uint16[L+8]=z,this.uint16[L+9]=M,e}}p.prototype.bytesPerElement=20,Ke("StructArrayLayout10ui20",p);class g extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y,w,b,T,z,M,L){const B=this.length;return this.resize(B+1),this.emplace(B,e,i,a,d,m,y,w,b,T,z,M,L)}emplace(e,i,a,d,m,y,w,b,T,z,M,L,B){const F=12*e;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=d,this.int16[F+3]=m,this.uint16[F+4]=y,this.uint16[F+5]=w,this.uint16[F+6]=b,this.uint16[F+7]=T,this.int16[F+8]=z,this.int16[F+9]=M,this.int16[F+10]=L,this.int16[F+11]=B,e}}g.prototype.bytesPerElement=24,Ke("StructArrayLayout4i4ui4i24",g);class x extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const m=3*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=d,e}}x.prototype.bytesPerElement=12,Ke("StructArrayLayout3f12",x);class S extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}S.prototype.bytesPerElement=4,Ke("StructArrayLayout1ul4",S);class E extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y,w,b,T){const z=this.length;return this.resize(z+1),this.emplace(z,e,i,a,d,m,y,w,b,T)}emplace(e,i,a,d,m,y,w,b,T,z){const M=10*e,L=5*e;return this.int16[M+0]=i,this.int16[M+1]=a,this.int16[M+2]=d,this.int16[M+3]=m,this.int16[M+4]=y,this.int16[M+5]=w,this.uint32[L+3]=b,this.uint16[M+8]=T,this.uint16[M+9]=z,e}}E.prototype.bytesPerElement=20,Ke("StructArrayLayout6i1ul2ui20",E);class k extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,i,a,d,m,y)}emplace(e,i,a,d,m,y,w){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=d,this.int16[b+3]=m,this.int16[b+4]=y,this.int16[b+5]=w,e}}k.prototype.bytesPerElement=12,Ke("StructArrayLayout2i2i2i12",k);class A extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m){const y=this.length;return this.resize(y+1),this.emplace(y,e,i,a,d,m)}emplace(e,i,a,d,m,y){const w=4*e,b=8*e;return this.float32[w+0]=i,this.float32[w+1]=a,this.float32[w+2]=d,this.int16[b+6]=m,this.int16[b+7]=y,e}}A.prototype.bytesPerElement=16,Ke("StructArrayLayout2f1f2i16",A);class D extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,d)}emplace(e,i,a,d,m){const y=12*e,w=3*e;return this.uint8[y+0]=i,this.uint8[y+1]=a,this.float32[w+1]=d,this.float32[w+2]=m,e}}D.prototype.bytesPerElement=12,Ke("StructArrayLayout2ub2f12",D);class R extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const m=3*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=d,e}}R.prototype.bytesPerElement=6,Ke("StructArrayLayout3ui6",R);class G extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y,w,b,T,z,M,L,B,F,H,X,le){const fe=this.length;return this.resize(fe+1),this.emplace(fe,e,i,a,d,m,y,w,b,T,z,M,L,B,F,H,X,le)}emplace(e,i,a,d,m,y,w,b,T,z,M,L,B,F,H,X,le,fe){const oe=24*e,de=12*e,Se=48*e;return this.int16[oe+0]=i,this.int16[oe+1]=a,this.uint16[oe+2]=d,this.uint16[oe+3]=m,this.uint32[de+2]=y,this.uint32[de+3]=w,this.uint32[de+4]=b,this.uint16[oe+10]=T,this.uint16[oe+11]=z,this.uint16[oe+12]=M,this.float32[de+7]=L,this.float32[de+8]=B,this.uint8[Se+36]=F,this.uint8[Se+37]=H,this.uint8[Se+38]=X,this.uint32[de+10]=le,this.int16[oe+22]=fe,e}}G.prototype.bytesPerElement=48,Ke("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",G);class $ extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d,m,y,w,b,T,z,M,L,B,F,H,X,le,fe,oe,de,Se,be,Xe,Je,Ve,Be,De,$e){const Oe=this.length;return this.resize(Oe+1),this.emplace(Oe,e,i,a,d,m,y,w,b,T,z,M,L,B,F,H,X,le,fe,oe,de,Se,be,Xe,Je,Ve,Be,De,$e)}emplace(e,i,a,d,m,y,w,b,T,z,M,L,B,F,H,X,le,fe,oe,de,Se,be,Xe,Je,Ve,Be,De,$e,Oe){const Ie=34*e,it=17*e;return this.int16[Ie+0]=i,this.int16[Ie+1]=a,this.int16[Ie+2]=d,this.int16[Ie+3]=m,this.int16[Ie+4]=y,this.int16[Ie+5]=w,this.int16[Ie+6]=b,this.int16[Ie+7]=T,this.uint16[Ie+8]=z,this.uint16[Ie+9]=M,this.uint16[Ie+10]=L,this.uint16[Ie+11]=B,this.uint16[Ie+12]=F,this.uint16[Ie+13]=H,this.uint16[Ie+14]=X,this.uint16[Ie+15]=le,this.uint16[Ie+16]=fe,this.uint16[Ie+17]=oe,this.uint16[Ie+18]=de,this.uint16[Ie+19]=Se,this.uint16[Ie+20]=be,this.uint16[Ie+21]=Xe,this.uint16[Ie+22]=Je,this.uint32[it+12]=Ve,this.float32[it+13]=Be,this.float32[it+14]=De,this.float32[it+15]=$e,this.float32[it+16]=Oe,e}}$.prototype.bytesPerElement=68,Ke("StructArrayLayout8i15ui1ul4f68",$);class j extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}j.prototype.bytesPerElement=4,Ke("StructArrayLayout1f4",j);class ee extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const m=3*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=d,e}}ee.prototype.bytesPerElement=6,Ke("StructArrayLayout3i6",ee);class ie extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const d=this.length;return this.resize(d+1),this.emplace(d,e,i,a)}emplace(e,i,a,d){const m=4*e;return this.uint32[2*e+0]=i,this.uint16[m+2]=a,this.uint16[m+3]=d,e}}ie.prototype.bytesPerElement=8,Ke("StructArrayLayout1ul2ui8",ie);class ce extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const d=2*e;return this.uint16[d+0]=i,this.uint16[d+1]=a,e}}ce.prototype.bytesPerElement=4,Ke("StructArrayLayout2ui4",ce);class W extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}W.prototype.bytesPerElement=2,Ke("StructArrayLayout1ui2",W);class pe extends fn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,d){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,d)}emplace(e,i,a,d,m){const y=4*e;return this.float32[y+0]=i,this.float32[y+1]=a,this.float32[y+2]=d,this.float32[y+3]=m,e}}pe.prototype.bytesPerElement=16,Ke("StructArrayLayout4f16",pe);class he extends eo{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new ot(this.anchorPointX,this.anchorPointY)}}he.prototype.size=20;class _e extends E{get(e){return new he(this,e)}}Ke("CollisionBoxArray",_e);class ve extends eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(e){this._structArray.uint8[this._pos1+37]=e}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(e){this._structArray.uint8[this._pos1+38]=e}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(e){this._structArray.uint32[this._pos4+10]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}ve.prototype.size=48;class Te extends G{get(e){return new ve(this,e)}}Ke("PlacedSymbolArray",Te);class ye extends eo{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(e){this._structArray.uint32[this._pos4+12]=e}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}ye.prototype.size=68;class Ze extends ${get(e){return new ye(this,e)}}Ke("SymbolInstanceArray",Ze);class Re extends j{getoffsetX(e){return this.float32[1*e+0]}}Ke("GlyphOffsetArray",Re);class We extends ee{getx(e){return this.int16[3*e+0]}gety(e){return this.int16[3*e+1]}gettileUnitDistanceFromAnchor(e){return this.int16[3*e+2]}}Ke("SymbolLineVertexArray",We);class mt extends eo{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}mt.prototype.size=8;class _t extends ie{get(e){return new mt(this,e)}}Ke("FeatureIndexArray",_t);class rt extends _o{}class Ft extends _o{}class Ot extends _o{}class Tt extends t{}class zt extends s{}class $t extends c{}class Nn extends p{}class fi extends g{}class ei extends x{}class mi extends S{}class to extends k{}class jr extends D{}class yr extends R{}class Pi extends ce{}const Ua=Cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:Pn}=Ua;class wt{constructor(e=[]){this.segments=e}prepareSegment(e,i,a,d){let m=this.segments[this.segments.length-1];return e>wt.MAX_VERTEX_ARRAY_LENGTH&&Me(`Max vertices per segment is ${wt.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!m||m.vertexLength+e>wt.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==d)&&(m={vertexOffset:i.length,primitiveOffset:a.length,vertexLength:0,primitiveLength:0},d!==void 0&&(m.sortKey=d),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,d){return new wt([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:d,vaos:{},sortKey:0}])}}function Bt(r,e){return 256*(r=q(Math.floor(r),0,255))+q(Math.floor(e),0,255)}wt.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ke("SegmentVector",wt);const Un=Cn([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Vn={exports:{}},on={exports:{}};on.exports=function(r,e){var i,a,d,m,y,w,b,T;for(a=r.length-(i=3&r.length),d=e,y=3432918353,w=461845907,T=0;T<a;)b=255&r.charCodeAt(T)|(255&r.charCodeAt(++T))<<8|(255&r.charCodeAt(++T))<<16|(255&r.charCodeAt(++T))<<24,++T,d=27492+(65535&(m=5*(65535&(d=(d^=b=(65535&(b=(b=(65535&b)*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*w+(((b>>>16)*w&65535)<<16)&4294967295)<<13|d>>>19))+((5*(d>>>16)&65535)<<16)&4294967295))+((58964+(m>>>16)&65535)<<16);switch(b=0,i){case 3:b^=(255&r.charCodeAt(T+2))<<16;case 2:b^=(255&r.charCodeAt(T+1))<<8;case 1:d^=b=(65535&(b=(b=(65535&(b^=255&r.charCodeAt(T)))*y+(((b>>>16)*y&65535)<<16)&4294967295)<<15|b>>>17))*w+(((b>>>16)*w&65535)<<16)&4294967295}return d^=r.length,d=2246822507*(65535&(d^=d>>>16))+((2246822507*(d>>>16)&65535)<<16)&4294967295,d=3266489909*(65535&(d^=d>>>13))+((3266489909*(d>>>16)&65535)<<16)&4294967295,(d^=d>>>16)>>>0};var Gr={exports:{}};Gr.exports=function(r,e){for(var i,a=r.length,d=e^a,m=0;a>=4;)i=1540483477*(65535&(i=255&r.charCodeAt(m)|(255&r.charCodeAt(++m))<<8|(255&r.charCodeAt(++m))<<16|(255&r.charCodeAt(++m))<<24))+((1540483477*(i>>>16)&65535)<<16),d=1540483477*(65535&d)+((1540483477*(d>>>16)&65535)<<16)^(i=1540483477*(65535&(i^=i>>>24))+((1540483477*(i>>>16)&65535)<<16)),a-=4,++m;switch(a){case 3:d^=(255&r.charCodeAt(m+2))<<16;case 2:d^=(255&r.charCodeAt(m+1))<<8;case 1:d=1540483477*(65535&(d^=255&r.charCodeAt(m)))+((1540483477*(d>>>16)&65535)<<16)}return d=1540483477*(65535&(d^=d>>>13))+((1540483477*(d>>>16)&65535)<<16),(d^=d>>>15)>>>0};var vo=on.exports,au=Gr.exports;Vn.exports=vo,Vn.exports.murmur3=vo,Vn.exports.murmur2=au;class ns{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,i,a,d){this.ids.push(rh(e)),this.positions.push(i,a,d)}getPositions(e){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const i=rh(e);let a=0,d=this.ids.length-1;for(;a<d;){const y=a+d>>1;this.ids[y]>=i?d=y:a=y+1}const m=[];for(;this.ids[a]===i;)m.push({index:this.positions[3*a],start:this.positions[3*a+1],end:this.positions[3*a+2]}),a++;return m}static serialize(e,i){const a=new Float64Array(e.ids),d=new Uint32Array(e.positions);return lu(a,d,0,a.length-1),i&&i.push(a.buffer,d.buffer),{ids:a,positions:d}}static deserialize(e){const i=new ns;return i.ids=e.ids,i.positions=e.positions,i.indexed=!0,i}}function rh(r){const e=+r;return!isNaN(e)&&e<=Number.MAX_SAFE_INTEGER?e:Vn.exports(String(r))}function lu(r,e,i,a){for(;i<a;){const d=r[i+a>>1];let m=i-1,y=a+1;for(;;){do m++;while(r[m]<d);do y--;while(r[y]>d);if(m>=y)break;no(r,m,y),no(e,3*m,3*y),no(e,3*m+1,3*y+1),no(e,3*m+2,3*y+2)}y-i<a-y?(lu(r,e,i,y),i=y+1):(lu(r,e,y+1,a),a=y)}}function no(r,e,i){const a=r[e];r[e]=r[i],r[i]=a}Ke("FeaturePositionMap",ns);class xo{constructor(e,i){this.gl=e.gl,this.location=i}}class wo extends xo{constructor(e,i){super(e,i),this.current=0}set(e){this.current!==e&&(this.current=e,this.gl.uniform1f(this.location,e))}}class Va extends xo{constructor(e,i){super(e,i),this.current=[0,0,0,0]}set(e){e[0]===this.current[0]&&e[1]===this.current[1]&&e[2]===this.current[2]&&e[3]===this.current[3]||(this.current=e,this.gl.uniform4f(this.location,e[0],e[1],e[2],e[3]))}}class Ig extends xo{constructor(e,i){super(e,i),this.current=U.transparent}set(e){e.r===this.current.r&&e.g===this.current.g&&e.b===this.current.b&&e.a===this.current.a||(this.current=e,this.gl.uniform4f(this.location,e.r,e.g,e.b,e.a))}}const B0=new Float32Array(16);function hp(r){return[Bt(255*r.r,255*r.g),Bt(255*r.b,255*r.a)]}class uu{constructor(e,i,a){this.value=e,this.uniformNames=i.map(d=>`u_${d}`),this.type=a}setUniform(e,i,a){e.set(a.constantOr(this.value))}getBinding(e,i,a){return this.type==="color"?new Ig(e,i):new wo(e,i)}}class $a{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(e,i){this.pixelRatioFrom=i.pixelRatio,this.pixelRatioTo=e.pixelRatio,this.patternFrom=i.tlbr,this.patternTo=e.tlbr}setUniform(e,i,a,d){const m=d==="u_pattern_to"?this.patternTo:d==="u_pattern_from"?this.patternFrom:d==="u_pixel_ratio_to"?this.pixelRatioTo:d==="u_pixel_ratio_from"?this.pixelRatioFrom:null;m&&e.set(m)}getBinding(e,i,a){return a.substr(0,9)==="u_pattern"?new Va(e,i):new wo(e,i)}}class bo{constructor(e,i,a,d){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(m=>({name:`a_${m}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new d}populatePaintArray(e,i,a,d,m){const y=this.paintVertexArray.length,w=this.expression.evaluate(new rn(0),i,{},d,[],m);this.paintVertexArray.resize(e),this._setPaintValue(y,e,w)}updatePaintArray(e,i,a,d){const m=this.expression.evaluate({zoom:0},a,d);this._setPaintValue(e,i,m)}_setPaintValue(e,i,a){if(this.type==="color"){const d=hp(a);for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,d[0],d[1])}else{for(let d=e;d<i;d++)this.paintVertexArray.emplace(d,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Di{constructor(e,i,a,d,m,y){this.expression=e,this.uniformNames=i.map(w=>`u_${w}_t`),this.type=a,this.useIntegerZoom=d,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=i.map(w=>({name:`a_${w}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,i,a,d,m){const y=this.expression.evaluate(new rn(this.zoom),i,{},d,[],m),w=this.expression.evaluate(new rn(this.zoom+1),i,{},d,[],m),b=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(b,e,y,w)}updatePaintArray(e,i,a,d){const m=this.expression.evaluate({zoom:this.zoom},a,d),y=this.expression.evaluate({zoom:this.zoom+1},a,d);this._setPaintValue(e,i,m,y)}_setPaintValue(e,i,a,d){if(this.type==="color"){const m=hp(a),y=hp(d);for(let w=e;w<i;w++)this.paintVertexArray.emplace(w,m[0],m[1],y[0],y[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,a,d);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(d))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i){const a=this.useIntegerZoom?Math.floor(i.zoom):i.zoom,d=q(this.expression.interpolationFactor(a,this.zoom,this.zoom+1),0,1);e.set(d)}getBinding(e,i,a){return new wo(e,i)}}class rs{constructor(e,i,a,d,m,y){this.expression=e,this.type=i,this.useIntegerZoom=a,this.zoom=d,this.layerId=y,this.zoomInPaintVertexArray=new m,this.zoomOutPaintVertexArray=new m}populatePaintArray(e,i,a){const d=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(e),this.zoomOutPaintVertexArray.resize(e),this._setPaintValues(d,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,d,m){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,i,a,d){if(!d||!a)return;const{min:m,mid:y,max:w}=a,b=d[m],T=d[y],z=d[w];if(b&&T&&z)for(let M=e;M<i;M++)this.zoomInPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],b.tl[0],b.tl[1],b.br[0],b.br[1],T.pixelRatio,b.pixelRatio),this.zoomOutPaintVertexArray.emplace(M,T.tl[0],T.tl[1],T.br[0],T.br[1],z.tl[0],z.tl[1],z.br[0],z.br[1],T.pixelRatio,z.pixelRatio)}upload(e){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=e.createVertexBuffer(this.zoomInPaintVertexArray,Un.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=e.createVertexBuffer(this.zoomOutPaintVertexArray,Un.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zg{constructor(e,i,a){this.binders={},this._buffers=[];const d=[];for(const m in e.paint._values){if(!a(m))continue;const y=e.paint.get(m);if(!(y instanceof di&&Jt(y.property.specification)))continue;const w=F0(m,e.type),b=y.value,T=y.property.specification.type,z=y.property.useIntegerZoom,M=y.property.specification["property-type"],L=M==="cross-faded"||M==="cross-faded-data-driven";if(b.kind==="constant")this.binders[m]=L?new $a(b.value,w):new uu(b.value,w,T),d.push(`/u_${m}`);else if(b.kind==="source"||L){const B=Ag(m,T,"source");this.binders[m]=L?new rs(b,T,z,i,B,e.id):new bo(b,w,T,B),d.push(`/a_${m}`)}else{const B=Ag(m,T,"composite");this.binders[m]=new Di(b,w,T,z,i,B),d.push(`/z_${m}`)}}this.cacheKey=d.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof bo||i instanceof Di?i.maxValue:0}populatePaintArrays(e,i,a,d,m){for(const y in this.binders){const w=this.binders[y];(w instanceof bo||w instanceof Di||w instanceof rs)&&w.populatePaintArray(e,i,a,d,m)}}setConstantPatternPositions(e,i){for(const a in this.binders){const d=this.binders[a];d instanceof $a&&d.setConstantPatternPositions(e,i)}}updatePaintArrays(e,i,a,d,m){let y=!1;for(const w in e){const b=i.getPositions(w);for(const T of b){const z=a.feature(T.index);for(const M in this.binders){const L=this.binders[M];if((L instanceof bo||L instanceof Di||L instanceof rs)&&L.expression.isStateDependent===!0){const B=d.paint.get(M);L.expression=B.value,L.updatePaintArray(T.start,T.end,z,e[w],m),y=!0}}}}return y}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof uu||a instanceof $a)&&e.push(...a.uniformNames.map(d=>`#define HAS_UNIFORM_${d}`))}return e}getBinderAttributes(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof bo||a instanceof Di)for(let d=0;d<a.paintVertexAttributes.length;d++)e.push(a.paintVertexAttributes[d].name);else if(a instanceof rs)for(let d=0;d<Un.members.length;d++)e.push(Un.members[d].name)}return e}getBinderUniforms(){const e=[];for(const i in this.binders){const a=this.binders[i];if(a instanceof uu||a instanceof $a||a instanceof Di)for(const d of a.uniformNames)e.push(d)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e,i){const a=[];for(const d in this.binders){const m=this.binders[d];if(m instanceof uu||m instanceof $a||m instanceof Di){for(const y of m.uniformNames)if(i[y]){const w=m.getBinding(e,i[y],y);a.push({name:y,property:d,binding:w})}}}return a}setUniforms(e,i,a,d){for(const{name:m,property:y,binding:w}of i)this.binders[y].setUniform(w,d,a.get(y),m)}updatePaintBuffers(e){this._buffers=[];for(const i in this.binders){const a=this.binders[i];if(e&&a instanceof rs){const d=e.fromScale===2?a.zoomInPaintVertexBuffer:a.zoomOutPaintVertexBuffer;d&&this._buffers.push(d)}else(a instanceof bo||a instanceof Di)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof bo||a instanceof Di||a instanceof rs)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof bo||i instanceof Di||i instanceof rs)&&i.destroy()}}}class ea{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const d of e)this.programConfigurations[d.id]=new zg(d,i,a);this.needsUpload=!1,this._featureMap=new ns,this._bufferOffset=0}populatePaintArrays(e,i,a,d,m,y){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(e,i,d,m,y);i.id!==void 0&&this._featureMap.add(i.id,a,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,d){for(const m of a)this.needsUpload=this.programConfigurations[m.id].updatePaintArrays(e,this._featureMap,i,m,d)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}function F0(r,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[r]||[r.replace(`${e}-`,"").replace(/-/g,"_")]}function Ag(r,e,i){const a={color:{source:c,composite:pe},number:{source:j,composite:c}},d=function(m){return{"line-pattern":{source:Nn,composite:Nn},"fill-pattern":{source:Nn,composite:Nn},"fill-extrusion-pattern":{source:Nn,composite:Nn}}[m]}(r);return d&&d[i]||a[e][i]}Ke("ConstantBinder",uu),Ke("CrossFadedConstantBinder",$a),Ke("SourceExpressionBinder",bo),Ke("CrossFadedCompositeBinder",rs),Ke("CompositeExpressionBinder",Di),Ke("ProgramConfiguration",zg,{omit:["_buffers"]}),Ke("ProgramConfigurationSet",ea);var Dn=8192;const dp=Math.pow(2,14)-1,Mg=-dp-1;function ta(r){const e=Dn/r.extent,i=r.loadGeometry();for(let a=0;a<i.length;a++){const d=i[a];for(let m=0;m<d.length;m++){const y=d[m],w=Math.round(y.x*e),b=Math.round(y.y*e);y.x=q(w,Mg,dp),y.y=q(b,Mg,dp),(w<y.x||w>y.x+1||b<y.y||b>y.y+1)&&Me("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return i}function na(r,e){return{type:r.type,id:r.id,properties:r.properties,geometry:e?ta(r):[]}}function ih(r,e,i,a,d){r.emplaceBack(2*e+(a+1)/2,2*i+(d+1)/2)}class pp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Ft,this.indexArray=new yr,this.segments=new wt,this.programConfigurations=new ea(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){const d=this.layers[0],m=[];let y=null,w=!1;d.type==="circle"&&(y=d.layout.get("circle-sort-key"),w=!y.isConstant());for(const{feature:b,id:T,index:z,sourceLayerIndex:M}of e){const L=this.layers[0]._featureFilter.needGeometry,B=na(b,L);if(!this.layers[0]._featureFilter.filter(new rn(this.zoom),B,a))continue;const F=w?y.evaluate(B,{},a):void 0,H={id:T,properties:b.properties,type:b.type,sourceLayerIndex:M,index:z,geometry:L?B.geometry:ta(b),patterns:{},sortKey:F};m.push(H)}w&&m.sort((b,T)=>b.sortKey-T.sortKey);for(const b of m){const{geometry:T,index:z,sourceLayerIndex:M}=b,L=e[z].feature;this.addFeature(b,T,z,a),i.featureIndex.insert(L,T,z,M,this.index)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Pn),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,d){for(const m of i)for(const y of m){const w=y.x,b=y.y;if(w<0||w>=Dn||b<0||b>=Dn)continue;const T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),z=T.vertexLength;ih(this.layoutVertexArray,w,b,-1,-1),ih(this.layoutVertexArray,w,b,1,-1),ih(this.layoutVertexArray,w,b,1,1),ih(this.layoutVertexArray,w,b,-1,1),this.indexArray.emplaceBack(z,z+1,z+2),this.indexArray.emplaceBack(z,z+3,z+2),T.vertexLength+=4,T.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},d)}}function Pg(r,e){for(let i=0;i<r.length;i++)if(ja(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(ja(r,e[i]))return!0;return!!fp(r,e)}function O0(r,e,i){return!!ja(r,e)||!!mp(e,r,i)}function Dg(r,e){if(r.length===1)return Rg(e,r[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let d=0;d<a.length;d++)if(ja(r,a[d]))return!0}for(let i=0;i<r.length;i++)if(Rg(e,r[i]))return!0;for(let i=0;i<e.length;i++)if(fp(r,e[i]))return!0;return!1}function N0(r,e,i){if(r.length>1){if(fp(r,e))return!0;for(let a=0;a<e.length;a++)if(mp(e[a],r,i))return!0}for(let a=0;a<r.length;a++)if(mp(r[a],e,i))return!0;return!1}function fp(r,e){if(r.length===0||e.length===0)return!1;for(let i=0;i<r.length-1;i++){const a=r[i],d=r[i+1];for(let m=0;m<e.length-1;m++)if(U0(a,d,e[m],e[m+1]))return!0}return!1}function U0(r,e,i,a){return ze(r,i,a)!==ze(e,i,a)&&ze(r,e,i)!==ze(r,e,a)}function mp(r,e,i){const a=i*i;if(e.length===1)return r.distSqr(e[0])<a;for(let d=1;d<e.length;d++)if(Lg(r,e[d-1],e[d])<a)return!0;return!1}function Lg(r,e,i){const a=e.distSqr(i);if(a===0)return r.distSqr(e);const d=((r.x-e.x)*(i.x-e.x)+(r.y-e.y)*(i.y-e.y))/a;return r.distSqr(d<0?e:d>1?i:i.sub(e)._mult(d)._add(e))}function Rg(r,e){let i,a,d,m=!1;for(let y=0;y<r.length;y++){i=r[y];for(let w=0,b=i.length-1;w<i.length;b=w++)a=i[w],d=i[b],a.y>e.y!=d.y>e.y&&e.x<(d.x-a.x)*(e.y-a.y)/(d.y-a.y)+a.x&&(m=!m)}return m}function ja(r,e){let i=!1;for(let a=0,d=r.length-1;a<r.length;d=a++){const m=r[a],y=r[d];m.y>e.y!=y.y>e.y&&e.x<(y.x-m.x)*(e.y-m.y)/(y.y-m.y)+m.x&&(i=!i)}return i}function V0(r,e,i){const a=i[0],d=i[2];if(r.x<a.x&&e.x<a.x||r.x>d.x&&e.x>d.x||r.y<a.y&&e.y<a.y||r.y>d.y&&e.y>d.y)return!1;const m=ze(r,e,i[0]);return m!==ze(r,e,i[1])||m!==ze(r,e,i[2])||m!==ze(r,e,i[3])}function cu(r,e,i){const a=e.paint.get(r).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(r)}function oh(r){return Math.sqrt(r[0]*r[0]+r[1]*r[1])}function sh(r,e,i,a,d){if(!e[0]&&!e[1])return r;const m=ot.convert(e)._mult(d);i==="viewport"&&m._rotate(-a);const y=[];for(let w=0;w<r.length;w++)y.push(r[w].sub(m));return y}Ke("CircleBucket",pp,{omit:["layers"]});const $0=new qn({"circle-sort-key":new lt(xe.layout_circle["circle-sort-key"])});var j0={paint:new qn({"circle-radius":new lt(xe.paint_circle["circle-radius"]),"circle-color":new lt(xe.paint_circle["circle-color"]),"circle-blur":new lt(xe.paint_circle["circle-blur"]),"circle-opacity":new lt(xe.paint_circle["circle-opacity"]),"circle-translate":new et(xe.paint_circle["circle-translate"]),"circle-translate-anchor":new et(xe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new et(xe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new et(xe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new lt(xe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new lt(xe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new lt(xe.paint_circle["circle-stroke-opacity"])}),layout:$0},_r=1e-6,vr=typeof Float32Array<"u"?Float32Array:Array;function Bg(){var r=new vr(9);return vr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[5]=0,r[6]=0,r[7]=0),r[0]=1,r[4]=1,r[8]=1,r}function gp(r){return r[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r}function Fg(r,e,i){var a=e[0],d=e[1],m=e[2],y=e[3],w=e[4],b=e[5],T=e[6],z=e[7],M=e[8],L=e[9],B=e[10],F=e[11],H=e[12],X=e[13],le=e[14],fe=e[15],oe=i[0],de=i[1],Se=i[2],be=i[3];return r[0]=oe*a+de*w+Se*M+be*H,r[1]=oe*d+de*b+Se*L+be*X,r[2]=oe*m+de*T+Se*B+be*le,r[3]=oe*y+de*z+Se*F+be*fe,r[4]=(oe=i[4])*a+(de=i[5])*w+(Se=i[6])*M+(be=i[7])*H,r[5]=oe*d+de*b+Se*L+be*X,r[6]=oe*m+de*T+Se*B+be*le,r[7]=oe*y+de*z+Se*F+be*fe,r[8]=(oe=i[8])*a+(de=i[9])*w+(Se=i[10])*M+(be=i[11])*H,r[9]=oe*d+de*b+Se*L+be*X,r[10]=oe*m+de*T+Se*B+be*le,r[11]=oe*y+de*z+Se*F+be*fe,r[12]=(oe=i[12])*a+(de=i[13])*w+(Se=i[14])*M+(be=i[15])*H,r[13]=oe*d+de*b+Se*L+be*X,r[14]=oe*m+de*T+Se*B+be*le,r[15]=oe*y+de*z+Se*F+be*fe,r}Math.hypot||(Math.hypot=function(){for(var r=0,e=arguments.length;e--;)r+=arguments[e]*arguments[e];return Math.sqrt(r)});var hu,G0=Fg;function Og(){var r=new vr(3);return vr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r}function Ng(r,e,i){var a=new vr(3);return a[0]=r,a[1]=e,a[2]=i,a}function ah(r,e,i){var a=e[0],d=e[1],m=e[2],y=e[3];return r[0]=i[0]*a+i[4]*d+i[8]*m+i[12]*y,r[1]=i[1]*a+i[5]*d+i[9]*m+i[13]*y,r[2]=i[2]*a+i[6]*d+i[10]*m+i[14]*y,r[3]=i[3]*a+i[7]*d+i[11]*m+i[15]*y,r}function Ug(){var r=new vr(4);return vr!=Float32Array&&(r[0]=0,r[1]=0,r[2]=0),r[3]=1,r}function Vg(r,e){const i=ah([],[r.x,r.y,0,1],e);return new ot(i[0]/i[3],i[1]/i[3])}Og(),hu=new vr(4),vr!=Float32Array&&(hu[0]=0,hu[1]=0,hu[2]=0,hu[3]=0),Og(),Ng(1,0,0),Ng(0,1,0),Ug(),Ug(),Bg(),function(){var r;r=new vr(2),vr!=Float32Array&&(r[0]=0,r[1]=0)}();class $g extends pp{}Ke("HeatmapBucket",$g,{omit:["layers"]});var Z0={paint:new qn({"heatmap-radius":new lt(xe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new lt(xe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new et(xe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ji(xe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new et(xe.paint_heatmap["heatmap-opacity"])})};function yp(r,{width:e,height:i},a,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==e*i*a)throw new RangeError(`mismatched image size. expected: ${d.length} but got: ${e*i*a}`)}else d=new Uint8Array(e*i*a);return r.width=e,r.height=i,r.data=d,r}function jg(r,{width:e,height:i},a){if(e===r.width&&i===r.height)return;const d=yp({},{width:e,height:i},a);_p(r,d,{x:0,y:0},{x:0,y:0},{width:Math.min(r.width,e),height:Math.min(r.height,i)},a),r.width=e,r.height=i,r.data=d.data}function _p(r,e,i,a,d,m){if(d.width===0||d.height===0)return e;if(d.width>r.width||d.height>r.height||i.x>r.width-d.width||i.y>r.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>e.width||d.height>e.height||a.x>e.width-d.width||a.y>e.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const y=r.data,w=e.data;if(y===w)throw new Error("srcData equals dstData, so image is already copied");for(let b=0;b<d.height;b++){const T=((i.y+b)*r.width+i.x)*m,z=((a.y+b)*e.width+a.x)*m;for(let M=0;M<d.width*m;M++)w[z+M]=y[T+M]}return e}class du{constructor(e,i){yp(this,e,1,i)}resize(e){jg(this,e,1)}clone(){return new du({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,d,m){_p(e,i,a,d,m,1)}}class ti{constructor(e,i){yp(this,e,4,i)}resize(e){jg(this,e,4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new ti({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,d,m){_p(e,i,a,d,m,4)}}function Gg(r){const e={},i=r.resolution||256,a=r.clips?r.clips.length:1,d=r.image||new ti({width:i,height:a});if(Math.log(i)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${i}`);const m=(y,w,b)=>{e[r.evaluationKey]=b;const T=r.expression.evaluate(e);d.data[y+w+0]=Math.floor(255*T.r/T.a),d.data[y+w+1]=Math.floor(255*T.g/T.a),d.data[y+w+2]=Math.floor(255*T.b/T.a),d.data[y+w+3]=Math.floor(255*T.a)};if(r.clips)for(let y=0,w=0;y<a;++y,w+=4*i)for(let b=0,T=0;b<i;b++,T+=4){const z=b/(i-1),{start:M,end:L}=r.clips[y];m(w,T,M*(1-z)+L*z)}else for(let y=0,w=0;y<i;y++,w+=4)m(0,w,y/(i-1));return d}Ke("AlphaImage",du),Ke("RGBAImage",ti);var q0={paint:new qn({"hillshade-illumination-direction":new et(xe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new et(xe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new et(xe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new et(xe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new et(xe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new et(xe.paint_hillshade["hillshade-accent-color"])})};const W0=Cn([{name:"a_pos",components:2,type:"Int16"}],4),{members:X0}=W0;var lh={exports:{}};function uh(r,e,i){i=i||2;var a,d,m,y,w,b,T,z=e&&e.length,M=z?e[0]*i:r.length,L=Zg(r,0,M,i,!0),B=[];if(!L||L.next===L.prev)return B;if(z&&(L=function(H,X,le,fe){var oe,de,Se,be=[];for(oe=0,de=X.length;oe<de;oe++)(Se=Zg(H,X[oe]*fe,oe<de-1?X[oe+1]*fe:H.length,fe,!1))===Se.next&&(Se.steiner=!0),be.push(n1(Se));for(be.sort(Q0),oe=0;oe<be.length;oe++)le=e1(be[oe],le);return le}(r,e,L,i)),r.length>80*i){a=m=r[0],d=y=r[1];for(var F=i;F<M;F+=i)(w=r[F])<a&&(a=w),(b=r[F+1])<d&&(d=b),w>m&&(m=w),b>y&&(y=b);T=(T=Math.max(m-a,y-d))!==0?32767/T:0}return pu(L,B,i,a,d,T,0),B}function Zg(r,e,i,a,d){var m,y;if(d===wp(r,e,i,a)>0)for(m=e;m<i;m+=a)y=Xg(m,r[m],r[m+1],y);else for(m=i-a;m>=e;m-=a)y=Xg(m,r[m],r[m+1],y);return y&&ch(y,y.next)&&(mu(y),y=y.next),y}function ra(r,e){if(!r)return r;e||(e=r);var i,a=r;do if(i=!1,a.steiner||!ch(a,a.next)&&vn(a.prev,a,a.next)!==0)a=a.next;else{if(mu(a),(a=e=a.prev)===a.next)break;i=!0}while(i||a!==e);return e}function pu(r,e,i,a,d,m,y){if(r){!y&&m&&function(z,M,L,B){var F=z;do F.z===0&&(F.z=vp(F.x,F.y,M,L,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==z);F.prevZ.nextZ=null,F.prevZ=null,function(H){var X,le,fe,oe,de,Se,be,Xe,Je=1;do{for(le=H,H=null,de=null,Se=0;le;){for(Se++,fe=le,be=0,X=0;X<Je&&(be++,fe=fe.nextZ);X++);for(Xe=Je;be>0||Xe>0&&fe;)be!==0&&(Xe===0||!fe||le.z<=fe.z)?(oe=le,le=le.nextZ,be--):(oe=fe,fe=fe.nextZ,Xe--),de?de.nextZ=oe:H=oe,oe.prevZ=de,de=oe;le=fe}de.nextZ=null,Je*=2}while(Se>1)}(F)}(r,a,d,m);for(var w,b,T=r;r.prev!==r.next;)if(w=r.prev,b=r.next,m?K0(r,a,d,m):H0(r))e.push(w.i/i|0),e.push(r.i/i|0),e.push(b.i/i|0),mu(r),r=b.next,T=b.next;else if((r=b)===T){y?y===1?pu(r=Y0(ra(r),e,i),e,i,a,d,m,2):y===2&&J0(r,e,i,a,d,m):pu(ra(r),e,i,a,d,m,1);break}}}function H0(r){var e=r.prev,i=r,a=r.next;if(vn(e,i,a)>=0)return!1;for(var d=e.x,m=i.x,y=a.x,w=e.y,b=i.y,T=a.y,z=d<m?d<y?d:y:m<y?m:y,M=w<b?w<T?w:T:b<T?b:T,L=d>m?d>y?d:y:m>y?m:y,B=w>b?w>T?w:T:b>T?b:T,F=a.next;F!==e;){if(F.x>=z&&F.x<=L&&F.y>=M&&F.y<=B&&Ga(d,w,m,b,y,T,F.x,F.y)&&vn(F.prev,F,F.next)>=0)return!1;F=F.next}return!0}function K0(r,e,i,a){var d=r.prev,m=r,y=r.next;if(vn(d,m,y)>=0)return!1;for(var w=d.x,b=m.x,T=y.x,z=d.y,M=m.y,L=y.y,B=w<b?w<T?w:T:b<T?b:T,F=z<M?z<L?z:L:M<L?M:L,H=w>b?w>T?w:T:b>T?b:T,X=z>M?z>L?z:L:M>L?M:L,le=vp(B,F,e,i,a),fe=vp(H,X,e,i,a),oe=r.prevZ,de=r.nextZ;oe&&oe.z>=le&&de&&de.z<=fe;){if(oe.x>=B&&oe.x<=H&&oe.y>=F&&oe.y<=X&&oe!==d&&oe!==y&&Ga(w,z,b,M,T,L,oe.x,oe.y)&&vn(oe.prev,oe,oe.next)>=0||(oe=oe.prevZ,de.x>=B&&de.x<=H&&de.y>=F&&de.y<=X&&de!==d&&de!==y&&Ga(w,z,b,M,T,L,de.x,de.y)&&vn(de.prev,de,de.next)>=0))return!1;de=de.nextZ}for(;oe&&oe.z>=le;){if(oe.x>=B&&oe.x<=H&&oe.y>=F&&oe.y<=X&&oe!==d&&oe!==y&&Ga(w,z,b,M,T,L,oe.x,oe.y)&&vn(oe.prev,oe,oe.next)>=0)return!1;oe=oe.prevZ}for(;de&&de.z<=fe;){if(de.x>=B&&de.x<=H&&de.y>=F&&de.y<=X&&de!==d&&de!==y&&Ga(w,z,b,M,T,L,de.x,de.y)&&vn(de.prev,de,de.next)>=0)return!1;de=de.nextZ}return!0}function Y0(r,e,i){var a=r;do{var d=a.prev,m=a.next.next;!ch(d,m)&&qg(d,a,a.next,m)&&fu(d,m)&&fu(m,d)&&(e.push(d.i/i|0),e.push(a.i/i|0),e.push(m.i/i|0),mu(a),mu(a.next),a=r=m),a=a.next}while(a!==r);return ra(a)}function J0(r,e,i,a,d,m){var y=r;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&r1(y,w)){var b=Wg(y,w);return y=ra(y,y.next),b=ra(b,b.next),pu(y,e,i,a,d,m,0),void pu(b,e,i,a,d,m,0)}w=w.next}y=y.next}while(y!==r)}function Q0(r,e){return r.x-e.x}function e1(r,e){var i=function(d,m){var y,w=m,b=d.x,T=d.y,z=-1/0;do{if(T<=w.y&&T>=w.next.y&&w.next.y!==w.y){var M=w.x+(T-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(M<=b&&M>z&&(z=M,y=w.x<w.next.x?w:w.next,M===b))return y}w=w.next}while(w!==m);if(!y)return null;var L,B=y,F=y.x,H=y.y,X=1/0;w=y;do b>=w.x&&w.x>=F&&b!==w.x&&Ga(T<H?b:z,T,F,H,T<H?z:b,T,w.x,w.y)&&(L=Math.abs(T-w.y)/(b-w.x),fu(w,d)&&(L<X||L===X&&(w.x>y.x||w.x===y.x&&t1(y,w)))&&(y=w,X=L)),w=w.next;while(w!==B);return y}(r,e);if(!i)return e;var a=Wg(i,r);return ra(a,a.next),ra(i,i.next)}function t1(r,e){return vn(r.prev,r,e.prev)<0&&vn(e.next,r,r.next)<0}function vp(r,e,i,a,d){return(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-i)*d|0)|r<<8))|r<<4))|r<<2))|r<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*d|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function n1(r){var e=r,i=r;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==r);return i}function Ga(r,e,i,a,d,m,y,w){return(d-y)*(e-w)>=(r-y)*(m-w)&&(r-y)*(a-w)>=(i-y)*(e-w)&&(i-y)*(m-w)>=(d-y)*(a-w)}function r1(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!function(i,a){var d=i;do{if(d.i!==i.i&&d.next.i!==i.i&&d.i!==a.i&&d.next.i!==a.i&&qg(d,d.next,i,a))return!0;d=d.next}while(d!==i);return!1}(r,e)&&(fu(r,e)&&fu(e,r)&&function(i,a){var d=i,m=!1,y=(i.x+a.x)/2,w=(i.y+a.y)/2;do d.y>w!=d.next.y>w&&d.next.y!==d.y&&y<(d.next.x-d.x)*(w-d.y)/(d.next.y-d.y)+d.x&&(m=!m),d=d.next;while(d!==i);return m}(r,e)&&(vn(r.prev,r,e.prev)||vn(r,e.prev,e))||ch(r,e)&&vn(r.prev,r,r.next)>0&&vn(e.prev,e,e.next)>0)}function vn(r,e,i){return(e.y-r.y)*(i.x-e.x)-(e.x-r.x)*(i.y-e.y)}function ch(r,e){return r.x===e.x&&r.y===e.y}function qg(r,e,i,a){var d=dh(vn(r,e,i)),m=dh(vn(r,e,a)),y=dh(vn(i,a,r)),w=dh(vn(i,a,e));return d!==m&&y!==w||!(d!==0||!hh(r,i,e))||!(m!==0||!hh(r,a,e))||!(y!==0||!hh(i,r,a))||!(w!==0||!hh(i,e,a))}function hh(r,e,i){return e.x<=Math.max(r.x,i.x)&&e.x>=Math.min(r.x,i.x)&&e.y<=Math.max(r.y,i.y)&&e.y>=Math.min(r.y,i.y)}function dh(r){return r>0?1:r<0?-1:0}function fu(r,e){return vn(r.prev,r,r.next)<0?vn(r,e,r.next)>=0&&vn(r,r.prev,e)>=0:vn(r,e,r.prev)<0||vn(r,r.next,e)<0}function Wg(r,e){var i=new xp(r.i,r.x,r.y),a=new xp(e.i,e.x,e.y),d=r.next,m=e.prev;return r.next=e,e.prev=r,i.next=d,d.prev=i,a.next=i,i.prev=a,m.next=a,a.prev=m,a}function Xg(r,e,i,a){var d=new xp(r,e,i);return a?(d.next=a.next,d.prev=a,a.next.prev=d,a.next=d):(d.prev=d,d.next=d),d}function mu(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function xp(r,e,i){this.i=r,this.x=e,this.y=i,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function wp(r,e,i,a){for(var d=0,m=e,y=i-a;m<i;m+=a)d+=(r[y]-r[m])*(r[m+1]+r[y+1]),y=m;return d}function i1(r,e,i,a,d){Hg(r,e,i||0,a||r.length-1,d||o1)}function Hg(r,e,i,a,d){for(;a>i;){if(a-i>600){var m=a-i+1,y=e-i+1,w=Math.log(m),b=.5*Math.exp(2*w/3),T=.5*Math.sqrt(w*b*(m-b)/m)*(y-m/2<0?-1:1);Hg(r,e,Math.max(i,Math.floor(e-y*b/m+T)),Math.min(a,Math.floor(e+(m-y)*b/m+T)),d)}var z=r[e],M=i,L=a;for(gu(r,i,e),d(r[a],z)>0&&gu(r,i,a);M<L;){for(gu(r,M,L),M++,L--;d(r[M],z)<0;)M++;for(;d(r[L],z)>0;)L--}d(r[i],z)===0?gu(r,i,L):gu(r,++L,a),L<=e&&(i=L+1),e<=L&&(a=L-1)}}function gu(r,e,i){var a=r[e];r[e]=r[i],r[i]=a}function o1(r,e){return r<e?-1:r>e?1:0}function bp(r,e){const i=r.length;if(i<=1)return[r];const a=[];let d,m;for(let y=0;y<i;y++){const w=je(r[y]);w!==0&&(r[y].area=Math.abs(w),m===void 0&&(m=w<0),m===w<0?(d&&a.push(d),d=[r[y]]):d.push(r[y]))}if(d&&a.push(d),e>1)for(let y=0;y<a.length;y++)a[y].length<=e||(i1(a[y],e,1,a[y].length-1,s1),a[y]=a[y].slice(0,e));return a}function s1(r,e){return e.area-r.area}function Sp(r,e,i){const a=i.patternDependencies;let d=!1;for(const m of e){const y=m.paint.get(`${r}-pattern`);y.isConstant()||(d=!0);const w=y.constantOr(null);w&&(d=!0,a[w.to]=!0,a[w.from]=!0)}return d}function Ep(r,e,i,a,d){const m=d.patternDependencies;for(const y of e){const w=y.paint.get(`${r}-pattern`).value;if(w.kind!=="constant"){let b=w.evaluate({zoom:a-1},i,{},d.availableImages),T=w.evaluate({zoom:a},i,{},d.availableImages),z=w.evaluate({zoom:a+1},i,{},d.availableImages);b=b&&b.name?b.name:b,T=T&&T.name?T.name:T,z=z&&z.name?z.name:z,m[b]=!0,m[T]=!0,m[z]=!0,i.patterns[y.id]={min:b,mid:T,max:z}}}return i}lh.exports=uh,lh.exports.default=uh,uh.deviation=function(r,e,i,a){var d=e&&e.length,m=Math.abs(wp(r,0,d?e[0]*i:r.length,i));if(d)for(var y=0,w=e.length;y<w;y++)m-=Math.abs(wp(r,e[y]*i,y<w-1?e[y+1]*i:r.length,i));var b=0;for(y=0;y<a.length;y+=3){var T=a[y]*i,z=a[y+1]*i,M=a[y+2]*i;b+=Math.abs((r[T]-r[M])*(r[z+1]-r[T+1])-(r[T]-r[z])*(r[M+1]-r[T+1]))}return m===0&&b===0?0:Math.abs((b-m)/m)},uh.flatten=function(r){for(var e=r[0][0].length,i={vertices:[],holes:[],dimensions:e},a=0,d=0;d<r.length;d++){for(var m=0;m<r[d].length;m++)for(var y=0;y<e;y++)i.vertices.push(r[d][m][y]);d>0&&i.holes.push(a+=r[d-1].length)}return i};class Tp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ot,this.indexArray=new yr,this.indexArray2=new Pi,this.programConfigurations=new ea(e.layers,e.zoom),this.segments=new wt,this.segments2=new wt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){this.hasPattern=Sp("fill",this.layers,i);const d=this.layers[0].layout.get("fill-sort-key"),m=!d.isConstant(),y=[];for(const{feature:w,id:b,index:T,sourceLayerIndex:z}of e){const M=this.layers[0]._featureFilter.needGeometry,L=na(w,M);if(!this.layers[0]._featureFilter.filter(new rn(this.zoom),L,a))continue;const B=m?d.evaluate(L,{},a,i.availableImages):void 0,F={id:b,properties:w.properties,type:w.type,sourceLayerIndex:z,index:T,geometry:M?L.geometry:ta(w),patterns:{},sortKey:B};y.push(F)}m&&y.sort((w,b)=>w.sortKey-b.sortKey);for(const w of y){const{geometry:b,index:T,sourceLayerIndex:z}=w;if(this.hasPattern){const M=Ep("fill",this.layers,w,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(w,b,T,a,{});i.featureIndex.insert(e[T].feature,b,T,z,this.index)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}addFeatures(e,i,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,X0),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,i,a,d,m){for(const y of bp(i,500)){let w=0;for(const B of y)w+=B.length;const b=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),T=b.vertexLength,z=[],M=[];for(const B of y){if(B.length===0)continue;B!==y[0]&&M.push(z.length/2);const F=this.segments2.prepareSegment(B.length,this.layoutVertexArray,this.indexArray2),H=F.vertexLength;this.layoutVertexArray.emplaceBack(B[0].x,B[0].y),this.indexArray2.emplaceBack(H+B.length-1,H),z.push(B[0].x),z.push(B[0].y);for(let X=1;X<B.length;X++)this.layoutVertexArray.emplaceBack(B[X].x,B[X].y),this.indexArray2.emplaceBack(H+X-1,H+X),z.push(B[X].x),z.push(B[X].y);F.vertexLength+=B.length,F.primitiveLength+=B.length}const L=lh.exports(z,M);for(let B=0;B<L.length;B+=3)this.indexArray.emplaceBack(T+L[B],T+L[B+1],T+L[B+2]);b.vertexLength+=w,b.primitiveLength+=L.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,d)}}Ke("FillBucket",Tp,{omit:["layers","patternFeatures"]});const a1=new qn({"fill-sort-key":new lt(xe.layout_fill["fill-sort-key"])});var l1={paint:new qn({"fill-antialias":new et(xe.paint_fill["fill-antialias"]),"fill-opacity":new lt(xe.paint_fill["fill-opacity"]),"fill-color":new lt(xe.paint_fill["fill-color"]),"fill-outline-color":new lt(xe.paint_fill["fill-outline-color"]),"fill-translate":new et(xe.paint_fill["fill-translate"]),"fill-translate-anchor":new et(xe.paint_fill["fill-translate-anchor"]),"fill-pattern":new ts(xe.paint_fill["fill-pattern"])}),layout:a1};const u1=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),c1=Cn([{name:"a_centroid",components:2,type:"Int16"}],4),{members:h1}=u1;var is={},d1=ot,Kg=Za;function Za(r,e,i,a,d){this.properties={},this.extent=i,this.type=0,this._pbf=r,this._geometry=-1,this._keys=a,this._values=d,r.readFields(p1,this,e)}function p1(r,e,i){r==1?e.id=i.readVarint():r==2?function(a,d){for(var m=a.readVarint()+a.pos;a.pos<m;){var y=d._keys[a.readVarint()],w=d._values[a.readVarint()];d.properties[y]=w}}(i,e):r==3?e.type=i.readVarint():r==4&&(e._geometry=i.pos)}function f1(r){for(var e,i,a=0,d=0,m=r.length,y=m-1;d<m;y=d++)a+=((i=r[y]).x-(e=r[d]).x)*(e.y+i.y);return a}Za.types=["Unknown","Point","LineString","Polygon"],Za.prototype.loadGeometry=function(){var r=this._pbf;r.pos=this._geometry;for(var e,i=r.readVarint()+r.pos,a=1,d=0,m=0,y=0,w=[];r.pos<i;){if(d<=0){var b=r.readVarint();a=7&b,d=b>>3}if(d--,a===1||a===2)m+=r.readSVarint(),y+=r.readSVarint(),a===1&&(e&&w.push(e),e=[]),e.push(new d1(m,y));else{if(a!==7)throw new Error("unknown command "+a);e&&e.push(e[0].clone())}}return e&&w.push(e),w},Za.prototype.bbox=function(){var r=this._pbf;r.pos=this._geometry;for(var e=r.readVarint()+r.pos,i=1,a=0,d=0,m=0,y=1/0,w=-1/0,b=1/0,T=-1/0;r.pos<e;){if(a<=0){var z=r.readVarint();i=7&z,a=z>>3}if(a--,i===1||i===2)(d+=r.readSVarint())<y&&(y=d),d>w&&(w=d),(m+=r.readSVarint())<b&&(b=m),m>T&&(T=m);else if(i!==7)throw new Error("unknown command "+i)}return[y,b,w,T]},Za.prototype.toGeoJSON=function(r,e,i){var a,d,m=this.extent*Math.pow(2,i),y=this.extent*r,w=this.extent*e,b=this.loadGeometry(),T=Za.types[this.type];function z(B){for(var F=0;F<B.length;F++){var H=B[F];B[F]=[360*(H.x+y)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(H.y+w)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var M=[];for(a=0;a<b.length;a++)M[a]=b[a][0];z(b=M);break;case 2:for(a=0;a<b.length;a++)z(b[a]);break;case 3:for(b=function(B){var F=B.length;if(F<=1)return[B];for(var H,X,le=[],fe=0;fe<F;fe++){var oe=f1(B[fe]);oe!==0&&(X===void 0&&(X=oe<0),X===oe<0?(H&&le.push(H),H=[B[fe]]):H.push(B[fe]))}return H&&le.push(H),le}(b),a=0;a<b.length;a++)for(d=0;d<b[a].length;d++)z(b[a][d])}b.length===1?b=b[0]:T="Multi"+T;var L={type:"Feature",geometry:{type:T,coordinates:b},properties:this.properties};return"id"in this&&(L.id=this.id),L};var m1=Kg,Yg=Jg;function Jg(r,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=r,this._keys=[],this._values=[],this._features=[],r.readFields(g1,this,e),this.length=this._features.length}function g1(r,e,i){r===15?e.version=i.readVarint():r===1?e.name=i.readString():r===5?e.extent=i.readVarint():r===2?e._features.push(i.pos):r===3?e._keys.push(i.readString()):r===4&&e._values.push(function(a){for(var d=null,m=a.readVarint()+a.pos;a.pos<m;){var y=a.readVarint()>>3;d=y===1?a.readString():y===2?a.readFloat():y===3?a.readDouble():y===4?a.readVarint64():y===5?a.readVarint():y===6?a.readSVarint():y===7?a.readBoolean():null}return d}(i))}Jg.prototype.feature=function(r){if(r<0||r>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[r];var e=this._pbf.readVarint()+this._pbf.pos;return new m1(this._pbf,e,this.extent,this._keys,this._values)};var y1=Yg;function _1(r,e,i){if(r===3){var a=new y1(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}is.VectorTile=function(r,e){this.layers=r.readFields(_1,{},e)},is.VectorTileFeature=Kg,is.VectorTileLayer=Yg;const v1=is.VectorTileFeature.types,kp=Math.pow(2,13);function yu(r,e,i,a,d,m,y,w){r.emplaceBack(e,i,2*Math.floor(a*kp)+y,d*kp*2,m*kp*2,Math.round(w))}class Cp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.layoutVertexArray=new Tt,this.centroidVertexArray=new rt,this.indexArray=new yr,this.programConfigurations=new ea(e.layers,e.zoom),this.segments=new wt,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){this.features=[],this.hasPattern=Sp("fill-extrusion",this.layers,i);for(const{feature:d,id:m,index:y,sourceLayerIndex:w}of e){const b=this.layers[0]._featureFilter.needGeometry,T=na(d,b);if(!this.layers[0]._featureFilter.filter(new rn(this.zoom),T,a))continue;const z={id:m,sourceLayerIndex:w,index:y,geometry:b?T.geometry:ta(d),properties:d.properties,type:d.type,patterns:{}};this.hasPattern?this.features.push(Ep("fill-extrusion",this.layers,z,this.zoom,i)):this.addFeature(z,z.geometry,y,a,{}),i.featureIndex.insert(d,z.geometry,y,w,this.index,!0)}}addFeatures(e,i,a){for(const d of this.features){const{geometry:m}=d;this.addFeature(d,m,d.index,i,a)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,h1),this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,c1.members,!0),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(e,i,a,d,m){const y={x:0,y:0,vertexCount:0};for(const w of bp(i,500)){let b=0;for(const F of w)b+=F.length;let T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const F of w){if(F.length===0||w1(F))continue;let H=0;for(let X=0;X<F.length;X++){const le=F[X];if(X>=1){const fe=F[X-1];if(!x1(le,fe)){T.vertexLength+4>wt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const oe=le.sub(fe)._perp()._unit(),de=fe.dist(le);H+de>32768&&(H=0),yu(this.layoutVertexArray,le.x,le.y,oe.x,oe.y,0,0,H),yu(this.layoutVertexArray,le.x,le.y,oe.x,oe.y,0,1,H),y.x+=2*le.x,y.y+=2*le.y,y.vertexCount+=2,H+=de,yu(this.layoutVertexArray,fe.x,fe.y,oe.x,oe.y,0,0,H),yu(this.layoutVertexArray,fe.x,fe.y,oe.x,oe.y,0,1,H),y.x+=2*fe.x,y.y+=2*fe.y,y.vertexCount+=2;const Se=T.vertexLength;this.indexArray.emplaceBack(Se,Se+2,Se+1),this.indexArray.emplaceBack(Se+1,Se+2,Se+3),T.vertexLength+=4,T.primitiveLength+=2}}}}if(T.vertexLength+b>wt.MAX_VERTEX_ARRAY_LENGTH&&(T=this.segments.prepareSegment(b,this.layoutVertexArray,this.indexArray)),v1[e.type]!=="Polygon")continue;const z=[],M=[],L=T.vertexLength;for(const F of w)if(F.length!==0){F!==w[0]&&M.push(z.length/2);for(let H=0;H<F.length;H++){const X=F[H];yu(this.layoutVertexArray,X.x,X.y,0,0,1,1,0),y.x+=X.x,y.y+=X.y,y.vertexCount+=1,z.push(X.x),z.push(X.y)}}const B=lh.exports(z,M);for(let F=0;F<B.length;F+=3)this.indexArray.emplaceBack(L+B[F],L+B[F+2],L+B[F+1]);T.primitiveLength+=B.length/3,T.vertexLength+=b}for(let w=0;w<y.vertexCount;w++)this.centroidVertexArray.emplaceBack(Math.floor(y.x/y.vertexCount),Math.floor(y.y/y.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,d)}}function x1(r,e){return r.x===e.x&&(r.x<0||r.x>Dn)||r.y===e.y&&(r.y<0||r.y>Dn)}function w1(r){return r.every(e=>e.x<0)||r.every(e=>e.x>Dn)||r.every(e=>e.y<0)||r.every(e=>e.y>Dn)}Ke("FillExtrusionBucket",Cp,{omit:["layers","features"]});var b1={paint:new qn({"fill-extrusion-opacity":new et(xe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new lt(xe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new et(xe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ts(xe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new lt(xe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new lt(xe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new et(xe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function _u(r,e){return r.x*e.x+r.y*e.y}function Qg(r,e){if(r.length===1){let i=0;const a=e[i++];let d;for(;!d||a.equals(d);)if(d=e[i++],!d)return 1/0;for(;i<e.length;i++){const m=e[i],y=r[0],w=d.sub(a),b=m.sub(a),T=y.sub(a),z=_u(w,w),M=_u(w,b),L=_u(b,b),B=_u(T,w),F=_u(T,b),H=z*L-M*M,X=(L*B-M*F)/H,le=(z*F-M*B)/H,fe=a.z*(1-X-le)+d.z*X+m.z*le;if(isFinite(fe))return fe}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}const S1=Cn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:E1}=S1,T1=Cn([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:k1}=T1,C1=is.VectorTileFeature.types,I1=Math.cos(Math.PI/180*37.5),ey=Math.pow(2,14)/.5;class Ip{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new zt,this.layoutVertexArray2=new $t,this.indexArray=new yr,this.programConfigurations=new ea(e.layers,e.zoom),this.segments=new wt,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id)}populate(e,i,a){this.hasPattern=Sp("line",this.layers,i);const d=this.layers[0].layout.get("line-sort-key"),m=!d.isConstant(),y=[];for(const{feature:w,id:b,index:T,sourceLayerIndex:z}of e){const M=this.layers[0]._featureFilter.needGeometry,L=na(w,M);if(!this.layers[0]._featureFilter.filter(new rn(this.zoom),L,a))continue;const B=m?d.evaluate(L,{},a):void 0,F={id:b,properties:w.properties,type:w.type,sourceLayerIndex:z,index:T,geometry:M?L.geometry:ta(w),patterns:{},sortKey:B};y.push(F)}m&&y.sort((w,b)=>w.sortKey-b.sortKey);for(const w of y){const{geometry:b,index:T,sourceLayerIndex:z}=w;if(this.hasPattern){const M=Ep("line",this.layers,w,this.zoom,i);this.patternFeatures.push(M)}else this.addFeature(w,b,T,a,{});i.featureIndex.insert(e[T].feature,b,T,z,this.index)}}update(e,i,a){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,i,this.stateDependentLayers,a)}addFeatures(e,i,a){for(const d of this.patternFeatures)this.addFeature(d,d.geometry,d.index,i,a)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,k1)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,E1),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(e.properties,"mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,i,a,d,m){const y=this.layers[0].layout,w=y.get("line-join").evaluate(e,{}),b=y.get("line-cap"),T=y.get("line-miter-limit"),z=y.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const M of i)this.addLine(M,e,w,b,T,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,m,d)}addLine(e,i,a,d,m,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let le=0;le<e.length-1;le++)this.totalDistance+=e[le].dist(e[le+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w=C1[i.type]==="Polygon";let b=e.length;for(;b>=2&&e[b-1].equals(e[b-2]);)b--;let T=0;for(;T<b-1&&e[T].equals(e[T+1]);)T++;if(b<(w?3:2))return;a==="bevel"&&(m=1.05);const z=this.overscaling<=16?122880/(512*this.overscaling):0,M=this.segments.prepareSegment(10*b,this.layoutVertexArray,this.indexArray);let L,B,F,H,X;this.e1=this.e2=-1,w&&(L=e[b-2],X=e[T].sub(L)._unit()._perp());for(let le=T;le<b;le++){if(F=le===b-1?w?e[T+1]:void 0:e[le+1],F&&e[le].equals(F))continue;X&&(H=X),L&&(B=L),L=e[le],X=F?F.sub(L)._unit()._perp():H,H=H||X;let fe=H.add(X);fe.x===0&&fe.y===0||fe._unit();const oe=H.x*X.x+H.y*X.y,de=fe.x*X.x+fe.y*X.y,Se=de!==0?1/de:1/0,be=2*Math.sqrt(2-2*de),Xe=de<I1&&B&&F,Je=H.x*X.y-H.y*X.x>0;if(Xe&&le>T){const De=L.dist(B);if(De>2*z){const $e=L.sub(L.sub(B)._mult(z/De)._round());this.updateDistance(B,$e),this.addCurrentVertex($e,H,0,0,M),B=$e}}const Ve=B&&F;let Be=Ve?a:w?"butt":d;if(Ve&&Be==="round"&&(Se<y?Be="miter":Se<=2&&(Be="fakeround")),Be==="miter"&&Se>m&&(Be="bevel"),Be==="bevel"&&(Se>2&&(Be="flipbevel"),Se<m&&(Be="miter")),B&&this.updateDistance(B,L),Be==="miter")fe._mult(Se),this.addCurrentVertex(L,fe,0,0,M);else if(Be==="flipbevel"){if(Se>100)fe=X.mult(-1);else{const De=Se*H.add(X).mag()/H.sub(X).mag();fe._perp()._mult(De*(Je?-1:1))}this.addCurrentVertex(L,fe,0,0,M),this.addCurrentVertex(L,fe.mult(-1),0,0,M)}else if(Be==="bevel"||Be==="fakeround"){const De=-Math.sqrt(Se*Se-1),$e=Je?De:0,Oe=Je?0:De;if(B&&this.addCurrentVertex(L,H,$e,Oe,M),Be==="fakeround"){const Ie=Math.round(180*be/Math.PI/20);for(let it=1;it<Ie;it++){let tt=it/Ie;if(tt!==.5){const Qt=tt-.5;tt+=tt*Qt*(tt-1)*((1.0904+oe*(oe*(3.55645-1.43519*oe)-3.2452))*Qt*Qt+(.848013+oe*(.215638*oe-1.06021)))}const vt=X.sub(H)._mult(tt)._add(H)._unit()._mult(Je?-1:1);this.addHalfVertex(L,vt.x,vt.y,!1,Je,0,M)}}F&&this.addCurrentVertex(L,X,-$e,-Oe,M)}else if(Be==="butt")this.addCurrentVertex(L,fe,0,0,M);else if(Be==="square"){const De=B?1:-1;this.addCurrentVertex(L,fe,De,De,M)}else Be==="round"&&(B&&(this.addCurrentVertex(L,H,0,0,M),this.addCurrentVertex(L,H,1,1,M,!0)),F&&(this.addCurrentVertex(L,X,-1,-1,M,!0),this.addCurrentVertex(L,X,0,0,M)));if(Xe&&le<b-1){const De=L.dist(F);if(De>2*z){const $e=L.add(F.sub(L)._mult(z/De)._round());this.updateDistance(L,$e),this.addCurrentVertex($e,X,0,0,M),L=$e}}}}addCurrentVertex(e,i,a,d,m,y=!1){const w=i.y*d-i.x,b=-i.y-i.x*d;this.addHalfVertex(e,i.x+i.y*a,i.y-i.x*a,y,!1,a,m),this.addHalfVertex(e,w,b,y,!0,-d,m),this.distance>ey/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(e,i,a,d,m,y))}addHalfVertex({x:e,y:i},a,d,m,y,w,b){const T=.5*(this.lineClips?this.scaledDistance*(ey-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((e<<1)+(m?1:0),(i<<1)+(y?1:0),Math.round(63*a)+128,Math.round(63*d)+128,1+(w===0?0:w<0?-1:1)|(63&T)<<2,T>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const z=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,z),b.primitiveLength++),y?this.e2=z:this.e1=z}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(e,i){this.distance+=e.dist(i),this.updateScaledDistance()}}Ke("LineBucket",Ip,{omit:["layers","patternFeatures"]});const z1=new qn({"line-cap":new et(xe.layout_line["line-cap"]),"line-join":new lt(xe.layout_line["line-join"]),"line-miter-limit":new et(xe.layout_line["line-miter-limit"]),"line-round-limit":new et(xe.layout_line["line-round-limit"]),"line-sort-key":new lt(xe.layout_line["line-sort-key"])});var ty={paint:new qn({"line-opacity":new lt(xe.paint_line["line-opacity"]),"line-color":new lt(xe.paint_line["line-color"]),"line-translate":new et(xe.paint_line["line-translate"]),"line-translate-anchor":new et(xe.paint_line["line-translate-anchor"]),"line-width":new lt(xe.paint_line["line-width"]),"line-gap-width":new lt(xe.paint_line["line-gap-width"]),"line-offset":new lt(xe.paint_line["line-offset"]),"line-blur":new lt(xe.paint_line["line-blur"]),"line-dasharray":new ou(xe.paint_line["line-dasharray"]),"line-pattern":new ts(xe.paint_line["line-pattern"]),"line-gradient":new Ji(xe.paint_line["line-gradient"])}),layout:z1};const ny=new class extends lt{possiblyEvaluate(r,e){return e=new rn(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(r,e)}evaluate(r,e,i,a){return e=Ce({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(r,e,i,a)}}(ty.paint.properties["line-width"].specification);function ry(r,e){return e>0?e+2*r:r}ny.useIntegerZoom=!0;const A1=Cn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),M1=Cn([{name:"a_projected_pos",components:3,type:"Float32"}],4);Cn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const P1=Cn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);Cn([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const iy=Cn([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),D1=Cn([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function L1(r,e,i){return r.sections.forEach(a=>{a.text=function(d,m,y){const w=m.layout.get("text-transform").evaluate(y,{});return w==="uppercase"?d=d.toLocaleUpperCase():w==="lowercase"&&(d=d.toLocaleLowerCase()),$r.applyArabicShaping&&(d=$r.applyArabicShaping(d)),d}(a.text,e,i)}),r}Cn([{name:"triangle",components:3,type:"Uint16"}]),Cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Cn([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Cn([{type:"Float32",name:"offsetX"}]),Cn([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const vu={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Wn=24,zp=Zt,oy=function(r,e,i,a,d){var m,y,w=8*d-a-1,b=(1<<w)-1,T=b>>1,z=-7,M=i?d-1:0,L=i?-1:1,B=r[e+M];for(M+=L,m=B&(1<<-z)-1,B>>=-z,z+=w;z>0;m=256*m+r[e+M],M+=L,z-=8);for(y=m&(1<<-z)-1,m>>=-z,z+=a;z>0;y=256*y+r[e+M],M+=L,z-=8);if(m===0)m=1-T;else{if(m===b)return y?NaN:1/0*(B?-1:1);y+=Math.pow(2,a),m-=T}return(B?-1:1)*y*Math.pow(2,m-a)},sy=function(r,e,i,a,d,m){var y,w,b,T=8*m-d-1,z=(1<<T)-1,M=z>>1,L=d===23?Math.pow(2,-24)-Math.pow(2,-77):0,B=a?0:m-1,F=a?1:-1,H=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,y=z):(y=Math.floor(Math.log(e)/Math.LN2),e*(b=Math.pow(2,-y))<1&&(y--,b*=2),(e+=y+M>=1?L/b:L*Math.pow(2,1-M))*b>=2&&(y++,b/=2),y+M>=z?(w=0,y=z):y+M>=1?(w=(e*b-1)*Math.pow(2,d),y+=M):(w=e*Math.pow(2,M-1)*Math.pow(2,d),y=0));d>=8;r[i+B]=255&w,B+=F,w/=256,d-=8);for(y=y<<d|w,T+=d;T>0;r[i+B]=255&y,B+=F,y/=256,T-=8);r[i+B-F]|=128*H};function Zt(r){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(r)?r:new Uint8Array(r||0),this.pos=0,this.type=0,this.length=this.buf.length}Zt.Varint=0,Zt.Fixed64=1,Zt.Bytes=2,Zt.Fixed32=5;var os,Ap=4294967296,ay=1/Ap,ly=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function So(r){return r.type===Zt.Bytes?r.readVarint()+r.pos:r.pos+1}function qa(r,e,i){return i?4294967296*e+(r>>>0):4294967296*(e>>>0)+(r>>>0)}function uy(r,e,i){var a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(var d=i.pos-1;d>=r;d--)i.buf[d+a]=i.buf[d]}function R1(r,e){for(var i=0;i<r.length;i++)e.writeVarint(r[i])}function B1(r,e){for(var i=0;i<r.length;i++)e.writeSVarint(r[i])}function F1(r,e){for(var i=0;i<r.length;i++)e.writeFloat(r[i])}function O1(r,e){for(var i=0;i<r.length;i++)e.writeDouble(r[i])}function N1(r,e){for(var i=0;i<r.length;i++)e.writeBoolean(r[i])}function U1(r,e){for(var i=0;i<r.length;i++)e.writeFixed32(r[i])}function V1(r,e){for(var i=0;i<r.length;i++)e.writeSFixed32(r[i])}function $1(r,e){for(var i=0;i<r.length;i++)e.writeFixed64(r[i])}function j1(r,e){for(var i=0;i<r.length;i++)e.writeSFixed64(r[i])}function ph(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+16777216*r[e+3]}function Wa(r,e,i){r[i]=e,r[i+1]=e>>>8,r[i+2]=e>>>16,r[i+3]=e>>>24}function cy(r,e){return(r[e]|r[e+1]<<8|r[e+2]<<16)+(r[e+3]<<24)}function G1(r,e,i){r===1&&i.readMessage(Z1,e)}function Z1(r,e,i){if(r===3){const{id:a,bitmap:d,width:m,height:y,left:w,top:b,advance:T}=i.readMessage(q1,{});e.push({id:a,bitmap:new du({width:m+6,height:y+6},d),metrics:{width:m,height:y,left:w,top:b,advance:T}})}}function q1(r,e,i){r===1?e.id=i.readVarint():r===2?e.bitmap=i.readBytes():r===3?e.width=i.readVarint():r===4?e.height=i.readVarint():r===5?e.left=i.readSVarint():r===6?e.top=i.readSVarint():r===7&&(e.advance=i.readVarint())}function hy(r){let e=0,i=0;for(const y of r)e+=y.w*y.h,i=Math.max(i,y.w);r.sort((y,w)=>w.h-y.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let d=0,m=0;for(const y of r)for(let w=a.length-1;w>=0;w--){const b=a[w];if(!(y.w>b.w||y.h>b.h)){if(y.x=b.x,y.y=b.y,m=Math.max(m,y.y+y.h),d=Math.max(d,y.x+y.w),y.w===b.w&&y.h===b.h){const T=a.pop();w<a.length&&(a[w]=T)}else y.h===b.h?(b.x+=y.w,b.w-=y.w):y.w===b.w?(b.y+=y.h,b.h-=y.h):(a.push({x:b.x+y.w,y:b.y,w:b.w-y.w,h:y.h}),b.y+=y.h,b.h-=y.h);break}}return{w:d,h:m,fill:e/(d*m)||0}}Zt.prototype={destroy:function(){this.buf=null},readFields:function(r,e,i){for(i=i||this.length;this.pos<i;){var a=this.readVarint(),d=a>>3,m=this.pos;this.type=7&a,r(d,e,this),this.pos===m&&this.skip(a)}return e},readMessage:function(r,e){return this.readFields(r,e,this.readVarint()+this.pos)},readFixed32:function(){var r=ph(this.buf,this.pos);return this.pos+=4,r},readSFixed32:function(){var r=cy(this.buf,this.pos);return this.pos+=4,r},readFixed64:function(){var r=ph(this.buf,this.pos)+ph(this.buf,this.pos+4)*Ap;return this.pos+=8,r},readSFixed64:function(){var r=ph(this.buf,this.pos)+cy(this.buf,this.pos+4)*Ap;return this.pos+=8,r},readFloat:function(){var r=oy(this.buf,this.pos,!0,23,4);return this.pos+=4,r},readDouble:function(){var r=oy(this.buf,this.pos,!0,52,8);return this.pos+=8,r},readVarint:function(r){var e,i,a=this.buf;return e=127&(i=a[this.pos++]),i<128?e:(e|=(127&(i=a[this.pos++]))<<7,i<128?e:(e|=(127&(i=a[this.pos++]))<<14,i<128?e:(e|=(127&(i=a[this.pos++]))<<21,i<128?e:function(d,m,y){var w,b,T=y.buf;if(w=(112&(b=T[y.pos++]))>>4,b<128||(w|=(127&(b=T[y.pos++]))<<3,b<128)||(w|=(127&(b=T[y.pos++]))<<10,b<128)||(w|=(127&(b=T[y.pos++]))<<17,b<128)||(w|=(127&(b=T[y.pos++]))<<24,b<128)||(w|=(1&(b=T[y.pos++]))<<31,b<128))return qa(d,w,m);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(i=a[this.pos]))<<28,r,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var r=this.readVarint();return r%2==1?(r+1)/-2:r/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var r=this.readVarint()+this.pos,e=this.pos;return this.pos=r,r-e>=12&&ly?function(i,a,d){return ly.decode(i.subarray(a,d))}(this.buf,e,r):function(i,a,d){for(var m="",y=a;y<d;){var w,b,T,z=i[y],M=null,L=z>239?4:z>223?3:z>191?2:1;if(y+L>d)break;L===1?z<128&&(M=z):L===2?(192&(w=i[y+1]))==128&&(M=(31&z)<<6|63&w)<=127&&(M=null):L===3?(b=i[y+2],(192&(w=i[y+1]))==128&&(192&b)==128&&((M=(15&z)<<12|(63&w)<<6|63&b)<=2047||M>=55296&&M<=57343)&&(M=null)):L===4&&(b=i[y+2],T=i[y+3],(192&(w=i[y+1]))==128&&(192&b)==128&&(192&T)==128&&((M=(15&z)<<18|(63&w)<<12|(63&b)<<6|63&T)<=65535||M>=1114112)&&(M=null)),M===null?(M=65533,L=1):M>65535&&(M-=65536,m+=String.fromCharCode(M>>>10&1023|55296),M=56320|1023&M),m+=String.fromCharCode(M),y+=L}return m}(this.buf,e,r)},readBytes:function(){var r=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,r);return this.pos=r,e},readPackedVarint:function(r,e){if(this.type!==Zt.Bytes)return r.push(this.readVarint(e));var i=So(this);for(r=r||[];this.pos<i;)r.push(this.readVarint(e));return r},readPackedSVarint:function(r){if(this.type!==Zt.Bytes)return r.push(this.readSVarint());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readSVarint());return r},readPackedBoolean:function(r){if(this.type!==Zt.Bytes)return r.push(this.readBoolean());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readBoolean());return r},readPackedFloat:function(r){if(this.type!==Zt.Bytes)return r.push(this.readFloat());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readFloat());return r},readPackedDouble:function(r){if(this.type!==Zt.Bytes)return r.push(this.readDouble());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readDouble());return r},readPackedFixed32:function(r){if(this.type!==Zt.Bytes)return r.push(this.readFixed32());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readFixed32());return r},readPackedSFixed32:function(r){if(this.type!==Zt.Bytes)return r.push(this.readSFixed32());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed32());return r},readPackedFixed64:function(r){if(this.type!==Zt.Bytes)return r.push(this.readFixed64());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readFixed64());return r},readPackedSFixed64:function(r){if(this.type!==Zt.Bytes)return r.push(this.readSFixed64());var e=So(this);for(r=r||[];this.pos<e;)r.push(this.readSFixed64());return r},skip:function(r){var e=7&r;if(e===Zt.Varint)for(;this.buf[this.pos++]>127;);else if(e===Zt.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Zt.Fixed32)this.pos+=4;else{if(e!==Zt.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(r,e){this.writeVarint(r<<3|e)},realloc:function(r){for(var e=this.length||16;e<this.pos+r;)e*=2;if(e!==this.length){var i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(r){this.realloc(4),Wa(this.buf,r,this.pos),this.pos+=4},writeSFixed32:function(r){this.realloc(4),Wa(this.buf,r,this.pos),this.pos+=4},writeFixed64:function(r){this.realloc(8),Wa(this.buf,-1&r,this.pos),Wa(this.buf,Math.floor(r*ay),this.pos+4),this.pos+=8},writeSFixed64:function(r){this.realloc(8),Wa(this.buf,-1&r,this.pos),Wa(this.buf,Math.floor(r*ay),this.pos+4),this.pos+=8},writeVarint:function(r){(r=+r||0)>268435455||r<0?function(e,i){var a,d;if(e>=0?(a=e%4294967296|0,d=e/4294967296|0):(d=~(-e/4294967296),4294967295^(a=~(-e%4294967296))?a=a+1|0:(a=0,d=d+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(m,y,w){w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,m>>>=7,w.buf[w.pos++]=127&m|128,w.buf[w.pos]=127&(m>>>=7)}(a,0,i),function(m,y){var w=(7&m)<<4;y.buf[y.pos++]|=w|((m>>>=3)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m|((m>>>=7)?128:0),m&&(y.buf[y.pos++]=127&m)))))}(d,i)}(r,this):(this.realloc(4),this.buf[this.pos++]=127&r|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=127&(r>>>=7)|(r>127?128:0),r<=127||(this.buf[this.pos++]=r>>>7&127))))},writeSVarint:function(r){this.writeVarint(r<0?2*-r-1:2*r)},writeBoolean:function(r){this.writeVarint(Boolean(r))},writeString:function(r){r=String(r),this.realloc(4*r.length),this.pos++;var e=this.pos;this.pos=function(a,d,m){for(var y,w,b=0;b<d.length;b++){if((y=d.charCodeAt(b))>55295&&y<57344){if(!w){y>56319||b+1===d.length?(a[m++]=239,a[m++]=191,a[m++]=189):w=y;continue}if(y<56320){a[m++]=239,a[m++]=191,a[m++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(a[m++]=239,a[m++]=191,a[m++]=189,w=null);y<128?a[m++]=y:(y<2048?a[m++]=y>>6|192:(y<65536?a[m++]=y>>12|224:(a[m++]=y>>18|240,a[m++]=y>>12&63|128),a[m++]=y>>6&63|128),a[m++]=63&y|128)}return m}(this.buf,r,this.pos);var i=this.pos-e;i>=128&&uy(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i},writeFloat:function(r){this.realloc(4),sy(this.buf,r,this.pos,!0,23,4),this.pos+=4},writeDouble:function(r){this.realloc(8),sy(this.buf,r,this.pos,!0,52,8),this.pos+=8},writeBytes:function(r){var e=r.length;this.writeVarint(e),this.realloc(e);for(var i=0;i<e;i++)this.buf[this.pos++]=r[i]},writeRawMessage:function(r,e){this.pos++;var i=this.pos;r(e,this);var a=this.pos-i;a>=128&&uy(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a},writeMessage:function(r,e,i){this.writeTag(r,Zt.Bytes),this.writeRawMessage(e,i)},writePackedVarint:function(r,e){e.length&&this.writeMessage(r,R1,e)},writePackedSVarint:function(r,e){e.length&&this.writeMessage(r,B1,e)},writePackedBoolean:function(r,e){e.length&&this.writeMessage(r,N1,e)},writePackedFloat:function(r,e){e.length&&this.writeMessage(r,F1,e)},writePackedDouble:function(r,e){e.length&&this.writeMessage(r,O1,e)},writePackedFixed32:function(r,e){e.length&&this.writeMessage(r,U1,e)},writePackedSFixed32:function(r,e){e.length&&this.writeMessage(r,V1,e)},writePackedFixed64:function(r,e){e.length&&this.writeMessage(r,$1,e)},writePackedSFixed64:function(r,e){e.length&&this.writeMessage(r,j1,e)},writeBytesField:function(r,e){this.writeTag(r,Zt.Bytes),this.writeBytes(e)},writeFixed32Field:function(r,e){this.writeTag(r,Zt.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(r,e){this.writeTag(r,Zt.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(r,e){this.writeTag(r,Zt.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(r,e){this.writeTag(r,Zt.Fixed64),this.writeSFixed64(e)},writeVarintField:function(r,e){this.writeTag(r,Zt.Varint),this.writeVarint(e)},writeSVarintField:function(r,e){this.writeTag(r,Zt.Varint),this.writeSVarint(e)},writeStringField:function(r,e){this.writeTag(r,Zt.Bytes),this.writeString(e)},writeFloatField:function(r,e){this.writeTag(r,Zt.Fixed32),this.writeFloat(e)},writeDoubleField:function(r,e){this.writeTag(r,Zt.Fixed64),this.writeDouble(e)},writeBooleanField:function(r,e){this.writeVarintField(r,Boolean(e))}};class Mp{constructor(e,{pixelRatio:i,version:a,stretchX:d,stretchY:m,content:y}){this.paddedRect=e,this.pixelRatio=i,this.stretchX=d,this.stretchY=m,this.content=y,this.version=a}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class dy{constructor(e,i){const a={},d={};this.haveRenderCallbacks=[];const m=[];this.addImages(e,a,m),this.addImages(i,d,m);const{w:y,h:w}=hy(m),b=new ti({width:y||1,height:w||1});for(const T in e){const z=e[T],M=a[T].paddedRect;ti.copy(z.data,b,{x:0,y:0},{x:M.x+1,y:M.y+1},z.data)}for(const T in i){const z=i[T],M=d[T].paddedRect,L=M.x+1,B=M.y+1,F=z.data.width,H=z.data.height;ti.copy(z.data,b,{x:0,y:0},{x:L,y:B},z.data),ti.copy(z.data,b,{x:0,y:H-1},{x:L,y:B-1},{width:F,height:1}),ti.copy(z.data,b,{x:0,y:0},{x:L,y:B+H},{width:F,height:1}),ti.copy(z.data,b,{x:F-1,y:0},{x:L-1,y:B},{width:1,height:H}),ti.copy(z.data,b,{x:0,y:0},{x:L+F,y:B},{width:1,height:H})}this.image=b,this.iconPositions=a,this.patternPositions=d}addImages(e,i,a){for(const d in e){const m=e[d],y={x:0,y:0,w:m.data.width+2,h:m.data.height+2};a.push(y),i[d]=new Mp(y,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(d)}}patchUpdatedImages(e,i){e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const a in e.updatedImages)this.patchUpdatedImage(this.iconPositions[a],e.getImage(a),i),this.patchUpdatedImage(this.patternPositions[a],e.getImage(a),i)}patchUpdatedImage(e,i,a){if(!e||!i||e.version===i.version)return;e.version=i.version;const[d,m]=e.tl;a.update(i.data,void 0,{x:d,y:m})}}Ke("ImagePosition",Mp),Ke("ImageAtlas",dy),u.WritingMode=void 0,(os=u.WritingMode||(u.WritingMode={}))[os.none=0]="none",os[os.horizontal=1]="horizontal",os[os.vertical=2]="vertical",os[os.horizontalOnly=3]="horizontalOnly";const fh=-17;class xu{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,i){const a=new xu;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new xu;return i.imageName=e,i}}class Xa{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i){const a=new Xa;for(let d=0;d<e.sections.length;d++){const m=e.sections[d];m.image?a.addImageSection(m):a.addTextSection(m,i)}return a}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(){this.text=function(e){let i="";for(let a=0;a<e.length;a++){const d=e.charCodeAt(a+1)||null,m=e.charCodeAt(a-1)||null;i+=d&&Xc(d)&&!vu[e[a+1]]||m&&Xc(m)&&!vu[e[a-1]]||!vu[e[a]]?e[a]:vu[e[a]]}return i}(this.text)}trim(){let e=0;for(let a=0;a<this.text.length&&gh[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&gh[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new Xa;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(xu.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let d=0;d<e.text.length;++d)this.sectionIndex.push(a)}addImageSection(e){const i=e.image?e.image.name:"";if(i.length===0)return void Me("Can't add FormattedSection with an empty image.");const a=this.getNextImageSectionCharCode();a?(this.text+=String.fromCharCode(a),this.sections.push(xu.forImage(i)),this.sectionIndex.push(this.sections.length-1)):Me("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function mh(r,e,i,a,d,m,y,w,b,T,z,M,L,B,F,H){const X=Xa.fromFeature(r,d);let le;M===u.WritingMode.vertical&&X.verticalizePunctuation();const{processBidirectionalText:fe,processStyledBidirectionalText:oe}=$r;if(fe&&X.sections.length===1){le=[];const be=fe(X.toString(),Pp(X,T,m,e,a,B,F));for(const Xe of be){const Je=new Xa;Je.text=Xe,Je.sections=X.sections;for(let Ve=0;Ve<Xe.length;Ve++)Je.sectionIndex.push(0);le.push(Je)}}else if(oe){le=[];const be=oe(X.text,X.sectionIndex,Pp(X,T,m,e,a,B,F));for(const Xe of be){const Je=new Xa;Je.text=Xe[0],Je.sectionIndex=Xe[1],Je.sections=X.sections,le.push(Je)}}else le=function(be,Xe){const Je=[],Ve=be.text;let Be=0;for(const De of Xe)Je.push(be.substring(Be,De)),Be=De;return Be<Ve.length&&Je.push(be.substring(Be,Ve.length)),Je}(X,Pp(X,T,m,e,a,B,F));const de=[],Se={positionedLines:de,text:X.toString(),top:z[1],bottom:z[1],left:z[0],right:z[0],writingMode:M,iconsInText:!1,verticalizable:!1};return function(be,Xe,Je,Ve,Be,De,$e,Oe,Ie,it,tt,vt){let Qt=0,sn=fh,Ln=0,ri=0;const er=Oe==="right"?1:Oe==="left"?0:.5;let In=0;for(const zn of Be){zn.trim();const nr=zn.getMaxScale(),ur=(nr-1)*Wn,xr={positionedGlyphs:[],lineOffset:0};be.positionedLines[In]=xr;const Mr=xr.positionedGlyphs;let Pr=0;if(!zn.length()){sn+=De,++In;continue}for(let jn=0;jn<zn.length();jn++){const bt=zn.getSection(jn),Zr=zn.getSectionIndex(jn),rr=zn.getCharCode(jn);let cr=0,gi=null,Li=null,Ri=null,To=Wn;const yi=!(Ie===u.WritingMode.horizontal||!tt&&!Ql(rr)||tt&&(gh[rr]||($n=rr,Ue.Arabic($n)||Ue["Arabic Supplement"]($n)||Ue["Arabic Extended-A"]($n)||Ue["Arabic Presentation Forms-A"]($n)||Ue["Arabic Presentation Forms-B"]($n))));if(bt.imageName){const ii=Ve[bt.imageName];if(!ii)continue;Ri=bt.imageName,be.iconsInText=be.iconsInText||!0,Li=ii.paddedRect;const Dr=ii.displaySize;bt.scale=bt.scale*Wn/vt,gi={width:Dr[0],height:Dr[1],left:1,top:-3,advance:yi?Dr[1]:Dr[0]},cr=ur+(Wn-Dr[1]*bt.scale),To=gi.advance;const ko=yi?Dr[0]*bt.scale-Wn*nr:Dr[1]*bt.scale-Wn*nr;ko>0&&ko>Pr&&(Pr=ko)}else{const ii=Je[bt.fontStack],Dr=ii&&ii[rr];if(Dr&&Dr.rect)Li=Dr.rect,gi=Dr.metrics;else{const ko=Xe[bt.fontStack],Su=ko&&ko[rr];if(!Su)continue;gi=Su.metrics}cr=(nr-bt.scale)*Wn}yi?(be.verticalizable=!0,Mr.push({glyph:rr,imageName:Ri,x:Qt,y:sn+cr,vertical:yi,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:Zr,metrics:gi,rect:Li}),Qt+=To*bt.scale+it):(Mr.push({glyph:rr,imageName:Ri,x:Qt,y:sn+cr,vertical:yi,scale:bt.scale,fontStack:bt.fontStack,sectionIndex:Zr,metrics:gi,rect:Li}),Qt+=gi.advance*bt.scale+it)}Mr.length!==0&&(Ln=Math.max(Qt-it,Ln),H1(Mr,0,Mr.length-1,er,Pr)),Qt=0;const an=De*nr+Pr;xr.lineOffset=Math.max(Pr,ur),sn+=an,ri=Math.max(an,ri),++In}var $n;const tr=sn-fh,{horizontalAlign:lr,verticalAlign:Ar}=Dp($e);(function(zn,nr,ur,xr,Mr,Pr,an,jn,bt){const Zr=(nr-ur)*Mr;let rr=0;rr=Pr!==an?-jn*xr-fh:(-xr*bt+.5)*an;for(const cr of zn)for(const gi of cr.positionedGlyphs)gi.x+=Zr,gi.y+=rr})(be.positionedLines,er,lr,Ar,Ln,ri,De,tr,Be.length),be.top+=-Ar*tr,be.bottom=be.top+tr,be.left+=-lr*Ln,be.right=be.left+Ln}(Se,e,i,a,le,y,w,b,M,T,L,H),!function(be){for(const Xe of be)if(Xe.positionedGlyphs.length!==0)return!1;return!0}(de)&&Se}const gh={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},W1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function py(r,e,i,a,d,m){if(e.imageName){const y=a[e.imageName];return y?y.displaySize[0]*e.scale*Wn/m+d:0}{const y=i[e.fontStack],w=y&&y[r];return w?w.metrics.advance*e.scale+d:0}}function fy(r,e,i,a){const d=Math.pow(r-e,2);return a?r<e?d/2:2*d:d+Math.abs(i)*i}function X1(r,e,i){let a=0;return r===10&&(a-=1e4),i&&(a+=150),r!==40&&r!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function my(r,e,i,a,d,m){let y=null,w=fy(e,i,d,m);for(const b of a){const T=fy(e-b.x,i,d,m)+b.badness;T<=w&&(y=b,w=T)}return{index:r,x:e,priorBreak:y,badness:w}}function gy(r){return r?gy(r.priorBreak).concat(r.index):[]}function Pp(r,e,i,a,d,m,y){if(m!=="point")return[];if(!r)return[];const w=[],b=function(L,B,F,H,X,le){let fe=0;for(let oe=0;oe<L.length();oe++){const de=L.getSection(oe);fe+=py(L.getCharCode(oe),de,H,X,B,le)}return fe/Math.max(1,Math.ceil(fe/F))}(r,e,i,a,d,y),T=r.text.indexOf("​")>=0;let z=0;for(let L=0;L<r.length();L++){const B=r.getSection(L),F=r.getCharCode(L);if(gh[F]||(z+=py(F,B,a,d,e,y)),L<r.length()-1){const H=!((M=F)<11904||!(Ue["Bopomofo Extended"](M)||Ue.Bopomofo(M)||Ue["CJK Compatibility Forms"](M)||Ue["CJK Compatibility Ideographs"](M)||Ue["CJK Compatibility"](M)||Ue["CJK Radicals Supplement"](M)||Ue["CJK Strokes"](M)||Ue["CJK Symbols and Punctuation"](M)||Ue["CJK Unified Ideographs Extension A"](M)||Ue["CJK Unified Ideographs"](M)||Ue["Enclosed CJK Letters and Months"](M)||Ue["Halfwidth and Fullwidth Forms"](M)||Ue.Hiragana(M)||Ue["Ideographic Description Characters"](M)||Ue["Kangxi Radicals"](M)||Ue["Katakana Phonetic Extensions"](M)||Ue.Katakana(M)||Ue["Vertical Forms"](M)||Ue["Yi Radicals"](M)||Ue["Yi Syllables"](M)));(W1[F]||H||B.imageName)&&w.push(my(L+1,z,b,w,X1(F,r.getCharCode(L+1),H&&T),!1))}}var M;return gy(my(r.length(),z,b,w,0,!0))}function Dp(r){let e=.5,i=.5;switch(r){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(r){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function H1(r,e,i,a,d){if(!a&&!d)return;const m=r[i],y=(r[i].x+m.metrics.advance*m.scale)*a;for(let w=e;w<=i;w++)r[w].x-=y,r[w].y+=d}function K1(r,e,i){const{horizontalAlign:a,verticalAlign:d}=Dp(i),m=e[0]-r.displaySize[0]*a,y=e[1]-r.displaySize[1]*d;return{image:r,top:y,bottom:y+r.displaySize[1],left:m,right:m+r.displaySize[0]}}function yy(r,e,i,a,d,m){const y=r.image;let w;if(y.content){const X=y.content,le=y.pixelRatio||1;w=[X[0]/le,X[1]/le,y.displaySize[0]-X[2]/le,y.displaySize[1]-X[3]/le]}const b=e.left*m,T=e.right*m;let z,M,L,B;i==="width"||i==="both"?(B=d[0]+b-a[3],M=d[0]+T+a[1]):(B=d[0]+(b+T-y.displaySize[0])/2,M=B+y.displaySize[0]);const F=e.top*m,H=e.bottom*m;return i==="height"||i==="both"?(z=d[1]+F-a[0],L=d[1]+H+a[2]):(z=d[1]+(F+H-y.displaySize[1])/2,L=z+y.displaySize[1]),{image:y,top:z,right:M,bottom:L,left:B,collisionPadding:w}}const Eo=128;function _y(r,e){const{expression:i}=e;if(i.kind==="constant")return{kind:"constant",layoutSize:i.evaluate(new rn(r+1))};if(i.kind==="source")return{kind:"source"};{const{zoomStops:a,interpolationType:d}=i;let m=0;for(;m<a.length&&a[m]<=r;)m++;m=Math.max(0,m-1);let y=m;for(;y<a.length&&a[y]<r+1;)y++;y=Math.min(a.length-1,y);const w=a[m],b=a[y];return i.kind==="composite"?{kind:"composite",minZoom:w,maxZoom:b,interpolationType:d}:{kind:"camera",minZoom:w,maxZoom:b,minSize:i.evaluate(new rn(w)),maxSize:i.evaluate(new rn(b)),interpolationType:d}}}class ss extends ot{constructor(e,i,a,d){super(e,i),this.angle=a,d!==void 0&&(this.segment=d)}clone(){return new ss(this.x,this.y,this.angle,this.segment)}}function vy(r,e,i,a,d){if(e.segment===void 0)return!0;let m=e,y=e.segment+1,w=0;for(;w>-i/2;){if(y--,y<0)return!1;w-=r[y].dist(m),m=r[y]}w+=r[y].dist(r[y+1]),y++;const b=[];let T=0;for(;w<i/2;){const z=r[y],M=r[y+1];if(!M)return!1;let L=r[y-1].angleTo(z)-z.angleTo(M);for(L=Math.abs((L+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:w,angleDelta:L}),T+=L;w-b[0].distance>a;)T-=b.shift().angleDelta;if(T>d)return!1;y++,w+=z.dist(M)}return!0}function xy(r){let e=0;for(let i=0;i<r.length-1;i++)e+=r[i].dist(r[i+1]);return e}function wy(r,e,i){return r?.6*e*i:0}function by(r,e){return Math.max(r?r.right-r.left:0,e?e.right-e.left:0)}function Y1(r,e,i,a,d,m){const y=wy(i,d,m),w=by(i,a)*m;let b=0;const T=xy(r)/2;for(let z=0;z<r.length-1;z++){const M=r[z],L=r[z+1],B=M.dist(L);if(b+B>T){const F=(T-b)/B,H=tn(M.x,L.x,F),X=tn(M.y,L.y,F),le=new ss(H,X,L.angleTo(M),z);return le._round(),!y||vy(r,le,w,y,e)?le:void 0}b+=B}}function J1(r,e,i,a,d,m,y,w,b){const T=wy(a,m,y),z=by(a,d),M=z*y,L=r[0].x===0||r[0].x===b||r[0].y===0||r[0].y===b;return e-M<e/4&&(e=M+e/4),Sy(r,L?e/2*w%e:(z/2+2*m)*y*w%e,e,T,i,M,L,!1,b)}function Sy(r,e,i,a,d,m,y,w,b){const T=m/2,z=xy(r);let M=0,L=e-i,B=[];for(let F=0;F<r.length-1;F++){const H=r[F],X=r[F+1],le=H.dist(X),fe=X.angleTo(H);for(;L+i<M+le;){L+=i;const oe=(L-M)/le,de=tn(H.x,X.x,oe),Se=tn(H.y,X.y,oe);if(de>=0&&de<b&&Se>=0&&Se<b&&L-T>=0&&L+T<=z){const be=new ss(de,Se,fe,F);be._round(),a&&!vy(r,be,m,a,d)||B.push(be)}}M+=le}return w||B.length||y||(B=Sy(r,M/2,i,a,d,m,y,!0,b)),B}function Ey(r,e,i,a,d){const m=[];for(let y=0;y<r.length;y++){const w=r[y];let b;for(let T=0;T<w.length-1;T++){let z=w[T],M=w[T+1];z.x<e&&M.x<e||(z.x<e?z=new ot(e,z.y+(e-z.x)/(M.x-z.x)*(M.y-z.y))._round():M.x<e&&(M=new ot(e,z.y+(e-z.x)/(M.x-z.x)*(M.y-z.y))._round()),z.y<i&&M.y<i||(z.y<i?z=new ot(z.x+(i-z.y)/(M.y-z.y)*(M.x-z.x),i)._round():M.y<i&&(M=new ot(z.x+(i-z.y)/(M.y-z.y)*(M.x-z.x),i)._round()),z.x>=a&&M.x>=a||(z.x>=a?z=new ot(a,z.y+(a-z.x)/(M.x-z.x)*(M.y-z.y))._round():M.x>=a&&(M=new ot(a,z.y+(a-z.x)/(M.x-z.x)*(M.y-z.y))._round()),z.y>=d&&M.y>=d||(z.y>=d?z=new ot(z.x+(d-z.y)/(M.y-z.y)*(M.x-z.x),d)._round():M.y>=d&&(M=new ot(z.x+(d-z.y)/(M.y-z.y)*(M.x-z.x),d)._round()),b&&z.equals(b[b.length-1])||(b=[z],m.push(b)),b.push(M)))))}}return m}function Ty(r,e,i,a){const d=[],m=r.image,y=m.pixelRatio,w=m.paddedRect.w-2,b=m.paddedRect.h-2,T=r.right-r.left,z=r.bottom-r.top,M=m.stretchX||[[0,w]],L=m.stretchY||[[0,b]],B=(De,$e)=>De+$e[1]-$e[0],F=M.reduce(B,0),H=L.reduce(B,0),X=w-F,le=b-H;let fe=0,oe=F,de=0,Se=H,be=0,Xe=X,Je=0,Ve=le;if(m.content&&a){const De=m.content;fe=yh(M,0,De[0]),de=yh(L,0,De[1]),oe=yh(M,De[0],De[2]),Se=yh(L,De[1],De[3]),be=De[0]-fe,Je=De[1]-de,Xe=De[2]-De[0]-oe,Ve=De[3]-De[1]-Se}const Be=(De,$e,Oe,Ie)=>{const it=_h(De.stretch-fe,oe,T,r.left),tt=vh(De.fixed-be,Xe,De.stretch,F),vt=_h($e.stretch-de,Se,z,r.top),Qt=vh($e.fixed-Je,Ve,$e.stretch,H),sn=_h(Oe.stretch-fe,oe,T,r.left),Ln=vh(Oe.fixed-be,Xe,Oe.stretch,F),ri=_h(Ie.stretch-de,Se,z,r.top),er=vh(Ie.fixed-Je,Ve,Ie.stretch,H),In=new ot(it,vt),$n=new ot(sn,vt),tr=new ot(sn,ri),lr=new ot(it,ri),Ar=new ot(tt/y,Qt/y),zn=new ot(Ln/y,er/y),nr=e*Math.PI/180;if(nr){const Mr=Math.sin(nr),Pr=Math.cos(nr),an=[Pr,-Mr,Mr,Pr];In._matMult(an),$n._matMult(an),lr._matMult(an),tr._matMult(an)}const ur=De.stretch+De.fixed,xr=$e.stretch+$e.fixed;return{tl:In,tr:$n,bl:lr,br:tr,tex:{x:m.paddedRect.x+1+ur,y:m.paddedRect.y+1+xr,w:Oe.stretch+Oe.fixed-ur,h:Ie.stretch+Ie.fixed-xr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Ar,pixelOffsetBR:zn,minFontScaleX:Xe/y/T,minFontScaleY:Ve/y/z,isSDF:i}};if(a&&(m.stretchX||m.stretchY)){const De=ky(M,X,F),$e=ky(L,le,H);for(let Oe=0;Oe<De.length-1;Oe++){const Ie=De[Oe],it=De[Oe+1];for(let tt=0;tt<$e.length-1;tt++)d.push(Be(Ie,$e[tt],it,$e[tt+1]))}}else d.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:b+1}));return d}function yh(r,e,i){let a=0;for(const d of r)a+=Math.max(e,Math.min(i,d[1]))-Math.max(e,Math.min(i,d[0]));return a}function ky(r,e,i){const a=[{fixed:-1,stretch:0}];for(const[d,m]of r){const y=a[a.length-1];a.push({fixed:d-y.stretch,stretch:y.stretch}),a.push({fixed:d-y.stretch,stretch:y.stretch+(m-d)})}return a.push({fixed:e+1,stretch:i}),a}function _h(r,e,i,a){return r/e*i+a}function vh(r,e,i,a){return r-e*i/a}Ke("Anchor",ss);class xh{constructor(e,i,a,d,m,y,w,b,T,z){if(this.boxStartIndex=e.length,T){let M=y.top,L=y.bottom;const B=y.collisionPadding;B&&(M-=B[1],L+=B[3]);let F=L-M;F>0&&(F=Math.max(10,F),this.circleDiameter=F)}else{let M=y.top*w-b[0],L=y.bottom*w+b[2],B=y.left*w-b[3],F=y.right*w+b[1];const H=y.collisionPadding;if(H&&(B-=H[0]*w,M-=H[1]*w,F+=H[2]*w,L+=H[3]*w),z){const X=new ot(B,M),le=new ot(F,M),fe=new ot(B,L),oe=new ot(F,L),de=z*Math.PI/180;X._rotate(de),le._rotate(de),fe._rotate(de),oe._rotate(de),B=Math.min(X.x,le.x,fe.x,oe.x),F=Math.max(X.x,le.x,fe.x,oe.x),M=Math.min(X.y,le.y,fe.y,oe.y),L=Math.max(X.y,le.y,fe.y,oe.y)}e.emplaceBack(i.x,i.y,B,M,F,L,a,d,m)}this.boxEndIndex=e.length}}class Q1{constructor(e=[],i=ew){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return this.length--,this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,d=i[e];for(;e>0;){const m=e-1>>1,y=i[m];if(a(d,y)>=0)break;i[e]=y,e=m}i[e]=d}_down(e){const{data:i,compare:a}=this,d=this.length>>1,m=i[e];for(;e<d;){let y=1+(e<<1),w=i[y];const b=y+1;if(b<this.length&&a(i[b],w)<0&&(y=b,w=i[b]),a(w,m)>=0)break;i[e]=w,e=y}i[e]=m}}function ew(r,e){return r<e?-1:r>e?1:0}function tw(r,e=1,i=!1){let a=1/0,d=1/0,m=-1/0,y=-1/0;const w=r[0];for(let B=0;B<w.length;B++){const F=w[B];(!B||F.x<a)&&(a=F.x),(!B||F.y<d)&&(d=F.y),(!B||F.x>m)&&(m=F.x),(!B||F.y>y)&&(y=F.y)}const b=Math.min(m-a,y-d);let T=b/2;const z=new Q1([],nw);if(b===0)return new ot(a,d);for(let B=a;B<m;B+=b)for(let F=d;F<y;F+=b)z.push(new Ha(B+T,F+T,T,r));let M=function(B){let F=0,H=0,X=0;const le=B[0];for(let fe=0,oe=le.length,de=oe-1;fe<oe;de=fe++){const Se=le[fe],be=le[de],Xe=Se.x*be.y-be.x*Se.y;H+=(Se.x+be.x)*Xe,X+=(Se.y+be.y)*Xe,F+=3*Xe}return new Ha(H/F,X/F,0,B)}(r),L=z.length;for(;z.length;){const B=z.pop();(B.d>M.d||!M.d)&&(M=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,L)),B.max-M.d<=e||(T=B.h/2,z.push(new Ha(B.p.x-T,B.p.y-T,T,r)),z.push(new Ha(B.p.x+T,B.p.y-T,T,r)),z.push(new Ha(B.p.x-T,B.p.y+T,T,r)),z.push(new Ha(B.p.x+T,B.p.y+T,T,r)),L+=4)}return i&&(console.log(`num probes: ${L}`),console.log(`best distance: ${M.d}`)),M.p}function nw(r,e){return e.max-r.max}function Ha(r,e,i,a){this.p=new ot(r,e),this.h=i,this.d=function(d,m){let y=!1,w=1/0;for(let b=0;b<m.length;b++){const T=m[b];for(let z=0,M=T.length,L=M-1;z<M;L=z++){const B=T[z],F=T[L];B.y>d.y!=F.y>d.y&&d.x<(F.x-B.x)*(d.y-B.y)/(F.y-B.y)+B.x&&(y=!y),w=Math.min(w,Lg(d,B,F))}}return(y?1:-1)*Math.sqrt(w)}(this.p,a),this.max=this.d+this.h*Math.SQRT2}const Lp=Number.POSITIVE_INFINITY;function Cy(r,e){return e[1]!==Lp?function(i,a,d){let m=0,y=0;switch(a=Math.abs(a),d=Math.abs(d),i){case"top-right":case"top-left":case"top":y=d-7;break;case"bottom-right":case"bottom-left":case"bottom":y=7-d}switch(i){case"top-right":case"bottom-right":case"right":m=-a;break;case"top-left":case"bottom-left":case"left":m=a}return[m,y]}(r,e[0],e[1]):function(i,a){let d=0,m=0;a<0&&(a=0);const y=a/Math.sqrt(2);switch(i){case"top-right":case"top-left":m=y-7;break;case"bottom-right":case"bottom-left":m=7-y;break;case"bottom":m=7-a;break;case"top":m=a-7}switch(i){case"top-right":case"bottom-right":d=-y;break;case"top-left":case"bottom-left":d=y;break;case"left":d=a;break;case"right":d=-a}return[d,m]}(r,e[0])}function Rp(r){switch(r){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function rw(r,e,i,a,d,m,y,w,b,T,z){let M=m.textMaxSize.evaluate(e,{});M===void 0&&(M=y);const L=r.layers[0].layout,B=L.get("icon-offset").evaluate(e,{},z),F=zy(i.horizontal),H=y/24,X=r.tilePixelRatio*H,le=r.tilePixelRatio*M/24,fe=r.tilePixelRatio*w,oe=r.tilePixelRatio*L.get("symbol-spacing"),de=L.get("text-padding")*r.tilePixelRatio,Se=function(Ie,it,tt,vt=1){const Qt=Ie.get("icon-padding").evaluate(it,{},tt),sn=Qt&&Qt.values;return[sn[0]*vt,sn[1]*vt,sn[2]*vt,sn[3]*vt]}(L,e,z,r.tilePixelRatio),be=L.get("text-max-angle")/180*Math.PI,Xe=L.get("text-rotation-alignment")!=="viewport"&&L.get("symbol-placement")!=="point",Je=L.get("icon-rotation-alignment")==="map"&&L.get("symbol-placement")!=="point",Ve=L.get("symbol-placement"),Be=oe/2,De=L.get("icon-text-fit");let $e;a&&De!=="none"&&(r.allowVerticalPlacement&&i.vertical&&($e=yy(a,i.vertical,De,L.get("icon-text-fit-padding"),B,H)),F&&(a=yy(a,F,De,L.get("icon-text-fit-padding"),B,H)));const Oe=(Ie,it)=>{it.x<0||it.x>=Dn||it.y<0||it.y>=Dn||function(tt,vt,Qt,sn,Ln,ri,er,In,$n,tr,lr,Ar,zn,nr,ur,xr,Mr,Pr,an,jn,bt,Zr,rr,cr,gi){const Li=tt.addToLineVertexArray(vt,Qt);let Ri,To,yi,ii,Dr=0,ko=0,Su=0,Zy=0,Zp=-1,qp=-1;const Co={};let qy=Vn.exports(""),Wp=0,Xp=0;if(In._unevaluatedLayout.getValue("text-radial-offset")===void 0?[Wp,Xp]=In.layout.get("text-offset").evaluate(bt,{},cr).map(Lr=>Lr*Wn):(Wp=In.layout.get("text-radial-offset").evaluate(bt,{},cr)*Wn,Xp=Lp),tt.allowVerticalPlacement&&sn.vertical){const Lr=In.layout.get("text-rotate").evaluate(bt,{},cr)+90;yi=new xh($n,vt,tr,lr,Ar,sn.vertical,zn,nr,ur,Lr),er&&(ii=new xh($n,vt,tr,lr,Ar,er,Mr,Pr,ur,Lr))}if(Ln){const Lr=In.layout.get("icon-rotate").evaluate(bt,{}),ro=In.layout.get("icon-text-fit")!=="none",Eu=Ty(Ln,Lr,rr,ro),Tu=er?Ty(er,Lr,rr,ro):void 0;To=new xh($n,vt,tr,lr,Ar,Ln,Mr,Pr,!1,Lr),Dr=4*Eu.length;const Hy=tt.iconSizeData;let oa=null;Hy.kind==="source"?(oa=[Eo*In.layout.get("icon-size").evaluate(bt,{})],oa[0]>as&&Me(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):Hy.kind==="composite"&&(oa=[Eo*Zr.compositeIconSizes[0].evaluate(bt,{},cr),Eo*Zr.compositeIconSizes[1].evaluate(bt,{},cr)],(oa[0]>as||oa[1]>as)&&Me(`${tt.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),tt.addSymbols(tt.icon,Eu,oa,jn,an,bt,u.WritingMode.none,vt,Li.lineStartIndex,Li.lineLength,-1,cr),Zp=tt.icon.placedSymbolArray.length-1,Tu&&(ko=4*Tu.length,tt.addSymbols(tt.icon,Tu,oa,jn,an,bt,u.WritingMode.vertical,vt,Li.lineStartIndex,Li.lineLength,-1,cr),qp=tt.icon.placedSymbolArray.length-1)}const Wy=Object.keys(sn.horizontal);for(const Lr of Wy){const ro=sn.horizontal[Lr];if(!Ri){qy=Vn.exports(ro.text);const Tu=In.layout.get("text-rotate").evaluate(bt,{},cr);Ri=new xh($n,vt,tr,lr,Ar,ro,zn,nr,ur,Tu)}const Eu=ro.positionedLines.length===1;if(Su+=Iy(tt,vt,ro,ri,In,ur,bt,xr,Li,sn.vertical?u.WritingMode.horizontal:u.WritingMode.horizontalOnly,Eu?Wy:[Lr],Co,Zp,Zr,cr),Eu)break}sn.vertical&&(Zy+=Iy(tt,vt,sn.vertical,ri,In,ur,bt,xr,Li,u.WritingMode.vertical,["vertical"],Co,qp,Zr,cr));const gw=Ri?Ri.boxStartIndex:tt.collisionBoxArray.length,yw=Ri?Ri.boxEndIndex:tt.collisionBoxArray.length,_w=yi?yi.boxStartIndex:tt.collisionBoxArray.length,vw=yi?yi.boxEndIndex:tt.collisionBoxArray.length,xw=To?To.boxStartIndex:tt.collisionBoxArray.length,ww=To?To.boxEndIndex:tt.collisionBoxArray.length,bw=ii?ii.boxStartIndex:tt.collisionBoxArray.length,Sw=ii?ii.boxEndIndex:tt.collisionBoxArray.length;let Bi=-1;const Th=(Lr,ro)=>Lr&&Lr.circleDiameter?Math.max(Lr.circleDiameter,ro):ro;Bi=Th(Ri,Bi),Bi=Th(yi,Bi),Bi=Th(To,Bi),Bi=Th(ii,Bi);const Xy=Bi>-1?1:0;Xy&&(Bi*=gi/Wn),tt.glyphOffsetArray.length>=Ka.MAX_GLYPHS&&Me("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),bt.sortKey!==void 0&&tt.addToSortKeyRanges(tt.symbolInstances.length,bt.sortKey),tt.symbolInstances.emplaceBack(vt.x,vt.y,Co.right>=0?Co.right:-1,Co.center>=0?Co.center:-1,Co.left>=0?Co.left:-1,Co.vertical||-1,Zp,qp,qy,gw,yw,_w,vw,xw,ww,bw,Sw,tr,Su,Zy,Dr,ko,Xy,0,zn,Wp,Xp,Bi)}(r,it,Ie,i,a,d,$e,r.layers[0],r.collisionBoxArray,e.index,e.sourceLayerIndex,r.index,X,[de,de,de,de],Xe,b,fe,Se,Je,B,e,m,T,z,y)};if(Ve==="line")for(const Ie of Ey(e.geometry,0,0,Dn,Dn)){const it=J1(Ie,oe,be,i.vertical||F,a,24,le,r.overscaling,Dn);for(const tt of it){const vt=F;vt&&iw(r,vt.text,Be,tt)||Oe(Ie,tt)}}else if(Ve==="line-center"){for(const Ie of e.geometry)if(Ie.length>1){const it=Y1(Ie,be,i.vertical||F,a,24,le);it&&Oe(Ie,it)}}else if(e.type==="Polygon")for(const Ie of bp(e.geometry,0)){const it=tw(Ie,16);Oe(Ie[0],new ss(it.x,it.y,0))}else if(e.type==="LineString")for(const Ie of e.geometry)Oe(Ie,new ss(Ie[0].x,Ie[0].y,0));else if(e.type==="Point")for(const Ie of e.geometry)for(const it of Ie)Oe([it],new ss(it.x,it.y,0))}const as=32640;function Iy(r,e,i,a,d,m,y,w,b,T,z,M,L,B,F){const H=function(fe,oe,de,Se,be,Xe,Je,Ve){const Be=Se.layout.get("text-rotate").evaluate(Xe,{})*Math.PI/180,De=[];for(const $e of oe.positionedLines)for(const Oe of $e.positionedGlyphs){if(!Oe.rect)continue;const Ie=Oe.rect||{};let it=4,tt=!0,vt=1,Qt=0;const sn=(be||Ve)&&Oe.vertical,Ln=Oe.metrics.advance*Oe.scale/2;if(Ve&&oe.verticalizable){const an=(Oe.scale-1)*Wn,jn=(Wn-Oe.metrics.width*Oe.scale)/2;Qt=$e.lineOffset/2-(Oe.imageName?-jn:an)}if(Oe.imageName){const an=Je[Oe.imageName];tt=an.sdf,vt=an.pixelRatio,it=1/vt}const ri=be?[Oe.x+Ln,Oe.y]:[0,0];let er=be?[0,0]:[Oe.x+Ln+de[0],Oe.y+de[1]-Qt],In=[0,0];sn&&(In=er,er=[0,0]);const $n=(Oe.metrics.left-it)*Oe.scale-Ln+er[0],tr=(-Oe.metrics.top-it)*Oe.scale+er[1],lr=$n+Ie.w*Oe.scale/vt,Ar=tr+Ie.h*Oe.scale/vt,zn=new ot($n,tr),nr=new ot(lr,tr),ur=new ot($n,Ar),xr=new ot(lr,Ar);if(sn){const an=new ot(-Ln,Ln-fh),jn=-Math.PI/2,bt=12-Ln,Zr=new ot(22-bt,-(Oe.imageName?bt:0)),rr=new ot(...In);zn._rotateAround(jn,an)._add(Zr)._add(rr),nr._rotateAround(jn,an)._add(Zr)._add(rr),ur._rotateAround(jn,an)._add(Zr)._add(rr),xr._rotateAround(jn,an)._add(Zr)._add(rr)}if(Be){const an=Math.sin(Be),jn=Math.cos(Be),bt=[jn,-an,an,jn];zn._matMult(bt),nr._matMult(bt),ur._matMult(bt),xr._matMult(bt)}const Mr=new ot(0,0),Pr=new ot(0,0);De.push({tl:zn,tr:nr,bl:ur,br:xr,tex:Ie,writingMode:oe.writingMode,glyphOffset:ri,sectionIndex:Oe.sectionIndex,isSDF:tt,pixelOffsetTL:Mr,pixelOffsetBR:Pr,minFontScaleX:0,minFontScaleY:0})}return De}(0,i,w,d,m,y,a,r.allowVerticalPlacement),X=r.textSizeData;let le=null;X.kind==="source"?(le=[Eo*d.layout.get("text-size").evaluate(y,{})],le[0]>as&&Me(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):X.kind==="composite"&&(le=[Eo*B.compositeTextSizes[0].evaluate(y,{},F),Eo*B.compositeTextSizes[1].evaluate(y,{},F)],(le[0]>as||le[1]>as)&&Me(`${r.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),r.addSymbols(r.text,H,le,w,m,y,T,e,b.lineStartIndex,b.lineLength,L,F);for(const fe of z)M[fe]=r.text.placedSymbolArray.length-1;return 4*H.length}function zy(r){for(const e in r)return r[e];return null}function iw(r,e,i,a){const d=r.compareText;if(e in d){const m=d[e];for(let y=m.length-1;y>=0;y--)if(a.dist(m[y])<i)return!0}else d[e]=[];return d[e].push(a),!1}const ow=is.VectorTileFeature.types,sw=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function wh(r,e,i,a,d,m,y,w,b,T,z,M,L){const B=w?Math.min(as,Math.round(w[0])):0,F=w?Math.min(as,Math.round(w[1])):0;r.emplaceBack(e,i,Math.round(32*a),Math.round(32*d),m,y,(B<<1)+(b?1:0),F,16*T,16*z,256*M,256*L)}function Bp(r,e,i){r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i),r.emplaceBack(e.x,e.y,i)}function aw(r){for(const e of r.sections)if(Kc(e.text))return!0;return!1}class Fp{constructor(e){this.layoutVertexArray=new fi,this.indexArray=new yr,this.programConfigurations=e,this.segments=new wt,this.dynamicLayoutVertexArray=new ei,this.opacityVertexArray=new mi,this.placedSymbolArray=new Te}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(e,i,a,d){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A1.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,M1.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,sw,!0),this.opacityVertexBuffer.itemSize=1),(a||d)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}Ke("SymbolBuffers",Fp);class Op{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new wt,this.collisionVertexArray=new jr}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,P1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}Ke("CollisionBuffers",Op);class Ka{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=gp([]),this.placementViewportMatrix=gp([]);const i=this.layers[0]._unevaluatedLayout._values;this.textSizeData=_y(this.zoom,i["text-size"]),this.iconSizeData=_y(this.zoom,i["icon-size"]);const a=this.layers[0].layout,d=a.get("symbol-sort-key"),m=a.get("symbol-z-order");this.canOverlap=Up(a,"text-overlap","text-allow-overlap")!=="never"||Up(a,"icon-overlap","icon-allow-overlap")!=="never"||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=m!=="viewport-y"&&!d.isConstant(),this.sortFeaturesByY=(m==="viewport-y"||m==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,a.get("symbol-placement")==="point"&&(this.writingModes=a.get("text-writing-mode").map(y=>u.WritingMode[y])),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID}createArrays(){this.text=new Fp(new ea(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Fp(new ea(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Re,this.lineVertexArray=new We,this.symbolInstances=new Ze}calculateGlyphDependencies(e,i,a,d,m){for(let y=0;y<e.length;y++)if(i[e.charCodeAt(y)]=!0,(a||d)&&m){const w=vu[e.charAt(y)];w&&(i[w.charCodeAt(0)]=!0)}}populate(e,i,a){const d=this.layers[0],m=d.layout,y=m.get("text-font"),w=m.get("text-field"),b=m.get("icon-image"),T=(w.value.kind!=="constant"||w.value.value instanceof J&&!w.value.value.isEmpty()||w.value.value.toString().length>0)&&(y.value.kind!=="constant"||y.value.value.length>0),z=b.value.kind!=="constant"||!!b.value.value||Object.keys(b.parameters).length>0,M=m.get("symbol-sort-key");if(this.features=[],!T&&!z)return;const L=i.iconDependencies,B=i.glyphDependencies,F=i.availableImages,H=new rn(this.zoom);for(const{feature:X,id:le,index:fe,sourceLayerIndex:oe}of e){const de=d._featureFilter.needGeometry,Se=na(X,de);if(!d._featureFilter.filter(H,Se,a))continue;let be,Xe;if(de||(Se.geometry=ta(X)),T){const Ve=d.getValueAndResolveTokens("text-field",Se,a,F),Be=J.factory(Ve);aw(Be)&&(this.hasRTLText=!0),(!this.hasRTLText||Ys()==="unavailable"||this.hasRTLText&&$r.isParsed())&&(be=L1(Be,d,Se))}if(z){const Ve=d.getValueAndResolveTokens("icon-image",Se,a,F);Xe=Ve instanceof re?Ve:re.fromString(Ve)}if(!be&&!Xe)continue;const Je=this.sortFeaturesByKey?M.evaluate(Se,{},a):void 0;if(this.features.push({id:le,text:be,icon:Xe,index:fe,sourceLayerIndex:oe,geometry:Se.geometry,properties:X.properties,type:ow[X.type],sortKey:Je}),Xe&&(L[Xe.name]=!0),be){const Ve=y.evaluate(Se,{},a).join(","),Be=m.get("text-rotation-alignment")!=="viewport"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.WritingMode.vertical)>=0;for(const De of be.sections)if(De.image)L[De.image.name]=!0;else{const $e=Oa(be.toString()),Oe=De.fontStack||Ve,Ie=B[Oe]=B[Oe]||{};this.calculateGlyphDependencies(De.text,Ie,Be,this.allowVerticalPlacement,$e)}}}m.get("symbol-placement")==="line"&&(this.features=function(X){const le={},fe={},oe=[];let de=0;function Se(Ve){oe.push(X[Ve]),de++}function be(Ve,Be,De){const $e=fe[Ve];return delete fe[Ve],fe[Be]=$e,oe[$e].geometry[0].pop(),oe[$e].geometry[0]=oe[$e].geometry[0].concat(De[0]),$e}function Xe(Ve,Be,De){const $e=le[Be];return delete le[Be],le[Ve]=$e,oe[$e].geometry[0].shift(),oe[$e].geometry[0]=De[0].concat(oe[$e].geometry[0]),$e}function Je(Ve,Be,De){const $e=De?Be[0][Be[0].length-1]:Be[0][0];return`${Ve}:${$e.x}:${$e.y}`}for(let Ve=0;Ve<X.length;Ve++){const Be=X[Ve],De=Be.geometry,$e=Be.text?Be.text.toString():null;if(!$e){Se(Ve);continue}const Oe=Je($e,De),Ie=Je($e,De,!0);if(Oe in fe&&Ie in le&&fe[Oe]!==le[Ie]){const it=Xe(Oe,Ie,De),tt=be(Oe,Ie,oe[it].geometry);delete le[Oe],delete fe[Ie],fe[Je($e,oe[tt].geometry,!0)]=tt,oe[it].geometry=null}else Oe in fe?be(Oe,Ie,De):Ie in le?Xe(Oe,Ie,De):(Se(Ve),le[Oe]=de-1,fe[Ie]=de-1)}return oe.filter(Ve=>Ve.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((X,le)=>X.sortKey-le.sortKey)}update(e,i,a){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,i,this.layers,a),this.icon.programConfigurations.updatePaintArrays(e,i,this.layers,a))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0){let d=e.dist(i[e.segment+1]),m=e.dist(i[e.segment]);const y={};for(let w=e.segment+1;w<i.length;w++)y[w]={x:i[w].x,y:i[w].y,tileUnitDistanceFromAnchor:d},w<i.length-1&&(d+=i[w+1].dist(i[w]));for(let w=e.segment||0;w>=0;w--)y[w]={x:i[w].x,y:i[w].y,tileUnitDistanceFromAnchor:m},w>0&&(m+=i[w-1].dist(i[w]));for(let w=0;w<i.length;w++){const b=y[w];this.lineVertexArray.emplaceBack(b.x,b.y,b.tileUnitDistanceFromAnchor)}}return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,d,m,y,w,b,T,z,M,L){const B=e.indexArray,F=e.layoutVertexArray,H=e.segments.prepareSegment(4*i.length,F,B,this.canOverlap?y.sortKey:void 0),X=this.glyphOffsetArray.length,le=H.vertexLength,fe=this.allowVerticalPlacement&&w===u.WritingMode.vertical?Math.PI/2:0,oe=y.text&&y.text.sections;for(let de=0;de<i.length;de++){const{tl:Se,tr:be,bl:Xe,br:Je,tex:Ve,pixelOffsetTL:Be,pixelOffsetBR:De,minFontScaleX:$e,minFontScaleY:Oe,glyphOffset:Ie,isSDF:it,sectionIndex:tt}=i[de],vt=H.vertexLength,Qt=Ie[1];wh(F,b.x,b.y,Se.x,Qt+Se.y,Ve.x,Ve.y,a,it,Be.x,Be.y,$e,Oe),wh(F,b.x,b.y,be.x,Qt+be.y,Ve.x+Ve.w,Ve.y,a,it,De.x,Be.y,$e,Oe),wh(F,b.x,b.y,Xe.x,Qt+Xe.y,Ve.x,Ve.y+Ve.h,a,it,Be.x,De.y,$e,Oe),wh(F,b.x,b.y,Je.x,Qt+Je.y,Ve.x+Ve.w,Ve.y+Ve.h,a,it,De.x,De.y,$e,Oe),Bp(e.dynamicLayoutVertexArray,b,fe),B.emplaceBack(vt,vt+1,vt+2),B.emplaceBack(vt+1,vt+2,vt+3),H.vertexLength+=4,H.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ie[0]),de!==i.length-1&&tt===i[de+1].sectionIndex||e.programConfigurations.populatePaintArrays(F.length,y,y.index,{},L,oe&&oe[tt])}e.placedSymbolArray.emplaceBack(b.x,b.y,X,this.glyphOffsetArray.length-X,le,T,z,b.segment,a?a[0]:0,a?a[1]:0,d[0],d[1],w,0,!1,0,M)}_addCollisionDebugVertex(e,i,a,d,m,y){return i.emplaceBack(0,0),e.emplaceBack(a.x,a.y,d,m,Math.round(y.x),Math.round(y.y))}addCollisionDebugVertices(e,i,a,d,m,y,w){const b=m.segments.prepareSegment(4,m.layoutVertexArray,m.indexArray),T=b.vertexLength,z=m.layoutVertexArray,M=m.collisionVertexArray,L=w.anchorX,B=w.anchorY;this._addCollisionDebugVertex(z,M,y,L,B,new ot(e,i)),this._addCollisionDebugVertex(z,M,y,L,B,new ot(a,i)),this._addCollisionDebugVertex(z,M,y,L,B,new ot(a,d)),this._addCollisionDebugVertex(z,M,y,L,B,new ot(e,d)),b.vertexLength+=4;const F=m.indexArray;F.emplaceBack(T,T+1),F.emplaceBack(T+1,T+2),F.emplaceBack(T+2,T+3),F.emplaceBack(T+3,T),b.primitiveLength+=4}addDebugCollisionBoxes(e,i,a,d){for(let m=e;m<i;m++){const y=this.collisionBoxArray.get(m);this.addCollisionDebugVertices(y.x1,y.y1,y.x2,y.y2,d?this.textCollisionBox:this.iconCollisionBox,y.anchorPoint,a)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Op(to,iy.members,Pi),this.iconCollisionBox=new Op(to,iy.members,Pi);for(let e=0;e<this.symbolInstances.length;e++){const i=this.symbolInstances.get(e);this.addDebugCollisionBoxes(i.textBoxStartIndex,i.textBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.verticalTextBoxStartIndex,i.verticalTextBoxEndIndex,i,!0),this.addDebugCollisionBoxes(i.iconBoxStartIndex,i.iconBoxEndIndex,i,!1),this.addDebugCollisionBoxes(i.verticalIconBoxStartIndex,i.verticalIconBoxEndIndex,i,!1)}}_deserializeCollisionBoxesForSymbol(e,i,a,d,m,y,w,b,T){const z={};for(let M=i;M<a;M++){const L=e.get(M);z.textBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.textFeatureIndex=L.featureIndex;break}for(let M=d;M<m;M++){const L=e.get(M);z.verticalTextBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.verticalTextFeatureIndex=L.featureIndex;break}for(let M=y;M<w;M++){const L=e.get(M);z.iconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.iconFeatureIndex=L.featureIndex;break}for(let M=b;M<T;M++){const L=e.get(M);z.verticalIconBox={x1:L.x1,y1:L.y1,x2:L.x2,y2:L.y2,anchorPointX:L.anchorPointX,anchorPointY:L.anchorPointY},z.verticalIconFeatureIndex=L.featureIndex;break}return z}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),d=a.vertexStartIndex+4*a.numGlyphs;for(let m=a.vertexStartIndex;m<d;m+=4)e.indexArray.emplaceBack(m,m+1,m+2),e.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),d=[],m=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const b=this.symbolInstances.get(w);d.push(0|Math.round(i*b.anchorX+a*b.anchorY)),m.push(b.featureIndex)}return y.sort((w,b)=>d[w]-d[b]||m[b]-m[w]),y}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex),[a.rightJustifiedTextSymbolIndex,a.centerJustifiedTextSymbolIndex,a.leftJustifiedTextSymbolIndex].forEach((d,m,y)=>{d>=0&&y.indexOf(d)===m&&this.addIndicesForPlacedSymbol(this.text,d)}),a.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,a.verticalPlacedTextSymbolIndex),a.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.placedIconSymbolIndex),a.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,a.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}Ke("SymbolBucket",Ka,{omit:["layers","collisionBoxArray","features","compareText"]}),Ka.MAX_GLYPHS=65535,Ka.addDynamicAttributes=Bp;const lw=new qn({"symbol-placement":new et(xe.layout_symbol["symbol-placement"]),"symbol-spacing":new et(xe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new et(xe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new lt(xe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new et(xe.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new et(xe.layout_symbol["icon-allow-overlap"]),"icon-overlap":new et(xe.layout_symbol["icon-overlap"]),"icon-ignore-placement":new et(xe.layout_symbol["icon-ignore-placement"]),"icon-optional":new et(xe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new et(xe.layout_symbol["icon-rotation-alignment"]),"icon-size":new lt(xe.layout_symbol["icon-size"]),"icon-text-fit":new et(xe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new et(xe.layout_symbol["icon-text-fit-padding"]),"icon-image":new lt(xe.layout_symbol["icon-image"]),"icon-rotate":new lt(xe.layout_symbol["icon-rotate"]),"icon-padding":new lt(xe.layout_symbol["icon-padding"]),"icon-keep-upright":new et(xe.layout_symbol["icon-keep-upright"]),"icon-offset":new lt(xe.layout_symbol["icon-offset"]),"icon-anchor":new lt(xe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new et(xe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new et(xe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new et(xe.layout_symbol["text-rotation-alignment"]),"text-field":new lt(xe.layout_symbol["text-field"]),"text-font":new lt(xe.layout_symbol["text-font"]),"text-size":new lt(xe.layout_symbol["text-size"]),"text-max-width":new lt(xe.layout_symbol["text-max-width"]),"text-line-height":new et(xe.layout_symbol["text-line-height"]),"text-letter-spacing":new lt(xe.layout_symbol["text-letter-spacing"]),"text-justify":new lt(xe.layout_symbol["text-justify"]),"text-radial-offset":new lt(xe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new et(xe.layout_symbol["text-variable-anchor"]),"text-anchor":new lt(xe.layout_symbol["text-anchor"]),"text-max-angle":new et(xe.layout_symbol["text-max-angle"]),"text-writing-mode":new et(xe.layout_symbol["text-writing-mode"]),"text-rotate":new lt(xe.layout_symbol["text-rotate"]),"text-padding":new et(xe.layout_symbol["text-padding"]),"text-keep-upright":new et(xe.layout_symbol["text-keep-upright"]),"text-transform":new lt(xe.layout_symbol["text-transform"]),"text-offset":new lt(xe.layout_symbol["text-offset"]),"text-allow-overlap":new et(xe.layout_symbol["text-allow-overlap"]),"text-overlap":new et(xe.layout_symbol["text-overlap"]),"text-ignore-placement":new et(xe.layout_symbol["text-ignore-placement"]),"text-optional":new et(xe.layout_symbol["text-optional"])});var Np={paint:new qn({"icon-opacity":new lt(xe.paint_symbol["icon-opacity"]),"icon-color":new lt(xe.paint_symbol["icon-color"]),"icon-halo-color":new lt(xe.paint_symbol["icon-halo-color"]),"icon-halo-width":new lt(xe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new lt(xe.paint_symbol["icon-halo-blur"]),"icon-translate":new et(xe.paint_symbol["icon-translate"]),"icon-translate-anchor":new et(xe.paint_symbol["icon-translate-anchor"]),"text-opacity":new lt(xe.paint_symbol["text-opacity"]),"text-color":new lt(xe.paint_symbol["text-color"],{runtimeType:Zn,getOverride:r=>r.textColor,hasOverride:r=>!!r.textColor}),"text-halo-color":new lt(xe.paint_symbol["text-halo-color"]),"text-halo-width":new lt(xe.paint_symbol["text-halo-width"]),"text-halo-blur":new lt(xe.paint_symbol["text-halo-blur"]),"text-translate":new et(xe.paint_symbol["text-translate"]),"text-translate-anchor":new et(xe.paint_symbol["text-translate-anchor"])}),layout:lw};class Ay{constructor(e){if(e.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=e.property.overrides?e.property.overrides.runtimeType:Wi,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ke("FormatSectionOverride",Ay,{omit:["defaultValue"]});class bh extends pi{constructor(e){super(e,Np)}recalculate(e,i){if(super.recalculate(e,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const a=this.layout.get("text-writing-mode");if(a){const d=[];for(const m of a)d.indexOf(m)<0&&d.push(m);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(e,i,a,d){const m=this.layout.get(e).evaluate(i,{},a,d),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||Os(y.value)||!m?m:function(w,b){return b.replace(/{([^{}]+)}/g,(T,z)=>z in w?String(w[z]):"")}(i.properties,m)}createBucket(e){return new Ka(e)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const e of Np.paint.overridableProperties){if(!bh.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new Ay(i),d=new Pa(a,i.property.specification);let m=null;m=i.value.kind==="constant"||i.value.kind==="source"?new Us("source",d):new Wl("composite",d,i.value.zoomStops),this.paint._values[e]=new di(i.property,m,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&bh.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),d=Np.paint.properties[i];let m=!1;const y=w=>{for(const b of w)if(d.overrides&&d.overrides.hasOverride(b))return void(m=!0)};if(a.value.kind==="constant"&&a.value.value instanceof J)y(a.value.value.sections);else if(a.value.kind==="source"){const w=T=>{m||(T instanceof Qe&&me(T.value)===Fn?y(T.value.sections):T instanceof Aa?y(T.sections):T.eachChild(w))},b=a.value;b._styleExpression&&w(b._styleExpression.expression)}return m}}function Up(r,e,i){let a="never";const d=r.get(e);return d?a=d:r.get(i)&&(a="always"),a}var uw={paint:new qn({"background-color":new et(xe.paint_background["background-color"]),"background-pattern":new ou(xe.paint_background["background-pattern"]),"background-opacity":new et(xe.paint_background["background-opacity"])})},cw={paint:new qn({"raster-opacity":new et(xe.paint_raster["raster-opacity"]),"raster-hue-rotate":new et(xe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new et(xe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new et(xe.paint_raster["raster-brightness-max"]),"raster-saturation":new et(xe.paint_raster["raster-saturation"]),"raster-contrast":new et(xe.paint_raster["raster-contrast"]),"raster-resampling":new et(xe.paint_raster["raster-resampling"]),"raster-fade-duration":new et(xe.paint_raster["raster-fade-duration"])})};class hw extends pi{constructor(e){super(e,{}),this.onAdd=i=>{this.implementation.onAdd&&this.implementation.onAdd(i,i.painter.context.gl)},this.onRemove=i=>{this.implementation.onRemove&&this.implementation.onRemove(i,i.painter.context.gl)},this.implementation=e}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const dw={circle:class extends pi{constructor(r){super(r,j0)}createBucket(r){return new pp(r)}queryRadius(r){const e=r;return cu("circle-radius",this,e)+cu("circle-stroke-width",this,e)+oh(this.paint.get("circle-translate"))}queryIntersectsFeature(r,e,i,a,d,m,y,w){const b=sh(r,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,y),T=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i),z=this.paint.get("circle-pitch-alignment")==="map",M=z?b:function(B,F){return B.map(H=>Vg(H,F))}(b,w),L=z?T*y:T;for(const B of a)for(const F of B){const H=z?F:Vg(F,w);let X=L;const le=ah([],[F.x,F.y,0,1],w);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?X*=le[3]/m.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(X*=m.cameraToCenterDistance/le[3]),O0(M,H,X))return!0}return!1}},heatmap:class extends pi{constructor(r){super(r,Z0),this._updateColorRamp()}createBucket(r){return new $g(r)}_handleSpecialPaintPropertyUpdate(r){r==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gg({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends pi{constructor(r){super(r,q0)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends pi{constructor(r){super(r,l1)}recalculate(r,e){super.recalculate(r,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(r){return new Tp(r)}queryRadius(){return oh(this.paint.get("fill-translate"))}queryIntersectsFeature(r,e,i,a,d,m,y){return Dg(sh(r,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,y),a)}isTileClipped(){return!0}},"fill-extrusion":class extends pi{constructor(r){super(r,b1)}createBucket(r){return new Cp(r)}queryRadius(){return oh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(r,e,i,a,d,m,y,w){const b=sh(r,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,y),T=this.paint.get("fill-extrusion-height").evaluate(e,i),z=this.paint.get("fill-extrusion-base").evaluate(e,i),M=function(B,F,H,X){const le=[];for(const fe of B){const oe=[fe.x,fe.y,0,1];ah(oe,oe,F),le.push(new ot(oe[0]/oe[3],oe[1]/oe[3]))}return le}(b,w),L=function(B,F,H,X){const le=[],fe=[],oe=X[8]*F,de=X[9]*F,Se=X[10]*F,be=X[11]*F,Xe=X[8]*H,Je=X[9]*H,Ve=X[10]*H,Be=X[11]*H;for(const De of B){const $e=[],Oe=[];for(const Ie of De){const it=Ie.x,tt=Ie.y,vt=X[0]*it+X[4]*tt+X[12],Qt=X[1]*it+X[5]*tt+X[13],sn=X[2]*it+X[6]*tt+X[14],Ln=X[3]*it+X[7]*tt+X[15],ri=sn+Se,er=Ln+be,In=vt+Xe,$n=Qt+Je,tr=sn+Ve,lr=Ln+Be,Ar=new ot((vt+oe)/er,(Qt+de)/er);Ar.z=ri/er,$e.push(Ar);const zn=new ot(In/lr,$n/lr);zn.z=tr/lr,Oe.push(zn)}le.push($e),fe.push(Oe)}return[le,fe]}(a,z,T,w);return function(B,F,H){let X=1/0;Dg(H,F)&&(X=Qg(H,F[0]));for(let le=0;le<F.length;le++){const fe=F[le],oe=B[le];for(let de=0;de<fe.length-1;de++){const Se=fe[de],be=[Se,fe[de+1],oe[de+1],oe[de],Se];Pg(H,be)&&(X=Math.min(X,Qg(H,be)))}}return X!==1/0&&X}(L[0],L[1],M)}},line:class extends pi{constructor(r){super(r,ty),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(r){r==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ds,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(r,e){super.recalculate(r,e),this.paint._values["line-floorwidth"]=ny.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,r)}createBucket(r){return new Ip(r)}queryRadius(r){const e=r,i=ry(cu("line-width",this,e),cu("line-gap-width",this,e)),a=cu("line-offset",this,e);return i/2+Math.abs(a)+oh(this.paint.get("line-translate"))}queryIntersectsFeature(r,e,i,a,d,m,y){const w=sh(r,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,y),b=y/2*ry(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),T=this.paint.get("line-offset").evaluate(e,i);return T&&(a=function(z,M){const L=[];for(let B=0;B<z.length;B++){const F=z[B],H=[];for(let X=0;X<F.length;X++){const le=F[X-1],fe=F[X],oe=F[X+1],de=X===0?new ot(0,0):fe.sub(le)._unit()._perp(),Se=X===F.length-1?new ot(0,0):oe.sub(fe)._unit()._perp(),be=de._add(Se)._unit(),Xe=be.x*Se.x+be.y*Se.y;Xe!==0&&be._mult(1/Xe),H.push(be._mult(M)._add(fe))}L.push(H)}return L}(a,T*y)),function(z,M,L){for(let B=0;B<M.length;B++){const F=M[B];if(z.length>=3){for(let H=0;H<F.length;H++)if(ja(z,F[H]))return!0}if(N0(z,F,L))return!0}return!1}(w,a,b)}isTileClipped(){return!0}},symbol:bh,background:class extends pi{constructor(r){super(r,uw)}},raster:class extends pi{constructor(r){super(r,cw)}}};class pw{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const My=63710088e-1;class mn{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new mn(Ae(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,d=e.lat*i,m=Math.sin(a)*Math.sin(d)+Math.cos(a)*Math.cos(d)*Math.cos((e.lng-this.lng)*i);return My*Math.acos(Math.min(m,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new ia(new mn(this.lng-a,this.lat-i),new mn(this.lng+a,this.lat+i))}static convert(e){if(e instanceof mn)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new mn(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new mn(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class ia{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof mn?new mn(e.lng,e.lat):mn.convert(e),this}setSouthWest(e){return this._sw=e instanceof mn?new mn(e.lng,e.lat):mn.convert(e),this}extend(e){const i=this._sw,a=this._ne;let d,m;if(e instanceof mn)d=e,m=e;else{if(!(e instanceof ia))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(ia.convert(e)):this.extend(mn.convert(e)):this;if(d=e._sw,m=e._ne,!d||!m)return this}return i||a?(i.lng=Math.min(d.lng,i.lng),i.lat=Math.min(d.lat,i.lat),a.lng=Math.max(m.lng,a.lng),a.lat=Math.max(m.lat,a.lat)):(this._sw=new mn(d.lng,d.lat),this._ne=new mn(m.lng,m.lat)),this}getCenter(){return new mn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new mn(this.getWest(),this.getNorth())}getSouthEast(){return new mn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=mn.convert(e);let d=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&d}static convert(e){return e instanceof ia?e:e&&new ia(e)}}const Py=2*Math.PI*My;function Dy(r){return Py*Math.cos(r*Math.PI/180)}function Ly(r){return(180+r)/360}function Ry(r){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+r*Math.PI/360)))/360}function By(r,e){return r/Dy(e)}function Vp(r){return 360/Math.PI*Math.atan(Math.exp((180-360*r)*Math.PI/180))-90}class Sh{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=mn.convert(e);return new Sh(Ly(a.lng),Ry(a.lat),By(i,a.lat))}toLngLat(){return new mn(360*this.x-180,Vp(this.y))}toAltitude(){return this.z*Dy(Vp(this.y))}meterInMercatorCoordinateUnits(){return 1/Py*(e=Vp(this.y),1/Math.cos(e*Math.PI/180));var e}}function Fy(r,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[r*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}class $p{constructor(e,i,a){if(e<0||e>25||a<0||a>=Math.pow(2,e)||i<0||i>=Math.pow(2,e))throw new Error(`x=${i}, y=${a}, z=${e} outside of bounds. 0<=x<${Math.pow(2,e)}, 0<=y<${Math.pow(2,e)} 0<=z<=25 `);this.z=e,this.x=i,this.y=a,this.key=wu(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,i,a){const d=(y=this.y,w=this.z,b=Fy(256*(m=this.x),256*(y=Math.pow(2,w)-y-1),w),T=Fy(256*(m+1),256*(y+1),w),b[0]+","+b[1]+","+T[0]+","+T[1]);var m,y,w,b,T;const z=function(M,L,B){let F,H="";for(let X=M;X>0;X--)F=1<<X-1,H+=(L&F?1:0)+(B&F?2:0);return H}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,i>1?"@2x":"").replace(/{quadkey}/g,z).replace(/{bbox-epsg-3857}/g,d)}isChildOf(e){const i=this.z-e.z;return i>0&&e.x===this.x>>i&&e.y===this.y>>i}getTilePoint(e){const i=Math.pow(2,this.z);return new ot((e.x*i-this.x)*Dn,(e.y*i-this.y)*Dn)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Oy{constructor(e,i){this.wrap=e,this.canonical=i,this.key=wu(e,i.z,i.z,i.x,i.y)}}class ni{constructor(e,i,a,d,m){if(e<a)throw new Error(`overscaledZ should be >= z; overscaledZ = ${e}; z = ${a}`);this.overscaledZ=e,this.wrap=i,this.canonical=new $p(a,+d,+m),this.key=wu(i,e,a,d,m)}clone(){return new ni(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const i=this.canonical.z-e;return e>this.canonical.z?new ni(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ni(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i){if(e>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${e}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-e;return e>this.canonical.z?wu(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y):wu(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new ni(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,d=2*this.canonical.y;return[new ni(i,this.wrap,i,a,d),new ni(i,this.wrap,i,a+1,d),new ni(i,this.wrap,i,a,d+1),new ni(i,this.wrap,i,a+1,d+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ni(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ni(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Oy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(e){return this.canonical.getTilePoint(new Sh(e.x-this.wrap,e.y))}}function wu(r,e,i,a,d){(r*=2)<0&&(r=-1*r-1);const m=1<<i;return(m*m*r+m*d+a).toString(36)+i.toString(36)+e.toString(36)}Ke("CanonicalTileID",$p),Ke("OverscaledTileID",ni,{omit:["posMatrix"]});class Ny{constructor(e,i,a){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Me(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const d=this.dim=i.height-2;this.data=new Uint32Array(i.data.buffer),this.encoding=a||"mapbox";for(let m=0;m<d;m++)this.data[this._idx(-1,m)]=this.data[this._idx(0,m)],this.data[this._idx(d,m)]=this.data[this._idx(d-1,m)],this.data[this._idx(m,-1)]=this.data[this._idx(m,0)],this.data[this._idx(m,d)]=this.data[this._idx(m,d-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(d,-1)]=this.data[this._idx(d-1,0)],this.data[this._idx(-1,d)]=this.data[this._idx(0,d-1)],this.data[this._idx(d,d)]=this.data[this._idx(d-1,d-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let m=0;m<d;m++)for(let y=0;y<d;y++){const w=this.get(m,y);w>this.max&&(this.max=w),w<this.min&&(this.min=w)}}get(e,i){const a=new Uint8Array(this.data.buffer),d=4*this._idx(e,i);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(a[d],a[d+1],a[d+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}_unpackMapbox(e,i,a){return(256*e*256+256*i+a)/10-1e4}_unpackTerrarium(e,i,a){return 256*e+i+a/256-32768}getPixels(){return new ti({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let d=i*this.dim,m=i*this.dim+this.dim,y=a*this.dim,w=a*this.dim+this.dim;switch(i){case-1:d=m-1;break;case 1:m=d+1}switch(a){case-1:y=w-1;break;case 1:w=y+1}const b=-i*this.dim,T=-a*this.dim;for(let z=y;z<w;z++)for(let M=d;M<m;M++)this.data[this._idx(M,z)]=e.data[this._idx(M+b,z+T)]}}Ke("DEMData",Ny);class Uy{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){if(e>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${e} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[e]}}class Vy{constructor(e,i,a,d,m){this.type="Feature",this._vectorTileFeature=e,e._z=i,e._x=a,e._y=d,this.properties=e.properties,this.id=m}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={geometry:this.geometry};for(const i in this)i!=="_geometry"&&i!=="_vectorTileFeature"&&(e[i]=this[i]);return e}}class $y{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Ks(Dn,16,0),this.grid3D=new Ks(Dn,16,0),this.featureIndexArray=new _t,this.promoteId=i}insert(e,i,a,d,m,y){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,d,m);const b=y?this.grid3D:this.grid;for(let T=0;T<i.length;T++){const z=i[T],M=[1/0,1/0,-1/0,-1/0];for(let L=0;L<z.length;L++){const B=z[L];M[0]=Math.min(M[0],B.x),M[1]=Math.min(M[1],B.y),M[2]=Math.max(M[2],B.x),M[3]=Math.max(M[3],B.y)}M[0]<Dn&&M[1]<Dn&&M[2]>=0&&M[3]>=0&&b.insert(w,M[0],M[1],M[2],M[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new is.VectorTile(new zp(this.rawTileData)).layers,this.sourceLayerCoder=new Uy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(e,i,a,d){this.loadVTLayers();const m=e.params||{},y=Dn/e.tileSize/e.scale,w=Ra(m.filter),b=e.queryGeometry,T=e.queryPadding*y,z=Gy(b),M=this.grid.query(z.minX-T,z.minY-T,z.maxX+T,z.maxY+T),L=Gy(e.cameraQueryGeometry),B=this.grid3D.query(L.minX-T,L.minY-T,L.maxX+T,L.maxY+T,(X,le,fe,oe)=>function(de,Se,be,Xe,Je){for(const Be of de)if(Se<=Be.x&&be<=Be.y&&Xe>=Be.x&&Je>=Be.y)return!0;const Ve=[new ot(Se,be),new ot(Se,Je),new ot(Xe,Je),new ot(Xe,be)];if(de.length>2){for(const Be of Ve)if(ja(de,Be))return!0}for(let Be=0;Be<de.length-1;Be++)if(V0(de[Be],de[Be+1],Ve))return!0;return!1}(e.cameraQueryGeometry,X-T,le-T,fe+T,oe+T));for(const X of B)M.push(X);M.sort(fw);const F={};let H;for(let X=0;X<M.length;X++){const le=M[X];if(le===H)continue;H=le;const fe=this.featureIndexArray.get(le);let oe=null;this.loadMatchingFeature(F,fe.bucketIndex,fe.sourceLayerIndex,fe.featureIndex,w,m.layers,m.availableImages,i,a,d,(de,Se,be)=>(oe||(oe=ta(de)),Se.queryIntersectsFeature(b,de,be,oe,this.z,e.transform,y,e.pixelPosMatrix)))}return F}loadMatchingFeature(e,i,a,d,m,y,w,b,T,z,M){const L=this.bucketLayerIDs[i];if(y&&!function(X,le){for(let fe=0;fe<X.length;fe++)if(le.indexOf(X[fe])>=0)return!0;return!1}(y,L))return;const B=this.sourceLayerCoder.decode(a),F=this.vtLayers[B].feature(d);if(m.needGeometry){const X=na(F,!0);if(!m.filter(new rn(this.tileID.overscaledZ),X,this.tileID.canonical))return}else if(!m.filter(new rn(this.tileID.overscaledZ),F))return;const H=this.getId(F,B);for(let X=0;X<L.length;X++){const le=L[X];if(y&&y.indexOf(le)<0)continue;const fe=b[le];if(!fe)continue;let oe={};H&&z&&(oe=z.getState(fe.sourceLayer||"_geojsonTileLayer",H));const de=Ce({},T[le]);de.paint=jy(de.paint,fe.paint,F,oe,w),de.layout=jy(de.layout,fe.layout,F,oe,w);const Se=!M||M(F,fe,oe);if(!Se)continue;const be=new Vy(F,this.z,this.x,this.y,H);be.layer=de;let Xe=e[le];Xe===void 0&&(Xe=e[le]=[]),Xe.push({featureIndex:d,feature:be,intersectionZ:Se})}}lookupSymbolFeatures(e,i,a,d,m,y,w,b){const T={};this.loadVTLayers();const z=Ra(m);for(const M of e)this.loadMatchingFeature(T,a,d,M,z,y,w,b,i);return T}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;return this.promoteId&&(a=e.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[i]],typeof a=="boolean"&&(a=Number(a))),a}}function jy(r,e,i,a,d){return se(r,(m,y)=>{const w=e instanceof Qs?e.get(y):null;return w&&w.evaluate?w.evaluate(i,a,d):w})}function Gy(r){let e=1/0,i=1/0,a=-1/0,d=-1/0;for(const m of r)e=Math.min(e,m.x),i=Math.min(i,m.y),a=Math.max(a,m.x),d=Math.max(d,m.y);return{minX:e,minY:i,maxX:a,maxY:d}}function fw(r,e){return e-r}var jp;Ke("FeatureIndex",$y,{omit:["rawTileData","sourceLayerCoder"]}),u.PerformanceMarkers=void 0,(jp=u.PerformanceMarkers||(u.PerformanceMarkers={})).create="create",jp.load="load",jp.fullLoad="fullLoad";let Eh=null,bu=[];const Gp=1e3/30,mw={mark(r){performance.mark(r)},frame(r){const e=r;Eh!=null&&bu.push(e-Eh),Eh=e},clearMetrics(){Eh=null,bu=[],performance.clearMeasures("loadTime"),performance.clearMeasures("fullLoadTime");for(const r in u.PerformanceMarkers)performance.clearMarks(u.PerformanceMarkers[r])},getPerformanceMetrics(){performance.measure("loadTime",u.PerformanceMarkers.create,u.PerformanceMarkers.load),performance.measure("fullLoadTime",u.PerformanceMarkers.create,u.PerformanceMarkers.fullLoad);const r=performance.getEntriesByName("loadTime")[0].duration,e=performance.getEntriesByName("fullLoadTime")[0].duration,i=bu.length,a=1/(bu.reduce((m,y)=>m+y,0)/i/1e3),d=bu.filter(m=>m>Gp).reduce((m,y)=>m+(y-Gp)/Gp,0);return{loadTime:r,fullLoadTime:e,fps:a,percentDroppedFrames:d/(i+d)*100}}};u.AJAXError=Mn,u.ARRAY_TYPE=vr,u.Actor=class{constructor(r,e,i){this.target=r,this.parent=e,this.mapId=i,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},xt(["receive","process"],this),this.invoker=new pw(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=He()?r:window}send(r,e,i,a,d=!1){const m=Math.round(1e18*Math.random()).toString(36).substring(0,10);i&&(this.callbacks[m]=i);const y=yn(this.globalScope)?void 0:[];return this.target.postMessage({id:m,type:r,hasCallback:!!i,targetMapId:a,mustQueue:d,sourceMapId:this.mapId,data:yo(e,y)},y),{cancel:()=>{i&&delete this.callbacks[m],this.target.postMessage({id:m,type:"<cancel>",targetMapId:a,sourceMapId:this.mapId})}}}receive(r){const e=r.data,i=e.id;if(i&&(!e.targetMapId||this.mapId===e.targetMapId))if(e.type==="<cancel>"){delete this.tasks[i];const a=this.cancelCallbacks[i];delete this.cancelCallbacks[i],a&&a()}else He()||e.mustQueue?(this.tasks[i]=e,this.taskQueue.push(i),this.invoker.trigger()):this.processTask(i,e)}process(){if(!this.taskQueue.length)return;const r=this.taskQueue.shift(),e=this.tasks[r];delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(r,e)}processTask(r,e){if(e.type==="<response>"){const i=this.callbacks[r];delete this.callbacks[r],i&&(e.error?i(Ki(e.error)):i(null,Ki(e.data)))}else{let i=!1;const a=yn(this.globalScope)?void 0:[],d=e.hasCallback?(w,b)=>{i=!0,delete this.cancelCallbacks[r],this.target.postMessage({id:r,type:"<response>",sourceMapId:this.mapId,error:w?yo(w):null,data:yo(b,a)},a)}:w=>{i=!0};let m=null;const y=Ki(e.data);if(this.parent[e.type])m=this.parent[e.type](e.sourceMapId,y,d);else if(this.parent.getWorkerSource){const w=e.type.split(".");m=this.parent.getWorkerSource(e.sourceMapId,w[0],y.source)[w[1]](y,d)}else d(new Error(`Could not find function ${e.type}`));!i&&m&&m.cancel&&(this.cancelCallbacks[r]=m.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.AlphaImage=du,u.CanonicalTileID=$p,u.CollisionBoxArray=_e,u.CollisionCircleLayoutArray=class extends A{},u.Color=U,u.DEMData=Ny,u.DataConstantProperty=et,u.DictionaryCoder=Uy,u.EXTENT=Dn,u.ErrorEvent=Uo,u.EvaluationParameters=rn,u.Event=Ci,u.Evented=Ii,u.FeatureIndex=$y,u.FillBucket=Tp,u.FillExtrusionBucket=Cp,u.GeoJSONFeature=Vy,u.ImageAtlas=dy,u.ImagePosition=Mp,u.LineBucket=Ip,u.LineStripIndexArray=class extends W{},u.LngLat=mn,u.LngLatBounds=ia,u.MercatorCoordinate=Sh,u.ONE_EM=Wn,u.OverscaledTileID=ni,u.PerformanceUtils=mw,u.PosArray=rt,u.Properties=qn,u.QuadTriangleArray=class extends R{},u.RGBAImage=ti,u.RasterBoundsArray=class extends h{},u.RequestPerformance=class{constructor(r){this._marks={start:[r.url,"start"].join("#"),end:[r.url,"end"].join("#"),measure:r.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let r=performance.getEntriesByName(this._marks.measure);return r.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),r=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),r}},u.ResourceType=Yt,u.SegmentVector=wt,u.SymbolBucket=Ka,u.Transitionable=Qc,u.TriangleIndexArray=yr,u.Uniform1f=wo,u.Uniform1i=class extends xo{constructor(r,e){super(r,e),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}},u.Uniform2f=class extends xo{constructor(r,e){super(r,e),this.current=[0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1]))}},u.Uniform3f=class extends xo{constructor(r,e){super(r,e),this.current=[0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2]))}},u.Uniform4f=Va,u.UniformColor=Ig,u.UniformMatrix4f=class extends xo{constructor(r,e){super(r,e),this.current=B0}set(r){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}},u.UnwrappedTileID=Oy,u.ValidationError=Fe,u.ZoomHistory=Yl,u.add=function(r,e,i){return r[0]=e[0]+i[0],r[1]=e[1]+i[1],r[2]=e[2]+i[2],r},u.addDynamicAttributes=Bp,u.asyncAll=function(r,e,i){if(!r.length)return i(null,[]);let a=r.length;const d=new Array(r.length);let m=null;r.forEach((y,w)=>{e(y,(b,T)=>{b&&(m=b),d[w]=T,--a==0&&i(m,d)})})},u.bezier=ue,u.bindAll=xt,u.cacheEntryPossiblyAdded=function(r){Jn++,Jn>fr&&(r.getActor().send("enforceCacheSizeLimit",qt),Jn=0)},u.clamp=q,u.clearTileCache=function(r){const e=caches.delete(st);r&&e.catch(r).then(()=>r())},u.clipLine=Ey,u.clone=function(r){var e=new vr(16);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e},u.clone$1=ae,u.clone$2=function(r){var e=new vr(3);return e[0]=r[0],e[1]=r[1],e[2]=r[2],e},u.collisionCircleLayout=D1,u.config=Ne,u.copy=function(r,e){return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},u.create=function(){var r=new vr(16);return vr!=Float32Array&&(r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=0,r[12]=0,r[13]=0,r[14]=0),r[0]=1,r[5]=1,r[10]=1,r[15]=1,r},u.create$1=Bg,u.createExpression=Ns,u.createFilter=Ra,u.createLayout=Cn,u.createStyleLayer=function(r){return r.type==="custom"?new hw(r):new dw[r.type](r)},u.cross=function(r,e,i){var a=e[0],d=e[1],m=e[2],y=i[0],w=i[1],b=i[2];return r[0]=d*b-m*w,r[1]=m*y-a*b,r[2]=a*w-d*y,r},u.dot=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]},u.dot$1=function(r,e){return r[0]*e[0]+r[1]*e[1]+r[2]*e[2]+r[3]*e[3]},u.ease=te,u.emitValidationErrors=Fa,u.enforceCacheSizeLimit=function(r){Yn(),ut&&ut.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-r;a++)e.delete(i[a])})})},u.equals=function(r,e){var i=r[0],a=r[1],d=r[2],m=r[3],y=r[4],w=r[5],b=r[6],T=r[7],z=r[8],M=r[9],L=r[10],B=r[11],F=r[12],H=r[13],X=r[14],le=r[15],fe=e[0],oe=e[1],de=e[2],Se=e[3],be=e[4],Xe=e[5],Je=e[6],Ve=e[7],Be=e[8],De=e[9],$e=e[10],Oe=e[11],Ie=e[12],it=e[13],tt=e[14],vt=e[15];return Math.abs(i-fe)<=_r*Math.max(1,Math.abs(i),Math.abs(fe))&&Math.abs(a-oe)<=_r*Math.max(1,Math.abs(a),Math.abs(oe))&&Math.abs(d-de)<=_r*Math.max(1,Math.abs(d),Math.abs(de))&&Math.abs(m-Se)<=_r*Math.max(1,Math.abs(m),Math.abs(Se))&&Math.abs(y-be)<=_r*Math.max(1,Math.abs(y),Math.abs(be))&&Math.abs(w-Xe)<=_r*Math.max(1,Math.abs(w),Math.abs(Xe))&&Math.abs(b-Je)<=_r*Math.max(1,Math.abs(b),Math.abs(Je))&&Math.abs(T-Ve)<=_r*Math.max(1,Math.abs(T),Math.abs(Ve))&&Math.abs(z-Be)<=_r*Math.max(1,Math.abs(z),Math.abs(Be))&&Math.abs(M-De)<=_r*Math.max(1,Math.abs(M),Math.abs(De))&&Math.abs(L-$e)<=_r*Math.max(1,Math.abs(L),Math.abs($e))&&Math.abs(B-Oe)<=_r*Math.max(1,Math.abs(B),Math.abs(Oe))&&Math.abs(F-Ie)<=_r*Math.max(1,Math.abs(F),Math.abs(Ie))&&Math.abs(H-it)<=_r*Math.max(1,Math.abs(H),Math.abs(it))&&Math.abs(X-tt)<=_r*Math.max(1,Math.abs(X),Math.abs(tt))&&Math.abs(le-vt)<=_r*Math.max(1,Math.abs(le),Math.abs(vt))},u.evaluateSizeForFeature=function(r,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:d}){return r.kind==="source"?a/Eo:r.kind==="composite"?tn(a/Eo,d/Eo,i):e},u.evaluateSizeForZoom=function(r,e){let i=0,a=0;if(r.kind==="constant")a=r.layoutSize;else if(r.kind!=="source"){const{interpolationType:d,minZoom:m,maxZoom:y}=r,w=d?q(Cr.interpolationFactor(d,e,m,y),0,1):0;r.kind==="camera"?a=tn(r.minSize,r.maxSize,w):i=w}return{uSizeT:i,uSize:a}},u.evaluateVariableOffset=Cy,u.evented=iu,u.exported=_n,u.exported$1=pn,u.extend=Ce,u.filterObject=Q,u.fromRotation=function(r,e){var i=Math.sin(e),a=Math.cos(e);return r[0]=a,r[1]=i,r[2]=0,r[3]=-i,r[4]=a,r[5]=0,r[6]=0,r[7]=0,r[8]=1,r},u.fromScaling=function(r,e){return r[0]=e[0],r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=e[1],r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=e[2],r[11]=0,r[12]=0,r[13]=0,r[14]=0,r[15]=1,r},u.getAnchorAlignment=Dp,u.getAnchorJustification=Rp,u.getArrayBuffer=Ti,u.getImage=Ur,u.getJSON=function(r,e){return Yr(Ce(r,{type:"json"}),e)},u.getOverlapMode=Up,u.getRTLTextPluginStatus=Ys,u.getReferrer=Nr,u.getVideo=function(r,e){const i=window.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<r.length;a++){const d=window.document.createElement("source");qi(r[a])||(i.crossOrigin="Anonymous"),d.src=r[a],i.appendChild(d)}return{cancel:()=>{}}},u.identity=gp,u.invert=function(r,e){var i=e[0],a=e[1],d=e[2],m=e[3],y=e[4],w=e[5],b=e[6],T=e[7],z=e[8],M=e[9],L=e[10],B=e[11],F=e[12],H=e[13],X=e[14],le=e[15],fe=i*w-a*y,oe=i*b-d*y,de=i*T-m*y,Se=a*b-d*w,be=a*T-m*w,Xe=d*T-m*b,Je=z*H-M*F,Ve=z*X-L*F,Be=z*le-B*F,De=M*X-L*H,$e=M*le-B*H,Oe=L*le-B*X,Ie=fe*Oe-oe*$e+de*De+Se*Be-be*Ve+Xe*Je;return Ie?(r[0]=(w*Oe-b*$e+T*De)*(Ie=1/Ie),r[1]=(d*$e-a*Oe-m*De)*Ie,r[2]=(H*Xe-X*be+le*Se)*Ie,r[3]=(L*be-M*Xe-B*Se)*Ie,r[4]=(b*Be-y*Oe-T*Ve)*Ie,r[5]=(i*Oe-d*Be+m*Ve)*Ie,r[6]=(X*de-F*Xe-le*oe)*Ie,r[7]=(z*Xe-L*de+B*oe)*Ie,r[8]=(y*$e-w*Be+T*Je)*Ie,r[9]=(a*Be-i*$e-m*Je)*Ie,r[10]=(F*be-H*de+le*fe)*Ie,r[11]=(M*de-z*be-B*fe)*Ie,r[12]=(w*Ve-y*De-b*Je)*Ie,r[13]=(i*De-a*Ve+d*Je)*Ie,r[14]=(H*oe-F*Se-X*fe)*Ie,r[15]=(z*Se-M*oe+L*fe)*Ie,r):null},u.isImageBitmap=Kn,u.isSafari=yn,u.isWorker=He,u.keysDifference=function(r,e){const i=[];for(const a in r)a in e||i.push(a);return i},u.lazyLoadRTLTextPlugin=function(){$r.isLoading()||$r.isLoaded()||Ys()!=="deferred"||Jc()},u.makeRequest=Yr,u.mapObject=se,u.mercatorXfromLng=Ly,u.mercatorYfromLat=Ry,u.mercatorZfromAltitude=By,u.mul=G0,u.mul$1=function(r,e,i){return r[0]=e[0]*i[0],r[1]=e[1]*i[1],r[2]=e[2]*i[2],r[3]=e[3]*i[3],r},u.multiply=Fg,u.nextPowerOfTwo=function(r){return r<=1?1:Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))},u.normalize=function(r,e){var i=e[0],a=e[1],d=e[2],m=i*i+a*a+d*d;return m>0&&(m=1/Math.sqrt(m)),r[0]=e[0]*m,r[1]=e[1]*m,r[2]=e[2]*m,r},u.number=tn,u.ortho=function(r,e,i,a,d,m,y){var w=1/(e-i),b=1/(a-d),T=1/(m-y);return r[0]=-2*w,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=-2*b,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=2*T,r[11]=0,r[12]=(e+i)*w,r[13]=(d+a)*b,r[14]=(y+m)*T,r[15]=1,r},u.parseCacheControl=Mt,u.parseGlyphPbf=function(r){return new zp(r).readFields(G1,[])},u.pbf=zp,u.performSymbolLayout=function(r){r.bucket.createArrays(),r.bucket.tilePixelRatio=Dn/(512*r.bucket.overscaling),r.bucket.compareText={},r.bucket.iconsNeedLinear=!1;const e=r.bucket.layers[0].layout,i=r.bucket.layers[0]._unevaluatedLayout._values,a={layoutIconSize:i["icon-size"].possiblyEvaluate(new rn(r.bucket.zoom+1),r.canonical),layoutTextSize:i["text-size"].possiblyEvaluate(new rn(r.bucket.zoom+1),r.canonical),textMaxSize:i["text-size"].possiblyEvaluate(new rn(18))};if(r.bucket.textSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=r.bucket.textSizeData;a.compositeTextSizes=[i["text-size"].possiblyEvaluate(new rn(b),r.canonical),i["text-size"].possiblyEvaluate(new rn(T),r.canonical)]}if(r.bucket.iconSizeData.kind==="composite"){const{minZoom:b,maxZoom:T}=r.bucket.iconSizeData;a.compositeIconSizes=[i["icon-size"].possiblyEvaluate(new rn(b),r.canonical),i["icon-size"].possiblyEvaluate(new rn(T),r.canonical)]}const d=e.get("text-line-height")*Wn,m=e.get("text-rotation-alignment")!=="viewport"&&e.get("symbol-placement")!=="point",y=e.get("text-keep-upright"),w=e.get("text-size");for(const b of r.bucket.features){const T=e.get("text-font").evaluate(b,{},r.canonical).join(","),z=w.evaluate(b,{},r.canonical),M=a.layoutTextSize.evaluate(b,{},r.canonical),L=a.layoutIconSize.evaluate(b,{},r.canonical),B={horizontal:{},vertical:void 0},F=b.text;let H,X=[0,0];if(F){const oe=F.toString(),de=e.get("text-letter-spacing").evaluate(b,{},r.canonical)*Wn,Se=lp(oe)?de:0,be=e.get("text-anchor").evaluate(b,{},r.canonical),Xe=e.get("text-variable-anchor");if(!Xe){const $e=e.get("text-radial-offset").evaluate(b,{},r.canonical);X=$e?Cy(be,[$e*Wn,Lp]):e.get("text-offset").evaluate(b,{},r.canonical).map(Oe=>Oe*Wn)}let Je=m?"center":e.get("text-justify").evaluate(b,{},r.canonical);const Ve=e.get("symbol-placement"),Be=Ve==="point"?e.get("text-max-width").evaluate(b,{},r.canonical)*Wn:0,De=()=>{r.bucket.allowVerticalPlacement&&Oa(oe)&&(B.vertical=mh(F,r.glyphMap,r.glyphPositions,r.imagePositions,T,Be,d,be,"left",Se,X,u.WritingMode.vertical,!0,Ve,M,z))};if(!m&&Xe){const $e=Je==="auto"?Xe.map(Ie=>Rp(Ie)):[Je];let Oe=!1;for(let Ie=0;Ie<$e.length;Ie++){const it=$e[Ie];if(!B.horizontal[it])if(Oe)B.horizontal[it]=B.horizontal[0];else{const tt=mh(F,r.glyphMap,r.glyphPositions,r.imagePositions,T,Be,d,"center",it,Se,X,u.WritingMode.horizontal,!1,Ve,M,z);tt&&(B.horizontal[it]=tt,Oe=tt.positionedLines.length===1)}}De()}else{Je==="auto"&&(Je=Rp(be));const $e=mh(F,r.glyphMap,r.glyphPositions,r.imagePositions,T,Be,d,be,Je,Se,X,u.WritingMode.horizontal,!1,Ve,M,z);$e&&(B.horizontal[Je]=$e),De(),Oa(oe)&&m&&y&&(B.vertical=mh(F,r.glyphMap,r.glyphPositions,r.imagePositions,T,Be,d,be,Je,Se,X,u.WritingMode.vertical,!1,Ve,M,z))}}let le=!1;if(b.icon&&b.icon.name){const oe=r.imageMap[b.icon.name];oe&&(H=K1(r.imagePositions[b.icon.name],e.get("icon-offset").evaluate(b,{},r.canonical),e.get("icon-anchor").evaluate(b,{},r.canonical)),le=!!oe.sdf,r.bucket.sdfIcons===void 0?r.bucket.sdfIcons=le:r.bucket.sdfIcons!==le&&Me("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(oe.pixelRatio!==r.bucket.pixelRatio||e.get("icon-rotate").constantOr(1)!==0)&&(r.bucket.iconsNeedLinear=!0))}const fe=zy(B.horizontal)||B.vertical;r.bucket.iconsInText=!!fe&&fe.iconsInText,(fe||H)&&rw(r.bucket,b,B,H,r.imageMap,a,M,L,X,le,r.canonical)}r.showCollisionBoxes&&r.bucket.generateCollisionDebugBuffers()},u.perspective=function(r,e,i,a,d){var m,y=1/Math.tan(e/2);return r[0]=y/i,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=y,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[11]=-1,r[12]=0,r[13]=0,r[15]=0,d!=null&&d!==1/0?(r[10]=(d+a)*(m=1/(a-d)),r[14]=2*d*a*m):(r[10]=-1,r[14]=-2*a),r},u.pick=function(r,e){const i={};for(let a=0;a<e.length;a++){const d=e[a];d in r&&(i[d]=r[d])}return i},u.plugin=$r,u.pointGeometry=ot,u.polygonIntersectsPolygon=Pg,u.potpack=hy,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.register=Ke,u.registerForPluginStateChange=function(r){return r({pluginStatus:gr,pluginURL:Yi}),iu.on("pluginStateChange",r),r},u.renderColorRamp=Gg,u.rotateX=function(r,e,i){var a=Math.sin(i),d=Math.cos(i),m=e[4],y=e[5],w=e[6],b=e[7],T=e[8],z=e[9],M=e[10],L=e[11];return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[4]=m*d+T*a,r[5]=y*d+z*a,r[6]=w*d+M*a,r[7]=b*d+L*a,r[8]=T*d-m*a,r[9]=z*d-y*a,r[10]=M*d-w*a,r[11]=L*d-b*a,r},u.rotateZ=function(r,e,i){var a=Math.sin(i),d=Math.cos(i),m=e[0],y=e[1],w=e[2],b=e[3],T=e[4],z=e[5],M=e[6],L=e[7];return e!==r&&(r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15]),r[0]=m*d+T*a,r[1]=y*d+z*a,r[2]=w*d+M*a,r[3]=b*d+L*a,r[4]=T*d-m*a,r[5]=z*d-y*a,r[6]=M*d-w*a,r[7]=L*d-b*a,r},u.scale=function(r,e,i){var a=i[0],d=i[1],m=i[2];return r[0]=e[0]*a,r[1]=e[1]*a,r[2]=e[2]*a,r[3]=e[3]*a,r[4]=e[4]*d,r[5]=e[5]*d,r[6]=e[6]*d,r[7]=e[7]*d,r[8]=e[8]*m,r[9]=e[9]*m,r[10]=e[10]*m,r[11]=e[11]*m,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},u.scale$1=function(r,e,i){return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r},u.setCacheLimits=function(r,e){qt=r,fr=e},u.setRTLTextPlugin=function(r,e,i=!1){if(gr===eu||gr===tu||gr===nu)throw new Error("setRTLTextPlugin cannot be called multiple times.");Yi=_n.resolveURL(r),gr=eu,ru=e,es(),i||Jc()},u.spec=xe,u.sphericalToCartesian=function([r,e,i]){return e+=90,e*=Math.PI/180,i*=Math.PI/180,{x:r*Math.cos(e)*Math.sin(i),y:r*Math.sin(e)*Math.sin(i),z:r*Math.cos(i)}},u.sqrLen=function(r){var e=r[0],i=r[1];return e*e+i*i},u.sub=function(r,e,i){return r[0]=e[0]-i[0],r[1]=e[1]-i[1],r[2]=e[2]-i[2],r},u.toEvaluationFeature=na,u.transformMat3=function(r,e,i){var a=e[0],d=e[1],m=e[2];return r[0]=a*i[0]+d*i[3]+m*i[6],r[1]=a*i[1]+d*i[4]+m*i[7],r[2]=a*i[2]+d*i[5]+m*i[8],r},u.transformMat4=ah,u.transformMat4$1=function(r,e,i){var a=e[0],d=e[1];return r[0]=i[0]*a+i[4]*d+i[12],r[1]=i[1]*a+i[5]*d+i[13],r},u.translate=function(r,e,i){var a,d,m,y,w,b,T,z,M,L,B,F,H=i[0],X=i[1],le=i[2];return e===r?(r[12]=e[0]*H+e[4]*X+e[8]*le+e[12],r[13]=e[1]*H+e[5]*X+e[9]*le+e[13],r[14]=e[2]*H+e[6]*X+e[10]*le+e[14],r[15]=e[3]*H+e[7]*X+e[11]*le+e[15]):(d=e[1],m=e[2],y=e[3],w=e[4],b=e[5],T=e[6],z=e[7],M=e[8],L=e[9],B=e[10],F=e[11],r[0]=a=e[0],r[1]=d,r[2]=m,r[3]=y,r[4]=w,r[5]=b,r[6]=T,r[7]=z,r[8]=M,r[9]=L,r[10]=B,r[11]=F,r[12]=a*H+w*X+M*le+e[12],r[13]=d*H+b*X+L*le+e[13],r[14]=m*H+T*X+B*le+e[14],r[15]=y*H+z*X+F*le+e[15]),r},u.triggerPluginCompletionEvent=Yc,u.unicodeBlockLookup=Ue,u.uniqueId=function(){return we++},u.validateCustomStyleLayer=function(r){const e=[],i=r.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),r.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),r.renderingMode&&r.renderingMode!=="2d"&&r.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateLight=Kl,u.validateStyle=Hs,u.vectorTile=is,u.warnOnce=Me,u.wrap=Ae}),v(["./shared"],function(u){function O(V){const I=typeof V;if(I==="number"||I==="boolean"||I==="string"||V==null)return JSON.stringify(V);if(Array.isArray(V)){let U="[";for(const K of V)U+=`${O(K)},`;return`${U}]`}const P=Object.keys(V).sort();let N="{";for(let U=0;U<P.length;U++)N+=`${JSON.stringify(P[U])}:${O(V[P[U]])},`;return`${N}}`}function Z(V){let I="";for(const P of u.refProperties)I+=`/${O(V[P])}`;return I}class ue{constructor(I){this.keyCache={},I&&this.replace(I)}replace(I){this._layerConfigs={},this._layers={},this.update(I,[])}update(I,P){for(const U of I){this._layerConfigs[U.id]=U;const K=this._layers[U.id]=u.createStyleLayer(U);K._featureFilter=u.createFilter(K.filter),this.keyCache[U.id]&&delete this.keyCache[U.id]}for(const U of P)delete this.keyCache[U],delete this._layerConfigs[U],delete this._layers[U];this.familiesBySource={};const N=function(U,K){const ne={};for(let Y=0;Y<U.length;Y++){const re=K&&K[U[Y].id]||Z(U[Y]);K&&(K[U[Y].id]=re);let ge=ne[re];ge||(ge=ne[re]=[]),ge.push(U[Y])}const J=[];for(const Y in ne)J.push(ne[Y]);return J}(Object.values(this._layerConfigs),this.keyCache);for(const U of N){const K=U.map(Ee=>this._layers[Ee.id]),ne=K[0];if(ne.visibility==="none")continue;const J=ne.source||"";let Y=this.familiesBySource[J];Y||(Y=this.familiesBySource[J]={});const re=ne.sourceLayer||"_geojsonTileLayer";let ge=Y[re];ge||(ge=Y[re]=[]),ge.push(K)}}}class te{constructor(I){const P={},N=[];for(const J in I){const Y=I[J],re=P[J]={};for(const ge in Y){const Ee=Y[+ge];if(!Ee||Ee.bitmap.width===0||Ee.bitmap.height===0)continue;const me={x:0,y:0,w:Ee.bitmap.width+2,h:Ee.bitmap.height+2};N.push(me),re[ge]={rect:me,metrics:Ee.metrics}}}const{w:U,h:K}=u.potpack(N),ne=new u.AlphaImage({width:U||1,height:K||1});for(const J in I){const Y=I[J];for(const re in Y){const ge=Y[+re];if(!ge||ge.bitmap.width===0||ge.bitmap.height===0)continue;const Ee=P[J][re].rect;u.AlphaImage.copy(ge.bitmap,ne,{x:0,y:0},{x:Ee.x+1,y:Ee.y+1},ge.bitmap)}}this.image=ne,this.positions=P}}u.register("GlyphAtlas",te);class q{constructor(I){this.tileID=new u.OverscaledTileID(I.tileID.overscaledZ,I.tileID.wrap,I.tileID.canonical.z,I.tileID.canonical.x,I.tileID.canonical.y),this.uid=I.uid,this.zoom=I.zoom,this.pixelRatio=I.pixelRatio,this.tileSize=I.tileSize,this.source=I.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=I.showCollisionBoxes,this.collectResourceTiming=!!I.collectResourceTiming,this.returnDependencies=!!I.returnDependencies,this.promoteId=I.promoteId}parse(I,P,N,U,K){this.status="parsing",this.data=I,this.collisionBoxArray=new u.CollisionBoxArray;const ne=new u.DictionaryCoder(Object.keys(I.layers).sort()),J=new u.FeatureIndex(this.tileID,this.promoteId);J.bucketLayerIDs=[];const Y={},re={featureIndex:J,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:N},ge=P.familiesBySource[this.source];for(const dt in ge){const yt=I.layers[dt];if(!yt)continue;yt.version===1&&u.warnOnce(`Vector tile source "${this.source}" layer "${dt}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const It=ne.encode(dt),jt=[];for(let On=0;On<yt.length;On++){const en=yt.feature(On),Qn=J.getId(en,dt);jt.push({feature:en,id:Qn,index:On,sourceLayerIndex:It})}for(const On of ge[dt]){const en=On[0];en.source!==this.source&&u.warnOnce(`layer.source = ${en.source} does not equal this.source = ${this.source}`),en.minzoom&&this.zoom<Math.floor(en.minzoom)||en.maxzoom&&this.zoom>=en.maxzoom||en.visibility!=="none"&&(Ae(On,this.zoom,N),(Y[en.id]=en.createBucket({index:J.bucketLayerIDs.length,layers:On,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:It,sourceID:this.source})).populate(jt,re,this.tileID.canonical),J.bucketLayerIDs.push(On.map(Qn=>Qn.id)))}}let Ee,me,Ye,Qe;const Ge=u.mapObject(re.glyphDependencies,dt=>Object.keys(dt).map(Number));Object.keys(Ge).length?U.send("getGlyphs",{uid:this.uid,stacks:Ge},(dt,yt)=>{Ee||(Ee=dt,me=yt,Ct.call(this))}):me={};const at=Object.keys(re.iconDependencies);at.length?U.send("getImages",{icons:at,source:this.source,tileID:this.tileID,type:"icons"},(dt,yt)=>{Ee||(Ee=dt,Ye=yt,Ct.call(this))}):Ye={};const ct=Object.keys(re.patternDependencies);function Ct(){if(Ee)return K(Ee);if(me&&Ye&&Qe){const dt=new te(me),yt=new u.ImageAtlas(Ye,Qe);for(const It in Y){const jt=Y[It];jt instanceof u.SymbolBucket?(Ae(jt.layers,this.zoom,N),u.performSymbolLayout({bucket:jt,glyphMap:me,glyphPositions:dt.positions,imageMap:Ye,imagePositions:yt.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):jt.hasPattern&&(jt instanceof u.LineBucket||jt instanceof u.FillBucket||jt instanceof u.FillExtrusionBucket)&&(Ae(jt.layers,this.zoom,N),jt.addFeatures(re,this.tileID.canonical,yt.patternPositions))}this.status="done",K(null,{buckets:Object.values(Y).filter(It=>!It.isEmpty()),featureIndex:J,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:dt.image,imageAtlas:yt,glyphMap:this.returnDependencies?me:null,iconMap:this.returnDependencies?Ye:null,glyphPositions:this.returnDependencies?dt.positions:null})}}ct.length?U.send("getImages",{icons:ct,source:this.source,tileID:this.tileID,type:"patterns"},(dt,yt)=>{Ee||(Ee=dt,Qe=yt,Ct.call(this))}):Qe={},Ct.call(this)}}function Ae(V,I,P){const N=new u.EvaluationParameters(I);for(const U of V)U.recalculate(N,P)}function Ce(V,I){const P=u.getArrayBuffer(V.request,(N,U,K,ne)=>{N?I(N):U&&I(null,{vectorTile:new u.vectorTile.VectorTile(new u.pbf(U)),rawData:U,cacheControl:K,expires:ne})});return()=>{P.cancel(),I()}}class we{constructor(I,P,N,U){this.actor=I,this.layerIndex=P,this.availableImages=N,this.loadVectorData=U||Ce,this.loading={},this.loaded={}}loadTile(I,P){const N=I.uid;this.loading||(this.loading={});const U=!!(I&&I.request&&I.request.collectResourceTiming)&&new u.RequestPerformance(I.request),K=this.loading[N]=new q(I);K.abort=this.loadVectorData(I,(ne,J)=>{if(delete this.loading[N],ne||!J)return K.status="done",this.loaded[N]=K,P(ne);const Y=J.rawData,re={};J.expires&&(re.expires=J.expires),J.cacheControl&&(re.cacheControl=J.cacheControl);const ge={};if(U){const Ee=U.finish();Ee&&(ge.resourceTiming=JSON.parse(JSON.stringify(Ee)))}K.vectorTile=J.vectorTile,K.parse(J.vectorTile,this.layerIndex,this.availableImages,this.actor,(Ee,me)=>{if(Ee||!me)return P(Ee);P(null,u.extend({rawTileData:Y.slice(0)},me,re,ge))}),this.loaded=this.loaded||{},this.loaded[N]=K})}reloadTile(I,P){const N=this.loaded,U=I.uid,K=this;if(N&&N[U]){const ne=N[U];ne.showCollisionBoxes=I.showCollisionBoxes;const J=(Y,re)=>{const ge=ne.reloadCallback;ge&&(delete ne.reloadCallback,ne.parse(ne.vectorTile,K.layerIndex,this.availableImages,K.actor,ge)),P(Y,re)};ne.status==="parsing"?ne.reloadCallback=J:ne.status==="done"&&(ne.vectorTile?ne.parse(ne.vectorTile,this.layerIndex,this.availableImages,this.actor,J):J())}}abortTile(I,P){const N=this.loading,U=I.uid;N&&N[U]&&N[U].abort&&(N[U].abort(),delete N[U]),P()}removeTile(I,P){const N=this.loaded,U=I.uid;N&&N[U]&&delete N[U],P()}}class xt{constructor(){this.loaded={}}loadTile(I,P){const{uid:N,encoding:U,rawImageData:K}=I,ne=u.isImageBitmap(K)?this.getImageData(K):K,J=new u.DEMData(N,ne,U);this.loaded=this.loaded||{},this.loaded[N]=J,P(null,J)}getImageData(I){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(I.width,I.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=I.width,this.offscreenCanvas.height=I.height,this.offscreenCanvasContext.drawImage(I,0,0,I.width,I.height);const P=this.offscreenCanvasContext.getImageData(-1,-1,I.width+2,I.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:P.width,height:P.height},P.data)}removeTile(I){const P=this.loaded,N=I.uid;P&&P[N]&&delete P[N]}}var se=function V(I,P){var N,U=I&&I.type;if(U==="FeatureCollection")for(N=0;N<I.features.length;N++)V(I.features[N],P);else if(U==="GeometryCollection")for(N=0;N<I.geometries.length;N++)V(I.geometries[N],P);else if(U==="Feature")V(I.geometry,P);else if(U==="Polygon")Q(I.coordinates,P);else if(U==="MultiPolygon")for(N=0;N<I.coordinates.length;N++)Q(I.coordinates[N],P);return I};function Q(V,I){if(V.length!==0){ae(V[0],I);for(var P=1;P<V.length;P++)ae(V[P],!I)}}function ae(V,I){for(var P=0,N=0,U=0,K=V.length,ne=K-1;U<K;ne=U++){var J=(V[U][0]-V[ne][0])*(V[ne][1]+V[U][1]),Y=P+J;N+=Math.abs(P)>=Math.abs(J)?P-Y+J:J-Y+P,P=Y}P+N>=0!=!!I&&V.reverse()}const ke=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Me{constructor(I){this._feature=I,this.extent=u.EXTENT,this.type=I.type,this.properties=I.tags,"id"in I&&!isNaN(I.id)&&(this.id=parseInt(I.id,10))}loadGeometry(){if(this._feature.type===1){const I=[];for(const P of this._feature.geometry)I.push([new u.pointGeometry(P[0],P[1])]);return I}{const I=[];for(const P of this._feature.geometry){const N=[];for(const U of P)N.push(new u.pointGeometry(U[0],U[1]));I.push(N)}return I}}toGeoJSON(I,P,N){return ke.call(this,I,P,N)}}class ze{constructor(I){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=I.length,this._features=I}feature(I){return new Me(this._features[I])}}var je={exports:{}},He=u.pointGeometry,Mt=u.vectorTile.VectorTileFeature,ht=Wt;function Wt(V,I){this.options=I||{},this.features=V,this.length=V.length}function En(V,I){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=I||4096}Wt.prototype.feature=function(V){return new En(this.features[V],this.options.extent)},En.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var I=0;I<V.length;I++){for(var P=V[I],N=[],U=0;U<P.length;U++)N.push(new He(P[U][0],P[U][1]));this.geometry.push(N)}return this.geometry},En.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,I=1/0,P=-1/0,N=1/0,U=-1/0,K=0;K<V.length;K++)for(var ne=V[K],J=0;J<ne.length;J++){var Y=ne[J];I=Math.min(I,Y.x),P=Math.max(P,Y.x),N=Math.min(N,Y.y),U=Math.max(U,Y.y)}return[I,N,P,U]},En.prototype.toGeoJSON=Mt.prototype.toGeoJSON;var yn=u.pbf,Kn=ht;function _n(V){var I=new yn;return function(P,N){for(var U in P.layers)N.writeMessage(3,ot,P.layers[U])}(V,I),I.finish()}function ot(V,I){var P;I.writeVarintField(15,V.version||1),I.writeStringField(1,V.name||""),I.writeVarintField(5,V.extent||4096);var N={keys:[],values:[],keycache:{},valuecache:{}};for(P=0;P<V.length;P++)N.feature=V.feature(P),I.writeMessage(2,Tn,N);var U=N.keys;for(P=0;P<U.length;P++)I.writeStringField(3,U[P]);var K=N.values;for(P=0;P<K.length;P++)I.writeMessage(4,qt,K[P])}function Tn(V,I){var P=V.feature;P.id!==void 0&&I.writeVarintField(1,P.id),I.writeMessage(2,Ne,V),I.writeVarintField(3,P.type),I.writeMessage(4,Pt,P)}function Ne(V,I){var P=V.feature,N=V.keys,U=V.values,K=V.keycache,ne=V.valuecache;for(var J in P.properties){var Y=P.properties[J],re=K[J];if(Y!==null){re===void 0&&(N.push(J),K[J]=re=N.length-1),I.writeVarint(re);var ge=typeof Y;ge!=="string"&&ge!=="boolean"&&ge!=="number"&&(Y=JSON.stringify(Y));var Ee=ge+":"+Y,me=ne[Ee];me===void 0&&(U.push(Y),ne[Ee]=me=U.length-1),I.writeVarint(me)}}}function st(V,I){return(I<<3)+(7&V)}function ut(V){return V<<1^V>>31}function Pt(V,I){for(var P=V.loadGeometry(),N=V.type,U=0,K=0,ne=P.length,J=0;J<ne;J++){var Y=P[J],re=1;N===1&&(re=Y.length),I.writeVarint(st(1,re));for(var ge=N===3?Y.length-1:Y.length,Ee=0;Ee<ge;Ee++){Ee===1&&N!==1&&I.writeVarint(st(2,ge-1));var me=Y[Ee].x-U,Ye=Y[Ee].y-K;I.writeVarint(ut(me)),I.writeVarint(ut(Ye)),U+=me,K+=Ye}N===3&&I.writeVarint(st(7,1))}}function qt(V,I){var P=typeof V;P==="string"?I.writeStringField(1,V):P==="boolean"?I.writeBooleanField(7,V):P==="number"&&(V%1!=0?I.writeDoubleField(3,V):V<0?I.writeSVarintField(6,V):I.writeVarintField(5,V))}function fr(V,I,P,N,U,K){if(U-N<=P)return;const ne=N+U>>1;Yn(V,I,ne,N,U,K%2),fr(V,I,P,N,ne-1,K+1),fr(V,I,P,ne+1,U,K+1)}function Yn(V,I,P,N,U,K){for(;U>N;){if(U-N>600){const re=U-N+1,ge=P-N+1,Ee=Math.log(re),me=.5*Math.exp(2*Ee/3),Ye=.5*Math.sqrt(Ee*me*(re-me)/re)*(ge-re/2<0?-1:1);Yn(V,I,P,Math.max(N,Math.floor(P-ge*me/re+Ye)),Math.min(U,Math.floor(P+(re-ge)*me/re+Ye)),K)}const ne=I[2*P+K];let J=N,Y=U;for(Jn(V,I,N,P),I[2*U+K]>ne&&Jn(V,I,N,U);J<Y;){for(Jn(V,I,J,Y),J++,Y--;I[2*J+K]<ne;)J++;for(;I[2*Y+K]>ne;)Y--}I[2*N+K]===ne?Jn(V,I,N,Y):(Y++,Jn(V,I,Y,U)),Y<=P&&(N=Y+1),P<=Y&&(U=Y-1)}}function Jn(V,I,P,N){pn(V,P,N),pn(I,2*P,2*N),pn(I,2*P+1,2*N+1)}function pn(V,I,P){const N=V[I];V[I]=V[P],V[P]=N}function sr(V,I,P,N){const U=V-P,K=I-N;return U*U+K*K}je.exports=_n,je.exports.fromVectorTileJs=_n,je.exports.fromGeojsonVt=function(V,I){I=I||{};var P={};for(var N in V)P[N]=new Kn(V[N].features,I),P[N].name=N,P[N].version=I.version,P[N].extent=I.extent;return _n({layers:P})},je.exports.GeoJSONWrapper=Kn;const Ut=V=>V[0],Rt=V=>V[1];class Kt{constructor(I,P=Ut,N=Rt,U=64,K=Float64Array){this.nodeSize=U,this.points=I;const ne=I.length<65536?Uint16Array:Uint32Array,J=this.ids=new ne(I.length),Y=this.coords=new K(2*I.length);for(let re=0;re<I.length;re++)J[re]=re,Y[2*re]=P(I[re]),Y[2*re+1]=N(I[re]);fr(J,Y,U,0,J.length-1,0)}range(I,P,N,U){return function(K,ne,J,Y,re,ge,Ee){const me=[0,K.length-1,0],Ye=[];let Qe,Ge;for(;me.length;){const at=me.pop(),ct=me.pop(),Ct=me.pop();if(ct-Ct<=Ee){for(let It=Ct;It<=ct;It++)Qe=ne[2*It],Ge=ne[2*It+1],Qe>=J&&Qe<=re&&Ge>=Y&&Ge<=ge&&Ye.push(K[It]);continue}const dt=Math.floor((Ct+ct)/2);Qe=ne[2*dt],Ge=ne[2*dt+1],Qe>=J&&Qe<=re&&Ge>=Y&&Ge<=ge&&Ye.push(K[dt]);const yt=(at+1)%2;(at===0?J<=Qe:Y<=Ge)&&(me.push(Ct),me.push(dt-1),me.push(yt)),(at===0?re>=Qe:ge>=Ge)&&(me.push(dt+1),me.push(ct),me.push(yt))}return Ye}(this.ids,this.coords,I,P,N,U,this.nodeSize)}within(I,P,N){return function(U,K,ne,J,Y,re){const ge=[0,U.length-1,0],Ee=[],me=Y*Y;for(;ge.length;){const Ye=ge.pop(),Qe=ge.pop(),Ge=ge.pop();if(Qe-Ge<=re){for(let yt=Ge;yt<=Qe;yt++)sr(K[2*yt],K[2*yt+1],ne,J)<=me&&Ee.push(U[yt]);continue}const at=Math.floor((Ge+Qe)/2),ct=K[2*at],Ct=K[2*at+1];sr(ct,Ct,ne,J)<=me&&Ee.push(U[at]);const dt=(Ye+1)%2;(Ye===0?ne-Y<=ct:J-Y<=Ct)&&(ge.push(Ge),ge.push(at-1),ge.push(dt)),(Ye===0?ne+Y>=ct:J+Y>=Ct)&&(ge.push(at+1),ge.push(Qe),ge.push(dt))}return Ee}(this.ids,this.coords,I,P,N,this.nodeSize)}}const un={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},Yt=Math.fround||(Mn=new Float32Array(1),V=>(Mn[0]=+V,Mn[0]));var Mn;class Nr{constructor(I){this.options=Ur(Object.create(un),I),this.trees=new Array(this.options.maxZoom+1)}load(I){const{log:P,minZoom:N,maxZoom:U,nodeSize:K}=this.options;P&&console.time("total time");const ne=`prepare ${I.length} points`;P&&console.time(ne),this.points=I;let J=[];for(let Y=0;Y<I.length;Y++)I[Y].geometry&&J.push(Yr(I[Y],Y));this.trees[U+1]=new Kt(J,As,ki,K,Float32Array),P&&console.timeEnd(ne);for(let Y=U;Y>=N;Y--){const re=+Date.now();J=this._cluster(J,Y),this.trees[Y]=new Kt(J,As,ki,K,Float32Array),P&&console.log("z%d: %d clusters in %dms",Y,J.length,+Date.now()-re)}return P&&console.timeEnd("total time"),this}getClusters(I,P){let N=((I[0]+180)%360+360)%360-180;const U=Math.max(-90,Math.min(90,I[1]));let K=I[2]===180?180:((I[2]+180)%360+360)%360-180;const ne=Math.max(-90,Math.min(90,I[3]));if(I[2]-I[0]>=360)N=-180,K=180;else if(N>K){const ge=this.getClusters([N,U,180,ne],P),Ee=this.getClusters([-180,U,K,ne],P);return ge.concat(Ee)}const J=this.trees[this._limitZoom(P)],Y=J.range(St(N),cn(ne),St(K),cn(U)),re=[];for(const ge of Y){const Ee=J.points[ge];re.push(Ee.numPoints?Ti(Ee):this.points[Ee.index])}return re}getChildren(I){const P=this._getOriginId(I),N=this._getOriginZoom(I),U="No cluster with the specified id.",K=this.trees[N];if(!K)throw new Error(U);const ne=K.points[P];if(!ne)throw new Error(U);const J=this.options.radius/(this.options.extent*Math.pow(2,N-1)),Y=K.within(ne.x,ne.y,J),re=[];for(const ge of Y){const Ee=K.points[ge];Ee.parentId===I&&re.push(Ee.numPoints?Ti(Ee):this.points[Ee.index])}if(re.length===0)throw new Error(U);return re}getLeaves(I,P,N){const U=[];return this._appendLeaves(U,I,P=P||10,N=N||0,0),U}getTile(I,P,N){const U=this.trees[this._limitZoom(I)],K=Math.pow(2,I),{extent:ne,radius:J}=this.options,Y=J/ne,re=(N-Y)/K,ge=(N+1+Y)/K,Ee={features:[]};return this._addTileFeatures(U.range((P-Y)/K,re,(P+1+Y)/K,ge),U.points,P,N,K,Ee),P===0&&this._addTileFeatures(U.range(1-Y/K,re,1,ge),U.points,K,N,K,Ee),P===K-1&&this._addTileFeatures(U.range(0,re,Y/K,ge),U.points,-1,N,K,Ee),Ee.features.length?Ee:null}getClusterExpansionZoom(I){let P=this._getOriginZoom(I)-1;for(;P<=this.options.maxZoom;){const N=this.getChildren(I);if(P++,N.length!==1)break;I=N[0].properties.cluster_id}return P}_appendLeaves(I,P,N,U,K){const ne=this.getChildren(P);for(const J of ne){const Y=J.properties;if(Y&&Y.cluster?K+Y.point_count<=U?K+=Y.point_count:K=this._appendLeaves(I,Y.cluster_id,N,U,K):K<U?K++:I.push(J),I.length===N)break}return K}_addTileFeatures(I,P,N,U,K,ne){for(const J of I){const Y=P[J],re=Y.numPoints;let ge,Ee,me;if(re)ge=qi(Y),Ee=Y.x,me=Y.y;else{const Ge=this.points[Y.index];ge=Ge.properties,Ee=St(Ge.geometry.coordinates[0]),me=cn(Ge.geometry.coordinates[1])}const Ye={type:1,geometry:[[Math.round(this.options.extent*(Ee*K-N)),Math.round(this.options.extent*(me*K-U))]],tags:ge};let Qe;re?Qe=Y.id:this.options.generateId?Qe=Y.index:this.points[Y.index].id&&(Qe=this.points[Y.index].id),Qe!==void 0&&(Ye.id=Qe),ne.features.push(Ye)}}_limitZoom(I){return Math.max(this.options.minZoom,Math.min(Math.floor(+I),this.options.maxZoom+1))}_cluster(I,P){const N=[],{radius:U,extent:K,reduce:ne,minPoints:J}=this.options,Y=U/(K*Math.pow(2,P));for(let re=0;re<I.length;re++){const ge=I[re];if(ge.zoom<=P)continue;ge.zoom=P;const Ee=this.trees[P+1],me=Ee.within(ge.x,ge.y,Y),Ye=ge.numPoints||1;let Qe=Ye;for(const Ge of me){const at=Ee.points[Ge];at.zoom>P&&(Qe+=at.numPoints||1)}if(Qe>Ye&&Qe>=J){let Ge=ge.x*Ye,at=ge.y*Ye,ct=ne&&Ye>1?this._map(ge,!0):null;const Ct=(re<<5)+(P+1)+this.points.length;for(const dt of me){const yt=Ee.points[dt];if(yt.zoom<=P)continue;yt.zoom=P;const It=yt.numPoints||1;Ge+=yt.x*It,at+=yt.y*It,yt.parentId=Ct,ne&&(ct||(ct=this._map(ge,!0)),ne(ct,this._map(yt)))}ge.parentId=Ct,N.push(mr(Ge/Qe,at/Qe,Ct,Qe,ct))}else if(N.push(ge),Qe>1)for(const Ge of me){const at=Ee.points[Ge];at.zoom<=P||(at.zoom=P,N.push(at))}}return N}_getOriginId(I){return I-this.points.length>>5}_getOriginZoom(I){return(I-this.points.length)%32}_map(I,P){if(I.numPoints)return P?Ur({},I.properties):I.properties;const N=this.points[I.index].properties,U=this.options.map(N);return P&&U===N?Ur({},U):U}}function mr(V,I,P,N,U){return{x:Yt(V),y:Yt(I),zoom:1/0,id:P,parentId:-1,numPoints:N,properties:U}}function Yr(V,I){const[P,N]=V.geometry.coordinates;return{x:Yt(St(P)),y:Yt(cn(N)),zoom:1/0,index:I,parentId:-1}}function Ti(V){return{type:"Feature",id:V.id,properties:qi(V),geometry:{type:"Point",coordinates:[(I=V.x,360*(I-.5)),Bn(V.y)]}};var I}function qi(V){const I=V.numPoints,P=I>=1e4?`${Math.round(I/1e3)}k`:I>=1e3?Math.round(I/100)/10+"k":I;return Ur(Ur({},V.properties),{cluster:!0,cluster_id:V.id,point_count:I,point_count_abbreviated:P})}function St(V){return V/360+.5}function cn(V){const I=Math.sin(V*Math.PI/180),P=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return P<0?0:P>1?1:P}function Bn(V){const I=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(I))/Math.PI-90}function Ur(V,I){for(const P in I)V[P]=I[P];return V}function As(V){return V.x}function ki(V){return V.y}function Ci(V,I,P,N){for(var U,K=N,ne=P-I>>1,J=P-I,Y=V[I],re=V[I+1],ge=V[P],Ee=V[P+1],me=I+3;me<P;me+=3){var Ye=Uo(V[me],V[me+1],Y,re,ge,Ee);if(Ye>K)U=me,K=Ye;else if(Ye===K){var Qe=Math.abs(me-ne);Qe<J&&(U=me,J=Qe)}}K>N&&(U-I>3&&Ci(V,I,U,N),V[U+2]=K,P-U>3&&Ci(V,U,P,N))}function Uo(V,I,P,N,U,K){var ne=U-P,J=K-N;if(ne!==0||J!==0){var Y=((V-P)*ne+(I-N)*J)/(ne*ne+J*J);Y>1?(P=U,N=K):Y>0&&(P+=ne*Y,N+=J*Y)}return(ne=V-P)*ne+(J=I-N)*J}function Ii(V,I,P,N){var U={id:V===void 0?null:V,type:I,geometry:P,tags:N,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(K){var ne=K.geometry,J=K.type;if(J==="Point"||J==="MultiPoint"||J==="LineString")xe(K,ne);else if(J==="Polygon"||J==="MultiLineString")for(var Y=0;Y<ne.length;Y++)xe(K,ne[Y]);else if(J==="MultiPolygon")for(Y=0;Y<ne.length;Y++)for(var re=0;re<ne[Y].length;re++)xe(K,ne[Y][re])}(U),U}function xe(V,I){for(var P=0;P<I.length;P+=3)V.minX=Math.min(V.minX,I[P]),V.minY=Math.min(V.minY,I[P+1]),V.maxX=Math.max(V.maxX,I[P]),V.maxY=Math.max(V.maxY,I[P+1])}function Fe(V,I,P,N){if(I.geometry){var U=I.geometry.coordinates,K=I.geometry.type,ne=Math.pow(P.tolerance/((1<<P.maxZoom)*P.extent),2),J=[],Y=I.id;if(P.promoteId?Y=I.properties[P.promoteId]:P.generateId&&(Y=N||0),K==="Point")uo(U,J);else if(K==="MultiPoint")for(var re=0;re<U.length;re++)uo(U[re],J);else if(K==="LineString")Jr(U,J,ne,!1);else if(K==="MultiLineString"){if(P.lineMetrics){for(re=0;re<U.length;re++)Jr(U[re],J=[],ne,!1),V.push(Ii(Y,"LineString",J,I.properties));return}kt(U,J,ne,!1)}else if(K==="Polygon")kt(U,J,ne,!0);else{if(K!=="MultiPolygon"){if(K==="GeometryCollection"){for(re=0;re<I.geometry.geometries.length;re++)Fe(V,{id:Y,geometry:I.geometry.geometries[re],properties:I.properties},P,N);return}throw new Error("Input data is not a valid GeoJSON object.")}for(re=0;re<U.length;re++){var ge=[];kt(U[re],ge,ne,!0),J.push(ge)}}V.push(Ii(Y,K,J,I.properties))}}function uo(V,I){I.push(Vr(V[0])),I.push(Tr(V[1])),I.push(0)}function Jr(V,I,P,N){for(var U,K,ne=0,J=0;J<V.length;J++){var Y=Vr(V[J][0]),re=Tr(V[J][1]);I.push(Y),I.push(re),I.push(0),J>0&&(ne+=N?(U*re-Y*K)/2:Math.sqrt(Math.pow(Y-U,2)+Math.pow(re-K,2))),U=Y,K=re}var ge=I.length-3;I[2]=1,Ci(I,0,ge,P),I[ge+2]=1,I.size=Math.abs(ne),I.start=0,I.end=I.size}function kt(V,I,P,N){for(var U=0;U<V.length;U++){var K=[];Jr(V[U],K,P,N),I.push(K)}}function Vr(V){return V/360+.5}function Tr(V){var I=Math.sin(V*Math.PI/180),P=.5-.25*Math.log((1+I)/(1-I))/Math.PI;return P<0?0:P>1?1:P}function kr(V,I,P,N,U,K,ne,J){if(N/=I,K>=(P/=I)&&ne<N)return V;if(ne<P||K>=N)return null;for(var Y=[],re=0;re<V.length;re++){var ge=V[re],Ee=ge.geometry,me=ge.type,Ye=U===0?ge.minX:ge.minY,Qe=U===0?ge.maxX:ge.maxY;if(Ye>=P&&Qe<N)Y.push(ge);else if(!(Qe<P||Ye>=N)){var Ge=[];if(me==="Point"||me==="MultiPoint")Wi(Ee,Ge,P,N,U);else if(me==="LineString")Le(Ee,Ge,P,N,U,!1,J.lineMetrics);else if(me==="MultiLineString")ft(Ee,Ge,P,N,U,!1);else if(me==="Polygon")ft(Ee,Ge,P,N,U,!0);else if(me==="MultiPolygon")for(var at=0;at<Ee.length;at++){var ct=[];ft(Ee[at],ct,P,N,U,!0),ct.length&&Ge.push(ct)}if(Ge.length){if(J.lineMetrics&&me==="LineString"){for(at=0;at<Ge.length;at++)Y.push(Ii(ge.id,me,Ge[at],ge.tags));continue}me!=="LineString"&&me!=="MultiLineString"||(Ge.length===1?(me="LineString",Ge=Ge[0]):me="MultiLineString"),me!=="Point"&&me!=="MultiPoint"||(me=Ge.length===3?"Point":"MultiPoint"),Y.push(Ii(ge.id,me,Ge,ge.tags))}}}return Y.length?Y:null}function Wi(V,I,P,N,U){for(var K=0;K<V.length;K+=3){var ne=V[K+U];ne>=P&&ne<=N&&(I.push(V[K]),I.push(V[K+1]),I.push(V[K+2]))}}function Le(V,I,P,N,U,K,ne){for(var J,Y,re=gt(V),ge=U===0?Xi:pt,Ee=V.start,me=0;me<V.length-3;me+=3){var Ye=V[me],Qe=V[me+1],Ge=V[me+2],at=V[me+3],ct=V[me+4],Ct=U===0?Ye:Qe,dt=U===0?at:ct,yt=!1;ne&&(J=Math.sqrt(Math.pow(Ye-at,2)+Math.pow(Qe-ct,2))),Ct<P?dt>P&&(Y=ge(re,Ye,Qe,at,ct,P),ne&&(re.start=Ee+J*Y)):Ct>N?dt<N&&(Y=ge(re,Ye,Qe,at,ct,N),ne&&(re.start=Ee+J*Y)):Zn(re,Ye,Qe,Ge),dt<P&&Ct>=P&&(Y=ge(re,Ye,Qe,at,ct,P),yt=!0),dt>N&&Ct<=N&&(Y=ge(re,Ye,Qe,at,ct,N),yt=!0),!K&&yt&&(ne&&(re.end=Ee+J*Y),I.push(re),re=gt(V)),ne&&(Ee+=J)}var It=V.length-3;Ye=V[It],Qe=V[It+1],Ge=V[It+2],(Ct=U===0?Ye:Qe)>=P&&Ct<=N&&Zn(re,Ye,Qe,Ge),It=re.length-3,K&&It>=3&&(re[It]!==re[0]||re[It+1]!==re[1])&&Zn(re,re[0],re[1],re[2]),re.length&&I.push(re)}function gt(V){var I=[];return I.size=V.size,I.start=V.start,I.end=V.end,I}function ft(V,I,P,N,U,K){for(var ne=0;ne<V.length;ne++)Le(V[ne],I,P,N,U,K,!1)}function Zn(V,I,P,N){V.push(I),V.push(P),V.push(N)}function Xi(V,I,P,N,U,K){var ne=(K-I)/(N-I);return V.push(K),V.push(P+(U-P)*ne),V.push(1),ne}function pt(V,I,P,N,U,K){var ne=(K-P)/(U-P);return V.push(I+(N-I)*ne),V.push(K),V.push(1),ne}function zi(V,I){for(var P=[],N=0;N<V.length;N++){var U,K=V[N],ne=K.type;if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")U=Fn(K.geometry,I);else if(ne==="MultiLineString"||ne==="Polygon"){U=[];for(var J=0;J<K.geometry.length;J++)U.push(Fn(K.geometry[J],I))}else if(ne==="MultiPolygon")for(U=[],J=0;J<K.geometry.length;J++){for(var Y=[],re=0;re<K.geometry[J].length;re++)Y.push(Fn(K.geometry[J][re],I));U.push(Y)}P.push(Ii(K.id,ne,U,K.tags))}return P}function Fn(V,I){var P=[];P.size=V.size,V.start!==void 0&&(P.start=V.start,P.end=V.end);for(var N=0;N<V.length;N+=3)P.push(V[N]+I,V[N+1],V[N+2]);return P}function Vo(V,I){if(V.transformed)return V;var P,N,U,K=1<<V.z,ne=V.x,J=V.y;for(P=0;P<V.features.length;P++){var Y=V.features[P],re=Y.geometry,ge=Y.type;if(Y.geometry=[],ge===1)for(N=0;N<re.length;N+=2)Y.geometry.push(kn(re[N],re[N+1],I,K,ne,J));else for(N=0;N<re.length;N++){var Ee=[];for(U=0;U<re[N].length;U+=2)Ee.push(kn(re[N][U],re[N][U+1],I,K,ne,J));Y.geometry.push(Ee)}}return V.transformed=!0,V}function kn(V,I,P,N,U,K){return[Math.round(P*(V*N-U)),Math.round(P*(I*N-K))]}function ar(V,I,P,N,U){for(var K=I===U.maxZoom?0:U.tolerance/((1<<I)*U.extent),ne={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:P,y:N,z:I,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},J=0;J<V.length;J++){ne.numFeatures++,Vt(ne,V[J],K,U);var Y=V[J].minX,re=V[J].minY,ge=V[J].maxX,Ee=V[J].maxY;Y<ne.minX&&(ne.minX=Y),re<ne.minY&&(ne.minY=re),ge>ne.maxX&&(ne.maxX=ge),Ee>ne.maxY&&(ne.maxY=Ee)}return ne}function Vt(V,I,P,N){var U=I.geometry,K=I.type,ne=[];if(K==="Point"||K==="MultiPoint")for(var J=0;J<U.length;J+=3)ne.push(U[J]),ne.push(U[J+1]),V.numPoints++,V.numSimplified++;else if(K==="LineString")$o(ne,U,V,P,!1,!1);else if(K==="MultiLineString"||K==="Polygon")for(J=0;J<U.length;J++)$o(ne,U[J],V,P,K==="Polygon",J===0);else if(K==="MultiPolygon")for(var Y=0;Y<U.length;Y++){var re=U[Y];for(J=0;J<re.length;J++)$o(ne,re[J],V,P,!0,J===0)}if(ne.length){var ge=I.tags||null;if(K==="LineString"&&N.lineMetrics){for(var Ee in ge={},I.tags)ge[Ee]=I.tags[Ee];ge.mapbox_clip_start=U.start/U.size,ge.mapbox_clip_end=U.end/U.size}var me={geometry:ne,type:K==="Polygon"||K==="MultiPolygon"?3:K==="LineString"||K==="MultiLineString"?2:1,tags:ge};I.id!==null&&(me.id=I.id),V.features.push(me)}}function $o(V,I,P,N,U,K){var ne=N*N;if(N>0&&I.size<(U?ne:N))P.numPoints+=I.length/3;else{for(var J=[],Y=0;Y<I.length;Y+=3)(N===0||I[Y+2]>ne)&&(P.numSimplified++,J.push(I[Y]),J.push(I[Y+1])),P.numPoints++;U&&function(re,ge){for(var Ee=0,me=0,Ye=re.length,Qe=Ye-2;me<Ye;Qe=me,me+=2)Ee+=(re[me]-re[Qe])*(re[me+1]+re[Qe+1]);if(Ee>0===ge)for(me=0,Ye=re.length;me<Ye/2;me+=2){var Ge=re[me],at=re[me+1];re[me]=re[Ye-2-me],re[me+1]=re[Ye-1-me],re[Ye-2-me]=Ge,re[Ye-1-me]=at}}(J,K),V.push(J)}}function hi(V,I){var P=(I=this.options=function(U,K){for(var ne in K)U[ne]=K[ne];return U}(Object.create(this.options),I)).debug;if(P&&console.time("preprocess data"),I.maxZoom<0||I.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(I.promoteId&&I.generateId)throw new Error("promoteId and generateId cannot be used together.");var N=function(U,K){var ne=[];if(U.type==="FeatureCollection")for(var J=0;J<U.features.length;J++)Fe(ne,U.features[J],K,J);else Fe(ne,U.type==="Feature"?U:{geometry:U},K);return ne}(V,I);this.tiles={},this.tileCoords=[],P&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",I.indexMaxZoom,I.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),N=function(U,K){var ne=K.buffer/K.extent,J=U,Y=kr(U,1,-1-ne,ne,0,-1,2,K),re=kr(U,1,1-ne,2+ne,0,-1,2,K);return(Y||re)&&(J=kr(U,1,-ne,1+ne,0,-1,2,K)||[],Y&&(J=zi(Y,1).concat(J)),re&&(J=J.concat(zi(re,-1)))),J}(N,I),N.length&&this.splitTile(N,0,0,0),P&&(N.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function co(V,I,P){return 32*((1<<V)*P+I)+V}function ho(V,I){const P=V.tileID.canonical;if(!this._geoJSONIndex)return I(null,null);const N=this._geoJSONIndex.getTile(P.z,P.x,P.y);if(!N)return I(null,null);const U=new ze(N.features);let K=je.exports(U);K.byteOffset===0&&K.byteLength===K.buffer.byteLength||(K=new Uint8Array(K)),I(null,{vectorTile:U,rawData:K.buffer})}hi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},hi.prototype.splitTile=function(V,I,P,N,U,K,ne){for(var J=[V,I,P,N],Y=this.options,re=Y.debug;J.length;){N=J.pop(),P=J.pop(),I=J.pop(),V=J.pop();var ge=1<<I,Ee=co(I,P,N),me=this.tiles[Ee];if(!me&&(re>1&&console.time("creation"),me=this.tiles[Ee]=ar(V,I,P,N,Y),this.tileCoords.push({z:I,x:P,y:N}),re)){re>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",I,P,N,me.numFeatures,me.numPoints,me.numSimplified),console.timeEnd("creation"));var Ye="z"+I;this.stats[Ye]=(this.stats[Ye]||0)+1,this.total++}if(me.source=V,U){if(I===Y.maxZoom||I===U)continue;var Qe=1<<U-I;if(P!==Math.floor(K/Qe)||N!==Math.floor(ne/Qe))continue}else if(I===Y.indexMaxZoom||me.numPoints<=Y.indexMaxPoints)continue;if(me.source=null,V.length!==0){re>1&&console.time("clipping");var Ge,at,ct,Ct,dt,yt,It=.5*Y.buffer/Y.extent,jt=.5-It,On=.5+It,en=1+It;Ge=at=ct=Ct=null,dt=kr(V,ge,P-It,P+On,0,me.minX,me.maxX,Y),yt=kr(V,ge,P+jt,P+en,0,me.minX,me.maxX,Y),V=null,dt&&(Ge=kr(dt,ge,N-It,N+On,1,me.minY,me.maxY,Y),at=kr(dt,ge,N+jt,N+en,1,me.minY,me.maxY,Y),dt=null),yt&&(ct=kr(yt,ge,N-It,N+On,1,me.minY,me.maxY,Y),Ct=kr(yt,ge,N+jt,N+en,1,me.minY,me.maxY,Y),yt=null),re>1&&console.timeEnd("clipping"),J.push(Ge||[],I+1,2*P,2*N),J.push(at||[],I+1,2*P,2*N+1),J.push(ct||[],I+1,2*P+1,2*N),J.push(Ct||[],I+1,2*P+1,2*N+1)}}},hi.prototype.getTile=function(V,I,P){var N=this.options,U=N.extent,K=N.debug;if(V<0||V>24)return null;var ne=1<<V,J=co(V,I=(I%ne+ne)%ne,P);if(this.tiles[J])return Vo(this.tiles[J],U);K>1&&console.log("drilling down to z%d-%d-%d",V,I,P);for(var Y,re=V,ge=I,Ee=P;!Y&&re>0;)re--,ge=Math.floor(ge/2),Ee=Math.floor(Ee/2),Y=this.tiles[co(re,ge,Ee)];return Y&&Y.source?(K>1&&console.log("found parent tile z%d-%d-%d",re,ge,Ee),K>1&&console.time("drilling down"),this.splitTile(Y.source,re,ge,Ee,V,I,P),K>1&&console.timeEnd("drilling down"),this.tiles[J]?Vo(this.tiles[J],U):null):null};class jo extends we{constructor(I,P,N,U){super(I,P,N,ho),U&&(this.loadGeoJSON=U)}loadData(I,P){var N;(N=this._pendingRequest)===null||N===void 0||N.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const U=!!(I&&I.request&&I.request.collectResourceTiming)&&new u.RequestPerformance(I.request);this._pendingCallback=P,this._pendingRequest=this.loadGeoJSON(I,(K,ne)=>{if(delete this._pendingCallback,delete this._pendingRequest,K||!ne)return P(K);if(typeof ne!="object")return P(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`));{se(ne,!0);try{if(I.filter){const Y=u.createExpression(I.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Y.result==="error")throw new Error(Y.value.map(ge=>`${ge.key}: ${ge.message}`).join(", "));ne={type:"FeatureCollection",features:ne.features.filter(ge=>Y.value.evaluate({zoom:0},ge))}}this._geoJSONIndex=I.cluster?new Nr(function({superclusterOptions:Y,clusterProperties:re}){if(!re||!Y)return Y;const ge={},Ee={},me={accumulated:null,zoom:0},Ye={properties:null},Qe=Object.keys(re);for(const Ge of Qe){const[at,ct]=re[Ge],Ct=u.createExpression(ct),dt=u.createExpression(typeof at=="string"?[at,["accumulated"],["get",Ge]]:at);ge[Ge]=Ct.value,Ee[Ge]=dt.value}return Y.map=Ge=>{Ye.properties=Ge;const at={};for(const ct of Qe)at[ct]=ge[ct].evaluate(me,Ye);return at},Y.reduce=(Ge,at)=>{Ye.properties=at;for(const ct of Qe)me.accumulated=Ge[ct],Ge[ct]=Ee[ct].evaluate(me,Ye)},Y}(I)).load(ne.features):function(Y,re){return new hi(Y,re)}(ne,I.geojsonVtOptions)}catch(Y){return P(Y)}this.loaded={};const J={};if(U){const Y=U.finish();Y&&(J.resourceTiming={},J.resourceTiming[I.source]=JSON.parse(JSON.stringify(Y)))}P(null,J)}})}reloadTile(I,P){const N=this.loaded;return N&&N[I.uid]?super.reloadTile(I,P):this.loadTile(I,P)}loadGeoJSON(I,P){if(I.request)return u.getJSON(I.request,P);if(typeof I.data=="string")try{P(null,JSON.parse(I.data))}catch{P(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`))}else P(new Error(`Input data given to '${I.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}}removeSource(I,P){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),P()}getClusterExpansionZoom(I,P){try{P(null,this._geoJSONIndex.getClusterExpansionZoom(I.clusterId))}catch(N){P(N)}}getClusterChildren(I,P){try{P(null,this._geoJSONIndex.getChildren(I.clusterId))}catch(N){P(N)}}getClusterLeaves(I,P){try{P(null,this._geoJSONIndex.getLeaves(I.clusterId,I.limit,I.offset))}catch(N){P(N)}}}class po{constructor(I){this.self=I,this.actor=new u.Actor(I,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:we,geojson:jo},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(P,N)=>{if(this.workerSourceTypes[P])throw new Error(`Worker source with name "${P}" already registered.`);this.workerSourceTypes[P]=N},this.self.registerRTLTextPlugin=P=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=P.applyArabicShaping,u.plugin.processBidirectionalText=P.processBidirectionalText,u.plugin.processStyledBidirectionalText=P.processStyledBidirectionalText}}setReferrer(I,P){this.referrer=P}setImages(I,P,N){this.availableImages[I]=P;for(const U in this.workerSources[I]){const K=this.workerSources[I][U];for(const ne in K)K[ne].availableImages=P}N()}setLayers(I,P,N){this.getLayerIndex(I).replace(P),N()}updateLayers(I,P,N){this.getLayerIndex(I).update(P.layers,P.removedIds),N()}loadTile(I,P,N){this.getWorkerSource(I,P.type,P.source).loadTile(P,N)}loadDEMTile(I,P,N){this.getDEMWorkerSource(I,P.source).loadTile(P,N)}reloadTile(I,P,N){this.getWorkerSource(I,P.type,P.source).reloadTile(P,N)}abortTile(I,P,N){this.getWorkerSource(I,P.type,P.source).abortTile(P,N)}removeTile(I,P,N){this.getWorkerSource(I,P.type,P.source).removeTile(P,N)}removeDEMTile(I,P){this.getDEMWorkerSource(I,P.source).removeTile(P)}removeSource(I,P,N){if(!this.workerSources[I]||!this.workerSources[I][P.type]||!this.workerSources[I][P.type][P.source])return;const U=this.workerSources[I][P.type][P.source];delete this.workerSources[I][P.type][P.source],U.removeSource!==void 0?U.removeSource(P,N):N()}loadWorkerSource(I,P,N){try{this.self.importScripts(P.url),N()}catch(U){N(U.toString())}}syncRTLPluginState(I,P,N){try{u.plugin.setState(P);const U=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&U!=null){this.self.importScripts(U);const K=u.plugin.isParsed();N(K?void 0:new Error(`RTL Text Plugin failed to import scripts from ${U}`),K)}}catch(U){N(U.toString())}}getAvailableImages(I){let P=this.availableImages[I];return P||(P=[]),P}getLayerIndex(I){let P=this.layerIndexes[I];return P||(P=this.layerIndexes[I]=new ue),P}getWorkerSource(I,P,N){if(this.workerSources[I]||(this.workerSources[I]={}),this.workerSources[I][P]||(this.workerSources[I][P]={}),!this.workerSources[I][P][N]){const U={send:(K,ne,J)=>{this.actor.send(K,ne,J,I)}};this.workerSources[I][P][N]=new this.workerSourceTypes[P](U,this.getLayerIndex(I),this.getAvailableImages(I))}return this.workerSources[I][P][N]}getDEMWorkerSource(I,P){return this.demWorkerSources[I]||(this.demWorkerSources[I]={}),this.demWorkerSources[I][P]||(this.demWorkerSources[I][P]=new xt),this.demWorkerSources[I][P]}enforceCacheSizeLimit(I,P){u.enforceCacheSizeLimit(P)}}return u.isWorker()&&(self.worker=new po(self)),po}),v(["./shared"],function(u){var O=Z;function Z(h){return!function(t){return typeof window>"u"||typeof document>"u"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var c,p,g=new Blob([""],{type:"text/javascript"}),x=URL.createObjectURL(g);try{p=new Worker(x),c=!0}catch{c=!1}return p&&p.terminate(),URL.revokeObjectURL(x),c}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var c=document.createElement("canvas");c.width=c.height=1;var p=c.getContext("2d");if(!p)return!1;var g=p.getImageData(0,0,1,1);return g&&g.width===c.width}()?(ue[s=t&&t.failIfMajorPerformanceCaveat]===void 0&&(ue[s]=function(c){var p,g=function(x){var S=document.createElement("canvas"),E=Object.create(Z.webGLContextAttributes);return E.failIfMajorPerformanceCaveat=x,S.getContext("webgl",E)||S.getContext("experimental-webgl",E)}(c);if(!g)return!1;try{p=g.createShader(g.VERTEX_SHADER)}catch{return!1}return!(!p||g.isContextLost())&&(g.shaderSource(p,"void main() {}"),g.compileShader(p),g.getShaderParameter(p,g.COMPILE_STATUS)===!0)}(s)),ue[s]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var s}(h)}var ue={};function te(h,t){if(Array.isArray(h)){if(!Array.isArray(t)||h.length!==t.length)return!1;for(let s=0;s<h.length;s++)if(!te(h[s],t[s]))return!1;return!0}if(typeof h=="object"&&h!==null&&t!==null){if(typeof t!="object"||Object.keys(h).length!==Object.keys(t).length)return!1;for(const s in h)if(!te(h[s],t[s]))return!1;return!0}return h===t}Z.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};class q{static testProp(t){if(!q.docStyle)return t[0];for(let s=0;s<t.length;s++)if(t[s]in q.docStyle)return t[s];return t[0]}static create(t,s,c){const p=window.document.createElement(t);return s!==void 0&&(p.className=s),c&&c.appendChild(p),p}static createNS(t,s){return window.document.createElementNS(t,s)}static disableDrag(){q.docStyle&&q.selectProp&&(q.userSelect=q.docStyle[q.selectProp],q.docStyle[q.selectProp]="none")}static enableDrag(){q.docStyle&&q.selectProp&&(q.docStyle[q.selectProp]=q.userSelect)}static setTransform(t,s){t.style[q.transformProp]=s}static addEventListener(t,s,c,p={}){t.addEventListener(s,c,"passive"in p?p:p.capture)}static removeEventListener(t,s,c,p={}){t.removeEventListener(s,c,"passive"in p?p:p.capture)}static suppressClickInternal(t){t.preventDefault(),t.stopPropagation(),window.removeEventListener("click",q.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",q.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",q.suppressClickInternal,!0)},0)}static mousePos(t,s){const c=t.getBoundingClientRect();return new u.pointGeometry(s.clientX-c.left-t.clientLeft,s.clientY-c.top-t.clientTop)}static touchPos(t,s){const c=t.getBoundingClientRect(),p=[];for(let g=0;g<s.length;g++)p.push(new u.pointGeometry(s[g].clientX-c.left-t.clientLeft,s[g].clientY-c.top-t.clientTop));return p}static mouseButton(t){return t.button}static remove(t){t.parentNode&&t.parentNode.removeChild(t)}}q.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,q.selectProp=q.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),q.transformProp=q.testProp(["transform","WebkitTransform"]);class Ae{constructor(t){this._transformRequestFn=t}transformRequest(t,s){return this._transformRequestFn&&this._transformRequestFn(t,s)||{url:t}}normalizeSpriteURL(t,s,c){const p=function(g){const x=g.match(Ce);if(!x)throw new Error(`Unable to parse URL "${g}"`);return{protocol:x[1],authority:x[2],path:x[3]||"/",params:x[4]?x[4].split("&"):[]}}(t);return p.path+=`${s}${c}`,function(g){const x=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${x}`}(p)}setTransformRequest(t){this._transformRequestFn=t}}const Ce=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;class we{constructor(t,s,c,p){this.context=t,this.format=c,this.texture=t.gl.createTexture(),this.update(s,p)}update(t,s,c){const{width:p,height:g}=t,x=!(this.size&&this.size[0]===p&&this.size[1]===g||c),{context:S}=this,{gl:E}=S;if(this.useMipmap=Boolean(s&&s.useMipmap),E.bindTexture(E.TEXTURE_2D,this.texture),S.pixelStoreUnpackFlipY.set(!1),S.pixelStoreUnpack.set(1),S.pixelStoreUnpackPremultiplyAlpha.set(this.format===E.RGBA&&(!s||s.premultiply!==!1)),x)this.size=[p,g],t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.isImageBitmap(t)?E.texImage2D(E.TEXTURE_2D,0,this.format,this.format,E.UNSIGNED_BYTE,t):E.texImage2D(E.TEXTURE_2D,0,this.format,p,g,0,this.format,E.UNSIGNED_BYTE,t.data);else{const{x:k,y:A}=c||{x:0,y:0};t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||u.isImageBitmap(t)?E.texSubImage2D(E.TEXTURE_2D,0,k,A,E.RGBA,E.UNSIGNED_BYTE,t):E.texSubImage2D(E.TEXTURE_2D,0,k,A,p,g,E.RGBA,E.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&E.generateMipmap(E.TEXTURE_2D)}bind(t,s,c){const{context:p}=this,{gl:g}=p;g.bindTexture(g.TEXTURE_2D,this.texture),c!==g.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=g.LINEAR),t!==this.filter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,c||t),this.filter=t),s!==this.wrap&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,s),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,s),this.wrap=s)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}function xt(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class se extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:s,callback:c}of this.requestors)this._notify(s,c);this.requestors=[]}}getImage(t){return this.images[t]}addImage(t,s){if(this.images[t])throw new Error(`Image id ${t} already exist, use updateImage instead`);this._validate(t,s)&&(this.images[t]=s)}_validate(t,s){let c=!0;return this._validateStretch(s.stretchX,s.data&&s.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchX" value`))),c=!1),this._validateStretch(s.stretchY,s.data&&s.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "stretchY" value`))),c=!1),this._validateContent(s.content,s)||(this.fire(new u.ErrorEvent(new Error(`Image "${t}" has invalid "content" value`))),c=!1),c}_validateStretch(t,s){if(!t)return!0;let c=0;for(const p of t){if(p[0]<c||p[1]<p[0]||s<p[1])return!1;c=p[1]}return!0}_validateContent(t,s){return!(t&&(t.length!==4||t[0]<0||s.data.width<t[0]||t[1]<0||s.data.height<t[1]||t[2]<0||s.data.width<t[2]||t[3]<0||s.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,s){const c=this.images[t];if(c.data.width!==s.data.width||c.data.height!==s.data.height)throw new Error(`size mismatch between old image (${c.data.width}x${c.data.height}) and new image (${s.data.width}x${s.data.height}).`);s.version=c.version+1,this.images[t]=s,this.updatedImages[t]=!0}removeImage(t){const s=this.images[t];delete this.images[t],delete this.patterns[t],s.userImage&&s.userImage.onRemove&&s.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,s){let c=!0;if(!this.isLoaded())for(const p of t)this.images[p]||(c=!1);this.isLoaded()||c?this._notify(t,s):this.requestors.push({ids:t,callback:s})}_notify(t,s){const c={};for(const p of t){this.images[p]||this.fire(new u.Event("styleimagemissing",{id:p}));const g=this.images[p];g?c[p]={data:g.data.clone(),pixelRatio:g.pixelRatio,sdf:g.sdf,version:g.version,stretchX:g.stretchX,stretchY:g.stretchY,content:g.content,hasRenderCallback:Boolean(g.userImage&&g.userImage.render)}:u.warnOnce(`Image "${p}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}s(null,c)}getPixelSize(){const{width:t,height:s}=this.atlasImage;return{width:t,height:s}}getPattern(t){const s=this.patterns[t],c=this.getImage(t);if(!c)return null;if(s&&s.position.version===c.version)return s.position;if(s)s.position.version=c.version;else{const p={w:c.data.width+2,h:c.data.height+2,x:0,y:0},g=new u.ImagePosition(p,c);this.patterns[t]={bin:p,position:g}}return this._updatePatternAtlas(),this.patterns[t].position}bind(t){const s=t.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new we(t,this.atlasImage,s.RGBA),this.atlasTexture.bind(s.LINEAR,s.CLAMP_TO_EDGE)}_updatePatternAtlas(){const t=[];for(const g in this.patterns)t.push(this.patterns[g].bin);const{w:s,h:c}=u.potpack(t),p=this.atlasImage;p.resize({width:s||1,height:c||1});for(const g in this.patterns){const{bin:x}=this.patterns[g],S=x.x+1,E=x.y+1,k=this.images[g].data,A=k.width,D=k.height;u.RGBAImage.copy(k,p,{x:0,y:0},{x:S,y:E},{width:A,height:D}),u.RGBAImage.copy(k,p,{x:0,y:D-1},{x:S,y:E-1},{width:A,height:1}),u.RGBAImage.copy(k,p,{x:0,y:0},{x:S,y:E+D},{width:A,height:1}),u.RGBAImage.copy(k,p,{x:A-1,y:0},{x:S-1,y:E},{width:1,height:D}),u.RGBAImage.copy(k,p,{x:0,y:0},{x:S+A,y:E},{width:1,height:D})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const s of t){if(this.callbackDispatchedThisFrame[s])continue;this.callbackDispatchedThisFrame[s]=!0;const c=this.images[s];c||u.warnOnce(`Image with ID: "${s}" was not found`),xt(c)&&this.updateImage(s,c)}}}const Q=1e20;function ae(h,t,s,c,p,g,x,S,E){for(let k=t;k<t+c;k++)ke(h,s*g+k,g,p,x,S,E);for(let k=s;k<s+p;k++)ke(h,k*g+t,1,c,x,S,E)}function ke(h,t,s,c,p,g,x){g[0]=0,x[0]=-Q,x[1]=Q,p[0]=h[t];for(let S=1,E=0,k=0;S<c;S++){p[S]=h[t+S*s];const A=S*S;do{const D=g[E];k=(p[S]-p[D]+A-D*D)/(S-D)/2}while(k<=x[E]&&--E>-1);E++,g[E]=S,x[E]=k,x[E+1]=Q}for(let S=0,E=0;S<c;S++){for(;x[E+1]<S;)E++;const k=g[E],A=S-k;h[t+S*s]=p[k]+A*A}}class Me{constructor(t,s){this.requestManager=t,this.localIdeographFontFamily=s,this.entries={}}setURL(t){this.url=t}getGlyphs(t,s){const c=[];for(const p in t)for(const g of t[p])c.push({stack:p,id:g});u.asyncAll(c,({stack:p,id:g},x)=>{let S=this.entries[p];S||(S=this.entries[p]={glyphs:{},requests:{},ranges:{}});let E=S.glyphs[g];if(E!==void 0)return void x(null,{stack:p,id:g,glyph:E});if(E=this._tinySDF(S,p,g),E)return S.glyphs[g]=E,void x(null,{stack:p,id:g,glyph:E});const k=Math.floor(g/256);if(256*k>65535)return void x(new Error("glyphs > 65535 not supported"));if(S.ranges[k])return void x(null,{stack:p,id:g,glyph:E});let A=S.requests[k];A||(A=S.requests[k]=[],Me.loadGlyphRange(p,k,this.url,this.requestManager,(D,R)=>{if(R){for(const G in R)this._doesCharSupportLocalGlyph(+G)||(S.glyphs[+G]=R[+G]);S.ranges[k]=!0}for(const G of A)G(D,R);delete S.requests[k]})),A.push((D,R)=>{D?x(D):R&&x(null,{stack:p,id:g,glyph:R[g]||null})})},(p,g)=>{if(p)s(p);else if(g){const x={};for(const{stack:S,id:E,glyph:k}of g)(x[S]||(x[S]={}))[E]=k&&{id:k.id,bitmap:k.bitmap.clone(),metrics:k.metrics};s(null,x)}})}_doesCharSupportLocalGlyph(t){return!!this.localIdeographFontFamily&&(u.unicodeBlockLookup["CJK Unified Ideographs"](t)||u.unicodeBlockLookup["Hangul Syllables"](t)||u.unicodeBlockLookup.Hiragana(t)||u.unicodeBlockLookup.Katakana(t))}_tinySDF(t,s,c){const p=this.localIdeographFontFamily;if(!p||!this._doesCharSupportLocalGlyph(c))return;let g=t.tinySDF;if(!g){let S="400";/bold/i.test(s)?S="900":/medium/i.test(s)?S="500":/light/i.test(s)&&(S="200"),g=t.tinySDF=new Me.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:p,fontWeight:S})}const x=g.draw(String.fromCharCode(c));return{id:c,bitmap:new u.AlphaImage({width:x.width||30,height:x.height||30},x.data),metrics:{width:x.glyphWidth||24,height:x.glyphHeight||24,left:x.glyphLeft||0,top:x.glyphTop-27||-8,advance:x.glyphAdvance||24}}}}Me.loadGlyphRange=function(h,t,s,c,p){const g=256*t,x=g+255,S=c.transformRequest(s.replace("{fontstack}",h).replace("{range}",`${g}-${x}`),u.ResourceType.Glyphs);u.getArrayBuffer(S,(E,k)=>{if(E)p(E);else if(k){const A={};for(const D of u.parseGlyphPbf(k))A[D.id]=D;p(null,A)}})},Me.TinySDF=class{constructor({fontSize:h=24,buffer:t=3,radius:s=8,cutoff:c=.25,fontFamily:p="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=c,this.radius=s;const S=this.size=h+4*t,E=this._createCanvas(S),k=this.ctx=E.getContext("2d",{willReadFrequently:!0});k.font=`${x} ${g} ${h}px ${p}`,k.textBaseline="alphabetic",k.textAlign="left",k.fillStyle="black",this.gridOuter=new Float64Array(S*S),this.gridInner=new Float64Array(S*S),this.f=new Float64Array(S),this.z=new Float64Array(S+1),this.v=new Uint16Array(S)}_createCanvas(h){const t=document.createElement("canvas");return t.width=t.height=h,t}draw(h){const{width:t,actualBoundingBoxAscent:s,actualBoundingBoxDescent:c,actualBoundingBoxLeft:p,actualBoundingBoxRight:g}=this.ctx.measureText(h),x=Math.ceil(s),S=Math.min(this.size-this.buffer,Math.ceil(g-p)),E=Math.min(this.size-this.buffer,x+Math.ceil(c)),k=S+2*this.buffer,A=E+2*this.buffer,D=Math.max(k*A,0),R=new Uint8ClampedArray(D),G={data:R,width:k,height:A,glyphWidth:S,glyphHeight:E,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(S===0||E===0)return G;const{ctx:$,buffer:j,gridInner:ee,gridOuter:ie}=this;$.clearRect(j,j,S,E),$.fillText(h,j,j+x);const ce=$.getImageData(j,j,S,E);ie.fill(Q,0,D),ee.fill(0,0,D);for(let W=0;W<E;W++)for(let pe=0;pe<S;pe++){const he=ce.data[4*(W*S+pe)+3]/255;if(he===0)continue;const _e=(W+j)*k+pe+j;if(he===1)ie[_e]=0,ee[_e]=Q;else{const ve=.5-he;ie[_e]=ve>0?ve*ve:0,ee[_e]=ve<0?ve*ve:0}}ae(ie,0,0,k,A,k,this.f,this.v,this.z),ae(ee,j,j,S,E,k,this.f,this.v,this.z);for(let W=0;W<D;W++){const pe=Math.sqrt(ie[W])-Math.sqrt(ee[W]);R[W]=Math.round(255-255*(pe/this.radius+this.cutoff))}return G}};const ze=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(h,t){return u.sphericalToCartesian(h.expression.evaluate(t))}interpolate(h,t,s){return{x:u.number(h.x,t.x,s),y:u.number(h.y,t.y,s),z:u.number(h.z,t.z,s)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),je="-transition";class He extends u.Evented{constructor(t){super(),this._transitionable=new u.Transitionable(ze),this.setLight(t),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,s={}){if(!this._validate(u.validateLight,t,s))for(const c in t){const p=t[c];c.endsWith(je)?this._transitionable.setTransition(c.slice(0,-je.length),p):this._transitionable.setValue(c,p)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,s,c){return(!c||c.validate!==!1)&&u.emitValidationErrors(this,t.call(u.validateStyle,u.extend({value:s,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class Mt{constructor(t,s){this.width=t,this.height=s,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(t,s){const c=t.join(",")+String(s);return this.dashEntry[c]||(this.dashEntry[c]=this.addDash(t,s)),this.dashEntry[c]}getDashRanges(t,s,c){const p=[];let g=t.length%2==1?-t[t.length-1]*c:0,x=t[0]*c,S=!0;p.push({left:g,right:x,isDash:S,zeroLength:t[0]===0});let E=t[0];for(let k=1;k<t.length;k++){S=!S;const A=t[k];g=E*c,E+=A,x=E*c,p.push({left:g,right:x,isDash:S,zeroLength:A===0})}return p}addRoundDash(t,s,c){const p=s/2;for(let g=-c;g<=c;g++){const x=this.width*(this.nextRow+c+g);let S=0,E=t[S];for(let k=0;k<this.width;k++){k/E.right>1&&(E=t[++S]);const A=Math.abs(k-E.left),D=Math.abs(k-E.right),R=Math.min(A,D);let G;const $=g/c*(p+1);if(E.isDash){const j=p-Math.abs($);G=Math.sqrt(R*R+j*j)}else G=p-Math.sqrt(R*R+$*$);this.data[x+k]=Math.max(0,Math.min(255,G+128))}}}addRegularDash(t){for(let S=t.length-1;S>=0;--S){const E=t[S],k=t[S+1];E.zeroLength?t.splice(S,1):k&&k.isDash===E.isDash&&(k.left=E.left,t.splice(S,1))}const s=t[0],c=t[t.length-1];s.isDash===c.isDash&&(s.left=c.left-this.width,c.right=s.right+this.width);const p=this.width*this.nextRow;let g=0,x=t[g];for(let S=0;S<this.width;S++){S/x.right>1&&(x=t[++g]);const E=Math.abs(S-x.left),k=Math.abs(S-x.right),A=Math.min(E,k);this.data[p+S]=Math.max(0,Math.min(255,(x.isDash?A:-A)+128))}}addDash(t,s){const c=s?7:0,p=2*c+1;if(this.nextRow+p>this.height)return u.warnOnce("LineAtlas out of space"),null;let g=0;for(let S=0;S<t.length;S++)g+=t[S];if(g!==0){const S=this.width/g,E=this.getDashRanges(t,this.width,S);s?this.addRoundDash(E,S,c):this.addRegularDash(E)}const x={y:(this.nextRow+c+.5)/this.height,height:2*c/this.height,width:g};return this.nextRow+=p,this.dirty=!0,x}bind(t){const s=t.gl;this.texture?(s.bindTexture(s.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,s.texSubImage2D(s.TEXTURE_2D,0,0,0,this.width,this.height,s.ALPHA,s.UNSIGNED_BYTE,this.data))):(this.texture=s.createTexture(),s.bindTexture(s.TEXTURE_2D,this.texture),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_S,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_WRAP_T,s.REPEAT),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_2D,s.TEXTURE_MAG_FILTER,s.LINEAR),s.texImage2D(s.TEXTURE_2D,0,s.ALPHA,this.width,this.height,0,s.ALPHA,s.UNSIGNED_BYTE,this.data))}}class ht{constructor(t,s){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const c=this.workerPool.acquire(this.id);for(let p=0;p<c.length;p++){const g=new ht.Actor(c[p],s,this.id);g.name=`Worker ${p}`,this.actors.push(g)}if(!this.actors.length)throw new Error("No actors found")}broadcast(t,s,c){u.asyncAll(this.actors,(p,g)=>{p.send(t,s,g)},c=c||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Wt(h,t,s){const c=function(p,g){if(p)return s(p);if(g){const x=u.pick(u.extend(g,h),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);g.vector_layers&&(x.vectorLayers=g.vector_layers,x.vectorLayerIds=x.vectorLayers.map(S=>S.id)),s(null,x)}};return h.url?u.getJSON(t.transformRequest(h.url,u.ResourceType.Source),c):u.exported.frame(()=>c(null,h))}ht.Actor=u.Actor;class En{constructor(t,s,c){this.bounds=u.LngLatBounds.convert(this.validateBounds(t)),this.minzoom=s||0,this.maxzoom=c||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(t){const s=Math.pow(2,t.z),c=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*s),p=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*s),g=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*s),x=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*s);return t.x>=c&&t.x<g&&t.y>=p&&t.y<x}}class yn extends u.Evented{constructor(t,s,c,p){if(super(),this.id=t,this.dispatcher=c,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(s,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},s),this._collectResourceTiming=s.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(p)}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),t?this.fire(new u.ErrorEvent(t)):s&&(u.extend(this,s),s.bounds&&(this.tileBounds=new En(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),p={request:this.map._requestManager.transformRequest(c,u.ResourceType.Tile),uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function g(x,S){return delete t.request,t.aborted?s(null):x&&x.status!==404?s(x):(S&&S.resourceTiming&&(t.resourceTiming=S.resourceTiming),this.map._refreshExpiredTiles&&S&&t.setExpiryData(S),t.loadVectorData(S,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),s(null),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}p.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired"?t.state==="loading"?t.reloadCallback=s:t.request=t.actor.send("reloadTile",p,g.bind(this)):(t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",p,g.bind(this)))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Kn extends u.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.setEventedParent(p),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},s),u.extend(this,u.pick(s,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Wt(this._options,this.map._requestManager,(t,s)=>{this._tileJSONRequest=null,this._loaded=!0,t?this.fire(new u.ErrorEvent(t)):s&&(u.extend(this,s),s.bounds&&(this.tileBounds=new En(s.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);t.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),(p,g,x)=>{if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(p)t.state="errored",s(p);else if(g){this.map._refreshExpiredTiles&&t.setExpiryData(x);const S=this.map.painter.context,E=S.gl;t.texture=this.map.painter.getTileTexture(g.width),t.texture?t.texture.update(g,{useMipmap:!0}):(t.texture=new we(S,g,E.RGBA,{useMipmap:!0}),t.texture.bind(E.LINEAR,E.CLAMP_TO_EDGE,E.LINEAR_MIPMAP_NEAREST),S.extTextureFilterAnisotropic&&E.texParameterf(E.TEXTURE_2D,S.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,S.extTextureFilterAnisotropicMax)),t.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),s(null)}})}abortTile(t,s){t.request&&(t.request.cancel(),delete t.request),s()}unloadTile(t,s){t.texture&&this.map.painter.saveTileTexture(t.texture),s()}hasTransition(){return!1}}let _n;class ot extends Kn{constructor(t,s,c,p){super(t,s,c,p),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},s),this.encoding=s.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(t,s){const c=t.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function p(g,x){g&&(t.state="errored",s(g)),x&&(t.dem=x,t.needsHillshadePrepare=!0,t.needsTerrainPrepare=!0,t.state="loaded",s(null))}t.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),function(g,x){if(delete t.request,t.aborted)t.state="unloaded",s(null);else if(g)t.state="errored",s(g);else if(x){this.map._refreshExpiredTiles&&t.setExpiryData(x),delete x.cacheControl,delete x.expires;const S=u.isImageBitmap(x)&&(_n==null&&(_n=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),_n)?x:u.exported.getImageData(x,1),E={uid:t.uid,coord:t.tileID,source:this.id,rawImageData:S,encoding:this.encoding};t.actor&&t.state!=="expired"||(t.actor=this.dispatcher.getActor(),t.actor.send("loadDEMTile",E,p.bind(this)))}}.bind(this)),t.neighboringTiles=this._getNeighboringTiles(t.tileID)}_getNeighboringTiles(t){const s=t.canonical,c=Math.pow(2,s.z),p=(s.x-1+c)%c,g=s.x===0?t.wrap-1:t.wrap,x=(s.x+1+c)%c,S=s.x+1===c?t.wrap+1:t.wrap,E={};return E[new u.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,S,s.z,x,s.y).key]={backfilled:!1},s.y>0&&(E[new u.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y-1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y-1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,S,s.z,x,s.y-1).key]={backfilled:!1}),s.y+1<c&&(E[new u.OverscaledTileID(t.overscaledZ,g,s.z,p,s.y+1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,t.wrap,s.z,s.x,s.y+1).key]={backfilled:!1},E[new u.OverscaledTileID(t.overscaledZ,S,s.z,x,s.y+1).key]={backfilled:!1}),E}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})}}class Tn extends u.Evented{constructor(t,s,c,p){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=c.getActor(),this.setEventedParent(p),this._data=s.data,this._options=u.extend({},s),this._collectResourceTiming=s.collectResourceTiming,s.maxzoom!==void 0&&(this.maxzoom=s.maxzoom),s.type&&(this.type=s.type),s.attribution&&(this.attribution=s.attribution),this.promoteId=s.promoteId;const g=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:s.cluster||!1,geojsonVtOptions:{buffer:(s.buffer!==void 0?s.buffer:128)*g,tolerance:(s.tolerance!==void 0?s.tolerance:.375)*g,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:s.lineMetrics||!1,generateId:s.generateId||!1},superclusterOptions:{maxZoom:s.clusterMaxZoom!==void 0?s.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,s.clusterMinPoints||2),extent:u.EXTENT,radius:(s.clusterRadius||50)*g,log:!1,generateId:s.generateId||!1},clusterProperties:s.clusterProperties,filter:s.filter},s.workerOptions)}load(){this._updateWorkerData("metadata")}onAdd(t){this.map=t,this.load()}setData(t){return this._data=t,this._updateWorkerData("content"),this}getClusterExpansionZoom(t,s){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},s),this}getClusterChildren(t,s){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},s),this}getClusterLeaves(t,s,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:s,offset:c},p),this}_updateWorkerData(t){const s=u.extend({},this.workerOptions),c=this._data;typeof c=="string"?(s.request=this.map._requestManager.transformRequest(u.exported.resolveURL(c),u.ResourceType.Source),s.request.collectResourceTiming=this._collectResourceTiming):s.data=JSON.stringify(c),this._pendingLoads++,this.fire(new u.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,s,(p,g)=>{if(this._pendingLoads--,this._removed||g&&g.abandoned)return void this.fire(new u.Event("dataabort",{dataType:"source",sourceDataType:t}));let x=null;if(g&&g.resourceTiming&&g.resourceTiming[this.id]&&(x=g.resourceTiming[this.id].slice(0)),p)return void this.fire(new u.ErrorEvent(p));const S={dataType:"source",sourceDataType:t};this._collectResourceTiming&&x&&x.length>0&&u.extend(S,{resourceTiming:x}),this.fire(new u.Event("data",S))})}loaded(){return this._pendingLoads===0}loadTile(t,s){const c=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const p={type:this.type,uid:t.uid,tileID:t.tileID,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};t.request=this.actor.send(c,p,(g,x)=>(delete t.request,t.unloadVectorData(),t.aborted?s(null):g?s(g):(t.loadVectorData(x,this.map.painter,c==="reloadTile"),s(null))))}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var Ne=u.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class st extends u.Evented{constructor(t,s,c,p){super(),this.id=t,this.dispatcher=c,this.coordinates=s.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(p),this.options=s}load(t,s){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(c,p)=>{this._loaded=!0,c?this.fire(new u.ErrorEvent(c)):p&&(this.image=p,t&&(this.coordinates=t),s&&s(),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}setCoordinates(t){this.coordinates=t;const s=t.map(u.MercatorCoordinate.fromLngLat);this.tileID=function(p){let g=1/0,x=1/0,S=-1/0,E=-1/0;for(const R of p)g=Math.min(g,R.x),x=Math.min(x,R.y),S=Math.max(S,R.x),E=Math.max(E,R.y);const k=Math.max(S-g,E-x),A=Math.max(0,Math.floor(-Math.log(k)/Math.LN2)),D=Math.pow(2,A);return new u.CanonicalTileID(A,Math.floor((g+S)/2*D),Math.floor((x+E)/2*D))}(s),this.minzoom=this.maxzoom=this.tileID.z;const c=s.map(p=>this.tileID.getTilePoint(p)._round());return this._boundsArray=new u.RasterBoundsArray,this._boundsArray.emplaceBack(c[0].x,c[0].y,0,0),this._boundsArray.emplaceBack(c[1].x,c[1].y,u.EXTENT,0),this._boundsArray.emplaceBack(c[3].x,c[3].y,0,u.EXTENT),this._boundsArray.emplaceBack(c[2].x,c[2].y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ne.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new we(t,this.image,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}loadTile(t,s){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},s(null)):(t.state="errored",s(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class ut extends st{constructor(t,s,c,p){super(t,s,c,p),this.roundZoom=!0,this.type="video",this.options=s}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const s of t.urls)this.urls.push(this.map._requestManager.transformRequest(s,u.ResourceType.Source).url);u.getVideo(this.urls,(s,c)=>{this._loaded=!0,s?this.fire(new u.ErrorEvent(s)):c&&(this.video=c,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const s=this.video.seekable;t<s.start(0)||t>s.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${s.start(0)} and ${s.end(0)}-second mark.`))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const t=this.map.painter.context,s=t.gl;this.boundsBuffer||(this.boundsBuffer=t.createVertexBuffer(this._boundsArray,Ne.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE),s.texSubImage2D(s.TEXTURE_2D,0,0,0,s.RGBA,s.UNSIGNED_BYTE,this.video)):(this.texture=new we(t,this.video,s.RGBA),this.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE));for(const c in this.tiles){const p=this.tiles[c];p.state!=="loaded"&&(p.state="loaded",p.texture=this.texture)}}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class Pt extends st{constructor(t,s,c,p){super(t,s,c,p),s.coordinates?Array.isArray(s.coordinates)&&s.coordinates.length===4&&!s.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(x=>typeof x!="number"))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'missing required property "coordinates"'))),s.animate&&typeof s.animate!="boolean"&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'optional "animate" property must be a boolean value'))),s.canvas?typeof s.canvas=="string"||s.canvas instanceof HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${t}`,null,'missing required property "canvas"'))),this.options=s,this.animate=s.animate===void 0||s.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const s=this.map.painter.context,c=s.gl;this.boundsBuffer||(this.boundsBuffer=s.createVertexBuffer(this._boundsArray,Ne.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(t||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new we(s,this.canvas,c.RGBA,{premultiply:!0});for(const p in this.tiles){const g=this.tiles[p];g.state!=="loaded"&&(g.state="loaded",g.texture=this.texture)}}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}}const qt={vector:yn,raster:Kn,"raster-dem":ot,geojson:Tn,video:ut,image:st,canvas:Pt};function fr(h,t){const s=u.create();return u.translate(s,s,[1,1,0]),u.scale(s,s,[.5*h.width,.5*h.height,1]),u.multiply(s,s,h.calculatePosMatrix(t.toUnwrapped()))}function Yn(h,t,s,c,p,g){const x=function(D,R,G){if(D)for(const $ of D){const j=R[$];if(j&&j.source===G&&j.type==="fill-extrusion")return!0}else for(const $ in R){const j=R[$];if(j.source===G&&j.type==="fill-extrusion")return!0}return!1}(p&&p.layers,t,h.id),S=g.maxPitchScaleFactor(),E=h.tilesIn(c,S,x);E.sort(Jn);const k=[];for(const D of E)k.push({wrappedTileID:D.tileID.wrapped().key,queryResults:D.tile.queryRenderedFeatures(t,s,h._state,D.queryGeometry,D.cameraQueryGeometry,D.scale,p,g,S,fr(h.transform,D.tileID))});const A=function(D){const R={},G={};for(const $ of D){const j=$.queryResults,ee=$.wrappedTileID,ie=G[ee]=G[ee]||{};for(const ce in j){const W=j[ce],pe=ie[ce]=ie[ce]||{},he=R[ce]=R[ce]||[];for(const _e of W)pe[_e.featureIndex]||(pe[_e.featureIndex]=!0,he.push(_e))}}return R}(k);for(const D in A)A[D].forEach(R=>{const G=R.feature,$=h.getFeatureState(G.layer["source-layer"],G.id);G.source=G.layer.source,G.layer["source-layer"]&&(G.sourceLayer=G.layer["source-layer"]),G.state=$});return A}function Jn(h,t){const s=h.tileID,c=t.tileID;return s.overscaledZ-c.overscaledZ||s.canonical.y-c.canonical.y||s.wrap-c.wrap||s.canonical.x-c.canonical.x}class pn{constructor(t,s){this.tileID=t,this.uid=u.uniqueId(),this.uses=0,this.tileSize=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.textures=[],this.textureCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(t){const s=t+this.timeAdded;s<u.exported.now()||this.fadeEndTime&&s<this.fadeEndTime||(this.fadeEndTime=s)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(t){this.demTexture&&t.saveTileTexture(this.demTexture),this.textures.forEach(s=>t.saveTileTexture(s)),this.demTexture=null,this.textures=[],this.textureCoords={}}loadVectorData(t,s,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(p,g){const x={};if(!g)return x;for(const S of p){const E=S.layerIds.map(k=>g.getLayer(k)).filter(Boolean);if(E.length!==0){S.layers=E,S.stateDependentLayerIds&&(S.stateDependentLayers=S.stateDependentLayerIds.map(k=>E.filter(A=>A.id===k)[0]));for(const k of E)x[k.id]=S}}return x}(t.buckets,s.style),this.hasSymbolBuckets=!1;for(const p in this.buckets){const g=this.buckets[p];if(g instanceof u.SymbolBucket){if(this.hasSymbolBuckets=!0,!c)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const p in this.buckets){const g=this.buckets[p];if(g instanceof u.SymbolBucket&&g.hasRTLText){this.hasRTLText=!0,u.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const p in this.buckets){const g=this.buckets[p];this.queryPadding=Math.max(this.queryPadding,s.style.getLayer(p).queryRadius(g))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new u.CollisionBoxArray}unloadVectorData(){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(t){return this.buckets[t.id]}upload(t){for(const c in this.buckets){const p=this.buckets[c];p.uploadPending()&&p.upload(t)}const s=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new we(t,this.imageAtlas.image,s.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new we(t,this.glyphAtlasImage,s.ALPHA),this.glyphAtlasImage=null)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,s,c,p,g,x,S,E,k,A){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:p,cameraQueryGeometry:g,scale:x,tileSize:this.tileSize,pixelPosMatrix:A,transform:E,params:S,queryPadding:this.queryPadding*k},t,s,c):{}}querySourceFeatures(t,s){const c=this.latestFeatureIndex;if(!c||!c.rawTileData)return;const p=c.loadVTLayers(),g=s?s.sourceLayer:"",x=p._geojsonTileLayer||p[g];if(!x)return;const S=u.createFilter(s&&s.filter),{z:E,x:k,y:A}=this.tileID.canonical,D={z:E,x:k,y:A};for(let R=0;R<x.length;R++){const G=x.feature(R);if(S.needGeometry){const ee=u.toEvaluationFeature(G,!0);if(!S.filter(new u.EvaluationParameters(this.tileID.overscaledZ),ee,this.tileID.canonical))continue}else if(!S.filter(new u.EvaluationParameters(this.tileID.overscaledZ),G))continue;const $=c.getId(G,g),j=new u.GeoJSONFeature(G,E,k,A,$);j.tile=D,t.push(j)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const s=this.expirationTime;if(t.cacheControl){const c=u.parseCacheControl(t.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const c=Date.now();let p=!1;if(this.expirationTime>c)p=!1;else if(s)if(this.expirationTime<s)p=!0;else{const g=this.expirationTime-s;g?this.expirationTime=c+Math.max(g,3e4):p=!0}else p=!0;p?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(t,s){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(t).length===0)return;const c=this.latestFeatureIndex.loadVTLayers();for(const p in this.buckets){if(!s.style.hasLayer(p))continue;const g=this.buckets[p],x=g.layers[0].sourceLayer||"_geojsonTileLayer",S=c[x],E=t[x];if(!S||!E||Object.keys(E).length===0)continue;g.update(E,S,this.imageAtlas&&this.imageAtlas.patternPositions||{});const k=s&&s.style&&s.style.getLayer(p);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(g)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<u.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=u.exported.now()+t}setDependencies(t,s){const c={};for(const p of s)c[p]=!0;this.dependencies[t]=c}hasDependency(t,s){for(const c of t){const p=this.dependencies[c];if(p){for(const g of s)if(p[g])return!0}}return!1}}class sr{constructor(t,s){this.max=t,this.onRemove=s,this.reset()}reset(){for(const t in this.data)for(const s of this.data[t])s.timeout&&clearTimeout(s.timeout),this.onRemove(s.value);return this.data={},this.order=[],this}add(t,s,c){const p=t.wrapped().key;this.data[p]===void 0&&(this.data[p]=[]);const g={value:s,timeout:void 0};if(c!==void 0&&(g.timeout=setTimeout(()=>{this.remove(t,g)},c)),this.data[p].push(g),this.order.push(p),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const s=this.data[t].shift();return s.timeout&&clearTimeout(s.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),s.value}getByKey(t){const s=this.data[t];return s?s[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,s){if(!this.has(t))return this;const c=t.wrapped().key,p=s===void 0?0:this.data[c].indexOf(s),g=this.data[c][p];return this.data[c].splice(p,1),g.timeout&&clearTimeout(g.timeout),this.data[c].length===0&&delete this.data[c],this.onRemove(g.value),this.order.splice(this.order.indexOf(c),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const s=this._getAndRemoveByKey(this.order[0]);s&&this.onRemove(s)}return this}filter(t){const s=[];for(const c in this.data)for(const p of this.data[c])t(p.value)||s.push(p);for(const c of s)this.remove(c.value.tileID,c)}}class Ut{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,s,c){const p=String(s);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][p]=this.stateChanges[t][p]||{},u.extend(this.stateChanges[t][p],c),this.deletedStates[t]===null){this.deletedStates[t]={};for(const g in this.state[t])g!==p&&(this.deletedStates[t][g]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][p]===null){this.deletedStates[t][p]={};for(const g in this.state[t][p])c[g]||(this.deletedStates[t][p][g]=null)}else for(const g in c)this.deletedStates[t]&&this.deletedStates[t][p]&&this.deletedStates[t][p][g]===null&&delete this.deletedStates[t][p][g]}removeFeatureState(t,s,c){if(this.deletedStates[t]===null)return;const p=String(s);if(this.deletedStates[t]=this.deletedStates[t]||{},c&&s!==void 0)this.deletedStates[t][p]!==null&&(this.deletedStates[t][p]=this.deletedStates[t][p]||{},this.deletedStates[t][p][c]=null);else if(s!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][p])for(c in this.deletedStates[t][p]={},this.stateChanges[t][p])this.deletedStates[t][p][c]=null;else this.deletedStates[t][p]=null;else this.deletedStates[t]=null}getState(t,s){const c=String(s),p=u.extend({},(this.state[t]||{})[c],(this.stateChanges[t]||{})[c]);if(this.deletedStates[t]===null)return{};if(this.deletedStates[t]){const g=this.deletedStates[t][s];if(g===null)return{};for(const x in g)delete p[x]}return p}initializeTileState(t,s){t.setFeatureState(this.state,s)}coalesceChanges(t,s){const c={};for(const p in this.stateChanges){this.state[p]=this.state[p]||{};const g={};for(const x in this.stateChanges[p])this.state[p][x]||(this.state[p][x]={}),u.extend(this.state[p][x],this.stateChanges[p][x]),g[x]=this.state[p][x];c[p]=g}for(const p in this.deletedStates){this.state[p]=this.state[p]||{};const g={};if(this.deletedStates[p]===null)for(const x in this.state[p])g[x]={},this.state[p][x]={};else for(const x in this.deletedStates[p]){if(this.deletedStates[p][x]===null)this.state[p][x]={};else for(const S of Object.keys(this.deletedStates[p][x]))delete this.state[p][x][S];g[x]=this.state[p][x]}c[p]=c[p]||{},u.extend(c[p],g)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(const p in t)t[p].setFeatureState(c,s)}}class Rt extends u.Evented{constructor(t,s,c){super(),this.id=t,this.dispatcher=c,this.on("data",p=>{p.dataType==="source"&&p.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&p.dataType==="source"&&p.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain))}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(p,g,x,S){const E=new qt[g.type](p,g,x,S);if(E.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${E.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],E),E}(t,s,c,this),this._tiles={},this._cache=new sr(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new Ut}onAdd(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)}onRemove(t){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(t)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles){const s=this._tiles[t];if(s.state!=="loaded"&&s.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(t,s){return this._source.loadTile(t,s)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){this._source.abortTile&&this._source.abortTile(t,()=>{}),this._source.fire(new u.Event("dataabort",{tile:t,coord:t.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const s in this._tiles){const c=this._tiles[s];c.upload(t),c.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Kt).map(t=>t.key)}getRenderableIds(t){const s=[];for(const c in this._tiles)this._isIdRenderable(c,t)&&s.push(this._tiles[c]);return t?s.sort((c,p)=>{const g=c.tileID,x=p.tileID,S=new u.pointGeometry(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),E=new u.pointGeometry(x.canonical.x,x.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-x.overscaledZ||E.y-S.y||E.x-S.x}).map(c=>c.tileID.key):s.map(c=>c.tileID).sort(Kt).map(c=>c.key)}hasRenderableParent(t){const s=this.findLoadedParent(t,0);return!!s&&this._isIdRenderable(s.tileID.key)}_isIdRenderable(t,s){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(s||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(t,"reloading")}}_reloadTile(t,s){const c=this._tiles[t];c&&(c.state!=="loading"&&(c.state=s),this._loadTile(c,this._tileLoaded.bind(this,c,t,s)))}_tileLoaded(t,s,c,p){if(p)return t.state="errored",void(p.status!==404?this._source.fire(new u.ErrorEvent(p,{tile:t})):this.update(this.transform,this.terrain));t.timeAdded=u.exported.now(),c==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(s,t),this.getSource().type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),t.aborted||this._source.fire(new u.Event("data",{dataType:"source",tile:t,coord:t.tileID}))}_backfillDEM(t){const s=this.getRenderableIds();for(let p=0;p<s.length;p++){const g=s[p];if(t.neighboringTiles&&t.neighboringTiles[g]){const x=this.getTileByID(g);c(t,x),c(x,t)}}function c(p,g){p.needsHillshadePrepare=!0,p.needsTerrainPrepare=!0;let x=g.tileID.canonical.x-p.tileID.canonical.x;const S=g.tileID.canonical.y-p.tileID.canonical.y,E=Math.pow(2,p.tileID.canonical.z),k=g.tileID.key;x===0&&S===0||Math.abs(S)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),g.dem&&p.dem&&(p.dem.backfillBorder(g.dem,x,S),p.neighboringTiles&&p.neighboringTiles[k]&&(p.neighboringTiles[k].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,s,c,p){for(const g in this._tiles){let x=this._tiles[g];if(p[g]||!x.hasData()||x.tileID.overscaledZ<=s||x.tileID.overscaledZ>c)continue;let S=x.tileID;for(;x&&x.tileID.overscaledZ>s+1;){const k=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[k.key],x&&x.hasData()&&(S=k)}let E=S;for(;E.overscaledZ>s;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){p[S.key]=S;break}}}findLoadedParent(t,s){if(t.key in this._loadedParentTiles){const c=this._loadedParentTiles[t.key];return c&&c.tileID.overscaledZ>=s?c:null}for(let c=t.overscaledZ-1;c>=s;c--){const p=t.scaledTo(c),g=this._getLoadedTile(p);if(g)return g}}_getLoadedTile(t){const s=this._tiles[t.key];return s&&s.hasData()?s:this._cache.getByKey(t.wrapped().key)}updateCacheSize(t){const s=Math.ceil(t.width/this._source.tileSize)+1,c=Math.ceil(t.height/this._source.tileSize)+1,p=Math.floor(s*c*5),g=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,p):p;this._cache.setMaxSize(g)}handleWrapJump(t){const s=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,s){const c={};for(const p in this._tiles){const g=this._tiles[p];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+s),c[g.tileID.key]=g}this._tiles=c;for(const p in this._timers)clearTimeout(this._timers[p]),delete this._timers[p];for(const p in this._tiles)this._setTileReloadTimer(p,this._tiles[p])}}update(t,s){if(this.transform=t,this.terrain=s,!this._sourceLoaded||this._paused)return;let c;this.updateCacheSize(t),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?c=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(k=>new u.OverscaledTileID(k.canonical.z,k.wrap,k.canonical.z,k.canonical.x,k.canonical.y)):(c=t.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:s}),this._source.hasTile&&(c=c.filter(k=>this._source.hasTile(k)))):c=[];const p=t.coveringZoomLevel(this._source),g=Math.max(p-Rt.maxOverzooming,this._source.minzoom),x=Math.max(p+Rt.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const k={};for(const A of c)if(A.canonical.z>this._source.minzoom){const D=A.scaledTo(A.canonical.z-1);k[D.key]=D;const R=A.scaledTo(Math.max(this._source.minzoom,Math.min(A.canonical.z,5)));k[R.key]=R}c=c.concat(Object.values(k))}const S=this._updateRetainedTiles(c,p);if(un(this._source.type)){const k={},A={},D=Object.keys(S);for(const R of D){const G=S[R],$=this._tiles[R];if(!$||$.fadeEndTime&&$.fadeEndTime<=u.exported.now())continue;const j=this.findLoadedParent(G,g);j&&(this._addTile(j.tileID),k[j.tileID.key]=j.tileID),A[R]=G}this._retainLoadedChildren(A,p,x,S);for(const R in k)S[R]||(this._coveredTiles[R]=!0,S[R]=k[R]);if(s){const R={},G={};for(const $ of c)this._tiles[$.key].hasData()?R[$.key]=$:G[$.key]=$;for(const $ in G){const j=G[$].children(this._source.maxzoom);this._tiles[j[0].key]&&this._tiles[j[1].key]&&this._tiles[j[2].key]&&this._tiles[j[3].key]&&(R[j[0].key]=S[j[0].key]=j[0],R[j[1].key]=S[j[1].key]=j[1],R[j[2].key]=S[j[2].key]=j[2],R[j[3].key]=S[j[3].key]=j[3],delete G[$])}for(const $ in G){const j=this.findLoadedParent(G[$],this._source.minzoom);if(j){R[j.tileID.key]=S[j.tileID.key]=j.tileID;for(const ee in R)R[ee].isChildOf(j.tileID)&&delete R[ee]}}for(const $ in this._tiles)R[$]||(this._coveredTiles[$]=!0)}}for(const k in S)this._tiles[k].clearFadeHold();const E=u.keysDifference(this._tiles,S);for(const k of E){const A=this._tiles[k];A.hasSymbolBuckets&&!A.holdingForFade()?A.setHoldDuration(this.map._fadeDuration):A.hasSymbolBuckets&&!A.symbolFadeFinished()||this._removeTile(k)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)}_updateRetainedTiles(t,s){const c={},p={},g=Math.max(s-Rt.maxOverzooming,this._source.minzoom),x=Math.max(s+Rt.maxUnderzooming,this._source.minzoom),S={};for(const E of t){const k=this._addTile(E);c[E.key]=E,k.hasData()||s<this._source.maxzoom&&(S[E.key]=E)}this._retainLoadedChildren(S,s,x,c);for(const E of t){let k=this._tiles[E.key];if(k.hasData())continue;if(s+1>this._source.maxzoom){const D=E.children(this._source.maxzoom)[0],R=this.getTile(D);if(R&&R.hasData()){c[D.key]=D;continue}}else{const D=E.children(this._source.maxzoom);if(c[D[0].key]&&c[D[1].key]&&c[D[2].key]&&c[D[3].key])continue}let A=k.wasRequested();for(let D=E.overscaledZ-1;D>=g;--D){const R=E.scaledTo(D);if(p[R.key]||(p[R.key]=!0,k=this.getTile(R),!k&&A&&(k=this._addTile(R)),k&&(c[R.key]=R,A=k.wasRequested(),k.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const s=[];let c,p=this._tiles[t].tileID;for(;p.overscaledZ>0;){if(p.key in this._loadedParentTiles){c=this._loadedParentTiles[p.key];break}s.push(p.key);const g=p.scaledTo(p.overscaledZ-1);if(c=this._getLoadedTile(g),c)break;p=g}for(const g of s)this._loadedParentTiles[g]=c}}_addTile(t){let s=this._tiles[t.key];if(s)return s;s=this._cache.getAndRemove(t),s&&(this._setTileReloadTimer(t.key,s),s.tileID=t,this._state.initializeTileState(s,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,s)));const c=s;return s||(s=new pn(t,this._source.tileSize*t.overscaleFactor()),this._loadTile(s,this._tileLoaded.bind(this,s,t.key,s.state))),s.uses++,this._tiles[t.key]=s,c||this._source.fire(new u.Event("dataloading",{tile:s,coord:s.tileID,dataType:"source"})),s}_setTileReloadTimer(t,s){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const c=s.getExpiryTimeout();c&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},c))}_removeTile(t){const s=this._tiles[t];s&&(s.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),s.uses>0||(s.hasData()&&s.state!=="reloading"?this._cache.add(s.tileID,s,s.getExpiryTimeout()):(s.aborted=!0,this._abortTile(s),this._unloadTile(s))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(t);this._cache.reset()}tilesIn(t,s,c){const p=[],g=this.transform;if(!g)return p;const x=c?g.getCameraQueryGeometry(t):t,S=t.map($=>g.pointCoordinate($,this.terrain)),E=x.map($=>g.pointCoordinate($,this.terrain)),k=this.getIds();let A=1/0,D=1/0,R=-1/0,G=-1/0;for(const $ of E)A=Math.min(A,$.x),D=Math.min(D,$.y),R=Math.max(R,$.x),G=Math.max(G,$.y);for(let $=0;$<k.length;$++){const j=this._tiles[k[$]];if(j.holdingForFade())continue;const ee=j.tileID,ie=Math.pow(2,g.zoom-j.tileID.overscaledZ),ce=s*j.queryPadding*u.EXTENT/j.tileSize/ie,W=[ee.getTilePoint(new u.MercatorCoordinate(A,D)),ee.getTilePoint(new u.MercatorCoordinate(R,G))];if(W[0].x-ce<u.EXTENT&&W[0].y-ce<u.EXTENT&&W[1].x+ce>=0&&W[1].y+ce>=0){const pe=S.map(_e=>ee.getTilePoint(_e)),he=E.map(_e=>ee.getTilePoint(_e));p.push({tile:j,tileID:ee,queryGeometry:pe,cameraQueryGeometry:he,scale:ie})}}return p}getVisibleCoordinates(t){const s=this.getRenderableIds(t).map(c=>this._tiles[c].tileID);for(const c of s)c.posMatrix=this.transform.calculatePosMatrix(c.toUnwrapped());return s}hasTransition(){if(this._source.hasTransition())return!0;if(un(this._source.type))for(const t in this._tiles){const s=this._tiles[t];if(s.fadeEndTime!==void 0&&s.fadeEndTime>=u.exported.now())return!0}return!1}setFeatureState(t,s,c){this._state.updateState(t=t||"_geojsonTileLayer",s,c)}removeFeatureState(t,s,c){this._state.removeFeatureState(t=t||"_geojsonTileLayer",s,c)}getFeatureState(t,s){return this._state.getState(t=t||"_geojsonTileLayer",s)}setDependencies(t,s,c){const p=this._tiles[t];p&&p.setDependencies(s,c)}reloadTilesForDependencies(t,s){for(const c in this._tiles)this._tiles[c].hasDependency(t,s)&&this._reloadTile(c,"reloading");this._cache.filter(c=>!c.hasDependency(t,s))}}function Kt(h,t){const s=Math.abs(2*h.wrap)-+(h.wrap<0),c=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||c-s||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function un(h){return h==="raster"||h==="image"||h==="video"}Rt.maxOverzooming=10,Rt.maxUnderzooming=3;const Yt="mapboxgl_preloaded_worker_pool";class Mn{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<Mn.workerCount;)this.workers.push(new Worker(_o.workerUrl));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.numActive()===0&&(this.workers.forEach(s=>{s.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Yt]}numActive(){return Object.keys(this.active).length}}const Nr=Math.floor(u.exported.hardwareConcurrency/2);let mr;function Yr(){return mr||(mr=new Mn),mr}function Ti(h,t){const s={};for(const c in h)c!=="ref"&&(s[c]=h[c]);return u.refProperties.forEach(c=>{c in t&&(s[c]=t[c])}),s}function qi(h){h=h.slice();const t=Object.create(null);for(let s=0;s<h.length;s++)t[h[s].id]=h[s];for(let s=0;s<h.length;s++)"ref"in h[s]&&(h[s]=Ti(h[s],t[h[s].ref]));return h}Mn.workerCount=Math.max(Math.min(Nr,6),1);const St={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function cn(h,t,s){s.push({command:St.addSource,args:[h,t[h]]})}function Bn(h,t,s){t.push({command:St.removeSource,args:[h]}),s[h]=!0}function Ur(h,t,s,c){Bn(h,s,c),cn(h,t,s)}function As(h,t,s){let c;for(c in h[s])if(Object.prototype.hasOwnProperty.call(h[s],c)&&c!=="data"&&!te(h[s][c],t[s][c]))return!1;for(c in t[s])if(Object.prototype.hasOwnProperty.call(t[s],c)&&c!=="data"&&!te(h[s][c],t[s][c]))return!1;return!0}function ki(h,t,s,c,p,g){let x;for(x in t=t||{},h=h||{})Object.prototype.hasOwnProperty.call(h,x)&&(te(h[x],t[x])||s.push({command:g,args:[c,x,t[x],p]}));for(x in t)Object.prototype.hasOwnProperty.call(t,x)&&!Object.prototype.hasOwnProperty.call(h,x)&&(te(h[x],t[x])||s.push({command:g,args:[c,x,t[x],p]}))}function Ci(h){return h.id}function Uo(h,t){return h[t.id]=t,h}class Ii{constructor(t,s){this.reset(t,s)}reset(t,s){this.points=t||[],this._distances=[0];for(let c=1;c<this.points.length;c++)this._distances[c]=this._distances[c-1]+this.points[c].dist(this.points[c-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(s||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=u.clamp(t,0,1);let s=1,c=this._distances[s];const p=t*this.paddedLength+this.padding;for(;c<p&&s<this._distances.length;)c=this._distances[++s];const g=s-1,x=this._distances[g],S=c-x,E=S>0?(p-x)/S:0;return this.points[g].mult(1-E).add(this.points[s].mult(E))}}function xe(h,t){let s=!0;return h==="always"||h!=="never"&&t!=="never"||(s=!1),s}class Fe{constructor(t,s,c){const p=this.boxCells=[],g=this.circleCells=[];this.xCellCount=Math.ceil(t/c),this.yCellCount=Math.ceil(s/c);for(let x=0;x<this.xCellCount*this.yCellCount;x++)p.push([]),g.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=s,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/s,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,s,c,p,g){this._forEachCell(s,c,p,g,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(s),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(g)}insertCircle(t,s,c,p){this._forEachCell(s-p,c-p,s+p,c+p,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(s),this.circles.push(c),this.circles.push(p)}_insertBoxCell(t,s,c,p,g,x){this.boxCells[g].push(x)}_insertCircleCell(t,s,c,p,g,x){this.circleCells[g].push(x)}_query(t,s,c,p,g,x,S){if(c<0||t>this.width||p<0||s>this.height)return[];const E=[];if(t<=0&&s<=0&&this.width<=c&&this.height<=p){if(g)return[{key:null,x1:t,y1:s,x2:c,y2:p}];for(let k=0;k<this.boxKeys.length;k++)E.push({key:this.boxKeys[k],x1:this.bboxes[4*k],y1:this.bboxes[4*k+1],x2:this.bboxes[4*k+2],y2:this.bboxes[4*k+3]});for(let k=0;k<this.circleKeys.length;k++){const A=this.circles[3*k],D=this.circles[3*k+1],R=this.circles[3*k+2];E.push({key:this.circleKeys[k],x1:A-R,y1:D-R,x2:A+R,y2:D+R})}}else this._forEachCell(t,s,c,p,this._queryCell,E,{hitTest:g,overlapMode:x,seenUids:{box:{},circle:{}}},S);return E}query(t,s,c,p){return this._query(t,s,c,p,!1,null)}hitTest(t,s,c,p,g,x){return this._query(t,s,c,p,!0,g,x).length>0}hitTestCircle(t,s,c,p,g){const x=t-c,S=t+c,E=s-c,k=s+c;if(S<0||x>this.width||k<0||E>this.height)return!1;const A=[];return this._forEachCell(x,E,S,k,this._queryCellCircle,A,{hitTest:!0,overlapMode:p,circle:{x:t,y:s,radius:c},seenUids:{box:{},circle:{}}},g),A.length>0}_queryCell(t,s,c,p,g,x,S,E){const{seenUids:k,hitTest:A,overlapMode:D}=S,R=this.boxCells[g];if(R!==null){const $=this.bboxes;for(const j of R)if(!k.box[j]){k.box[j]=!0;const ee=4*j,ie=this.boxKeys[j];if(t<=$[ee+2]&&s<=$[ee+3]&&c>=$[ee+0]&&p>=$[ee+1]&&(!E||E(ie))&&(!A||!xe(D,ie.overlapMode))&&(x.push({key:ie,x1:$[ee],y1:$[ee+1],x2:$[ee+2],y2:$[ee+3]}),A))return!0}}const G=this.circleCells[g];if(G!==null){const $=this.circles;for(const j of G)if(!k.circle[j]){k.circle[j]=!0;const ee=3*j,ie=this.circleKeys[j];if(this._circleAndRectCollide($[ee],$[ee+1],$[ee+2],t,s,c,p)&&(!E||E(ie))&&(!A||!xe(D,ie.overlapMode))){const ce=$[ee],W=$[ee+1],pe=$[ee+2];if(x.push({key:ie,x1:ce-pe,y1:W-pe,x2:ce+pe,y2:W+pe}),A)return!0}}}return!1}_queryCellCircle(t,s,c,p,g,x,S,E){const{circle:k,seenUids:A,overlapMode:D}=S,R=this.boxCells[g];if(R!==null){const $=this.bboxes;for(const j of R)if(!A.box[j]){A.box[j]=!0;const ee=4*j,ie=this.boxKeys[j];if(this._circleAndRectCollide(k.x,k.y,k.radius,$[ee+0],$[ee+1],$[ee+2],$[ee+3])&&(!E||E(ie))&&!xe(D,ie.overlapMode))return x.push(!0),!0}}const G=this.circleCells[g];if(G!==null){const $=this.circles;for(const j of G)if(!A.circle[j]){A.circle[j]=!0;const ee=3*j,ie=this.circleKeys[j];if(this._circlesCollide($[ee],$[ee+1],$[ee+2],k.x,k.y,k.radius)&&(!E||E(ie))&&!xe(D,ie.overlapMode))return x.push(!0),!0}}}_forEachCell(t,s,c,p,g,x,S,E){const k=this._convertToXCellCoord(t),A=this._convertToYCellCoord(s),D=this._convertToXCellCoord(c),R=this._convertToYCellCoord(p);for(let G=k;G<=D;G++)for(let $=A;$<=R;$++)if(g.call(this,t,s,c,p,this.xCellCount*$+G,x,S,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,s,c,p,g,x){const S=p-t,E=g-s,k=c+x;return k*k>S*S+E*E}_circleAndRectCollide(t,s,c,p,g,x,S){const E=(x-p)/2,k=Math.abs(t-(p+E));if(k>E+c)return!1;const A=(S-g)/2,D=Math.abs(s-(g+A));if(D>A+c)return!1;if(k<=E||D<=A)return!0;const R=k-E,G=D-A;return R*R+G*G<=c*c}}function uo(h,t,s,c,p){const g=u.create();return t?(u.scale(g,g,[1/p,1/p,1]),s||u.rotateZ(g,g,c.angle)):u.multiply(g,c.labelPlaneMatrix,h),g}function Jr(h,t,s,c,p){if(t){const g=u.clone(h);return u.scale(g,g,[p,p,1]),s||u.rotateZ(g,g,-c.angle),g}return c.glCoordMatrix}function kt(h,t,s){let c;s?(c=[h.x,h.y,s(h.x,h.y),1],u.transformMat4(c,c,t)):(c=[h.x,h.y,0,1],zi(c,c,t));const p=c[3];return{point:new u.pointGeometry(c[0]/p,c[1]/p),signedDistanceFromCamera:p}}function Vr(h,t){return .5+h/t*.5}function Tr(h,t){const s=h[0]/h[3],c=h[1]/h[3];return s>=-t[0]&&s<=t[0]&&c>=-t[1]&&c<=t[1]}function kr(h,t,s,c,p,g,x,S,E,k){const A=c?h.textSizeData:h.iconSizeData,D=u.evaluateSizeForZoom(A,s.transform.zoom),R=[256/s.width*2+1,256/s.height*2+1],G=c?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;G.clear();const $=h.lineVertexArray,j=c?h.text.placedSymbolArray:h.icon.placedSymbolArray,ee=s.transform.width/s.transform.height;let ie=!1;for(let ce=0;ce<j.length;ce++){const W=j.get(ce);if(W.hidden||W.writingMode===u.WritingMode.vertical&&!ie){pt(W.numGlyphs,G);continue}let pe;if(ie=!1,k?(pe=[W.anchorX,W.anchorY,k(W.anchorX,W.anchorY),1],u.transformMat4(pe,pe,t)):(pe=[W.anchorX,W.anchorY,0,1],zi(pe,pe,t)),!Tr(pe,R)){pt(W.numGlyphs,G);continue}const he=Vr(s.transform.cameraToCenterDistance,pe[3]),_e=u.evaluateSizeForFeature(A,D,W),ve=x?_e/he:_e*he,Te=new u.pointGeometry(W.anchorX,W.anchorY),ye=kt(Te,p,k).point,Ze={},Re=gt(W,ve,!1,S,t,p,g,h.glyphOffsetArray,$,G,ye,Te,Ze,ee,E,k);ie=Re.useVertical,(Re.notEnoughRoom||ie||Re.needsFlipping&&gt(W,ve,!0,S,t,p,g,h.glyphOffsetArray,$,G,ye,Te,Ze,ee,E,k).notEnoughRoom)&&pt(W.numGlyphs,G)}c?h.text.dynamicLayoutVertexBuffer.updateData(G):h.icon.dynamicLayoutVertexBuffer.updateData(G)}function Wi(h,t,s,c,p,g,x,S,E,k,A,D,R){const G=S.glyphStartIndex+S.numGlyphs,$=S.lineStartIndex,j=S.lineStartIndex+S.lineLength,ee=t.getoffsetX(S.glyphStartIndex),ie=t.getoffsetX(G-1),ce=Zn(h*ee,s,c,p,g,x,S.segment,$,j,E,k,A,D,R);if(!ce)return null;const W=Zn(h*ie,s,c,p,g,x,S.segment,$,j,E,k,A,D,R);return W?{first:ce,last:W}:null}function Le(h,t,s,c){return h===u.WritingMode.horizontal&&Math.abs(s.y-t.y)>Math.abs(s.x-t.x)*c?{useVertical:!0}:(h===u.WritingMode.vertical?t.y<s.y:t.x>s.x)?{needsFlipping:!0}:null}function gt(h,t,s,c,p,g,x,S,E,k,A,D,R,G,$,j){const ee=t/24,ie=h.lineOffsetX*ee,ce=h.lineOffsetY*ee;let W;if(h.numGlyphs>1){const pe=h.glyphStartIndex+h.numGlyphs,he=h.lineStartIndex,_e=h.lineStartIndex+h.lineLength,ve=Wi(ee,S,ie,ce,s,A,D,h,E,g,R,$,j);if(!ve)return{notEnoughRoom:!0};const Te=kt(ve.first.point,x,j).point,ye=kt(ve.last.point,x,j).point;if(c&&!s){const Ze=Le(h.writingMode,Te,ye,G);if(Ze)return Ze}W=[ve.first];for(let Ze=h.glyphStartIndex+1;Ze<pe-1;Ze++)W.push(Zn(ee*S.getoffsetX(Ze),ie,ce,s,A,D,h.segment,he,_e,E,g,R,$,j));W.push(ve.last)}else{if(c&&!s){const he=kt(D,p,j).point,_e=h.lineStartIndex+h.segment+1,ve=new u.pointGeometry(E.getx(_e),E.gety(_e)),Te=kt(ve,p,j),ye=Te.signedDistanceFromCamera>0?Te.point:ft(D,ve,he,1,p,j),Ze=Le(h.writingMode,he,ye,G);if(Ze)return Ze}const pe=Zn(ee*S.getoffsetX(h.glyphStartIndex),ie,ce,s,A,D,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,E,g,R,$,j);if(!pe)return{notEnoughRoom:!0};W=[pe]}for(const pe of W)u.addDynamicAttributes(k,pe.point,pe.angle);return{}}function ft(h,t,s,c,p,g){const x=kt(h.add(h.sub(t)._unit()),p,g).point,S=s.sub(x);return s.add(S._mult(c/S.mag()))}function Zn(h,t,s,c,p,g,x,S,E,k,A,D,R,G){const $=c?h-t:h+t;let j=$>0?1:-1,ee=0;c&&(j*=-1,ee=Math.PI),j<0&&(ee+=Math.PI);let ie=j>0?S+x:S+x+1,ce=p,W=p,pe=0,he=0;const _e=Math.abs($),ve=[];for(;pe+he<=_e;){if(ie+=j,ie<S||ie>=E)return null;if(W=ce,ve.push(ce),ce=D[ie],ce===void 0){const We=new u.pointGeometry(k.getx(ie),k.gety(ie)),mt=kt(We,A,G);if(mt.signedDistanceFromCamera>0)ce=D[ie]=mt.point;else{const _t=ie-j;ce=ft(pe===0?g:new u.pointGeometry(k.getx(_t),k.gety(_t)),We,W,_e-pe+1,A,G)}}pe+=he,he=W.dist(ce)}const Te=(_e-pe)/he,ye=ce.sub(W),Ze=ye.mult(Te)._add(W);Ze._add(ye._unit()._perp()._mult(s*j));const Re=ee+Math.atan2(ce.y-W.y,ce.x-W.x);return ve.push(Ze),{point:Ze,angle:R?Re:0,path:ve}}const Xi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pt(h,t){for(let s=0;s<h;s++){const c=t.length;t.resize(c+4),t.float32.set(Xi,3*c)}}function zi(h,t,s){const c=t[0],p=t[1];return h[0]=s[0]*c+s[4]*p+s[12],h[1]=s[1]*c+s[5]*p+s[13],h[3]=s[3]*c+s[7]*p+s[15],h}const Fn=100;class Vo{constructor(t,s=new Fe(t.width+200,t.height+200,25),c=new Fe(t.width+200,t.height+200,25)){this.transform=t,this.grid=s,this.ignoredGrid=c,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+Fn,this.screenBottomBoundary=t.height+Fn,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(t,s,c,p,g,x){const S=this.projectAndGetPerspectiveRatio(p,t.anchorPointX,t.anchorPointY,x),E=c*S.perspectiveRatio,k=t.x1*E+S.point.x,A=t.y1*E+S.point.y,D=t.x2*E+S.point.x,R=t.y2*E+S.point.y;return!this.isInsideGrid(k,A,D,R)||s!=="always"&&this.grid.hitTest(k,A,D,R,s,g)||S.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[k,A,D,R],offscreen:this.isOffscreen(k,A,D,R)}}placeCollisionCircles(t,s,c,p,g,x,S,E,k,A,D,R,G,$){const j=[],ee=new u.pointGeometry(s.anchorX,s.anchorY),ie=kt(ee,x,$),ce=Vr(this.transform.cameraToCenterDistance,ie.signedDistanceFromCamera),W=(A?g/ce:g*ce)/u.ONE_EM,pe=kt(ee,S,$).point,he=Wi(W,p,s.lineOffsetX*W,s.lineOffsetY*W,!1,pe,ee,s,c,S,{},!1,$);let _e=!1,ve=!1,Te=!0;if(he){const ye=.5*R*ce+G,Ze=new u.pointGeometry(-100,-100),Re=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),We=new Ii,mt=he.first,_t=he.last;let rt=[];for(let Tt=mt.path.length-1;Tt>=1;Tt--)rt.push(mt.path[Tt]);for(let Tt=1;Tt<_t.path.length;Tt++)rt.push(_t.path[Tt]);const Ft=2.5*ye;if(E){const Tt=rt.map(zt=>kt(zt,E,$));rt=Tt.some(zt=>zt.signedDistanceFromCamera<=0)?[]:Tt.map(zt=>zt.point)}let Ot=[];if(rt.length>0){const Tt=rt[0].clone(),zt=rt[0].clone();for(let $t=1;$t<rt.length;$t++)Tt.x=Math.min(Tt.x,rt[$t].x),Tt.y=Math.min(Tt.y,rt[$t].y),zt.x=Math.max(zt.x,rt[$t].x),zt.y=Math.max(zt.y,rt[$t].y);Ot=Tt.x>=Ze.x&&zt.x<=Re.x&&Tt.y>=Ze.y&&zt.y<=Re.y?[rt]:zt.x<Ze.x||Tt.x>Re.x||zt.y<Ze.y||Tt.y>Re.y?[]:u.clipLine([rt],Ze.x,Ze.y,Re.x,Re.y)}for(const Tt of Ot){We.reset(Tt,.25*ye);let zt=0;zt=We.length<=.5*ye?1:Math.ceil(We.paddedLength/Ft)+1;for(let $t=0;$t<zt;$t++){const Nn=$t/Math.max(zt-1,1),fi=We.lerp(Nn),ei=fi.x+Fn,mi=fi.y+Fn;j.push(ei,mi,ye,0);const to=ei-ye,jr=mi-ye,yr=ei+ye,Pi=mi+ye;if(Te=Te&&this.isOffscreen(to,jr,yr,Pi),ve=ve||this.isInsideGrid(to,jr,yr,Pi),t!=="always"&&this.grid.hitTestCircle(ei,mi,ye,t,D)&&(_e=!0,!k))return{circles:[],offscreen:!1,collisionDetected:_e}}}}return{circles:!k&&_e||!ve||ce<this.perspectiveRatioCutoff?[]:j,offscreen:Te,collisionDetected:_e}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const s=[];let c=1/0,p=1/0,g=-1/0,x=-1/0;for(const A of t){const D=new u.pointGeometry(A.x+Fn,A.y+Fn);c=Math.min(c,D.x),p=Math.min(p,D.y),g=Math.max(g,D.x),x=Math.max(x,D.y),s.push(D)}const S=this.grid.query(c,p,g,x).concat(this.ignoredGrid.query(c,p,g,x)),E={},k={};for(const A of S){const D=A.key;if(E[D.bucketInstanceId]===void 0&&(E[D.bucketInstanceId]={}),E[D.bucketInstanceId][D.featureIndex])continue;const R=[new u.pointGeometry(A.x1,A.y1),new u.pointGeometry(A.x2,A.y1),new u.pointGeometry(A.x2,A.y2),new u.pointGeometry(A.x1,A.y2)];u.polygonIntersectsPolygon(s,R)&&(E[D.bucketInstanceId][D.featureIndex]=!0,k[D.bucketInstanceId]===void 0&&(k[D.bucketInstanceId]=[]),k[D.bucketInstanceId].push(D.featureIndex))}return k}insertCollisionBox(t,s,c,p,g,x){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:s},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,s,c,p,g,x){const S=c?this.ignoredGrid:this.grid,E={bucketInstanceId:p,featureIndex:g,collisionGroupID:x,overlapMode:s};for(let k=0;k<t.length;k+=4)S.insertCircle(E,t[k],t[k+1],t[k+2])}projectAndGetPerspectiveRatio(t,s,c,p){let g;return p?(g=[s,c,p(s,c),1],u.transformMat4(g,g,t)):(g=[s,c,0,1],zi(g,g,t)),{point:new u.pointGeometry((g[0]/g[3]+1)/2*this.transform.width+Fn,(-g[1]/g[3]+1)/2*this.transform.height+Fn),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}}isOffscreen(t,s,c,p){return c<Fn||t>=this.screenRightBoundary||p<Fn||s>this.screenBottomBoundary}isInsideGrid(t,s,c,p){return c>=0&&t<this.gridRightBoundary&&p>=0&&s<this.gridBottomBoundary}getViewportMatrix(){const t=u.identity([]);return u.translate(t,t,[-100,-100,0]),t}}function kn(h,t,s){return t*(u.EXTENT/(h.tileSize*Math.pow(2,s-h.tileID.overscaledZ)))}class ar{constructor(t,s,c,p){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?s:-s))):p&&c?1:0,this.placed=c}isHidden(){return this.opacity===0&&!this.placed}}class Vt{constructor(t,s,c,p,g){this.text=new ar(t?t.text:null,s,c,g),this.icon=new ar(t?t.icon:null,s,p,g)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class $o{constructor(t,s,c){this.text=t,this.icon=s,this.skipFade=c}}class hi{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class co{constructor(t,s,c,p,g){this.bucketInstanceId=t,this.featureIndex=s,this.sourceLayerIndex=c,this.bucketIndex=p,this.tileID=g}}class ho{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const s=++this.maxGroupID;this.collisionGroups[t]={ID:s,predicate:c=>c.collisionGroupID===s}}return this.collisionGroups[t]}}function jo(h,t,s,c,p){const{horizontalAlign:g,verticalAlign:x}=u.getAnchorAlignment(h),S=-(g-.5)*t,E=-(x-.5)*s,k=u.evaluateVariableOffset(h,c);return new u.pointGeometry(S+k[0]*p,E+k[1]*p)}function po(h,t,s,c,p,g){const{x1:x,x2:S,y1:E,y2:k,anchorPointX:A,anchorPointY:D}=h,R=new u.pointGeometry(t,s);return c&&R._rotate(p?g:-g),{x1:x+R.x,y1:E+R.y,x2:S+R.x,y2:k+R.y,anchorPointX:A,anchorPointY:D}}class V{constructor(t,s,c,p,g){this.transform=t.clone(),this.terrain=s,this.collisionIndex=new Vo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ho(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(t,s,c,p){const g=c.getBucket(s),x=c.latestFeatureIndex;if(!g||!x||s.id!==g.layerIds[0])return;const S=c.collisionBoxArray,E=g.layers[0].layout,k=Math.pow(2,this.transform.zoom-c.tileID.overscaledZ),A=c.tileSize/u.EXTENT,D=this.transform.calculatePosMatrix(c.tileID.toUnwrapped()),R=E.get("text-pitch-alignment")==="map",G=E.get("text-rotation-alignment")==="map",$=kn(c,1,this.transform.zoom),j=uo(D,R,G,this.transform,$);let ee=null;if(R){const ce=Jr(D,R,G,this.transform,$);ee=u.multiply([],this.transform.labelPlaneMatrix,ce)}this.retainedQueryData[g.bucketInstanceId]=new co(g.bucketInstanceId,x,g.sourceLayerIndex,g.index,c.tileID);const ie={bucket:g,layout:E,posMatrix:D,textLabelPlaneMatrix:j,labelToScreenMatrix:ee,scale:k,textPixelRatio:A,holdingForFade:c.holdingForFade(),collisionBoxArray:S,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(g.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(g.sourceID)};if(p)for(const ce of g.sortKeyRanges){const{sortKey:W,symbolInstanceStart:pe,symbolInstanceEnd:he}=ce;t.push({sortKey:W,symbolInstanceStart:pe,symbolInstanceEnd:he,parameters:ie})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:g.symbolInstances.length,parameters:ie})}attemptAnchorPlacement(t,s,c,p,g,x,S,E,k,A,D,R,G,$,j,ee){const ie=[R.textOffset0,R.textOffset1],ce=jo(t,c,p,ie,g),W=this.collisionIndex.placeCollisionBox(po(s,ce.x,ce.y,x,S,this.transform.angle),D,E,k,A.predicate,ee);if((!j||this.collisionIndex.placeCollisionBox(po(j,ce.x,ce.y,x,S,this.transform.angle),D,E,k,A.predicate,ee).box.length!==0)&&W.box.length>0){let pe;if(this.prevPlacement&&this.prevPlacement.variableOffsets[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID]&&this.prevPlacement.placements[R.crossTileID].text&&(pe=this.prevPlacement.variableOffsets[R.crossTileID].anchor),R.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[R.crossTileID]={textOffset:ie,width:c,height:p,anchor:t,textBoxScale:g,prevAnchor:pe},this.markUsedJustification(G,t,R,$),G.allowVerticalPlacement&&(this.markUsedOrientation(G,$,R),this.placedOrientations[R.crossTileID]=$),{shift:ce,placedGlyphBoxes:W}}}placeLayerBucketPart(t,s,c){const{bucket:p,layout:g,posMatrix:x,textLabelPlaneMatrix:S,labelToScreenMatrix:E,textPixelRatio:k,holdingForFade:A,collisionBoxArray:D,partiallyEvaluatedTextSize:R,collisionGroup:G}=t.parameters,$=g.get("text-optional"),j=g.get("icon-optional"),ee=u.getOverlapMode(g,"text-overlap","text-allow-overlap"),ie=ee==="always",ce=u.getOverlapMode(g,"icon-overlap","icon-allow-overlap"),W=ce==="always",pe=g.get("text-rotation-alignment")==="map",he=g.get("text-pitch-alignment")==="map",_e=g.get("icon-text-fit")!=="none",ve=g.get("symbol-z-order")==="viewport-y",Te=ie&&(W||!p.hasIconData()||j),ye=W&&(ie||!p.hasTextData()||$);!p.collisionArrays&&D&&p.deserializeCollisionBoxes(D);const Ze=(Re,We)=>{if(s[Re.crossTileID])return;if(A)return void(this.placements[Re.crossTileID]=new $o(!1,!1,!1));let mt=!1,_t=!1,rt=!0,Ft=null,Ot={box:null,offscreen:null},Tt={box:null,offscreen:null},zt=null,$t=null,Nn=null,fi=0,ei=0,mi=0;We.textFeatureIndex?fi=We.textFeatureIndex:Re.useRuntimeCollisionCircles&&(fi=Re.featureIndex),We.verticalTextFeatureIndex&&(ei=We.verticalTextFeatureIndex);const to=this.retainedQueryData[p.bucketInstanceId].tileID,jr=this.terrain?(Pn,wt)=>this.terrain.getElevation(to,Pn,wt):null;for(const Pn of["textBox","verticalTextBox","iconBox","verticalIconBox"]){const wt=We[Pn];wt&&(wt.elevation=jr?jr(wt.anchorPointX,wt.anchorPointY):0)}const yr=We.textBox;if(yr){const Pn=Bt=>{let Un=u.WritingMode.horizontal;if(p.allowVerticalPlacement&&!Bt&&this.prevPlacement){const Vn=this.prevPlacement.placedOrientations[Re.crossTileID];Vn&&(this.placedOrientations[Re.crossTileID]=Vn,Un=Vn,this.markUsedOrientation(p,Un,Re))}return Un},wt=(Bt,Un)=>{if(p.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&We.verticalTextBox){for(const Vn of p.writingModes)if(Vn===u.WritingMode.vertical?(Ot=Un(),Tt=Ot):Ot=Bt(),Ot&&Ot.box&&Ot.box.length)break}else Ot=Bt()};if(g.get("text-variable-anchor")){let Bt=g.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Re.crossTileID]){const on=this.prevPlacement.variableOffsets[Re.crossTileID];Bt.indexOf(on.anchor)>0&&(Bt=Bt.filter(Gr=>Gr!==on.anchor),Bt.unshift(on.anchor))}const Un=(on,Gr,vo)=>{const au=on.x2-on.x1,ns=on.y2-on.y1,rh=Re.textBoxScale,lu=_e&&ce==="never"?Gr:null;let no={box:[],offscreen:!1};const xo=ee!=="never"?2*Bt.length:Bt.length;for(let wo=0;wo<xo;++wo){const Va=this.attemptAnchorPlacement(Bt[wo%Bt.length],on,au,ns,rh,pe,he,k,x,G,wo>=Bt.length?ee:"never",Re,p,vo,lu,jr);if(Va&&(no=Va.placedGlyphBoxes,no&&no.box&&no.box.length)){mt=!0,Ft=Va.shift;break}}return no};wt(()=>Un(yr,We.iconBox,u.WritingMode.horizontal),()=>{const on=We.verticalTextBox;return p.allowVerticalPlacement&&!(Ot&&Ot.box&&Ot.box.length)&&Re.numVerticalGlyphVertices>0&&on?Un(on,We.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),Ot&&(mt=Ot.box,rt=Ot.offscreen);const Vn=Pn(Ot&&Ot.box);if(!mt&&this.prevPlacement){const on=this.prevPlacement.variableOffsets[Re.crossTileID];on&&(this.variableOffsets[Re.crossTileID]=on,this.markUsedJustification(p,on.anchor,Re,Vn))}}else{const Bt=(Un,Vn)=>{const on=this.collisionIndex.placeCollisionBox(Un,ee,k,x,G.predicate,jr);return on&&on.box&&on.box.length&&(this.markUsedOrientation(p,Vn,Re),this.placedOrientations[Re.crossTileID]=Vn),on};wt(()=>Bt(yr,u.WritingMode.horizontal),()=>{const Un=We.verticalTextBox;return p.allowVerticalPlacement&&Re.numVerticalGlyphVertices>0&&Un?Bt(Un,u.WritingMode.vertical):{box:null,offscreen:null}}),Pn(Ot&&Ot.box&&Ot.box.length)}}if(zt=Ot,mt=zt&&zt.box&&zt.box.length>0,rt=zt&&zt.offscreen,Re.useRuntimeCollisionCircles){const Pn=p.text.placedSymbolArray.get(Re.centerJustifiedTextSymbolIndex),wt=u.evaluateSizeForFeature(p.textSizeData,R,Pn),Bt=g.get("text-padding");$t=this.collisionIndex.placeCollisionCircles(ee,Pn,p.lineVertexArray,p.glyphOffsetArray,wt,x,S,E,c,he,G.predicate,Re.collisionCircleDiameter,Bt,jr),$t.circles.length&&$t.collisionDetected&&!c&&u.warnOnce("Collisions detected, but collision boxes are not shown"),mt=ie||$t.circles.length>0&&!$t.collisionDetected,rt=rt&&$t.offscreen}if(We.iconFeatureIndex&&(mi=We.iconFeatureIndex),We.iconBox){const Pn=wt=>{const Bt=_e&&Ft?po(wt,Ft.x,Ft.y,pe,he,this.transform.angle):wt;return this.collisionIndex.placeCollisionBox(Bt,ce,k,x,G.predicate,jr)};Tt&&Tt.box&&Tt.box.length&&We.verticalIconBox?(Nn=Pn(We.verticalIconBox),_t=Nn.box.length>0):(Nn=Pn(We.iconBox),_t=Nn.box.length>0),rt=rt&&Nn.offscreen}const Pi=$||Re.numHorizontalGlyphVertices===0&&Re.numVerticalGlyphVertices===0,Ua=j||Re.numIconVertices===0;if(Pi||Ua?Ua?Pi||(_t=_t&&mt):mt=_t&&mt:_t=mt=_t&&mt,mt&&zt&&zt.box&&this.collisionIndex.insertCollisionBox(zt.box,ee,g.get("text-ignore-placement"),p.bucketInstanceId,Tt&&Tt.box&&ei?ei:fi,G.ID),_t&&Nn&&this.collisionIndex.insertCollisionBox(Nn.box,ce,g.get("icon-ignore-placement"),p.bucketInstanceId,mi,G.ID),$t&&(mt&&this.collisionIndex.insertCollisionCircles($t.circles,ee,g.get("text-ignore-placement"),p.bucketInstanceId,fi,G.ID),c)){const Pn=p.bucketInstanceId;let wt=this.collisionCircleArrays[Pn];wt===void 0&&(wt=this.collisionCircleArrays[Pn]=new hi);for(let Bt=0;Bt<$t.circles.length;Bt+=4)wt.circles.push($t.circles[Bt+0]),wt.circles.push($t.circles[Bt+1]),wt.circles.push($t.circles[Bt+2]),wt.circles.push($t.collisionDetected?1:0)}if(Re.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(p.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[Re.crossTileID]=new $o(mt||Te,_t||ye,rt||p.justReloaded),s[Re.crossTileID]=!0};if(ve){if(t.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const Re=p.getSortedSymbolIndexes(this.transform.angle);for(let We=Re.length-1;We>=0;--We){const mt=Re[We];Ze(p.symbolInstances.get(mt),p.collisionArrays[mt])}}else for(let Re=t.symbolInstanceStart;Re<t.symbolInstanceEnd;Re++)Ze(p.symbolInstances.get(Re),p.collisionArrays[Re]);if(c&&p.bucketInstanceId in this.collisionCircleArrays){const Re=this.collisionCircleArrays[p.bucketInstanceId];u.invert(Re.invProjMatrix,x),Re.viewportMatrix=this.collisionIndex.getViewportMatrix()}p.justReloaded=!1}markUsedJustification(t,s,c,p){let g;g=p===u.WritingMode.vertical?c.verticalPlacedTextSymbolIndex:{left:c.leftJustifiedTextSymbolIndex,center:c.centerJustifiedTextSymbolIndex,right:c.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(s)];const x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex,c.verticalPlacedTextSymbolIndex];for(const S of x)S>=0&&(t.text.placedSymbolArray.get(S).crossTileID=g>=0&&S!==g?0:c.crossTileID)}markUsedOrientation(t,s,c){const p=s===u.WritingMode.horizontal||s===u.WritingMode.horizontalOnly?s:0,g=s===u.WritingMode.vertical?s:0,x=[c.leftJustifiedTextSymbolIndex,c.centerJustifiedTextSymbolIndex,c.rightJustifiedTextSymbolIndex];for(const S of x)t.text.placedSymbolArray.get(S).placedOrientation=p;c.verticalPlacedTextSymbolIndex&&(t.text.placedSymbolArray.get(c.verticalPlacedTextSymbolIndex).placedOrientation=g)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const s=this.prevPlacement;let c=!1;this.prevZoomAdjustment=s?s.zoomAdjustment(this.transform.zoom):0;const p=s?s.symbolFadeChange(t):1,g=s?s.opacities:{},x=s?s.variableOffsets:{},S=s?s.placedOrientations:{};for(const E in this.placements){const k=this.placements[E],A=g[E];A?(this.opacities[E]=new Vt(A,p,k.text,k.icon),c=c||k.text!==A.text.placed||k.icon!==A.icon.placed):(this.opacities[E]=new Vt(null,p,k.text,k.icon,k.skipFade),c=c||k.text||k.icon)}for(const E in g){const k=g[E];if(!this.opacities[E]){const A=new Vt(k,p,!1,!1);A.isHidden()||(this.opacities[E]=A,c=c||k.text.placed||k.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in S)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=S[E]);if(s&&s.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");c?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=s?s.lastPlacementChangeTime:t)}updateLayerOpacities(t,s){const c={};for(const p of s){const g=p.getBucket(t);g&&p.latestFeatureIndex&&t.id===g.layerIds[0]&&this.updateBucketOpacities(g,c,p.collisionBoxArray)}}updateBucketOpacities(t,s,c){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const p=t.layers[0].layout,g=new Vt(null,0,!1,!1,!0),x=p.get("text-allow-overlap"),S=p.get("icon-allow-overlap"),E=p.get("text-variable-anchor"),k=p.get("text-rotation-alignment")==="map",A=p.get("text-pitch-alignment")==="map",D=p.get("icon-text-fit")!=="none",R=new Vt(null,0,x&&(S||!t.hasIconData()||p.get("icon-optional")),S&&(x||!t.hasTextData()||p.get("text-optional")),!0);!t.collisionArrays&&c&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(c);const G=($,j,ee)=>{for(let ie=0;ie<j/4;ie++)$.opacityVertexArray.emplaceBack(ee)};for(let $=0;$<t.symbolInstances.length;$++){const j=t.symbolInstances.get($),{numHorizontalGlyphVertices:ee,numVerticalGlyphVertices:ie,crossTileID:ce}=j;let W=this.opacities[ce];s[ce]?W=g:W||(W=R,this.opacities[ce]=W),s[ce]=!0;const pe=j.numIconVertices>0,he=this.placedOrientations[j.crossTileID],_e=he===u.WritingMode.vertical,ve=he===u.WritingMode.horizontal||he===u.WritingMode.horizontalOnly;if(ee>0||ie>0){const Te=re(W.text);G(t.text,ee,_e?ge:Te),G(t.text,ie,ve?ge:Te);const ye=W.text.isHidden();[j.rightJustifiedTextSymbolIndex,j.centerJustifiedTextSymbolIndex,j.leftJustifiedTextSymbolIndex].forEach(We=>{We>=0&&(t.text.placedSymbolArray.get(We).hidden=ye||_e?1:0)}),j.verticalPlacedTextSymbolIndex>=0&&(t.text.placedSymbolArray.get(j.verticalPlacedTextSymbolIndex).hidden=ye||ve?1:0);const Ze=this.variableOffsets[j.crossTileID];Ze&&this.markUsedJustification(t,Ze.anchor,j,he);const Re=this.placedOrientations[j.crossTileID];Re&&(this.markUsedJustification(t,"left",j,Re),this.markUsedOrientation(t,Re,j))}if(pe){const Te=re(W.icon),ye=!(D&&j.verticalPlacedIconSymbolIndex&&_e);j.placedIconSymbolIndex>=0&&(G(t.icon,j.numIconVertices,ye?Te:ge),t.icon.placedSymbolArray.get(j.placedIconSymbolIndex).hidden=W.icon.isHidden()),j.verticalPlacedIconSymbolIndex>=0&&(G(t.icon,j.numVerticalIconVertices,ye?ge:Te),t.icon.placedSymbolArray.get(j.verticalPlacedIconSymbolIndex).hidden=W.icon.isHidden())}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Te=t.collisionArrays[$];if(Te){let ye=new u.pointGeometry(0,0);if(Te.textBox||Te.verticalTextBox){let Re=!0;if(E){const We=this.variableOffsets[ce];We?(ye=jo(We.anchor,We.width,We.height,We.textOffset,We.textBoxScale),k&&ye._rotate(A?this.transform.angle:-this.transform.angle)):Re=!1}Te.textBox&&I(t.textCollisionBox.collisionVertexArray,W.text.placed,!Re||_e,ye.x,ye.y),Te.verticalTextBox&&I(t.textCollisionBox.collisionVertexArray,W.text.placed,!Re||ve,ye.x,ye.y)}const Ze=Boolean(!ve&&Te.verticalIconBox);Te.iconBox&&I(t.iconCollisionBox.collisionVertexArray,W.icon.placed,Ze,D?ye.x:0,D?ye.y:0),Te.verticalIconBox&&I(t.iconCollisionBox.collisionVertexArray,W.icon.placed,!Ze,D?ye.x:0,D?ye.y:0)}}}if(t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.text.opacityVertexArray.length!==t.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${t.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${t.text.layoutVertexArray.length}) / 4`);if(t.icon.opacityVertexArray.length!==t.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${t.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${t.icon.layoutVertexArray.length}) / 4`);if(t.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=$.invProjMatrix,t.placementViewportMatrix=$.viewportMatrix,t.collisionCircleArray=$.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,s){const c=this.zoomAtLastRecencyCheck===s?1-this.zoomAdjustment(s):1;return this.zoomAtLastRecencyCheck=s,this.commitTime+this.fadeDuration*c>t}setStale(){this.stale=!0}}function I(h,t,s,c,p){h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0),h.emplaceBack(t?1:0,s?1:0,c||0,p||0)}const P=Math.pow(2,25),N=Math.pow(2,24),U=Math.pow(2,17),K=Math.pow(2,16),ne=Math.pow(2,9),J=Math.pow(2,8),Y=Math.pow(2,1);function re(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,s=Math.floor(127*h.opacity);return s*P+t*N+s*U+t*K+s*ne+t*J+s*Y+t}const ge=0;class Ee{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&!t.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,s,c,p,g){const x=this._bucketParts;for(;this._currentTileIndex<t.length;)if(s.getBucketParts(x,p,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,g())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,x.sort((S,E)=>S.sortKey-E.sortKey));this._currentPartIndex<x.length;)if(s.placeLayerBucketPart(x[this._currentPartIndex],this._seenCrossTileIDs,c),this._currentPartIndex++,g())return!0;return!1}}class me{constructor(t,s,c,p,g,x,S,E){this.placement=new V(t,s,x,S,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1}isDone(){return this._done}continuePlacement(t,s,c){const p=u.exported.now(),g=()=>{const x=u.exported.now()-p;return!this._forceFullPlacement&&x>2};for(;this._currentPlacementIndex>=0;){const x=s[t[this._currentPlacementIndex]],S=this.placement.collisionIndex.transform.zoom;if(x.type==="symbol"&&(!x.minzoom||x.minzoom<=S)&&(!x.maxzoom||x.maxzoom>S)){if(this._inProgressLayer||(this._inProgressLayer=new Ee(x)),this._inProgressLayer.continuePlacement(c[x.source],this.placement,this._showCollisionBoxes,x,g))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const Ye=512/u.EXTENT/2;class Qe{constructor(t,s,c){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=c;for(let p=0;p<s.length;p++){const g=s.get(p),x=g.key;this.indexedSymbolInstances[x]||(this.indexedSymbolInstances[x]=[]),this.indexedSymbolInstances[x].push({crossTileID:g.crossTileID,coord:this.getScaledCoordinates(g,t)})}}getScaledCoordinates(t,s){const c=Ye/Math.pow(2,s.canonical.z-this.tileID.canonical.z);return{x:Math.floor((s.canonical.x*u.EXTENT+t.anchorX)*c),y:Math.floor((s.canonical.y*u.EXTENT+t.anchorY)*c)}}findMatches(t,s,c){const p=this.tileID.canonical.z<s.canonical.z?1:Math.pow(2,this.tileID.canonical.z-s.canonical.z);for(let g=0;g<t.length;g++){const x=t.get(g);if(x.crossTileID)continue;const S=this.indexedSymbolInstances[x.key];if(!S)continue;const E=this.getScaledCoordinates(x,s);for(const k of S)if(Math.abs(k.coord.x-E.x)<=p&&Math.abs(k.coord.y-E.y)<=p&&!c[k.crossTileID]){c[k.crossTileID]=!0,x.crossTileID=k.crossTileID;break}}}}class Ge{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class at{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const s=Math.round((t-this.lng)/360);if(s!==0)for(const c in this.indexes){const p=this.indexes[c],g={};for(const x in p){const S=p[x];S.tileID=S.tileID.unwrapTo(S.tileID.wrap+s),g[S.tileID.key]=S}this.indexes[c]=g}this.lng=t}addBucket(t,s,c){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===s.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let g=0;g<s.symbolInstances.length;g++)s.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const p=this.usedCrossTileIDs[t.overscaledZ];for(const g in this.indexes){const x=this.indexes[g];if(Number(g)>t.overscaledZ)for(const S in x){const E=x[S];E.tileID.isChildOf(t)&&E.findMatches(s.symbolInstances,t,p)}else{const S=x[t.scaledTo(Number(g)).key];S&&S.findMatches(s.symbolInstances,t,p)}}for(let g=0;g<s.symbolInstances.length;g++){const x=s.symbolInstances.get(g);x.crossTileID||(x.crossTileID=c.generate(),p[x.crossTileID]=!0)}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Qe(t,s.symbolInstances,s.bucketInstanceId),!0}removeBucketCrossTileIDs(t,s){for(const c in s.indexedSymbolInstances)for(const p of s.indexedSymbolInstances[c])delete this.usedCrossTileIDs[t][p.crossTileID]}removeStaleBuckets(t){let s=!1;for(const c in this.indexes){const p=this.indexes[c];for(const g in p)t[p[g].bucketInstanceId]||(this.removeBucketCrossTileIDs(c,p[g]),delete p[g],s=!0)}return s}}class ct{constructor(){this.layerIndexes={},this.crossTileIDs=new Ge,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,s,c){let p=this.layerIndexes[t.id];p===void 0&&(p=this.layerIndexes[t.id]=new at);let g=!1;const x={};p.handleWrapJump(c);for(const S of s){const E=S.getBucket(t);E&&t.id===E.layerIds[0]&&(E.bucketInstanceId||(E.bucketInstanceId=++this.maxBucketInstanceId),p.addBucket(S.tileID,E,this.crossTileIDs)&&(g=!0),x[E.bucketInstanceId]=!0)}return p.removeStaleBuckets(x)&&(g=!0),g}pruneUnusedLayers(t){const s={};t.forEach(c=>{s[c]=!0});for(const c in this.layerIndexes)s[c]||delete this.layerIndexes[c]}}var Ct=u.createLayout([{name:"a_pos",type:"Int16",components:2}]);class dt extends u.Evented{constructor(t){super(),this.sourceCache=t,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.renderHistory=[],this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,this.renderHistorySize=t._cache.max,t.usedForTerrain=!0,t.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null;for(const t in this._tiles){const s=this._tiles[t];s.textures.forEach(c=>c.destroy()),s.textures=[]}}update(t,s){this.sourceCache.update(t,s),this._renderableTilesKeys=[];for(const c of t.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:s}))this._renderableTilesKeys.push(c.key),this._tiles[c.key]||(c.posMatrix=new Float64Array(16),u.ortho(c.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),this._tiles[c.key]=new pn(c,this.tileSize))}removeOutdated(t){const s={};this.renderHistory=this.renderHistory.filter((c,p)=>this.renderHistory.indexOf(c)===p).slice(0,this.renderHistorySize);for(const c of this._renderableTilesKeys)s[c]=!0;for(const c of this.renderHistory)s[c]=!0;for(const c in this._tiles)s[c]||(this._tiles[c].clearTextures(t),delete this._tiles[c])}getRenderableTiles(){return this._renderableTilesKeys.map(t=>this.getTileByID(t))}getTileByID(t){return this._tiles[t]}getTerrainCoords(t){const s={};for(const c of this._renderableTilesKeys){const p=this._tiles[c].tileID;if(p.canonical.equals(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16),u.ortho(g.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),s[c]=g}else if(p.canonical.isChildOf(t.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=p.canonical.z-t.canonical.z,S=p.canonical.x-(p.canonical.x>>x<<x),E=p.canonical.y-(p.canonical.y>>x<<x),k=u.EXTENT>>x;u.ortho(g.posMatrix,0,k,0,k,0,1),u.translate(g.posMatrix,g.posMatrix,[-S*k,-E*k,0]),s[c]=g}else if(t.canonical.isChildOf(p.canonical)){const g=t.clone();g.posMatrix=new Float64Array(16);const x=t.canonical.z-p.canonical.z,S=t.canonical.x-(t.canonical.x>>x<<x),E=t.canonical.y-(t.canonical.y>>x<<x),k=u.EXTENT>>x;u.ortho(g.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),u.translate(g.posMatrix,g.posMatrix,[S*k,E*k,0]),u.scale(g.posMatrix,g.posMatrix,[1/2**x,1/2**x,0]),s[c]=g}}return s}getSourceTile(t,s){const c=this.sourceCache._source;let p=t.overscaledZ-this.deltaZoom;if(p>c.maxzoom&&(p=c.maxzoom),p<c.minzoom)return null;this._sourceTileCache[t.key]||(this._sourceTileCache[t.key]=t.scaledTo(p).key);let g=this.sourceCache.getTileByID(this._sourceTileCache[t.key]);if((!g||!g.dem)&&s)for(;p>=c.minzoom&&(!g||!g.dem);)g=this.sourceCache.getTileByID(t.scaledTo(p--).key);return g}tilesAfterTime(t=Date.now()){return Object.values(this._tiles).filter(s=>s.timeLoaded>=t)}}class yt{constructor(t,s,c){this.style=t,this.sourceCache=new dt(s),this.options=c,this.exaggeration=typeof c.exaggeration=="number"?c.exaggeration:1,this.elevationOffset=typeof c.elevationOffset=="number"?c.elevationOffset:450,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024,this.clearRerenderCache()}getDEMElevation(t,s,c,p=u.EXTENT){if(!(s>=0&&s<p&&c>=0&&c<p))return this.elevationOffset;let g=0;const x=this.getTerrainData(t);if(x.tile&&x.tile.dem){const S=u.transformMat4$1([],[s/p*u.EXTENT,c/p*u.EXTENT],x.u_terrain_matrix),E=[S[0]*x.tile.dem.dim,S[1]*x.tile.dem.dim],k=[Math.floor(E[0]),Math.floor(E[1])],A=x.tile.dem.get(k[0],k[1]),D=x.tile.dem.get(k[0],k[1]+1),R=x.tile.dem.get(k[0]+1,k[1]),G=x.tile.dem.get(k[0]+1,k[1]+1);g=u.number(u.number(A,D,E[0]-k[0]),u.number(R,G,E[0]-k[0]),E[1]-k[1])}return g}rememberForRerender(t,s){for(const c in this.sourceCache._tiles){const p=this.sourceCache._tiles[c];(p.tileID.equals(s)||p.tileID.isChildOf(s))&&(t===this.sourceCache.sourceCache.id&&(p.timeLoaded=Date.now()),this._rerender[t]=this._rerender[t]||{},this._rerender[t][p.tileID.key]=!0)}}needsRerender(t,s){return this._rerender[t]&&this._rerender[t][s.key]}clearRerenderCache(){this._rerender={}}getElevation(t,s,c,p=u.EXTENT){return(this.getDEMElevation(t,s,c,p)+this.elevationOffset)*this.exaggeration}getTerrainData(t){if(!this._emptyDemTexture){const p=this.style.map.painter.context,g=new u.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new we(p,g,p.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new we(p,new u.RGBAImage({width:1,height:1}),p.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.identity([])}const s=this.sourceCache.getSourceTile(t,!0);if(s&&s.dem&&(!s.demTexture||s.needsTerrainPrepare)){const p=this.style.map.painter.context;s.demTexture=this.style.map.painter.getTileTexture(s.dem.stride),s.demTexture?s.demTexture.update(s.dem.getPixels(),{premultiply:!1}):s.demTexture=new we(p,s.dem.getPixels(),p.gl.RGBA,{premultiply:!1}),s.demTexture.bind(p.gl.NEAREST,p.gl.CLAMP_TO_EDGE),s.needsTerrainPrepare=!1}const c=s&&s+s.tileID.key+t.key;if(c&&!this._demMatrixCache[c]){const p=this.sourceCache.sourceCache._source.maxzoom;let g=t.canonical.z-s.tileID.canonical.z;t.overscaledZ>t.canonical.z&&(t.canonical.z>=p?g=t.canonical.z-p:u.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const x=t.canonical.x-(t.canonical.x>>g<<g),S=t.canonical.y-(t.canonical.y>>g<<g),E=u.fromScaling(new Float64Array(16),[1/(u.EXTENT<<g),1/(u.EXTENT<<g),0]);u.translate(E,E,[x*u.EXTENT,S*u.EXTENT,0]),this._demMatrixCache[t.key]={matrix:E,coord:t}}return{u_depth:2,u_terrain:3,u_terrain_dim:s&&s.dem&&s.dem.dim||1,u_terrain_matrix:c?this._demMatrixCache[t.key].matrix:this._emptyDemMatrix,u_terrain_unpack:s&&s.dem&&s.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_offset:this.elevationOffset,u_terrain_exaggeration:this.exaggeration,texture:(s&&s.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:s}}getRTTFramebuffer(){const t=this.style.map.painter;if(!this._rttFramebuffer){const s=this.sourceCache.tileSize*this.qualityFactor;this._rttFramebuffer=t.context.createFramebuffer(s,s,!0),this._rttFramebuffer.depthAttachment.set(t.context.createRenderbuffer(t.context.gl.DEPTH_COMPONENT16,s,s))}return this._rttFramebuffer}getFramebuffer(t){const s=this.style.map.painter,c=s.width/devicePixelRatio,p=s.height/devicePixelRatio;return!this._fbo||this._fbo.width===c&&this._fbo.height===p||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new we(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new we(s.context,{width:c,height:p,data:null},s.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(s.context.gl.NEAREST,s.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=s.context.createFramebuffer(c,p,!0),this._fbo.depthAttachment.set(s.context.createRenderbuffer(s.context.gl.DEPTH_COMPONENT16,c,p))),this._fbo.colorAttachment.set(t==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const t=this.style.map.painter.context;if(this._coordsTexture)return this._coordsTexture;const s=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let g=0,x=0;g<this._coordsTextureSize;g++)for(let S=0;S<this._coordsTextureSize;S++,x+=4)s[x+0]=255&S,s[x+1]=255&g,s[x+2]=S>>8<<4|g>>8,s[x+3]=0;const c=new u.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(s.buffer)),p=new we(t,c,t.gl.RGBA,{premultiply:!1});return p.bind(t.gl.NEAREST,t.gl.CLAMP_TO_EDGE),this._coordsTexture=p,p}pointCoordinate(t){const s=new Uint8Array(4),c=this.style.map.painter,p=c.context,g=p.gl;p.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),g.readPixels(t.x,c.height/devicePixelRatio-t.y-1,1,1,g.RGBA,g.UNSIGNED_BYTE,s),p.bindFramebuffer.set(null);const x=s[0]+(s[2]>>4<<8),S=s[1]+((15&s[2])<<8),E=this.coordsIndex[255-s[3]],k=E&&this.sourceCache.getTileByID(E);if(!k)return null;const A=this._coordsTextureSize,D=(1<<k.tileID.canonical.z)*A;return new u.MercatorCoordinate((k.tileID.canonical.x*A+x)/D,(k.tileID.canonical.y*A+S)/D,this.getElevation(k.tileID,x,S,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const t=this.style.map.painter.context,s=new u.PosArray,c=new u.TriangleIndexArray,p=this.meshSize,g=u.EXTENT/p,x=p*p;for(let S=0;S<=p;S++)for(let E=0;E<=p;E++)s.emplaceBack(E*g,S*g);for(let S=0;S<x;S+=p+1)for(let E=0;E<p;E++)c.emplaceBack(E+S,p+E+S+1,p+E+S+2),c.emplaceBack(E+S,p+E+S+2,E+S+1);return this._mesh={indexBuffer:t.createIndexBuffer(c),vertexBuffer:t.createVertexBuffer(s,Ct.members),segments:u.SegmentVector.simpleSegment(0,0,s.length,c.length)},this._mesh}getMinMaxElevation(t){const s=this.getTerrainData(t).tile,c={minElevation:null,maxElevation:null};return s&&s.dem&&(c.minElevation=(s.dem.min+this.elevationOffset)*this.exaggeration,c.maxElevation=(s.dem.max+this.elevationOffset)*this.exaggeration),c}}const It=(h,t)=>u.emitValidationErrors(h,t&&t.filter(s=>s.identifier!=="source.canvas")),jt=u.pick(St,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),On=u.pick(St,["setCenter","setZoom","setBearing","setPitch"]),en=function(){const h={},t=u.spec.$version;for(const s in u.spec.$root){const c=u.spec.$root[s];if(c.required){let p=null;p=s==="version"?t:c.type==="array"?[]:{},p!=null&&(h[s]=p)}}return h}();class Qn extends u.Evented{constructor(t,s={}){super(),this.map=t,this.dispatcher=new ht(Yr(),this),this.imageManager=new se,this.imageManager.setEventedParent(this),this.glyphManager=new Me(t._requestManager,s.localIdeographFontFamily),this.lineAtlas=new Mt(256,512),this.crossTileSymbolIndex=new ct,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const c=this;this._rtlTextPluginCallback=Qn.registerForPluginStateChange(p=>{c.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:p.pluginStatus,pluginURL:p.pluginURL},(g,x)=>{if(u.triggerPluginCompletionEvent(g),x&&x.every(S=>S))for(const S in c.sourceCaches)c.sourceCaches[S].reload()})}),this.on("data",p=>{if(p.dataType!=="source"||p.sourceDataType!=="metadata")return;const g=this.sourceCaches[p.sourceId];if(!g)return;const x=g.getSource();if(x&&x.vectorLayerIds)for(const S in this._layers){const E=this._layers[S];E.source===x.id&&this._validateLayer(E)}})}loadURL(t,s={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const c=typeof s.validate!="boolean"||s.validate,p=this.map._requestManager.transformRequest(t,u.ResourceType.Style);this._request=u.getJSON(p,(g,x)=>{this._request=null,g?this.fire(new u.ErrorEvent(g)):x&&this._load(x,c)})}loadJSON(t,s={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(t,s.validate!==!1)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(en,!1)}_load(t,s){if(s&&It(this,u.validateStyle(t)))return;this._loaded=!0,this.stylesheet=t;for(const p in t.sources)this.addSource(p,t.sources[p],{validate:!1});t.sprite?this._loadSprite(t.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(t.glyphs);const c=qi(this.stylesheet.layers);this._order=c.map(p=>p.id),this._layers={},this._serializedLayers={};for(let p of c)p=u.createStyleLayer(p),p.setEventedParent(this,{layer:{id:p.id}}),this._layers[p.id]=p,this._serializedLayers[p.id]=p.serialize();this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new He(this.stylesheet.light),this.setTerrain(this.stylesheet.terrain),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}_loadSprite(t){this._spriteRequest=function(s,c,p,g){let x,S,E;const k=p>1?"@2x":"";let A=u.getJSON(c.transformRequest(c.normalizeSpriteURL(s,k,".json"),u.ResourceType.SpriteJSON),(G,$)=>{A=null,E||(E=G,x=$,R())}),D=u.getImage(c.transformRequest(c.normalizeSpriteURL(s,k,".png"),u.ResourceType.SpriteImage),(G,$)=>{D=null,E||(E=G,S=$,R())});function R(){if(E)g(E);else if(x&&S){const G=u.exported.getImageData(S),$={};for(const j in x){const{width:ee,height:ie,x:ce,y:W,sdf:pe,pixelRatio:he,stretchX:_e,stretchY:ve,content:Te}=x[j],ye=new u.RGBAImage({width:ee,height:ie});u.RGBAImage.copy(G,ye,{x:ce,y:W},{x:0,y:0},{width:ee,height:ie}),$[j]={data:ye,pixelRatio:he,sdf:pe,stretchX:_e,stretchY:ve,content:Te}}g(null,$)}}return{cancel(){A&&(A.cancel(),A=null),D&&(D.cancel(),D=null)}}}(t,this.map._requestManager,this.map.getPixelRatio(),(s,c)=>{if(this._spriteRequest=null,s)this.fire(new u.ErrorEvent(s));else if(c)for(const p in c)this.imageManager.addImage(p,c[p]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(t){const s=this.sourceCaches[t.source];if(!s)return;const c=t.sourceLayer;if(!c)return;const p=s.getSource();(p.type==="geojson"||p.vectorLayerIds&&p.vectorLayerIds.indexOf(c)===-1)&&this.fire(new u.ErrorEvent(new Error(`Source layer "${c}" does not exist on source "${p.id}" as specified by style layer "${t.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const s=[];for(const c of t){const p=this._layers[c];p.type!=="custom"&&s.push(p.serialize())}return s}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(t){if(!this._loaded)return;const s=this._changed;if(this._changed){const p=Object.keys(this._updatedLayers),g=Object.keys(this._removedLayers);(p.length||g.length)&&this._updateWorkerLayers(p,g);for(const x in this._updatedSources){const S=this._updatedSources[x];if(S==="reload")this._reloadSource(x);else{if(S!=="clear")throw new Error(`Invalid action ${S}`);this._clearSource(x)}}this._updateTilesForChangedImages();for(const x in this._updatedPaintProps)this._layers[x].updateTransitions(t);this.light.updateTransitions(t),this._resetUpdates()}const c={};for(const p in this.sourceCaches){const g=this.sourceCaches[p];c[p]=g.used,g.used=!1}for(const p of this._order){const g=this._layers[p];g.recalculate(t,this._availableImages),!g.isHidden(t.zoom)&&g.source&&(this.sourceCaches[g.source].used=!0)}for(const p in c){const g=this.sourceCaches[p];c[p]!==g.used&&g.fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:p}))}this.light.recalculate(t),this.z=t.zoom,s&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const s in this.sourceCaches)this.sourceCaches[s].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,s){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:s})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setTerrain(t){if(this._checkLoaded(),this._terrainDataCallback&&this.off("data",this._terrainDataCallback),this._terrainfreezeElevationCallback&&this.map.off("freezeElevation",this._terrainfreezeElevationCallback),t){const s=this.sourceCaches[t.source];if(!s)throw new Error(`cannot load terrain, because there exists no source with ID: ${t.source}`);this.terrain=new yt(this,s,t),this.map.transform.updateElevation(this.terrain),this._terrainfreezeElevationCallback=c=>{c.freeze?this.map.transform.freezeElevation=!0:(this.map.transform.freezeElevation=!1,this.map.transform.recalculateZoom(this.terrain))},this._terrainDataCallback=c=>{c.tile&&(c.sourceId===t.source?(this.map.transform.updateElevation(this.terrain),this.terrain.rememberForRerender(c.sourceId,c.tile.tileID)):c.source.type==="geojson"&&this.terrain.rememberForRerender(c.sourceId,c.tile.tileID))},this.on("data",this._terrainDataCallback),this.map.on("freezeElevation",this._terrainfreezeElevationCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.map.transform.updateElevation(this.terrain);this.map.fire(new u.Event("terrain",{terrain:t}))}setState(t){if(this._checkLoaded(),It(this,u.validateStyle(t)))return!1;(t=u.clone$1(t)).layers=qi(t.layers);const s=function(p,g){if(!p)return[{command:St.setStyle,args:[g]}];let x=[];try{if(!te(p.version,g.version))return[{command:St.setStyle,args:[g]}];te(p.center,g.center)||x.push({command:St.setCenter,args:[g.center]}),te(p.zoom,g.zoom)||x.push({command:St.setZoom,args:[g.zoom]}),te(p.bearing,g.bearing)||x.push({command:St.setBearing,args:[g.bearing]}),te(p.pitch,g.pitch)||x.push({command:St.setPitch,args:[g.pitch]}),te(p.sprite,g.sprite)||x.push({command:St.setSprite,args:[g.sprite]}),te(p.glyphs,g.glyphs)||x.push({command:St.setGlyphs,args:[g.glyphs]}),te(p.transition,g.transition)||x.push({command:St.setTransition,args:[g.transition]}),te(p.light,g.light)||x.push({command:St.setLight,args:[g.light]});const S={},E=[];(function(A,D,R,G){let $;for($ in D=D||{},A=A||{})Object.prototype.hasOwnProperty.call(A,$)&&(Object.prototype.hasOwnProperty.call(D,$)||Bn($,R,G));for($ in D)Object.prototype.hasOwnProperty.call(D,$)&&(Object.prototype.hasOwnProperty.call(A,$)?te(A[$],D[$])||(A[$].type==="geojson"&&D[$].type==="geojson"&&As(A,D,$)?R.push({command:St.setGeoJSONSourceData,args:[$,D[$].data]}):Ur($,D,R,G)):cn($,D,R))})(p.sources,g.sources,E,S);const k=[];p.layers&&p.layers.forEach(A=>{S[A.source]?x.push({command:St.removeLayer,args:[A.id]}):k.push(A)}),x=x.concat(E),function(A,D,R){D=D||[];const G=(A=A||[]).map(Ci),$=D.map(Ci),j=A.reduce(Uo,{}),ee=D.reduce(Uo,{}),ie=G.slice(),ce=Object.create(null);let W,pe,he,_e,ve,Te,ye;for(W=0,pe=0;W<G.length;W++)he=G[W],Object.prototype.hasOwnProperty.call(ee,he)?pe++:(R.push({command:St.removeLayer,args:[he]}),ie.splice(ie.indexOf(he,pe),1));for(W=0,pe=0;W<$.length;W++)he=$[$.length-1-W],ie[ie.length-1-W]!==he&&(Object.prototype.hasOwnProperty.call(j,he)?(R.push({command:St.removeLayer,args:[he]}),ie.splice(ie.lastIndexOf(he,ie.length-pe),1)):pe++,Te=ie[ie.length-W],R.push({command:St.addLayer,args:[ee[he],Te]}),ie.splice(ie.length-W,0,he),ce[he]=!0);for(W=0;W<$.length;W++)if(he=$[W],_e=j[he],ve=ee[he],!ce[he]&&!te(_e,ve))if(te(_e.source,ve.source)&&te(_e["source-layer"],ve["source-layer"])&&te(_e.type,ve.type)){for(ye in ki(_e.layout,ve.layout,R,he,null,St.setLayoutProperty),ki(_e.paint,ve.paint,R,he,null,St.setPaintProperty),te(_e.filter,ve.filter)||R.push({command:St.setFilter,args:[he,ve.filter]}),te(_e.minzoom,ve.minzoom)&&te(_e.maxzoom,ve.maxzoom)||R.push({command:St.setLayerZoomRange,args:[he,ve.minzoom,ve.maxzoom]}),_e)Object.prototype.hasOwnProperty.call(_e,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?ki(_e[ye],ve[ye],R,he,ye.slice(6),St.setPaintProperty):te(_e[ye],ve[ye])||R.push({command:St.setLayerProperty,args:[he,ye,ve[ye]]}));for(ye in ve)Object.prototype.hasOwnProperty.call(ve,ye)&&!Object.prototype.hasOwnProperty.call(_e,ye)&&ye!=="layout"&&ye!=="paint"&&ye!=="filter"&&ye!=="metadata"&&ye!=="minzoom"&&ye!=="maxzoom"&&(ye.indexOf("paint.")===0?ki(_e[ye],ve[ye],R,he,ye.slice(6),St.setPaintProperty):te(_e[ye],ve[ye])||R.push({command:St.setLayerProperty,args:[he,ye,ve[ye]]}))}else R.push({command:St.removeLayer,args:[he]}),Te=ie[ie.lastIndexOf(he)+1],R.push({command:St.addLayer,args:[ve,Te]})}(k,g.layers,x)}catch(S){console.warn("Unable to compute style diff:",S),x=[{command:St.setStyle,args:[g]}]}return x}(this.serialize(),t).filter(p=>!(p.command in On));if(s.length===0)return!1;const c=s.filter(p=>!(p.command in jt));if(c.length>0)throw new Error(`Unimplemented: ${c.map(p=>p.command).join(", ")}.`);return s.forEach(p=>{p.command!=="setTransition"&&this[p.command].apply(this,p.args)}),this.stylesheet=t,!0}addImage(t,s){if(this.getImage(t))return this.fire(new u.ErrorEvent(new Error(`An image named "${t}" already exists.`)));this.imageManager.addImage(t,s),this._afterImageUpdated(t)}updateImage(t,s){this.imageManager.updateImage(t,s)}getImage(t){return this.imageManager.getImage(t)}removeImage(t){if(!this.getImage(t))return this.fire(new u.ErrorEvent(new Error(`An image named "${t}" does not exist.`)));this.imageManager.removeImage(t),this._afterImageUpdated(t)}_afterImageUpdated(t){this._availableImages=this.imageManager.listImages(),this._changedImages[t]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(t,s,c={}){if(this._checkLoaded(),this.sourceCaches[t]!==void 0)throw new Error(`Source "${t}" already exists.`);if(!s.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(s).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(s.type)>=0&&this._validate(u.validateStyle.source,`sources.${t}`,s,null,c))return;this.map&&this.map._collectResourceTiming&&(s.collectResourceTiming=!0);const p=this.sourceCaches[t]=new Rt(t,s,this.dispatcher);p.style=this,p.setEventedParent(this,()=>({isSourceLoaded:this.loaded(),source:p.serialize(),sourceId:t})),p.onAdd(this.map),this._changed=!0}removeSource(t){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error("There is no source with this ID");for(const c in this._layers)if(this._layers[c].source===t)return this.fire(new u.ErrorEvent(new Error(`Source "${t}" cannot be removed while layer "${c}" is using it.`)));const s=this.sourceCaches[t];delete this.sourceCaches[t],delete this._updatedSources[t],s.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:t})),s.setEventedParent(null),s.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(t,s){if(this._checkLoaded(),this.sourceCaches[t]===void 0)throw new Error(`There is no source with this ID=${t}`);const c=this.sourceCaches[t].getSource();if(c.type!=="geojson")throw new Error(`geojsonSource.type is ${c.type}, which is !== 'geojson`);c.setData(s),this._changed=!0}getSource(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()}addLayer(t,s,c={}){this._checkLoaded();const p=t.id;if(this.getLayer(p))return void this.fire(new u.ErrorEvent(new Error(`Layer "${p}" already exists on this map.`)));let g;if(t.type==="custom"){if(It(this,u.validateCustomStyleLayer(t)))return;g=u.createStyleLayer(t)}else{if(typeof t.source=="object"&&(this.addSource(p,t.source),t=u.clone$1(t),t=u.extend(t,{source:p})),this._validate(u.validateStyle.layer,`layers.${p}`,t,{arrayIndex:-1},c))return;g=u.createStyleLayer(t),this._validateLayer(g),g.setEventedParent(this,{layer:{id:p}}),this._serializedLayers[g.id]=g.serialize()}const x=s?this._order.indexOf(s):this._order.length;if(s&&x===-1)this.fire(new u.ErrorEvent(new Error(`Cannot add layer "${p}" before non-existing layer "${s}".`)));else{if(this._order.splice(x,0,p),this._layerOrderChanged=!0,this._layers[p]=g,this._removedLayers[p]&&g.source&&g.type!=="custom"){const S=this._removedLayers[p];delete this._removedLayers[p],S.type!==g.type?this._updatedSources[g.source]="clear":(this._updatedSources[g.source]="reload",this.sourceCaches[g.source].pause())}this._updateLayer(g),g.onAdd&&g.onAdd(this.map)}}moveLayer(t,s){if(this._checkLoaded(),this._changed=!0,!this._layers[t])return void this.fire(new u.ErrorEvent(new Error(`The layer '${t}' does not exist in the map's style and cannot be moved.`)));if(t===s)return;const c=this._order.indexOf(t);this._order.splice(c,1);const p=s?this._order.indexOf(s):this._order.length;s&&p===-1?this.fire(new u.ErrorEvent(new Error(`Cannot move layer "${t}" before non-existing layer "${s}".`))):(this._order.splice(p,0,t),this._layerOrderChanged=!0)}removeLayer(t){this._checkLoaded();const s=this._layers[t];if(!s)return void this.fire(new u.ErrorEvent(new Error(`Cannot remove non-existing layer "${t}".`)));s.setEventedParent(null);const c=this._order.indexOf(t);this._order.splice(c,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[t]=s,delete this._layers[t],delete this._serializedLayers[t],delete this._updatedLayers[t],delete this._updatedPaintProps[t],s.onRemove&&s.onRemove(this.map)}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}setLayerZoomRange(t,s,c){this._checkLoaded();const p=this.getLayer(t);p?p.minzoom===s&&p.maxzoom===c||(s!=null&&(p.minzoom=s),c!=null&&(p.maxzoom=c),this._updateLayer(p)):this.fire(new u.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${t}".`)))}setFilter(t,s,c={}){this._checkLoaded();const p=this.getLayer(t);if(p){if(!te(p.filter,s))return s==null?(p.filter=void 0,void this._updateLayer(p)):void(this._validate(u.validateStyle.filter,`layers.${p.id}.filter`,s,null,c)||(p.filter=u.clone$1(s),this._updateLayer(p)))}else this.fire(new u.ErrorEvent(new Error(`Cannot filter non-existing layer "${t}".`)))}getFilter(t){return u.clone$1(this.getLayer(t).filter)}setLayoutProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?te(g.getLayoutProperty(s),c)||(g.setLayoutProperty(s,c,p),this._updateLayer(g)):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getLayoutProperty(t,s){const c=this.getLayer(t);if(c)return c.getLayoutProperty(s);this.fire(new u.ErrorEvent(new Error(`Cannot get style of non-existing layer "${t}".`)))}setPaintProperty(t,s,c,p={}){this._checkLoaded();const g=this.getLayer(t);g?te(g.getPaintProperty(s),c)||(g.setPaintProperty(s,c,p)&&this._updateLayer(g),this._changed=!0,this._updatedPaintProps[t]=!0):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${t}".`)))}getPaintProperty(t,s){return this.getLayer(t).getPaintProperty(s)}setFeatureState(t,s){this._checkLoaded();const c=t.source,p=t.sourceLayer,g=this.sourceCaches[c];if(g===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const x=g.getSource().type;x==="geojson"&&p?this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):x!=="vector"||p?(t.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),g.setFeatureState(p,t.id,s)):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(t,s){this._checkLoaded();const c=t.source,p=this.sourceCaches[c];if(p===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)));const g=p.getSource().type,x=g==="vector"?t.sourceLayer:void 0;g!=="vector"||x?s&&typeof t.id!="string"&&typeof t.id!="number"?this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):p.removeFeatureState(x,t.id,s):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(t){this._checkLoaded();const s=t.source,c=t.sourceLayer,p=this.sourceCaches[s];if(p!==void 0)return p.getSource().type!=="vector"||c?(t.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),p.getFeatureState(c,t.id)):void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.ErrorEvent(new Error(`The source '${s}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:u.mapObject(this.sourceCaches,t=>t.serialize()),layers:this._serializeLayers(this._order)},t=>t!==void 0)}_updateLayer(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&this.sourceCaches[t.source].getSource().type!=="raster"&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0}_flattenAndSortRenderedFeatures(t){const s=x=>this._layers[x].type==="fill-extrusion",c={},p=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S)){c[S]=x;for(const E of t){const k=E[S];if(k)for(const A of k)p.push(A)}}}p.sort((x,S)=>S.intersectionZ-x.intersectionZ);const g=[];for(let x=this._order.length-1;x>=0;x--){const S=this._order[x];if(s(S))for(let E=p.length-1;E>=0;E--){const k=p[E].feature;if(c[k.layer.id]<x)break;g.push(k),p.pop()}else for(const E of t){const k=E[S];if(k)for(const A of k)g.push(A.feature)}}return g}queryRenderedFeatures(t,s,c){s&&s.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",s.filter,null,s);const p={};if(s&&s.layers){if(!Array.isArray(s.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const x of s.layers){const S=this._layers[x];if(!S)return this.fire(new u.ErrorEvent(new Error(`The layer '${x}' does not exist in the map's style and cannot be queried for features.`))),[];p[S.source]=!0}}const g=[];s.availableImages=this._availableImages;for(const x in this.sourceCaches)s.layers&&!p[x]||g.push(Yn(this.sourceCaches[x],this._layers,this._serializedLayers,t,s,c));return this.placement&&g.push(function(x,S,E,k,A,D,R){const G={},$=D.queryRenderedSymbols(k),j=[];for(const ee of Object.keys($).map(Number))j.push(R[ee]);j.sort(Jn);for(const ee of j){const ie=ee.featureIndex.lookupSymbolFeatures($[ee.bucketInstanceId],S,ee.bucketIndex,ee.sourceLayerIndex,A.filter,A.layers,A.availableImages,x);for(const ce in ie){const W=G[ce]=G[ce]||[],pe=ie[ce];pe.sort((he,_e)=>{const ve=ee.featureSortOrder;if(ve){const Te=ve.indexOf(he.featureIndex);return ve.indexOf(_e.featureIndex)-Te}return _e.featureIndex-he.featureIndex});for(const he of pe)W.push(he)}}for(const ee in G)G[ee].forEach(ie=>{const ce=ie.feature,W=E[x[ee].source].getFeatureState(ce.layer["source-layer"],ce.id);ce.source=ce.layer.source,ce.layer["source-layer"]&&(ce.sourceLayer=ce.layer["source-layer"]),ce.state=W});return G}(this._layers,this._serializedLayers,this.sourceCaches,t,s,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(g)}querySourceFeatures(t,s){s&&s.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",s.filter,null,s);const c=this.sourceCaches[t];return c?function(p,g){const x=p.getRenderableIds().map(k=>p.getTileByID(k)),S=[],E={};for(let k=0;k<x.length;k++){const A=x[k],D=A.tileID.canonical.key;E[D]||(E[D]=!0,A.querySourceFeatures(S,g))}return S}(c,s):[]}addSourceType(t,s,c){return Qn.getSourceType(t)?c(new Error(`A source type called "${t}" already exists.`)):(Qn.setSourceType(t,s),s.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:s.workerSourceURL},c):c(null,null))}getLight(){return this.light.getLight()}setLight(t,s={}){this._checkLoaded();const c=this.light.getLight();let p=!1;for(const x in t)if(!te(t[x],c[x])){p=!0;break}if(!p)return;const g={now:u.exported.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(t,s),this.light.updateTransitions(g)}_validate(t,s,c,p,g={}){return(!g||g.validate!==!1)&&It(this,t.call(u.validateStyle,u.extend({key:s,style:this.serialize(),value:c,styleSpec:u.spec},p)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this.sourceCaches){const s=this.sourceCaches[t];s.setEventedParent(null),s.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){this.sourceCaches[t].clearTiles()}_reloadSource(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()}_updateSources(t){for(const s in this.sourceCaches)this.sourceCaches[s].update(t,this.terrain)}_generateCollisionBoxes(){for(const t in this.sourceCaches)this._reloadSource(t)}_updatePlacement(t,s,c,p,g=!1){let x=!1,S=!1;const E={};for(const k of this._order){const A=this._layers[k];if(A.type!=="symbol")continue;if(!E[A.source]){const R=this.sourceCaches[A.source];E[A.source]=R.getRenderableIds(!0).map(G=>R.getTileByID(G)).sort((G,$)=>$.tileID.overscaledZ-G.tileID.overscaledZ||(G.tileID.isLessThan($.tileID)?-1:1))}const D=this.crossTileSymbolIndex.addLayer(A,E[A.source],t.center.lng);x=x||D}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((g=g||this._layerOrderChanged||c===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),t.zoom))&&(this.pauseablePlacement=new me(t,this.terrain,this._order,g,s,c,p,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),S=!0),x&&this.pauseablePlacement.placement.setStale()),S||x)for(const k of this._order){const A=this._layers[k];A.type==="symbol"&&this.placement.updateLayerOpacities(A,E[A.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,s,c){this.imageManager.getImages(s.icons,c),this._updateTilesForChangedImages();const p=this.sourceCaches[s.source];p&&p.setDependencies(s.tileID.key,s.type,s.icons)}getGlyphs(t,s,c){this.glyphManager.getGlyphs(s.stacks,c)}getResource(t,s,c){return u.makeRequest(s,c)}}Qn.getSourceType=function(h){return qt[h]},Qn.setSourceType=function(h,t){qt[h]=t},Qn.registerForPluginStateChange=u.registerForPluginStateChange;var Go="attribute vec2 a_pos;uniform mat4 u_matrix;varying vec2 v_texture_pos;varying float v_depth;void main() {v_texture_pos=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);v_depth=gl_Position.z/gl_Position.w;}";const Ms={prelude:Gt(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_offset;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return (elevation+u_terrain_offset)*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Gt(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Gt(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Gt(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Gt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Gt(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Gt(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Gt("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Gt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Gt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Gt(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Gt(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Gt(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Gt(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Gt(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float baseDelta=10.0;float ele=get_elevation(a_centroid);
#else
float baseDelta=0.0;float ele=0.0;
#endif
base=max(0.0,ele+base-baseDelta);height=max(0.0,ele+height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Gt(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Gt(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Gt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Gt(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Gt(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Gt(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Gt(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Gt(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Gt(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Gt("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Go),terrainDepth:Gt("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Go),terrainCoords:Gt("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Go)};function Gt(h,t){const s=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,c=t.match(/attribute ([\w]+) ([\w]+)/g),p=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),g=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=g?g.concat(p):p,S={};return{fragmentSource:h=h.replace(s,(E,k,A,D,R)=>(S[R]=!0,k==="define"?`
#ifndef HAS_UNIFORM_u_${R}
varying ${A} ${D} ${R};
#else
uniform ${A} ${D} u_${R};
#endif
`:`
#ifdef HAS_UNIFORM_u_${R}
    ${A} ${D} ${R} = u_${R};
#endif
`)),vertexSource:t=t.replace(s,(E,k,A,D,R)=>{const G=D==="float"?"vec2":"vec4",$=R.match(/color/)?"color":G;return S[R]?k==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${A} ${G} a_${R};
varying ${A} ${D} ${R};
#else
uniform ${A} ${D} u_${R};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = a_${R};
#else
    ${A} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);
#else
    ${A} ${D} ${R} = u_${R};
#endif
`:k==="define"?`
#ifndef HAS_UNIFORM_u_${R}
uniform lowp float u_${R}_t;
attribute ${A} ${G} a_${R};
#else
uniform ${A} ${D} u_${R};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${R}
    ${A} ${D} ${R} = a_${R};
#else
    ${A} ${D} ${R} = u_${R};
#endif
`:`
#ifndef HAS_UNIFORM_u_${R}
    ${A} ${D} ${R} = unpack_mix_${$}(a_${R}, u_${R}_t);
#else
    ${A} ${D} ${R} = u_${R};
#endif
`}),staticAttributes:c,staticUniforms:x}}class zl{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,s,c,p,g,x,S,E,k){this.context=t;let A=this.boundPaintVertexBuffers.length!==p.length;for(let D=0;!A&&D<p.length;D++)this.boundPaintVertexBuffers[D]!==p[D]&&(A=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===s&&this.boundLayoutVertexBuffer===c&&!A&&this.boundIndexBuffer===g&&this.boundVertexOffset===x&&this.boundDynamicVertexBuffer===S&&this.boundDynamicVertexBuffer2===E&&this.boundDynamicVertexBuffer3===k?(t.bindVertexArrayOES.set(this.vao),S&&S.bind(),g&&g.dynamicDraw&&g.bind(),E&&E.bind(),k&&k.bind()):this.freshBind(s,c,p,g,x,S,E,k)}freshBind(t,s,c,p,g,x,S,E){let k;const A=t.numAttributes,D=this.context,R=D.gl;if(D.extVertexArrayObject)this.vao&&this.destroy(),this.vao=D.extVertexArrayObject.createVertexArrayOES(),D.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=t,this.boundLayoutVertexBuffer=s,this.boundPaintVertexBuffers=c,this.boundIndexBuffer=p,this.boundVertexOffset=g,this.boundDynamicVertexBuffer=x,this.boundDynamicVertexBuffer2=S,this.boundDynamicVertexBuffer3=E;else{k=D.currentNumAttributes||0;for(let G=A;G<k;G++)R.disableVertexAttribArray(G)}s.enableAttributes(R,t);for(const G of c)G.enableAttributes(R,t);x&&x.enableAttributes(R,t),S&&S.enableAttributes(R,t),E&&E.enableAttributes(R,t),s.bind(),s.setVertexAttribPointers(R,t,g);for(const G of c)G.bind(),G.setVertexAttribPointers(R,t,g);x&&(x.bind(),x.setVertexAttribPointers(R,t,g)),p&&p.bind(),S&&(S.bind(),S.setVertexAttribPointers(R,t,g)),E&&(E.bind(),E.setVertexAttribPointers(R,t,g)),D.currentNumAttributes=A}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Al(h){const t=[];for(let s=0;s<h.length;s++){if(h[s]===null)continue;const c=h[s].split(" ");t.push(c.pop())}return t}class vc{constructor(t,s,c,p,g,x,S){const E=t.gl;this.program=E.createProgram();const k=Al(c.staticAttributes),A=p?p.getBinderAttributes():[],D=k.concat(A),R=Ms.prelude.staticUniforms?Al(Ms.prelude.staticUniforms):[],G=c.staticUniforms?Al(c.staticUniforms):[],$=p?p.getBinderUniforms():[],j=R.concat(G).concat($),ee=[];for(const ve of j)ee.indexOf(ve)<0&&ee.push(ve);const ie=p?p.defines():[];x&&ie.push("#define OVERDRAW_INSPECTOR;"),S&&ie.push("#define TERRAIN3D;");const ce=ie.concat(Ms.prelude.fragmentSource,c.fragmentSource).join(`
`),W=ie.concat(Ms.prelude.vertexSource,c.vertexSource).join(`
`),pe=E.createShader(E.FRAGMENT_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(pe,ce),E.compileShader(pe),E.attachShader(this.program,pe);const he=E.createShader(E.VERTEX_SHADER);if(E.isContextLost())return void(this.failedToCreate=!0);E.shaderSource(he,W),E.compileShader(he),E.attachShader(this.program,he),this.attributes={};const _e={};this.numAttributes=D.length;for(let ve=0;ve<this.numAttributes;ve++)D[ve]&&(E.bindAttribLocation(this.program,ve,D[ve]),this.attributes[D[ve]]=ve);E.linkProgram(this.program),E.deleteShader(he),E.deleteShader(pe);for(let ve=0;ve<ee.length;ve++){const Te=ee[ve];if(Te&&!_e[Te]){const ye=E.getUniformLocation(this.program,Te);ye&&(_e[Te]=ye)}}this.fixedUniforms=g(t,_e),this.terrainUniforms=((ve,Te)=>({u_depth:new u.Uniform1i(ve,Te.u_depth),u_terrain:new u.Uniform1i(ve,Te.u_terrain),u_terrain_dim:new u.Uniform1f(ve,Te.u_terrain_dim),u_terrain_matrix:new u.UniformMatrix4f(ve,Te.u_terrain_matrix),u_terrain_unpack:new u.Uniform4f(ve,Te.u_terrain_unpack),u_terrain_offset:new u.Uniform1f(ve,Te.u_terrain_offset),u_terrain_exaggeration:new u.Uniform1f(ve,Te.u_terrain_exaggeration)}))(t,_e),this.binderUniforms=p?p.getUniforms(t,_e):[]}draw(t,s,c,p,g,x,S,E,k,A,D,R,G,$,j,ee,ie,ce){const W=t.gl;if(this.failedToCreate)return;if(t.program.set(this.program),t.setDepthMode(c),t.setStencilMode(p),t.setColorMode(g),t.setCullFace(x),E){t.activeTexture.set(W.TEXTURE2),W.bindTexture(W.TEXTURE_2D,E.depthTexture),t.activeTexture.set(W.TEXTURE3),W.bindTexture(W.TEXTURE_2D,E.texture);for(const he in this.terrainUniforms)this.terrainUniforms[he].set(E[he])}for(const he in this.fixedUniforms)this.fixedUniforms[he].set(S[he]);j&&j.setUniforms(t,this.binderUniforms,G,{zoom:$});let pe=0;switch(s){case W.LINES:pe=2;break;case W.TRIANGLES:pe=3;break;case W.LINE_STRIP:pe=1}for(const he of R.get()){const _e=he.vaos||(he.vaos={});(_e[k]||(_e[k]=new zl)).bind(t,this,A,j?j.getPaintVertexBuffers():[],D,he.vertexOffset,ee,ie,ce),W.drawElements(s,he.primitiveLength*pe,W.UNSIGNED_SHORT,he.primitiveOffset*pe*2)}}}function xc(h,t,s){const c=1/kn(s,1,t.transform.tileZoom),p=Math.pow(2,s.tileID.overscaledZ),g=s.tileSize*Math.pow(2,t.transform.tileZoom)/p,x=g*(s.tileID.canonical.x+s.tileID.wrap*p),S=g*s.tileID.canonical.y;return{u_image:0,u_texsize:s.imageAtlasTexture.size,u_scale:[c,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[x>>16,S>>16],u_pixel_coord_lower:[65535&x,65535&S]}}const Ml=(h,t,s,c)=>{const p=t.style.light,g=p.properties.get("position"),x=[g.x,g.y,g.z],S=u.create$1();p.properties.get("anchor")==="viewport"&&u.fromRotation(S,-t.transform.angle),u.transformMat3(x,x,S);const E=p.properties.get("color");return{u_matrix:h,u_lightpos:x,u_lightintensity:p.properties.get("intensity"),u_lightcolor:[E.r,E.g,E.b],u_vertical_gradient:+s,u_opacity:c}},Zd=(h,t,s,c,p,g,x)=>u.extend(Ml(h,t,s,c),xc(g,t,x),{u_height_factor:-Math.pow(2,p.overscaledZ)/x.tileSize/8}),wa=h=>({u_matrix:h}),Pl=(h,t,s,c)=>u.extend(wa(h),xc(s,t,c)),wc=(h,t)=>({u_matrix:h,u_world:t}),bc=(h,t,s,c,p)=>u.extend(Pl(h,t,s,c),{u_world:p}),Sc=(h,t,s,c)=>{const p=h.transform;let g,x;if(c.paint.get("circle-pitch-alignment")==="map"){const S=kn(s,1,p.zoom);g=!0,x=[S,S]}else g=!1,x=p.pixelsToGLUnits;return{u_camera_to_center_distance:p.cameraToCenterDistance,u_scale_with_map:+(c.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(t.posMatrix,s,c.paint.get("circle-translate"),c.paint.get("circle-translate-anchor")),u_pitch_with_map:+g,u_device_pixel_ratio:h.pixelRatio,u_extrude_scale:x}},fo=(h,t,s)=>{const c=kn(s,1,t.zoom),p=Math.pow(2,t.zoom-s.tileID.overscaledZ),g=s.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:t.cameraToCenterDistance,u_pixels_to_tile_units:c,u_extrude_scale:[t.pixelsToGLUnits[0]/(c*p),t.pixelsToGLUnits[1]/(c*p)],u_overscale_factor:g}},Ps=(h,t,s=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:s}),Zo=h=>({u_matrix:h}),ba=(h,t,s,c)=>({u_matrix:h,u_extrude_scale:kn(t,1,s),u_intensity:c});function Sa(h,t){const s=Math.pow(2,t.canonical.z),c=t.canonical.y;return[new u.MercatorCoordinate(0,c/s).toLngLat().lat,new u.MercatorCoordinate(0,(c+1)/s).toLngLat().lat]}const qo=(h,t,s,c)=>{const p=h.transform;return{u_matrix:Ls(h,t,s,c),u_ratio:1/kn(t,1,p.zoom),u_device_pixel_ratio:h.pixelRatio,u_units_to_pixels:[1/p.pixelsToGLUnits[0],1/p.pixelsToGLUnits[1]]}},Dl=(h,t,s,c,p)=>u.extend(qo(h,t,s,p),{u_image:0,u_image_height:c}),Ea=(h,t,s,c,p)=>{const g=h.transform,x=tn(t,g);return{u_matrix:Ls(h,t,s,p),u_texsize:t.imageAtlasTexture.size,u_ratio:1/kn(t,1,g.zoom),u_device_pixel_ratio:h.pixelRatio,u_image:0,u_scale:[x,c.fromScale,c.toScale],u_fade:c.t,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},Ds=(h,t,s,c,p,g)=>{const x=h.lineAtlas,S=tn(t,h.transform),E=s.layout.get("line-cap")==="round",k=x.getDash(c.from,E),A=x.getDash(c.to,E),D=k.width*p.fromScale,R=A.width*p.toScale;return u.extend(qo(h,t,s,g),{u_patternscale_a:[S/D,-k.height/2],u_patternscale_b:[S/R,-A.height/2],u_sdfgamma:x.width/(256*Math.min(D,R)*h.pixelRatio)/2,u_image:0,u_tex_y_a:k.y,u_tex_y_b:A.y,u_mix:p.t})};function tn(h,t){return 1/kn(h,1,t.tileZoom)}function Ls(h,t,s,c){return h.translatePosMatrix(c?c.posMatrix:t.tileID.posMatrix,t,s.paint.get("line-translate"),s.paint.get("line-translate-anchor"))}const Ec=(h,t,s,c,p)=>{return{u_matrix:h,u_tl_parent:t,u_scale_parent:s,u_buffer_scale:1,u_fade_t:c.mix,u_opacity:c.opacity*p.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:p.paint.get("raster-brightness-min"),u_brightness_high:p.paint.get("raster-brightness-max"),u_saturation_factor:(x=p.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(g=p.paint.get("raster-contrast"),g>0?1/(1-g):1+g),u_spin_weights:Tc(p.paint.get("raster-hue-rotate"))};var g,x};function Tc(h){h*=Math.PI/180;const t=Math.sin(h),s=Math.cos(h);return[(2*s+1)/3,(-Math.sqrt(3)*t-s+1)/3,(Math.sqrt(3)*t-s+1)/3]}const Ll=(h,t,s,c,p,g,x,S,E,k)=>{const A=p.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:A.cameraToCenterDistance,u_pitch:A.pitch/360*2*Math.PI,u_rotate_symbol:+s,u_aspect_ratio:A.width/A.height,u_fade_change:p.options.fadeDuration?p.symbolFadeChange:1,u_matrix:g,u_label_plane_matrix:x,u_coord_matrix:S,u_is_text:+E,u_pitch_with_map:+c,u_texsize:k,u_texture:0}},Ta=(h,t,s,c,p,g,x,S,E,k,A)=>{const D=p.transform;return u.extend(Ll(h,t,s,c,p,g,x,S,E,k),{u_gamma_scale:c?Math.cos(D._pitch)*D.cameraToCenterDistance:1,u_device_pixel_ratio:p.pixelRatio,u_is_halo:+A})},kc=(h,t,s,c,p,g,x,S,E,k)=>u.extend(Ta(h,t,s,c,p,g,x,S,!0,E,!0),{u_texsize_icon:k,u_texture_icon:1}),qd=(h,t,s)=>({u_matrix:h,u_opacity:t,u_color:s}),Wd=(h,t,s,c,p,g)=>u.extend(function(x,S,E,k){const A=E.imageManager.getPattern(x.from.toString()),D=E.imageManager.getPattern(x.to.toString()),{width:R,height:G}=E.imageManager.getPixelSize(),$=Math.pow(2,k.tileID.overscaledZ),j=k.tileSize*Math.pow(2,E.transform.tileZoom)/$,ee=j*(k.tileID.canonical.x+k.tileID.wrap*$),ie=j*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:A.tl,u_pattern_br_a:A.br,u_pattern_tl_b:D.tl,u_pattern_br_b:D.br,u_texsize:[R,G],u_mix:S.t,u_pattern_size_a:A.displaySize,u_pattern_size_b:D.displaySize,u_scale_a:S.fromScale,u_scale_b:S.toScale,u_tile_units_to_pixels:1/kn(k,1,E.transform.tileZoom),u_pixel_coord_upper:[ee>>16,ie>>16],u_pixel_coord_lower:[65535&ee,65535&ie]}}(c,g,s,p),{u_matrix:h,u_opacity:t}),Rl={fillExtrusion:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_lightpos:new u.Uniform3f(h,t.u_lightpos),u_lightintensity:new u.Uniform1f(h,t.u_lightintensity),u_lightcolor:new u.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(h,t.u_vertical_gradient),u_opacity:new u.Uniform1f(h,t.u_opacity)}),fillExtrusionPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_lightpos:new u.Uniform3f(h,t.u_lightpos),u_lightintensity:new u.Uniform1f(h,t.u_lightintensity),u_lightcolor:new u.Uniform3f(h,t.u_lightcolor),u_vertical_gradient:new u.Uniform1f(h,t.u_vertical_gradient),u_height_factor:new u.Uniform1f(h,t.u_height_factor),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade),u_opacity:new u.Uniform1f(h,t.u_opacity)}),fill:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),fillPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),fillOutline:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world)}),fillOutlinePattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world),u_image:new u.Uniform1i(h,t.u_image),u_texsize:new u.Uniform2f(h,t.u_texsize),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),circle:(h,t)=>({u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_scale_with_map:new u.Uniform1i(h,t.u_scale_with_map),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_extrude_scale:new u.Uniform2f(h,t.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),collisionBox:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pixels_to_tile_units:new u.Uniform1f(h,t.u_pixels_to_tile_units),u_extrude_scale:new u.Uniform2f(h,t.u_extrude_scale),u_overscale_factor:new u.Uniform1f(h,t.u_overscale_factor)}),collisionCircle:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_inv_matrix:new u.UniformMatrix4f(h,t.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(h,t.u_viewport_size)}),debug:(h,t)=>({u_color:new u.UniformColor(h,t.u_color),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_overlay:new u.Uniform1i(h,t.u_overlay),u_overlay_scale:new u.Uniform1f(h,t.u_overlay_scale)}),clippingMask:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),heatmap:(h,t)=>({u_extrude_scale:new u.Uniform1f(h,t.u_extrude_scale),u_intensity:new u.Uniform1f(h,t.u_intensity),u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),heatmapTexture:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_world:new u.Uniform2f(h,t.u_world),u_image:new u.Uniform1i(h,t.u_image),u_color_ramp:new u.Uniform1i(h,t.u_color_ramp),u_opacity:new u.Uniform1f(h,t.u_opacity)}),hillshade:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_latrange:new u.Uniform2f(h,t.u_latrange),u_light:new u.Uniform2f(h,t.u_light),u_shadow:new u.UniformColor(h,t.u_shadow),u_highlight:new u.UniformColor(h,t.u_highlight),u_accent:new u.UniformColor(h,t.u_accent)}),hillshadePrepare:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_image:new u.Uniform1i(h,t.u_image),u_dimension:new u.Uniform2f(h,t.u_dimension),u_zoom:new u.Uniform1f(h,t.u_zoom),u_unpack:new u.Uniform4f(h,t.u_unpack)}),line:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels)}),lineGradient:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_image:new u.Uniform1i(h,t.u_image),u_image_height:new u.Uniform1f(h,t.u_image_height)}),linePattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texsize:new u.Uniform2f(h,t.u_texsize),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_image:new u.Uniform1i(h,t.u_image),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_scale:new u.Uniform3f(h,t.u_scale),u_fade:new u.Uniform1f(h,t.u_fade)}),lineSDF:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_ratio:new u.Uniform1f(h,t.u_ratio),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(h,t.u_units_to_pixels),u_patternscale_a:new u.Uniform2f(h,t.u_patternscale_a),u_patternscale_b:new u.Uniform2f(h,t.u_patternscale_b),u_sdfgamma:new u.Uniform1f(h,t.u_sdfgamma),u_image:new u.Uniform1i(h,t.u_image),u_tex_y_a:new u.Uniform1f(h,t.u_tex_y_a),u_tex_y_b:new u.Uniform1f(h,t.u_tex_y_b),u_mix:new u.Uniform1f(h,t.u_mix)}),raster:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_tl_parent:new u.Uniform2f(h,t.u_tl_parent),u_scale_parent:new u.Uniform1f(h,t.u_scale_parent),u_buffer_scale:new u.Uniform1f(h,t.u_buffer_scale),u_fade_t:new u.Uniform1f(h,t.u_fade_t),u_opacity:new u.Uniform1f(h,t.u_opacity),u_image0:new u.Uniform1i(h,t.u_image0),u_image1:new u.Uniform1i(h,t.u_image1),u_brightness_low:new u.Uniform1f(h,t.u_brightness_low),u_brightness_high:new u.Uniform1f(h,t.u_brightness_high),u_saturation_factor:new u.Uniform1f(h,t.u_saturation_factor),u_contrast_factor:new u.Uniform1f(h,t.u_contrast_factor),u_spin_weights:new u.Uniform3f(h,t.u_spin_weights)}),symbolIcon:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(h,t.u_pitch),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texture:new u.Uniform1i(h,t.u_texture)}),symbolSDF:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(h,t.u_pitch),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texture:new u.Uniform1i(h,t.u_texture),u_gamma_scale:new u.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(h,t.u_is_halo)}),symbolTextAndIcon:(h,t)=>({u_is_size_zoom_constant:new u.Uniform1i(h,t.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(h,t.u_is_size_feature_constant),u_size_t:new u.Uniform1f(h,t.u_size_t),u_size:new u.Uniform1f(h,t.u_size),u_camera_to_center_distance:new u.Uniform1f(h,t.u_camera_to_center_distance),u_pitch:new u.Uniform1f(h,t.u_pitch),u_rotate_symbol:new u.Uniform1i(h,t.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(h,t.u_aspect_ratio),u_fade_change:new u.Uniform1f(h,t.u_fade_change),u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(h,t.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(h,t.u_coord_matrix),u_is_text:new u.Uniform1i(h,t.u_is_text),u_pitch_with_map:new u.Uniform1i(h,t.u_pitch_with_map),u_texsize:new u.Uniform2f(h,t.u_texsize),u_texsize_icon:new u.Uniform2f(h,t.u_texsize_icon),u_texture:new u.Uniform1i(h,t.u_texture),u_texture_icon:new u.Uniform1i(h,t.u_texture_icon),u_gamma_scale:new u.Uniform1f(h,t.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(h,t.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(h,t.u_is_halo)}),background:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_opacity:new u.Uniform1f(h,t.u_opacity),u_color:new u.UniformColor(h,t.u_color)}),backgroundPattern:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_opacity:new u.Uniform1f(h,t.u_opacity),u_image:new u.Uniform1i(h,t.u_image),u_pattern_tl_a:new u.Uniform2f(h,t.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(h,t.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(h,t.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(h,t.u_pattern_br_b),u_texsize:new u.Uniform2f(h,t.u_texsize),u_mix:new u.Uniform1f(h,t.u_mix),u_pattern_size_a:new u.Uniform2f(h,t.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(h,t.u_pattern_size_b),u_scale_a:new u.Uniform1f(h,t.u_scale_a),u_scale_b:new u.Uniform1f(h,t.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(h,t.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(h,t.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(h,t.u_tile_units_to_pixels)}),terrain:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texture:new u.Uniform1i(h,t.u_texture)}),terrainDepth:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix)}),terrainCoords:(h,t)=>({u_matrix:new u.UniformMatrix4f(h,t.u_matrix),u_texture:new u.Uniform1i(h,t.u_texture),u_terrain_coords_id:new u.Uniform1f(h,t.u_terrain_coords_id)})};class Bl{constructor(t,s,c){this.context=t;const p=t.gl;this.buffer=p.createBuffer(),this.dynamicDraw=Boolean(c),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),p.bufferData(p.ELEMENT_ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?p.DYNAMIC_DRAW:p.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const s=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),s.bufferSubData(s.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const Fl={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ol{constructor(t,s,c,p){this.length=s.length,this.attributes=c,this.itemSize=s.bytesPerElement,this.dynamicDraw=p,this.context=t;const g=t.gl;this.buffer=g.createBuffer(),t.bindVertexBuffer.set(this.buffer),g.bufferData(g.ARRAY_BUFFER,s.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete s.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){if(t.length!==this.length)throw new Error(`Length of new data is ${t.length}, which doesn't match current length of ${this.length}`);const s=this.context.gl;this.bind(),s.bufferSubData(s.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,s){for(let c=0;c<this.attributes.length;c++){const p=s.attributes[this.attributes[c].name];p!==void 0&&t.enableVertexAttribArray(p)}}setVertexAttribPointers(t,s,c){for(let p=0;p<this.attributes.length;p++){const g=this.attributes[p],x=s.attributes[g.name];x!==void 0&&t.vertexAttribPointer(x,g.components,t[Fl[g.type]],!1,this.itemSize,g.offset+this.itemSize*(c||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Dt{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Cc extends Dt{getDefault(){return u.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Xd extends Dt{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class Rs extends Dt{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class Bs extends Dt{getDefault(){return[!0,!0,!0,!0]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Ic extends Dt{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class Cr extends Dt{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Nl extends Dt{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const s=this.current;(t.func!==s.func||t.ref!==s.ref||t.mask!==s.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class ka extends Dt{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Ca extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.STENCIL_TEST):s.disable(s.STENCIL_TEST),this.current=t,this.dirty=!1}}class Ul extends Dt{getDefault(){return[0,1]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Vl extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),this.current=t,this.dirty=!1}}class Ia extends Dt{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class $l extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.BLEND):s.disable(s.BLEND),this.current=t,this.dirty=!1}}class jl extends Dt{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class za extends Dt{getDefault(){return u.Color.transparent}set(t){const s=this.current;(t.r!==s.r||t.g!==s.g||t.b!==s.b||t.a!==s.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class zc extends Dt{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class Ac extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;t?s.enable(s.CULL_FACE):s.disable(s.CULL_FACE),this.current=t,this.dirty=!1}}class Wo extends Dt{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class Hd extends Dt{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class Kd extends Dt{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class Yd extends Dt{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Jd extends Dt{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const s=this.current;(t[0]!==s[0]||t[1]!==s[1]||t[2]!==s[2]||t[3]!==s[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Qd extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindFramebuffer(s.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ep extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindRenderbuffer(s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Gl extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindTexture(s.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class Aa extends Dt{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.bindBuffer(s.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Zl extends Dt{getDefault(){return null}set(t){const s=this.gl;s.bindBuffer(s.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ql extends Dt{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class Xo extends Dt{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Mc extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class Pc extends Dt{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const s=this.gl;s.pixelStorei(s.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Ma extends Dt{constructor(t,s){super(t),this.context=t,this.parent=s}getDefault(){return null}}class mo extends Ma{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferTexture2D(s.FRAMEBUFFER,s.COLOR_ATTACHMENT0,s.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Dc extends Ma{set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const s=this.gl;s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Ho{constructor(t,s,c,p){this.context=t,this.width=s,this.height=c;const g=t.gl,x=this.framebuffer=g.createFramebuffer();if(this.colorAttachment=new mo(t,x),p&&(this.depthAttachment=new Dc(t,x)),g.checkFramebufferStatus(g.FRAMEBUFFER)!==g.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const t=this.context.gl,s=this.colorAttachment.get();if(s&&t.deleteTexture(s),this.depthAttachment){const c=this.depthAttachment.get();c&&t.deleteRenderbuffer(c)}t.deleteFramebuffer(this.framebuffer)}}class Jt{constructor(t,s,c){this.blendFunction=t,this.blendColor=s,this.mask=c}}Jt.Replace=[1,0],Jt.disabled=new Jt(Jt.Replace,u.Color.transparent,[!1,!1,!1,!1]),Jt.unblended=new Jt(Jt.Replace,u.Color.transparent,[!0,!0,!0,!0]),Jt.alphaBlended=new Jt([1,771],u.Color.transparent,[!0,!0,!0,!0]);class Lc{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new Cc(this),this.clearDepth=new Xd(this),this.clearStencil=new Rs(this),this.colorMask=new Bs(this),this.depthMask=new Ic(this),this.stencilMask=new Cr(this),this.stencilFunc=new Nl(this),this.stencilOp=new ka(this),this.stencilTest=new Ca(this),this.depthRange=new Ul(this),this.depthTest=new Vl(this),this.depthFunc=new Ia(this),this.blend=new $l(this),this.blendFunc=new jl(this),this.blendColor=new za(this),this.blendEquation=new zc(this),this.cullFace=new Ac(this),this.cullFaceSide=new Wo(this),this.frontFace=new Hd(this),this.program=new Kd(this),this.activeTexture=new Yd(this),this.viewport=new Jd(this),this.bindFramebuffer=new Qd(this),this.bindRenderbuffer=new ep(this),this.bindTexture=new Gl(this),this.bindVertexBuffer=new Aa(this),this.bindElementBuffer=new Zl(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ql(this),this.pixelStoreUnpack=new Xo(this),this.pixelStoreUnpackPremultiplyAlpha=new Mc(this),this.pixelStoreUnpackFlipY=new Pc(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,s){return new Bl(this,t,s)}createVertexBuffer(t,s,c){return new Ol(this,t,s,c)}createRenderbuffer(t,s,c){const p=this.gl,g=p.createRenderbuffer();return this.bindRenderbuffer.set(g),p.renderbufferStorage(p.RENDERBUFFER,t,s,c),this.bindRenderbuffer.set(null),g}createFramebuffer(t,s,c){return new Ho(this,t,s,c)}clear({color:t,depth:s}){const c=this.gl;let p=0;t&&(p|=c.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),s!==void 0&&(p|=c.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(s),this.depthMask.set(!0)),c.clear(p)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){te(t.blendFunction,Jt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor)),this.colorMask.set(t.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Et{constructor(t,s,c){this.func=t,this.mask=s,this.range=c}}Et.ReadOnly=!1,Et.ReadWrite=!0,Et.disabled=new Et(519,Et.ReadOnly,[0,1]);const Lt=7680;class Xt{constructor(t,s,c,p,g,x){this.test=t,this.ref=s,this.mask=c,this.fail=p,this.depthFail=g,this.pass=x}}Xt.disabled=new Xt({func:519,mask:0},0,0,Lt,Lt,Lt);class nn{constructor(t,s,c){this.enable=t,this.mode=s,this.frontFace=c}}let Fs;function Ko(h,t,s,c,p,g,x){const S=h.context,E=S.gl,k=h.useProgram("collisionBox"),A=[];let D=0,R=0;for(let W=0;W<c.length;W++){const pe=c[W],he=t.getTile(pe),_e=he.getBucket(s);if(!_e)continue;let ve=pe.posMatrix;p[0]===0&&p[1]===0||(ve=h.translatePosMatrix(pe.posMatrix,he,p,g));const Te=x?_e.textCollisionBox:_e.iconCollisionBox,ye=_e.collisionCircleArray;if(ye.length>0){const Ze=u.create(),Re=ve;u.mul(Ze,_e.placementInvProjMatrix,h.transform.glCoordMatrix),u.mul(Ze,Ze,_e.placementViewportMatrix),A.push({circleArray:ye,circleOffset:R,transform:Re,invTransform:Ze,coord:pe}),D+=ye.length/4,R=D}Te&&k.draw(S,E.LINES,Et.disabled,Xt.disabled,h.colorModeForRenderPass(),nn.disabled,fo(ve,h.transform,he),h.style.terrain&&h.style.terrain.getTerrainData(pe),s.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segments,null,h.transform.zoom,null,null,Te.collisionVertexBuffer)}if(!x||!A.length)return;const G=h.useProgram("collisionCircle"),$=new u.CollisionCircleLayoutArray;$.resize(4*D),$._trim();let j=0;for(const W of A)for(let pe=0;pe<W.circleArray.length/4;pe++){const he=4*pe,_e=W.circleArray[he+0],ve=W.circleArray[he+1],Te=W.circleArray[he+2],ye=W.circleArray[he+3];$.emplace(j++,_e,ve,Te,ye,0),$.emplace(j++,_e,ve,Te,ye,1),$.emplace(j++,_e,ve,Te,ye,2),$.emplace(j++,_e,ve,Te,ye,3)}(!Fs||Fs.length<2*D)&&(Fs=function(W){const pe=2*W,he=new u.QuadTriangleArray;he.resize(pe),he._trim();for(let _e=0;_e<pe;_e++){const ve=6*_e;he.uint16[ve+0]=4*_e+0,he.uint16[ve+1]=4*_e+1,he.uint16[ve+2]=4*_e+2,he.uint16[ve+3]=4*_e+2,he.uint16[ve+4]=4*_e+3,he.uint16[ve+5]=4*_e+0}return he}(D));const ee=S.createIndexBuffer(Fs,!0),ie=S.createVertexBuffer($,u.collisionCircleLayout.members,!0);for(const W of A){const pe={u_matrix:W.transform,u_inv_matrix:W.invTransform,u_camera_to_center_distance:(ce=h.transform).cameraToCenterDistance,u_viewport_size:[ce.width,ce.height]};G.draw(S,E.TRIANGLES,Et.disabled,Xt.disabled,h.colorModeForRenderPass(),nn.disabled,pe,h.style.terrain&&h.style.terrain.getTerrainData(W.coord),s.id,ie,ee,u.SegmentVector.simpleSegment(0,2*W.circleOffset,W.circleArray.length,W.circleArray.length/2),null,h.transform.zoom,null,null,null)}var ce;ie.destroy(),ee.destroy()}nn.disabled=new nn(!1,1029,2305),nn.backCCW=new nn(!0,1029,2305);const tp=u.identity(new Float32Array(16));function np(h,t,s,c,p,g){const{horizontalAlign:x,verticalAlign:S}=u.getAnchorAlignment(h),E=-(x-.5)*t,k=-(S-.5)*s,A=u.evaluateVariableOffset(h,c);return new u.pointGeometry((E/p+A[0])*g,(k/p+A[1])*g)}function Rc(h,t,s,c,p,g,x,S,E,k,A){const D=h.text.placedSymbolArray,R=h.text.dynamicLayoutVertexArray,G=h.icon.dynamicLayoutVertexArray,$={};R.clear();for(let j=0;j<D.length;j++){const ee=D.get(j),ie=h.allowVerticalPlacement&&!ee.placedOrientation,ce=ee.hidden||!ee.crossTileID||ie?null:c[ee.crossTileID];if(ce){const W=new u.pointGeometry(ee.anchorX,ee.anchorY),pe=kt(W,s?x:g,A),he=Vr(p.cameraToCenterDistance,pe.signedDistanceFromCamera);let _e=u.evaluateSizeForFeature(h.textSizeData,E,ee)*he/u.ONE_EM;s&&(_e*=h.tilePixelRatio/S);const{width:ve,height:Te,anchor:ye,textOffset:Ze,textBoxScale:Re}=ce,We=np(ye,ve,Te,Ze,Re,_e),mt=s?kt(W.add(We),g,A).point:pe.point.add(t?We.rotate(-p.angle):We),_t=h.allowVerticalPlacement&&ee.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let rt=0;rt<ee.numGlyphs;rt++)u.addDynamicAttributes(R,mt,_t);k&&ee.associatedIconIndex>=0&&($[ee.associatedIconIndex]={shiftedAnchor:mt,angle:_t})}else pt(ee.numGlyphs,R)}if(k){G.clear();const j=h.icon.placedSymbolArray;for(let ee=0;ee<j.length;ee++){const ie=j.get(ee);if(ie.hidden)pt(ie.numGlyphs,G);else{const ce=$[ee];if(ce)for(let W=0;W<ie.numGlyphs;W++)u.addDynamicAttributes(G,ce.shiftedAnchor,ce.angle);else pt(ie.numGlyphs,G)}}h.icon.dynamicLayoutVertexBuffer.updateData(G)}h.text.dynamicLayoutVertexBuffer.updateData(R)}function rp(h,t,s){return s.iconsInText&&t?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Pa(h,t,s,c,p,g,x,S,E,k,A,D){const R=h.context,G=R.gl,$=h.transform,j=S==="map",ee=E==="map",ie=S!=="viewport"&&s.layout.get("symbol-placement")!=="point",ce=j&&!ee&&!ie,W=!s.layout.get("symbol-sort-key").isConstant();let pe=!1;const he=h.depthModeForSublayer(0,Et.ReadOnly),_e=s.layout.get("text-variable-anchor"),ve=[];for(const Te of c){const ye=t.getTile(Te),Ze=ye.getBucket(s);if(!Ze)continue;const Re=p?Ze.text:Ze.icon;if(!Re||!Re.segments.get().length)continue;const We=Re.programConfigurations.get(s.id),mt=p||Ze.sdfIcons,_t=p?Ze.textSizeData:Ze.iconSizeData,rt=ee||$.pitch!==0,Ft=h.useProgram(rp(mt,p,Ze),We),Ot=u.evaluateSizeForZoom(_t,$.zoom),Tt=h.style.terrain&&h.style.terrain.getTerrainData(Te);let zt,$t,Nn,fi,ei=[0,0],mi=null;if(p){if($t=ye.glyphAtlasTexture,Nn=G.LINEAR,zt=ye.glyphAtlasTexture.size,Ze.iconsInText){ei=ye.imageAtlasTexture.size,mi=ye.imageAtlasTexture;const Gr=_t.kind==="composite"||_t.kind==="camera";fi=rt||h.options.rotating||h.options.zooming||Gr?G.LINEAR:G.NEAREST}}else{const Gr=s.layout.get("icon-size").constantOr(0)!==1||Ze.iconsNeedLinear;$t=ye.imageAtlasTexture,Nn=mt||h.options.rotating||h.options.zooming||Gr||rt?G.LINEAR:G.NEAREST,zt=ye.imageAtlasTexture.size}const to=kn(ye,1,h.transform.zoom),jr=uo(Te.posMatrix,ee,j,h.transform,to),yr=Jr(Te.posMatrix,ee,j,h.transform,to),Pi=_e&&Ze.hasTextData(),Ua=s.layout.get("icon-text-fit")!=="none"&&Pi&&Ze.hasIconData();if(ie){const Gr=h.style.terrain?(au,ns)=>h.style.terrain.getElevation(Te,au,ns):null,vo=s.layout.get("text-rotation-alignment")==="map";kr(Ze,Te.posMatrix,h,p,jr,yr,ee,k,vo,Gr)}const Pn=h.translatePosMatrix(Te.posMatrix,ye,g,x),wt=ie||p&&_e||Ua?tp:jr,Bt=h.translatePosMatrix(yr,ye,g,x,!0),Un=mt&&s.paint.get(p?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Vn;Vn=mt?Ze.iconsInText?kc(_t.kind,Ot,ce,ee,h,Pn,wt,Bt,zt,ei):Ta(_t.kind,Ot,ce,ee,h,Pn,wt,Bt,p,zt,!0):Ll(_t.kind,Ot,ce,ee,h,Pn,wt,Bt,p,zt);const on={program:Ft,buffers:Re,uniformValues:Vn,atlasTexture:$t,atlasTextureIcon:mi,atlasInterpolation:Nn,atlasInterpolationIcon:fi,isSDF:mt,hasHalo:Un};if(W&&Ze.canOverlap){pe=!0;const Gr=Re.segments.get();for(const vo of Gr)ve.push({segments:new u.SegmentVector([vo]),sortKey:vo.sortKey,state:on,terrainData:Tt})}else ve.push({segments:Re.segments,sortKey:0,state:on,terrainData:Tt})}pe&&ve.sort((Te,ye)=>Te.sortKey-ye.sortKey);for(const Te of ve){const ye=Te.state;if(R.activeTexture.set(G.TEXTURE0),ye.atlasTexture.bind(ye.atlasInterpolation,G.CLAMP_TO_EDGE),ye.atlasTextureIcon&&(R.activeTexture.set(G.TEXTURE1),ye.atlasTextureIcon&&ye.atlasTextureIcon.bind(ye.atlasInterpolationIcon,G.CLAMP_TO_EDGE)),ye.isSDF){const Ze=ye.uniformValues;ye.hasHalo&&(Ze.u_is_halo=1,Os(ye.buffers,Te.segments,s,h,ye.program,he,A,D,Ze,Te.terrainData)),Ze.u_is_halo=0}Os(ye.buffers,Te.segments,s,h,ye.program,he,A,D,ye.uniformValues,Te.terrainData)}}function Os(h,t,s,c,p,g,x,S,E,k){const A=c.context;p.draw(A,A.gl.TRIANGLES,g,x,S,nn.disabled,E,k,s.id,h.layoutVertexBuffer,h.indexBuffer,t,s.paint,c.transform.zoom,h.programConfigurations.get(s.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function Ns(h,t,s,c,p,g,x){const S=h.context.gl,E=s.paint.get("fill-pattern"),k=E&&E.constantOr(1),A=s.getCrossfadeParameters();let D,R,G,$,j;x?(R=k&&!s.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",D=S.LINES):(R=k?"fillPattern":"fill",D=S.TRIANGLES);for(const ee of c){const ie=t.getTile(ee);if(k&&!ie.patternsLoaded())continue;const ce=ie.getBucket(s);if(!ce)continue;const W=ce.programConfigurations.get(s.id),pe=h.useProgram(R,W),he=h.style.terrain&&h.style.terrain.getTerrainData(ee);k&&(h.context.activeTexture.set(S.TEXTURE0),ie.imageAtlasTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),W.updatePaintBuffers(A));const _e=E.constantOr(null);if(_e&&ie.imageAtlas){const ye=ie.imageAtlas,Ze=ye.patternPositions[_e.to.toString()],Re=ye.patternPositions[_e.from.toString()];Ze&&Re&&W.setConstantPatternPositions(Ze,Re)}const ve=he?ee:null,Te=h.translatePosMatrix(ve?ve.posMatrix:ee.posMatrix,ie,s.paint.get("fill-translate"),s.paint.get("fill-translate-anchor"));if(x){$=ce.indexBuffer2,j=ce.segments2;const ye=[S.drawingBufferWidth,S.drawingBufferHeight];G=R==="fillOutlinePattern"&&k?bc(Te,h,A,ie,ye):wc(Te,ye)}else $=ce.indexBuffer,j=ce.segments,G=k?Pl(Te,h,A,ie):wa(Te);pe.draw(h.context,D,p,h.stencilModeForClipping(ee),g,nn.disabled,G,he,s.id,ce.layoutVertexBuffer,$,j,s.paint,h.transform.zoom,W)}}function Us(h,t,s,c,p,g,x){const S=h.context,E=S.gl,k=s.paint.get("fill-extrusion-pattern"),A=k.constantOr(1),D=s.getCrossfadeParameters(),R=s.paint.get("fill-extrusion-opacity");for(const G of c){const $=t.getTile(G),j=$.getBucket(s);if(!j)continue;const ee=h.style.terrain&&h.style.terrain.getTerrainData(G),ie=j.programConfigurations.get(s.id),ce=h.useProgram(A?"fillExtrusionPattern":"fillExtrusion",ie);A&&(h.context.activeTexture.set(E.TEXTURE0),$.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),ie.updatePaintBuffers(D));const W=k.constantOr(null);if(W&&$.imageAtlas){const ve=$.imageAtlas,Te=ve.patternPositions[W.to.toString()],ye=ve.patternPositions[W.from.toString()];Te&&ye&&ie.setConstantPatternPositions(Te,ye)}const pe=h.translatePosMatrix(G.posMatrix,$,s.paint.get("fill-extrusion-translate"),s.paint.get("fill-extrusion-translate-anchor")),he=s.paint.get("fill-extrusion-vertical-gradient"),_e=A?Zd(pe,h,he,R,G,D,$):Ml(pe,h,he,R);ce.draw(S,S.gl.TRIANGLES,p,g,x,nn.backCCW,_e,ee,s.id,j.layoutVertexBuffer,j.indexBuffer,j.segments,s.paint,h.transform.zoom,ie,h.style.terrain&&j.centroidVertexBuffer)}}function Wl(h,t,s,c,p,g,x){const S=h.context,E=S.gl,k=s.fbo;if(!k)return;const A=h.useProgram("hillshade"),D=h.style.terrain&&h.style.terrain.getTerrainData(t);S.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,k.colorAttachment.get()),A.draw(S,E.TRIANGLES,p,g,x,nn.disabled,((R,G,$,j)=>{const ee=$.paint.get("hillshade-shadow-color"),ie=$.paint.get("hillshade-highlight-color"),ce=$.paint.get("hillshade-accent-color");let W=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(W-=R.transform.angle);const pe=!R.options.moving;return{u_matrix:j?j.posMatrix:R.transform.calculatePosMatrix(G.tileID.toUnwrapped(),pe),u_image:0,u_latrange:Sa(0,G.tileID),u_light:[$.paint.get("hillshade-exaggeration"),W],u_shadow:ee,u_highlight:ie,u_accent:ce}})(h,s,c,D?t:null),D,c.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}function Bc(h,t,s,c,p,g){const x=h.context,S=x.gl,E=t.dem;if(E&&E.data){const k=E.dim,A=E.stride,D=E.getPixels();if(x.activeTexture.set(S.TEXTURE1),x.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(A),t.demTexture){const G=t.demTexture;G.update(D,{premultiply:!1}),G.bind(S.NEAREST,S.CLAMP_TO_EDGE)}else t.demTexture=new we(x,D,S.RGBA,{premultiply:!1}),t.demTexture.bind(S.NEAREST,S.CLAMP_TO_EDGE);x.activeTexture.set(S.TEXTURE0);let R=t.fbo;if(!R){const G=new we(x,{width:k,height:k,data:null},S.RGBA);G.bind(S.LINEAR,S.CLAMP_TO_EDGE),R=t.fbo=x.createFramebuffer(k,k,!0),R.colorAttachment.set(G.texture)}x.bindFramebuffer.set(R.framebuffer),x.viewport.set([0,0,k,k]),h.useProgram("hillshadePrepare").draw(x,S.TRIANGLES,c,p,g,nn.disabled,((G,$)=>{const j=$.stride,ee=u.create();return u.ortho(ee,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(ee,ee,[0,-u.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[j,j],u_zoom:G.overscaledZ,u_unpack:$.getUnpackVector()}})(t.tileID,E),null,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),t.needsHillshadePrepare=!1}}function Da(h,t,s,c,p,g){const x=c.paint.get("raster-fade-duration");if(!g&&x>0){const S=u.exported.now(),E=(S-h.timeAdded)/x,k=t?(S-t.timeAdded)/x:-1,A=s.getSource(),D=p.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),R=!t||Math.abs(t.tileID.overscaledZ-D)>Math.abs(h.tileID.overscaledZ-D),G=R&&h.refreshedUponExpiration?1:u.clamp(R?E:1-k,0,1);return h.refreshedUponExpiration&&E>=1&&(h.refreshedUponExpiration=!1),t?{opacity:1,mix:1-G}:{opacity:G,mix:0}}return{opacity:1,mix:0}}const La=new u.Color(1,0,0,1),Qr=new u.Color(0,1,0,1),Fc=new u.Color(0,0,1,1),Xl=new u.Color(1,0,1,1),Oc=new u.Color(0,1,1,1);function go(h,t,s,c){Yo(h,0,t+s/2,h.transform.width,s,c)}function Vs(h,t,s,c){Yo(h,t-s/2,0,s,h.transform.height,c)}function Yo(h,t,s,c,p,g){const x=h.context,S=x.gl;S.enable(S.SCISSOR_TEST),S.scissor(t*h.pixelRatio,s*h.pixelRatio,c*h.pixelRatio,p*h.pixelRatio),x.clear({color:g}),S.disable(S.SCISSOR_TEST)}function ip(h,t,s){const c=h.context,p=c.gl,g=s.posMatrix,x=h.useProgram("debug"),S=Et.disabled,E=Xt.disabled,k=h.colorModeForRenderPass(),A="$debug",D=h.style.terrain&&h.style.terrain.getTerrainData(s);c.activeTexture.set(p.TEXTURE0),h.emptyTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE);const R=t.getTileByID(s.key).latestRawTileData,G=Math.floor((R&&R.byteLength||0)/1024),$=t.getTile(s).tileSize,j=512/Math.min($,512)*(s.overscaledZ/h.transform.zoom)*.5;let ee=s.canonical.toString();s.overscaledZ!==s.canonical.z&&(ee+=` => ${s.overscaledZ}`),function(ie,ce){ie.initDebugOverlayCanvas();const W=ie.debugOverlayCanvas,pe=ie.context.gl,he=ie.debugOverlayCanvas.getContext("2d");he.clearRect(0,0,W.width,W.height),he.shadowColor="white",he.shadowBlur=2,he.lineWidth=1.5,he.strokeStyle="white",he.textBaseline="top",he.font="bold 36px Open Sans, sans-serif",he.fillText(ce,5,5),he.strokeText(ce,5,5),ie.debugOverlayTexture.update(W),ie.debugOverlayTexture.bind(pe.LINEAR,pe.CLAMP_TO_EDGE)}(h,`${ee} ${G}kB`),x.draw(c,p.TRIANGLES,S,E,Jt.alphaBlended,nn.disabled,Ps(g,u.Color.transparent,j),null,A,h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments),x.draw(c,p.LINE_STRIP,S,E,k,nn.disabled,Ps(g,u.Color.red),D,A,h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments)}function Ra(h,t,s){const c=h.context,p=c.gl,g=h.colorModeForRenderPass(),x=new Et(p.LEQUAL,Et.ReadWrite,h.depthRangeFor3D),S=h.useProgram("terrain"),E=t.getTerrainMesh(),k=t.getTerrainData(s.tileID);c.bindFramebuffer.set(null),c.viewport.set([0,0,h.width,h.height]),c.activeTexture.set(p.TEXTURE0),p.bindTexture(p.TEXTURE_2D,t.getRTTFramebuffer().colorAttachment.get());const A=h.transform.calculatePosMatrix(s.tileID.toUnwrapped());S.draw(c,p.TRIANGLES,x,Xt.disabled,g,nn.backCCW,{u_matrix:A,u_texture:0},k,"terrain",E.vertexBuffer,E.indexBuffer,E.segments)}function Nc(h,t,s,c){const p=h.context,g=s.tileSize*t.qualityFactor;s.textures[c]||(s.textures[c]=h.getTileTexture(g)||new we(p,{width:g,height:g,data:null},p.gl.RGBA),s.textures[c].bind(p.gl.LINEAR,p.gl.CLAMP_TO_EDGE),c===0&&t.sourceCache.renderHistory.unshift(s.tileID.key));const x=t.getRTTFramebuffer();x.colorAttachment.set(s.textures[c].texture),p.bindFramebuffer.set(x.framebuffer),p.viewport.set([0,0,g,g])}class Uc{constructor(t){this._coordsDescendingInv={},this._coordsDescendingInvStr={},this.painter=t,this._renderToTexture={background:!0,fill:!0,line:!0,raster:!0},this._coordsDescendingInv={},this._coordsDescendingInvStr={},this._stacks=[],this._prevType=null,this._rerender={},this._renderableTiles=t.style.terrain.sourceCache.getRenderableTiles(),this._init()}_init(){const t=this.painter.style,s=t.terrain;for(const c in t.sourceCaches){this._coordsDescendingInv[c]={};const p=t.sourceCaches[c].getVisibleCoordinates();for(const g of p){const x=s.sourceCache.getTerrainCoords(g);for(const S in x)this._coordsDescendingInv[c][S]||(this._coordsDescendingInv[c][S]=[]),this._coordsDescendingInv[c][S].push(x[S])}}for(const c of t._order){const p=t._layers[c],g=p.source;if(this._renderToTexture[p.type]&&!this._coordsDescendingInvStr[g]){this._coordsDescendingInvStr[g]={};for(const x in this._coordsDescendingInv[g])this._coordsDescendingInvStr[g][x]=this._coordsDescendingInv[g][x].map(S=>S.key).sort().join()}}return this._renderableTiles.forEach(c=>{for(const p in this._coordsDescendingInvStr){const g=this._coordsDescendingInvStr[p][c.tileID.key];g&&g!==c.textureCoords[p]&&c.clearTextures(this.painter),s.needsRerender(p,c.tileID)&&c.clearTextures(this.painter)}this._rerender[c.tileID.key]=!c.textures.length}),s.clearRerenderCache(),s.sourceCache.removeOutdated(this.painter),this}renderLayer(t){const s=t.type,c=this.painter,p=c.style._order,g=c.currentLayer,x=g+1===p.length;if(this._renderToTexture[s]&&(this._prevType&&this._renderToTexture[this._prevType]||this._stacks.push([]),this._prevType=s,this._stacks[this._stacks.length-1].push(p[g]),!x))return!0;if(this._renderToTexture[this._prevType]||s==="hillshade"||this._renderToTexture[s]&&x){this._prevType=s;const S=this._stacks.length-1,E=this._stacks[S]||[];for(const k of this._renderableTiles){if(Nc(c,c.style.terrain,k,S),this._rerender[k.tileID.key]){c.context.clear({color:u.Color.transparent});for(let A=0;A<E.length;A++){const D=c.style._layers[E[A]],R=D.source?this._coordsDescendingInv[D.source][k.tileID.key]:[k.tileID];c._renderTileClippingMasks(D,R),c.renderLayer(c,c.style.sourceCaches[D.source],D,R),D.source&&(k.textureCoords[D.source]=this._coordsDescendingInvStr[D.source][k.tileID.key])}}Ra(c,c.style.terrain,k)}if(s==="hillshade"){this._stacks.push([p[g]]);for(const k of this._renderableTiles){const A=this._coordsDescendingInv[t.source][k.tileID.key];Nc(c,c.style.terrain,k,this._stacks.length-1),c.context.clear({color:u.Color.transparent}),c._renderTileClippingMasks(t,A),c.renderLayer(c,c.style.sourceCaches[t.source],t,A),Ra(c,c.style.terrain,k)}return!0}return this._renderToTexture[s]}return!1}}const $s={symbol:function(h,t,s,c,p){if(h.renderPass!=="translucent")return;const g=Xt.disabled,x=h.colorModeForRenderPass();s.layout.get("text-variable-anchor")&&function(S,E,k,A,D,R,G){const $=E.transform,j=D==="map",ee=R==="map";for(const ie of S){const ce=A.getTile(ie),W=ce.getBucket(k);if(!W||!W.text||!W.text.segments.get().length)continue;const pe=u.evaluateSizeForZoom(W.textSizeData,$.zoom),he=kn(ce,1,E.transform.zoom),_e=uo(ie.posMatrix,ee,j,E.transform,he),ve=k.layout.get("icon-text-fit")!=="none"&&W.hasIconData();if(pe){const Te=Math.pow(2,$.zoom-ce.tileID.overscaledZ);Rc(W,j,ee,G,$,_e,ie.posMatrix,Te,pe,ve,E.style.terrain?(ye,Ze)=>E.style.terrain.getElevation(ie,ye,Ze):null)}}}(c,h,s,t,s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),p),s.paint.get("icon-opacity").constantOr(1)!==0&&Pa(h,t,s,c,!1,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),s.layout.get("icon-rotation-alignment"),s.layout.get("icon-pitch-alignment"),s.layout.get("icon-keep-upright"),g,x),s.paint.get("text-opacity").constantOr(1)!==0&&Pa(h,t,s,c,!0,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),s.layout.get("text-rotation-alignment"),s.layout.get("text-pitch-alignment"),s.layout.get("text-keep-upright"),g,x),t.map.showCollisionBoxes&&(Ko(h,t,s,c,s.paint.get("text-translate"),s.paint.get("text-translate-anchor"),!0),Ko(h,t,s,c,s.paint.get("icon-translate"),s.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("circle-opacity"),g=s.paint.get("circle-stroke-width"),x=s.paint.get("circle-stroke-opacity"),S=!s.layout.get("circle-sort-key").isConstant();if(p.constantOr(1)===0&&(g.constantOr(1)===0||x.constantOr(1)===0))return;const E=h.context,k=E.gl,A=h.depthModeForSublayer(0,Et.ReadOnly),D=Xt.disabled,R=h.colorModeForRenderPass(),G=[];for(let $=0;$<c.length;$++){const j=c[$],ee=t.getTile(j),ie=ee.getBucket(s);if(!ie)continue;const ce=ie.programConfigurations.get(s.id),W=h.useProgram("circle",ce),pe=ie.layoutVertexBuffer,he=ie.indexBuffer,_e=h.style.terrain&&h.style.terrain.getTerrainData(j),ve={programConfiguration:ce,program:W,layoutVertexBuffer:pe,indexBuffer:he,uniformValues:Sc(h,j,ee,s),terrainData:_e};if(S){const Te=ie.segments.get();for(const ye of Te)G.push({segments:new u.SegmentVector([ye]),sortKey:ye.sortKey,state:ve})}else G.push({segments:ie.segments,sortKey:0,state:ve})}S&&G.sort(($,j)=>$.sortKey-j.sortKey);for(const $ of G){const{programConfiguration:j,program:ee,layoutVertexBuffer:ie,indexBuffer:ce,uniformValues:W,terrainData:pe}=$.state;ee.draw(E,k.TRIANGLES,A,D,R,nn.disabled,W,pe,s.id,ie,ce,$.segments,s.paint,h.transform.zoom,j)}},heatmap:function(h,t,s,c){if(s.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const p=h.context,g=p.gl,x=Xt.disabled,S=new Jt([g.ONE,g.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(E,k,A){const D=E.gl;E.activeTexture.set(D.TEXTURE1),E.viewport.set([0,0,k.width/4,k.height/4]);let R=A.heatmapFbo;if(R)D.bindTexture(D.TEXTURE_2D,R.colorAttachment.get()),E.bindFramebuffer.set(R.framebuffer);else{const G=D.createTexture();D.bindTexture(D.TEXTURE_2D,G),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_S,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_WRAP_T,D.CLAMP_TO_EDGE),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MIN_FILTER,D.LINEAR),D.texParameteri(D.TEXTURE_2D,D.TEXTURE_MAG_FILTER,D.LINEAR),R=A.heatmapFbo=E.createFramebuffer(k.width/4,k.height/4,!1),function($,j,ee,ie){const ce=$.gl;ce.texImage2D(ce.TEXTURE_2D,0,ce.RGBA,j.width/4,j.height/4,0,ce.RGBA,$.extRenderToTextureHalfFloat?$.extTextureHalfFloat.HALF_FLOAT_OES:ce.UNSIGNED_BYTE,null),ie.colorAttachment.set(ee)}(E,k,G,R)}})(p,h,s),p.clear({color:u.Color.transparent});for(let E=0;E<c.length;E++){const k=c[E];if(t.hasRenderableParent(k))continue;const A=t.getTile(k),D=A.getBucket(s);if(!D)continue;const R=D.programConfigurations.get(s.id),G=h.useProgram("heatmap",R),{zoom:$}=h.transform;G.draw(p,g.TRIANGLES,Et.disabled,x,S,nn.disabled,ba(k.posMatrix,A,$,s.paint.get("heatmap-intensity")),null,s.id,D.layoutVertexBuffer,D.indexBuffer,D.segments,s.paint,h.transform.zoom,R)}p.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(p,g){const x=p.context,S=x.gl,E=g.heatmapFbo;if(!E)return;x.activeTexture.set(S.TEXTURE0),S.bindTexture(S.TEXTURE_2D,E.colorAttachment.get()),x.activeTexture.set(S.TEXTURE1);let k=g.colorRampTexture;k||(k=g.colorRampTexture=new we(x,g.colorRamp,S.RGBA)),k.bind(S.LINEAR,S.CLAMP_TO_EDGE),p.useProgram("heatmapTexture").draw(x,S.TRIANGLES,Et.disabled,Xt.disabled,p.colorModeForRenderPass(),nn.disabled,((A,D,R,G)=>{const $=u.create();u.ortho($,0,A.width,A.height,0,0,1);const j=A.context.gl;return{u_matrix:$,u_world:[j.drawingBufferWidth,j.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:D.paint.get("heatmap-opacity")}})(p,g),null,g.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments,g.paint,p.transform.zoom)}(h,s))},line:function(h,t,s,c){if(h.renderPass!=="translucent")return;const p=s.paint.get("line-opacity"),g=s.paint.get("line-width");if(p.constantOr(1)===0||g.constantOr(1)===0)return;const x=h.depthModeForSublayer(0,Et.ReadOnly),S=h.colorModeForRenderPass(),E=s.paint.get("line-dasharray"),k=s.paint.get("line-pattern"),A=k.constantOr(1),D=s.paint.get("line-gradient"),R=s.getCrossfadeParameters(),G=A?"linePattern":E?"lineSDF":D?"lineGradient":"line",$=h.context,j=$.gl;let ee=!0;for(const ie of c){const ce=t.getTile(ie);if(A&&!ce.patternsLoaded())continue;const W=ce.getBucket(s);if(!W)continue;const pe=W.programConfigurations.get(s.id),he=h.context.program.get(),_e=h.useProgram(G,pe),ve=ee||_e.program!==he,Te=h.style.terrain&&h.style.terrain.getTerrainData(ie),ye=k.constantOr(null);if(ye&&ce.imageAtlas){const We=ce.imageAtlas,mt=We.patternPositions[ye.to.toString()],_t=We.patternPositions[ye.from.toString()];mt&&_t&&pe.setConstantPatternPositions(mt,_t)}const Ze=Te?ie:null,Re=A?Ea(h,ce,s,R,Ze):E?Ds(h,ce,s,E,R,Ze):D?Dl(h,ce,s,W.lineClipsArray.length,Ze):qo(h,ce,s,Ze);if(A)$.activeTexture.set(j.TEXTURE0),ce.imageAtlasTexture.bind(j.LINEAR,j.CLAMP_TO_EDGE),pe.updatePaintBuffers(R);else if(E&&(ve||h.lineAtlas.dirty))$.activeTexture.set(j.TEXTURE0),h.lineAtlas.bind($);else if(D){const We=W.gradients[s.id];let mt=We.texture;if(s.gradientVersion!==We.version){let _t=256;if(s.stepInterpolant){const rt=t.getSource().maxzoom,Ft=ie.canonical.z===rt?Math.ceil(1<<h.transform.maxZoom-ie.canonical.z):1;_t=u.clamp(u.nextPowerOfTwo(W.maxLineLength/u.EXTENT*1024*Ft),256,$.maxTextureSize)}We.gradient=u.renderColorRamp({expression:s.gradientExpression(),evaluationKey:"lineProgress",resolution:_t,image:We.gradient||void 0,clips:W.lineClipsArray}),We.texture?We.texture.update(We.gradient):We.texture=new we($,We.gradient,j.RGBA),We.version=s.gradientVersion,mt=We.texture}$.activeTexture.set(j.TEXTURE0),mt.bind(s.stepInterpolant?j.NEAREST:j.LINEAR,j.CLAMP_TO_EDGE)}_e.draw($,j.TRIANGLES,x,h.stencilModeForClipping(ie),S,nn.disabled,Re,Te,s.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,s.paint,h.transform.zoom,pe,W.layoutVertexBuffer2),ee=!1}},fill:function(h,t,s,c){const p=s.paint.get("fill-color"),g=s.paint.get("fill-opacity");if(g.constantOr(1)===0)return;const x=h.colorModeForRenderPass(),S=s.paint.get("fill-pattern"),E=h.opaquePassEnabledForLayer()&&!S.constantOr(1)&&p.constantOr(u.Color.transparent).a===1&&g.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===E){const k=h.depthModeForSublayer(1,h.renderPass==="opaque"?Et.ReadWrite:Et.ReadOnly);Ns(h,t,s,c,k,x,!1)}if(h.renderPass==="translucent"&&s.paint.get("fill-antialias")){const k=h.depthModeForSublayer(s.getPaintProperty("fill-outline-color")?2:0,Et.ReadOnly);Ns(h,t,s,c,k,x,!0)}},"fill-extrusion":function(h,t,s,c){const p=s.paint.get("fill-extrusion-opacity");if(p!==0&&h.renderPass==="translucent"){const g=new Et(h.context.gl.LEQUAL,Et.ReadWrite,h.depthRangeFor3D);if(p!==1||s.paint.get("fill-extrusion-pattern").constantOr(1))Us(h,t,s,c,g,Xt.disabled,Jt.disabled),Us(h,t,s,c,g,h.stencilModeFor3D(),h.colorModeForRenderPass());else{const x=h.colorModeForRenderPass();Us(h,t,s,c,g,Xt.disabled,x)}}},hillshade:function(h,t,s,c){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent")return;const p=h.context,g=h.depthModeForSublayer(0,Et.ReadOnly),x=h.colorModeForRenderPass(),[S,E]=h.renderPass==="translucent"?h.stencilConfigForOverlap(c):[{},c];for(const k of E){const A=t.getTile(k);A.needsHillshadePrepare!==void 0&&A.needsHillshadePrepare&&h.renderPass==="offscreen"?Bc(h,A,s,g,Xt.disabled,x):h.renderPass==="translucent"&&Wl(h,k,A,s,g,S[k.overscaledZ],x)}p.viewport.set([0,0,h.width,h.height])},raster:function(h,t,s,c){if(h.renderPass!=="translucent"||s.paint.get("raster-opacity")===0||!c.length)return;const p=h.context,g=p.gl,x=t.getSource(),S=h.useProgram("raster"),E=h.colorModeForRenderPass(),[k,A]=x instanceof st?[{},c]:h.stencilConfigForOverlap(c),D=A[A.length-1].overscaledZ,R=!h.options.moving;for(const G of A){const $=h.depthModeForSublayer(G.overscaledZ-D,s.paint.get("raster-opacity")===1?Et.ReadWrite:Et.ReadOnly,g.LESS),j=t.getTile(G);j.registerFadeDuration(s.paint.get("raster-fade-duration"));const ee=t.findLoadedParent(G,0),ie=Da(j,ee,t,s,h.transform,h.style.terrain);let ce,W;const pe=s.paint.get("raster-resampling")==="nearest"?g.NEAREST:g.LINEAR;p.activeTexture.set(g.TEXTURE0),j.texture.bind(pe,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),p.activeTexture.set(g.TEXTURE1),ee?(ee.texture.bind(pe,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST),ce=Math.pow(2,ee.tileID.overscaledZ-j.tileID.overscaledZ),W=[j.tileID.canonical.x*ce%1,j.tileID.canonical.y*ce%1]):j.texture.bind(pe,g.CLAMP_TO_EDGE,g.LINEAR_MIPMAP_NEAREST);const he=h.style.terrain&&h.style.terrain.getTerrainData(G),_e=he?G:null,ve=_e?_e.posMatrix:h.transform.calculatePosMatrix(G.toUnwrapped(),R),Te=Ec(ve,W||[0,0],ce||1,ie,s);x instanceof st?S.draw(p,g.TRIANGLES,$,Xt.disabled,E,nn.disabled,Te,he,s.id,x.boundsBuffer,h.quadTriangleIndexBuffer,x.boundsSegments):S.draw(p,g.TRIANGLES,$,k[G.overscaledZ],E,nn.disabled,Te,he,s.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,t,s,c){const p=s.paint.get("background-color"),g=s.paint.get("background-opacity");if(g===0)return;const x=h.context,S=x.gl,E=h.transform,k=E.tileSize,A=s.paint.get("background-pattern");if(h.isPatternMissing(A))return;const D=!A&&p.a===1&&g===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==D)return;const R=Xt.disabled,G=h.depthModeForSublayer(0,D==="opaque"?Et.ReadWrite:Et.ReadOnly),$=h.colorModeForRenderPass(),j=h.useProgram(A?"backgroundPattern":"background"),ee=c||E.coveringTiles({tileSize:k,terrain:h.style.terrain});A&&(x.activeTexture.set(S.TEXTURE0),h.imageManager.bind(h.context));const ie=s.getCrossfadeParameters();for(const ce of ee){const W=c?ce.posMatrix:h.transform.calculatePosMatrix(ce.toUnwrapped()),pe=A?Wd(W,g,h,A,{tileID:ce,tileSize:k},ie):qd(W,g,p),he=h.style.terrain&&h.style.terrain.getTerrainData(ce);j.draw(x,S.TRIANGLES,G,R,$,nn.disabled,pe,he,s.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}},debug:function(h,t,s){for(let c=0;c<s.length;c++)ip(h,t,s[c])},custom:function(h,t,s){const c=h.context,p=s.implementation;if(h.renderPass==="offscreen"){const g=p.prerender;g&&(h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),g.call(p,c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),c.setColorMode(h.colorModeForRenderPass()),c.setStencilMode(Xt.disabled);const g=p.renderingMode==="3d"?new Et(h.context.gl.LEQUAL,Et.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Et.ReadOnly);c.setDepthMode(g),p.render(c.gl,h.transform.customLayerMatrix()),c.setDirty(),h.setBaseState(),c.bindFramebuffer.set(null)}}};class Hl{constructor(t,s){this.context=new Lc(t),this.transform=s,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.create(),renderTime:0},this.setup(),this.numSublayers=Rt.maxUnderzooming+Rt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new ct,this.gpuTimers={}}resize(t,s,c){if(this.width=t*c,this.height=s*c,this.pixelRatio=c,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style._order)this.style._layers[p].resize()}setup(){const t=this.context,s=new u.PosArray;s.emplaceBack(0,0),s.emplaceBack(u.EXTENT,0),s.emplaceBack(0,u.EXTENT),s.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=t.createVertexBuffer(s,Ct.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const c=new u.PosArray;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=t.createVertexBuffer(c,Ct.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const p=new u.RasterBoundsArray;p.emplaceBack(0,0,0,0),p.emplaceBack(u.EXTENT,0,u.EXTENT,0),p.emplaceBack(0,u.EXTENT,0,u.EXTENT),p.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.rasterBoundsBuffer=t.createVertexBuffer(p,Ne.members),this.rasterBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const g=new u.PosArray;g.emplaceBack(0,0),g.emplaceBack(1,0),g.emplaceBack(0,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,Ct.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const x=new u.LineStripIndexArray;x.emplaceBack(0),x.emplaceBack(1),x.emplaceBack(3),x.emplaceBack(2),x.emplaceBack(0),this.tileBorderIndexBuffer=t.createIndexBuffer(x);const S=new u.TriangleIndexArray;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(S),this.emptyTexture=new we(t,{width:1,height:1,data:new Uint8Array([0,0,0,0])},t.gl.RGBA);const E=this.context.gl;this.stencilClearMode=new Xt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO)}clearStencil(){const t=this.context,s=t.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const c=u.create();u.ortho(c,0,this.width,this.height,0,0,1),u.scale(c,c,[s.drawingBufferWidth,s.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(t,s.TRIANGLES,Et.disabled,this.stencilClearMode,Jt.disabled,nn.disabled,Zo(c),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(t,s){if(this.currentStencilSource===t.source||!t.isTileClipped()||!s||!s.length)return;this.currentStencilSource=t.source;const c=this.context,p=c.gl;this.nextStencilID+s.length>256&&this.clearStencil(),c.setColorMode(Jt.disabled),c.setDepthMode(Et.disabled);const g=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of s){const S=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,E=this.style.terrain&&this.style.terrain.getTerrainData(x);g.draw(c,p.TRIANGLES,Et.disabled,new Xt({func:p.ALWAYS,mask:0},S,255,p.KEEP,p.KEEP,p.REPLACE),Jt.disabled,nn.disabled,Zo(x.posMatrix),E,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,s=this.context.gl;return new Xt({func:s.NOTEQUAL,mask:255},t,255,s.KEEP,s.KEEP,s.REPLACE)}stencilModeForClipping(t){const s=this.context.gl;return new Xt({func:s.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,s.KEEP,s.KEEP,s.REPLACE)}stencilConfigForOverlap(t){const s=this.context.gl,c=t.sort((x,S)=>S.overscaledZ-x.overscaledZ),p=c[c.length-1].overscaledZ,g=c[0].overscaledZ-p+1;if(g>1){this.currentStencilSource=void 0,this.nextStencilID+g>256&&this.clearStencil();const x={};for(let S=0;S<g;S++)x[S+p]=new Xt({func:s.GEQUAL,mask:255},S+this.nextStencilID,255,s.KEEP,s.KEEP,s.REPLACE);return this.nextStencilID+=g,[x,c]}return[{[p]:Xt.disabled},c]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new Jt([t.CONSTANT_COLOR,t.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Jt.unblended:Jt.alphaBlended}depthModeForSublayer(t,s,c){if(!this.opaquePassEnabledForLayer())return Et.disabled;const p=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Et(c||this.context.gl.LEQUAL,s,[p,p])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(t,s){this.style=t,this.options=s,this.lineAtlas=t.lineAtlas,this.imageManager=t.imageManager,this.glyphManager=t.glyphManager,this.symbolFadeChange=t.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const c=this.style._order,p=this.style.sourceCaches,g=this.style.terrain&&new Uc(this);for(const k in p){const A=p[k];A.used&&A.prepare(this.context)}const x={},S={},E={};for(const k in p){const A=p[k];x[k]=A.getVisibleCoordinates(),S[k]=x[k].slice().reverse(),E[k]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let k=0;k<c.length;k++)if(this.style._layers[c[k]].is3D()){this.opaquePassCutoff=k;break}if(g){this.opaquePassCutoff=0;const k=this.style.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||k.length)&&(u.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,D){const R=A.context,G=R.gl,$=Jt.unblended,j=new Et(G.LEQUAL,Et.ReadWrite,[0,1]),ee=D.getTerrainMesh(),ie=D.sourceCache.getRenderableTiles(),ce=A.useProgram("terrainDepth");R.bindFramebuffer.set(D.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1});for(const W of ie){const pe=D.getTerrainData(W.tileID),he=A.transform.calculatePosMatrix(W.tileID.toUnwrapped());ce.draw(R,G.TRIANGLES,j,Xt.disabled,$,nn.backCCW,{u_matrix:he},pe,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.terrain),function(A,D){const R=A.context,G=R.gl,$=Jt.unblended,j=new Et(G.LEQUAL,Et.ReadWrite,[0,1]),ee=D.getTerrainMesh(),ie=D.getCoordsTexture(),ce=D.sourceCache.getRenderableTiles(),W=A.useProgram("terrainCoords");R.bindFramebuffer.set(D.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1}),D.coordsIndex=[];for(const pe of ce){const he=D.getTerrainData(pe.tileID);R.activeTexture.set(G.TEXTURE0),G.bindTexture(G.TEXTURE_2D,ie.texture);const _e=A.transform.calculatePosMatrix(pe.tileID.toUnwrapped());W.draw(R,G.TRIANGLES,j,Xt.disabled,$,nn.backCCW,{u_matrix:_e,u_terrain_coords_id:(255-D.coordsIndex.length)/255,u_texture:0},he,"terrain",ee.vertexBuffer,ee.indexBuffer,ee.segments),D.coordsIndex.push(pe.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.terrain))}this.renderPass="offscreen";for(const k of c){const A=this.style._layers[k];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const D=S[A.source];(A.type==="custom"||D.length)&&this.renderLayer(this,p[A.source],A,D)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:s.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=s.showOverdrawInspector,this.depthRangeFor3D=[0,1-(t._order.length+2)*this.numSublayers*this.depthEpsilon],!g)for(this.renderPass="opaque",this.currentLayer=c.length-1;this.currentLayer>=0;this.currentLayer--){const k=this.style._layers[c[this.currentLayer]],A=p[k.source],D=x[k.source];this._renderTileClippingMasks(k,D),this.renderLayer(this,A,k,D)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<c.length;this.currentLayer++){const k=this.style._layers[c[this.currentLayer]],A=p[k.source];if(g&&g.renderLayer(k))continue;const D=(k.type==="symbol"?E:S)[k.source];this._renderTileClippingMasks(k,x[k.source]),this.renderLayer(this,A,k,D)}if(this.options.showTileBoundaries){let k,A;Object.values(this.style._layers).forEach(D=>{D.source&&!D.isHidden(this.transform.zoom)&&(D.source!==(A&&A.id)&&(A=this.style.sourceCaches[D.source]),(!k||k.getSource().maxzoom<A.getSource().maxzoom)&&(k=A))}),k&&$s.debug(this,k,k.getVisibleCoordinates())}this.options.showPadding&&function(k){const A=k.transform.padding;go(k,k.transform.height-(A.top||0),3,La),go(k,A.bottom||0,3,Qr),Vs(k,A.left||0,3,Fc),Vs(k,k.transform.width-(A.right||0),3,Xl);const D=k.transform.centerPoint;(function(R,G,$,j){Yo(R,G-1,$-10,2,20,j),Yo(R,G-10,$-1,20,2,j)})(k,D.x,k.transform.height-D.y,Oc)}(this),this.context.setDefault()}renderLayer(t,s,c,p){c.isHidden(this.transform.zoom)||(c.type==="background"||c.type==="custom"||(p||[]).length)&&(this.id=c.id,this.gpuTimingStart(c),$s[c.type](t,s,c,p,this.style.placement.variableOffsets),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const s=this.context.extTimerQuery;let c=this.gpuTimers[t.id];c||(c=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:s.createQueryEXT()}),c.calls++,s.beginQueryEXT(s.TIME_ELAPSED_EXT,c.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const s={};for(const c in t){const p=t[c],g=this.context.extTimerQuery,x=g.getQueryObjectEXT(p.query,g.QUERY_RESULT_EXT)/1e6;g.deleteQueryEXT(p.query),s[c]=x}return s}translatePosMatrix(t,s,c,p,g){if(!c[0]&&!c[1])return t;const x=g?p==="map"?this.transform.angle:0:p==="viewport"?-this.transform.angle:0;if(x){const k=Math.sin(x),A=Math.cos(x);c=[c[0]*A-c[1]*k,c[0]*k+c[1]*A]}const S=[g?c[0]:kn(s,c[0],this.transform.zoom),g?c[1]:kn(s,c[1],this.transform.zoom),0],E=new Float32Array(16);return u.translate(E,t,S),E}saveTileTexture(t){const s=this._tileTextures[t.size[0]];s?s.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const s=this._tileTextures[t];return s&&s.length>0?s.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const s=this.imageManager.getPattern(t.from.toString()),c=this.imageManager.getPattern(t.to.toString());return!s||!c}useProgram(t,s){this.cache=this.cache||{};const c=t+(s?s.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.terrain?"/terrain":"");return this.cache[c]||(this.cache[c]=new vc(this.context,t,Ms[t],s,Rl[t],this._showOverdrawInspector,this.style.terrain)),this.cache[c]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new we(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class Ba{constructor(t,s){this.points=t,this.planes=s}static fromInvProjectionMatrix(t,s,c){const p=Math.pow(2,c),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const E=1/(S=u.transformMat4([],S,t))[3]/s*p;return u.mul$1(S,S,[E,E,1/S[3],E])}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const E=u.sub([],g[S[0]],g[S[1]]),k=u.sub([],g[S[2]],g[S[1]]),A=u.normalize([],u.cross([],E,k)),D=-u.dot(A,g[S[1]]);return A.concat(D)});return new Ba(g,x)}}class js{constructor(t,s){this.min=t,this.max=s,this.center=u.scale$1([],u.add([],this.min,this.max),.5)}quadrant(t){const s=[t%2==0,t<2],c=u.clone$2(this.min),p=u.clone$2(this.max);for(let g=0;g<s.length;g++)c[g]=s[g]?this.min[g]:this.center[g],p[g]=s[g]?this.center[g]:this.max[g];return p[2]=this.max[2],new js(c,p)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}intersects(t){const s=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let c=!0;for(let p=0;p<t.planes.length;p++){const g=t.planes[p];let x=0;for(let S=0;S<s.length;S++)u.dot$1(g,s[S])>=0&&x++;if(x===0)return 0;x!==s.length&&(c=!1)}if(c)return 2;for(let p=0;p<3;p++){let g=Number.MAX_VALUE,x=-Number.MAX_VALUE;for(let S=0;S<t.points.length;S++){const E=t.points[S][p]-this.min[p];g=Math.min(g,E),x=Math.max(x,E)}if(x<0||g>this.max[p]-this.min[p])return 0}return 1}}class Jo{constructor(t=0,s=0,c=0,p=0){if(isNaN(t)||t<0||isNaN(s)||s<0||isNaN(c)||c<0||isNaN(p)||p<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=s,this.left=c,this.right=p}interpolate(t,s,c){return s.top!=null&&t.top!=null&&(this.top=u.number(t.top,s.top,c)),s.bottom!=null&&t.bottom!=null&&(this.bottom=u.number(t.bottom,s.bottom,c)),s.left!=null&&t.left!=null&&(this.left=u.number(t.left,s.left,c)),s.right!=null&&t.right!=null&&(this.right=u.number(t.right,s.right,c)),this}getCenter(t,s){const c=u.clamp((this.left+t-this.right)/2,0,t),p=u.clamp((this.top+s-this.bottom)/2,0,s);return new u.pointGeometry(c,p)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Jo(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Gs{constructor(t,s,c,p,g){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=g===void 0||!!g,this._minZoom=t||0,this._maxZoom=s||22,this._minPitch=c??0,this._maxPitch=p??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Jo,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const t=new Gs(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t._elevation=this._elevation,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(t){const s=-u.wrap(t,-180,180)*Math.PI/180;var c;this.angle!==s&&(this._unmodified=!1,this.angle=s,this._calcMatrices(),this.rotationMatrix=(c=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(c[1]=0,c[2]=0),c[0]=1,c[3]=1,c),function(p,g,x){var S=g[0],E=g[1],k=g[2],A=g[3],D=Math.sin(x),R=Math.cos(x);p[0]=S*R+k*D,p[1]=E*R+A*D,p[2]=S*-D+k*R,p[3]=E*-D+A*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const s=u.clamp(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==s&&(this._unmodified=!1,this._pitch=s,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(t){const s=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==s&&(this._unmodified=!1,this._zoom=s,this.scale=this.zoomScale(s),this.tileZoom=Math.floor(s),this.zoomFraction=s-this.tileZoom,this._constrain(),this._calcMatrices())}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(t){t!==this._elevation&&(this._elevation=t,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,s,c){this._unmodified=!1,this._edgeInsets.interpolate(t,s,c),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const s=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,s)}getVisibleUnwrappedCoordinates(t){const s=[new u.UnwrappedTileID(0,t)];if(this._renderWorldCopies){const c=this.pointCoordinate(new u.pointGeometry(0,0)),p=this.pointCoordinate(new u.pointGeometry(this.width,0)),g=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),x=this.pointCoordinate(new u.pointGeometry(0,this.height)),S=Math.floor(Math.min(c.x,p.x,g.x,x.x)),E=Math.floor(Math.max(c.x,p.x,g.x,x.x)),k=1;for(let A=S-k;A<=E+k;A++)A!==0&&s.push(new u.UnwrappedTileID(A,t))}return s}coveringTiles(t){var s,c;let p=this.coveringZoomLevel(t);const g=p;if(t.minzoom!==void 0&&p<t.minzoom)return[];t.maxzoom!==void 0&&p>t.maxzoom&&(p=t.maxzoom);const x=this.pointCoordinate(this.getCameraPoint()),S=u.MercatorCoordinate.fromLngLat(this.center),E=Math.pow(2,p),k=[E*x.x,E*x.y,0],A=[E*S.x,E*S.y,0],D=Ba.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,p);let R=t.minzoom||0;!t.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(R=p);const G=t.terrain?2/Math.min(this.tileSize,t.tileSize)*this.tileSize:3,$=W=>({aabb:new js([W*E,0,0],[(W+1)*E,E,0]),zoom:0,x:0,y:0,wrap:W,fullyVisible:!1}),j=[],ee=[],ie=p,ce=t.reparseOverscaled?g:p;if(this._renderWorldCopies)for(let W=1;W<=3;W++)j.push($(-W)),j.push($(W));for(j.push($(0));j.length>0;){const W=j.pop(),pe=W.x,he=W.y;let _e=W.fullyVisible;if(!_e){const We=W.aabb.intersects(D);if(We===0)continue;_e=We===2}const ve=t.terrain?k:A,Te=W.aabb.distanceX(ve),ye=W.aabb.distanceY(ve),Ze=Math.max(Math.abs(Te),Math.abs(ye)),Re=G+(1<<ie-W.zoom)-2;if(W.zoom===ie||Ze>Re&&W.zoom>=R){const We=ie-W.zoom,mt=k[0]-.5-(pe<<We),_t=k[1]-.5-(he<<We);ee.push({tileID:new u.OverscaledTileID(W.zoom===ie?ce:W.zoom,W.wrap,W.zoom,pe,he),distanceSq:u.sqrLen([A[0]-.5-pe,A[1]-.5-he]),tileDistanceToCamera:Math.sqrt(mt*mt+_t*_t)})}else for(let We=0;We<4;We++){const mt=(pe<<1)+We%2,_t=(he<<1)+(We>>1),rt=W.zoom+1;let Ft=W.aabb.quadrant(We);if(t.terrain){const Ot=new u.OverscaledTileID(rt,W.wrap,rt,mt,_t),Tt=t.terrain.getMinMaxElevation(Ot),zt=(s=Tt.minElevation)!==null&&s!==void 0?s:this.elevation,$t=(c=Tt.maxElevation)!==null&&c!==void 0?c:this.elevation;Ft=new js([Ft.min[0],Ft.min[1],zt],[Ft.max[0],Ft.max[1],$t])}j.push({aabb:Ft,zoom:rt,x:mt,y:_t,wrap:W.wrap,fullyVisible:_e})}}return ee.sort((W,pe)=>W.distanceSq-pe.distanceSq).map(W=>W.tileID)}resize(t,s){this.width=t,this.height=s,this.pixelsToGLUnits=[2/t,-2/s],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(t){const s=u.clamp(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.pointGeometry(u.mercatorXfromLng(t.lng)*this.worldSize,u.mercatorYfromLat(s)*this.worldSize)}unproject(t){return new u.MercatorCoordinate(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(t){this.freezeElevation||(this.elevation=t?this.getElevation(this._center,t):0)}getElevation(t,s){const c=u.MercatorCoordinate.fromLngLat(t),p=(1<<this.tileZoom)*u.EXTENT,g=c.x*p,x=c.y*p,S=Math.floor(g/u.EXTENT),E=Math.floor(x/u.EXTENT),k=new u.OverscaledTileID(this.tileZoom,0,this.tileZoom,S,E);return s.getElevation(k,g%u.EXTENT,x%u.EXTENT,u.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(t){const s=this.pointLocation(this.centerPoint,t),c=this.getElevation(s,t);if(!(this.elevation-c))return;const p=this.getCameraPosition(),g=u.MercatorCoordinate.fromLngLat(p.lngLat,p.altitude),x=u.MercatorCoordinate.fromLngLat(s,c),S=g.x-x.x,E=g.y-x.y,k=g.z-x.z,A=Math.sqrt(S*S+E*E+k*k),D=this.scaleZoom(this.cameraToCenterDistance/A/this.tileSize);this._elevation=c,this._center=s,this.zoom=D}setLocationAtPoint(t,s){const c=this.pointCoordinate(s),p=this.pointCoordinate(this.centerPoint),g=this.locationCoordinate(t),x=new u.MercatorCoordinate(g.x-(c.x-p.x),g.y-(c.y-p.y));this.center=this.coordinateLocation(x),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(t,s){return s?this.coordinatePoint(this.locationCoordinate(t),this.getElevation(t,s),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(t))}pointLocation(t,s){return this.coordinateLocation(this.pointCoordinate(t,s))}locationCoordinate(t){return u.MercatorCoordinate.fromLngLat(t)}coordinateLocation(t){return t&&t.toLngLat()}pointCoordinate(t,s){if(s){const R=s.pointCoordinate(t);if(R!=null)return R}const c=[t.x,t.y,0,1],p=[t.x,t.y,1,1];u.transformMat4(c,c,this.pixelMatrixInverse),u.transformMat4(p,p,this.pixelMatrixInverse);const g=c[3],x=p[3],S=c[1]/g,E=p[1]/x,k=c[2]/g,A=p[2]/x,D=k===A?0:(0-k)/(A-k);return new u.MercatorCoordinate(u.number(c[0]/g,p[0]/x,D)/this.worldSize,u.number(S,E,D)/this.worldSize)}coordinatePoint(t,s=0,c=this.pixelMatrix){const p=[t.x*this.worldSize,t.y*this.worldSize,s,1];return u.transformMat4(p,p,c),new u.pointGeometry(p[0]/p[3],p[1]/p[3])}getBounds(){const t=Math.max(0,this.height/2-this.getHorizon());return new u.LngLatBounds().extend(this.pointLocation(new u.pointGeometry(0,t))).extend(this.pointLocation(new u.pointGeometry(this.width,t))).extend(this.pointLocation(new u.pointGeometry(this.width,this.height))).extend(this.pointLocation(new u.pointGeometry(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new u.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(t,s=!1){const c=t.key,p=s?this._alignedPosMatrixCache:this._posMatrixCache;if(p[c])return p[c];const g=t.canonical,x=this.worldSize/this.zoomScale(g.z),S=g.x+Math.pow(2,g.z)*t.wrap,E=u.identity(new Float64Array(16));return u.translate(E,E,[S*x,g.y*x,0]),u.scale(E,E,[x/u.EXTENT,x/u.EXTENT,1]),u.multiply(E,s?this.alignedProjMatrix:this.projMatrix,E),p[c]=new Float32Array(E),p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let t,s,c,p,g=-90,x=90,S=-180,E=180;const k=this.size,A=this._unmodified;if(this.latRange){const G=this.latRange;g=u.mercatorYfromLat(G[1])*this.worldSize,x=u.mercatorYfromLat(G[0])*this.worldSize,t=x-g<k.y?k.y/(x-g):0}if(this.lngRange){const G=this.lngRange;S=u.wrap(u.mercatorXfromLng(G[0])*this.worldSize,0,this.worldSize),E=u.wrap(u.mercatorXfromLng(G[1])*this.worldSize,0,this.worldSize),E<S&&(E+=this.worldSize),s=E-S<k.x?k.x/(E-S):0}const D=this.point,R=Math.max(s||0,t||0);if(R)return this.center=this.unproject(new u.pointGeometry(s?(E+S)/2:D.x,t?(x+g)/2:D.y)),this.zoom+=this.scaleZoom(R),this._unmodified=A,void(this._constraining=!1);if(this.latRange){const G=D.y,$=k.y/2;G-$<g&&(p=g+$),G+$>x&&(p=x-$)}if(this.lngRange){const G=(S+E)/2,$=u.wrap(D.x,G-this.worldSize/2,G+this.worldSize/2),j=k.x/2;$-j<S&&(c=S+j),$+j>E&&(c=E-j)}c===void 0&&p===void 0||(this.center=this.unproject(new u.pointGeometry(c!==void 0?c:D.x,p!==void 0?p:D.y)).wrap()),this._unmodified=A,this._constraining=!1}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,s=this.point.x,c=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let p=u.identity(new Float64Array(16));u.scale(p,p,[this.width/2,-this.height/2,1]),u.translate(p,p,[1,-1,0]),this.labelPlaneMatrix=p,p=u.identity(new Float64Array(16)),u.scale(p,p,[1,-1,1]),u.translate(p,p,[-1,-1,0]),u.scale(p,p,[2/this.width,2/this.height,1]),this.glCoordMatrix=p,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const g=Math.PI/2+this._pitch,x=this._fov*(.5+t.y/this.height),S=Math.sin(x)*this.cameraToSeaLevelDistance/Math.sin(u.clamp(Math.PI-g-x,.01,Math.PI-.01)),E=this.getHorizon(),k=2*Math.atan(E/this.cameraToCenterDistance)*(.5+t.y/(2*E)),A=Math.sin(k)*this.cameraToSeaLevelDistance/Math.sin(u.clamp(Math.PI-g-k,.01,Math.PI-.01)),D=Math.cos(Math.PI/2-this._pitch)*S+this.cameraToSeaLevelDistance,R=Math.cos(Math.PI/2-this._pitch)*A+this.cameraToSeaLevelDistance,G=1.01*Math.min(D,R),$=this.height/50;p=new Float64Array(16),u.perspective(p,this._fov,this.width/this.height,$,G),p[8]=2*-t.x/this.width,p[9]=2*t.y/this.height,u.scale(p,p,[1,-1,1]),u.translate(p,p,[0,0,-this.cameraToCenterDistance]),u.rotateX(p,p,this._pitch),u.rotateZ(p,p,this.angle),u.translate(p,p,[-s,-c,0]),this.mercatorMatrix=u.scale([],p,[this.worldSize,this.worldSize,this.worldSize]),u.scale(p,p,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,p),u.translate(p,p,[0,0,-this.elevation]),this.projMatrix=p,this.invProjMatrix=u.invert([],p),this.pixelMatrix3D=u.multiply(new Float64Array(16),this.labelPlaneMatrix,p);const j=this.width%2/2,ee=this.height%2/2,ie=Math.cos(this.angle),ce=Math.sin(this.angle),W=s-Math.round(s)+ie*j+ce*ee,pe=c-Math.round(c)+ie*ee+ce*j,he=new Float64Array(p);if(u.translate(he,he,[W>.5?W-1:W,pe>.5?pe-1:pe,0]),this.alignedProjMatrix=he,p=u.invert(new Float64Array(16),this.pixelMatrix),!p)throw new Error("failed to invert matrix");this.pixelMatrixInverse=p,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const t=this.pointCoordinate(new u.pointGeometry(0,0)),s=[t.x*this.worldSize,t.y*this.worldSize,0,1];return u.transformMat4(s,s,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,t))}getCameraQueryGeometry(t){const s=this.getCameraPoint();if(t.length===1)return[t[0],s];{let c=s.x,p=s.y,g=s.x,x=s.y;for(const S of t)c=Math.min(c,S.x),p=Math.min(p,S.y),g=Math.max(g,S.x),x=Math.max(x,S.y);return[new u.pointGeometry(c,p),new u.pointGeometry(g,p),new u.pointGeometry(g,x),new u.pointGeometry(c,x),new u.pointGeometry(c,p)]}}}class Vc{constructor(t){this._hashName=t&&encodeURIComponent(t),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(s,c){let p=!1,g=null;const x=()=>{g=null,p&&(s(),g=setTimeout(x,300),p=!1)};return()=>(p=!0,g||x(),g)}(this._updateHashUnthrottled.bind(this))}addTo(t){return this._map=t,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(t){const s=this._map.getCenter(),c=Math.round(100*this._map.getZoom())/100,p=Math.ceil((c*Math.LN2+Math.log(512/360/.5))/Math.LN10),g=Math.pow(10,p),x=Math.round(s.lng*g)/g,S=Math.round(s.lat*g)/g,E=this._map.getBearing(),k=this._map.getPitch();let A="";if(A+=t?`/${x}/${S}/${c}`:`${c}/${S}/${x}`,(E||k)&&(A+="/"+Math.round(10*E)/10),k&&(A+=`/${Math.round(k)}`),this._hashName){const D=this._hashName;let R=!1;const G=window.location.hash.slice(1).split("&").map($=>{const j=$.split("=")[0];return j===D?(R=!0,`${j}=${A}`):$}).filter($=>$);return R||G.push(`${D}=${A}`),`#${G.join("&")}`}return`#${A}`}_getCurrentHash(){const t=window.location.hash.replace("#","");if(this._hashName){let s;return t.split("&").map(c=>c.split("=")).forEach(c=>{c[0]===this._hashName&&(s=c)}),(s&&s[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._getCurrentHash();if(t.length>=3&&!t.some(s=>isNaN(s))){const s=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:s,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){const t=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,t)}catch{}}}const Zs={linearity:.3,easing:u.bezier(0,0,.3,1)},$c=u.extend({deceleration:2500,maxSpeed:1400},Zs),jc=u.extend({deceleration:20,maxSpeed:1400},Zs),Gc=u.extend({deceleration:1e3,maxSpeed:360},Zs),Qo=u.extend({deceleration:1e3,maxSpeed:90},Zs);class Zc{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,s=u.exported.now();for(;t.length>0&&s-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const s={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:g}of this._inertiaBuffer)s.zoom+=g.zoomDelta||0,s.bearing+=g.bearingDelta||0,s.pitch+=g.pitchDelta||0,g.panDelta&&s.pan._add(g.panDelta),g.around&&(s.around=g.around),g.pinchAround&&(s.pinchAround=g.pinchAround);const c=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,p={};if(s.pan.mag()){const g=Ws(s.pan.mag(),c,u.extend({},$c,t||{}));p.offset=s.pan.mult(g.amount/s.pan.mag()),p.center=this._map.transform.center,qs(p,g)}if(s.zoom){const g=Ws(s.zoom,c,jc);p.zoom=this._map.transform.zoom+g.amount,qs(p,g)}if(s.bearing){const g=Ws(s.bearing,c,Gc);p.bearing=this._map.transform.bearing+u.clamp(g.amount,-179,179),qs(p,g)}if(s.pitch){const g=Ws(s.pitch,c,Qo);p.pitch=this._map.transform.pitch+g.amount,qs(p,g)}if(p.zoom||p.bearing){const g=s.pinchAround===void 0?s.around:s.pinchAround;p.around=g?this._map.unproject(g):this._map.getCenter()}return this.clear(),u.extend(p,{noMoveStart:!0})}}function qs(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Ws(h,t,s){const{maxSpeed:c,linearity:p,deceleration:g}=s,x=u.clamp(h*p/(t/1e3),-c,c),S=Math.abs(x)/(g*p);return{easing:s.easing,duration:1e3*S,amount:x*(S/2)}}class Ir extends u.Event{constructor(t,s,c,p={}){const g=q.mousePos(s.getCanvasContainer(),c),x=s.unproject(g);super(t,u.extend({point:g,lngLat:x,originalEvent:c},p)),this._defaultPrevented=!1,this.target=s}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class Xs extends u.Event{constructor(t,s,c){const p=t==="touchend"?c.changedTouches:c.touches,g=q.touchPos(s.getCanvasContainer(),p),x=g.map(E=>s.unproject(E)),S=g.reduce((E,k,A,D)=>E.add(k.div(D.length)),new u.pointGeometry(0,0));super(t,{points:g,point:S,lngLats:x,lngLat:s.unproject(S),originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class zr extends u.Event{constructor(t,s,c){super(t,{originalEvent:c}),this._defaultPrevented=!1}preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}}class op{constructor(t,s){this._map=t,this._clickTolerance=s.clickTolerance}reset(){delete this._mousedownPos}wheel(t){return this._firePreventable(new zr(t.type,this._map,t))}mousedown(t,s){return this._mousedownPos=s,this._firePreventable(new Ir(t.type,this._map,t))}mouseup(t){this._map.fire(new Ir(t.type,this._map,t))}click(t,s){this._mousedownPos&&this._mousedownPos.dist(s)>=this._clickTolerance||this._map.fire(new Ir(t.type,this._map,t))}dblclick(t){return this._firePreventable(new Ir(t.type,this._map,t))}mouseover(t){this._map.fire(new Ir(t.type,this._map,t))}mouseout(t){this._map.fire(new Ir(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Xs(t.type,this._map,t))}touchmove(t){this._map.fire(new Xs(t.type,this._map,t))}touchend(t){this._map.fire(new Xs(t.type,this._map,t))}touchcancel(t){this._map.fire(new Xs(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Hi{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(t){this._map.fire(new Ir(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ir("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._ignoreContextMenu||this._map.fire(new Ir(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class qc{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=s.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,s){this.isEnabled()&&t.shiftKey&&t.button===0&&(q.disableDrag(),this._startPos=this._lastPos=s,this._active=!0)}mousemoveWindow(t,s){if(!this._active)return;const c=s;if(this._lastPos.equals(c)||!this._box&&c.dist(this._startPos)<this._clickTolerance)return;const p=this._startPos;this._lastPos=c,this._box||(this._box=q.create("div","maplibregl-boxzoom mapboxgl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair","mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const g=Math.min(p.x,c.x),x=Math.max(p.x,c.x),S=Math.min(p.y,c.y),E=Math.max(p.y,c.y);q.setTransform(this._box,`translate(${g}px,${S}px)`),this._box.style.width=x-g+"px",this._box.style.height=E-S+"px"}mouseupWindow(t,s){if(!this._active||t.button!==0)return;const c=this._startPos,p=s;if(this.reset(),q.suppressClick(),c.x!==p.x||c.y!==p.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:t})),{cameraAnimation:g=>g.fitScreenCoordinates(c,p,this._map.getBearing(),{linear:!0})};this._fireEvent("boxzoomcancel",t)}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair","mapboxgl-crosshair"),this._box&&(q.remove(this._box),this._box=null),q.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(t,s){return this._map.fire(new u.Event(t,{originalEvent:s}))}}function Ai(h,t){if(h.length!==t.length)throw new Error(`The number of touches and points are not equal - touches ${h.length}, points ${t.length}`);const s={};for(let c=0;c<h.length;c++)s[h[c].identifier]=t[c];return s}class Hs{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(t,s,c){(this.centroid||c.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=t.timeStamp),c.length===this.numTouches&&(this.centroid=function(p){const g=new u.pointGeometry(0,0);for(const x of p)g._add(x);return g.div(p.length)}(s),this.touches=Ai(c,s)))}touchmove(t,s,c){if(this.aborted||!this.centroid)return;const p=Ai(c,s);for(const g in this.touches){const x=this.touches[g],S=p[g];(!S||S.dist(x)>30)&&(this.aborted=!0)}}touchend(t,s,c){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),c.length===0){const p=!this.aborted&&this.centroid;if(this.reset(),p)return p}}}class Kl{constructor(t){this.singleTap=new Hs(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(t,s,c){this.singleTap.touchstart(t,s,c)}touchmove(t,s,c){this.singleTap.touchmove(t,s,c)}touchend(t,s,c){const p=this.singleTap.touchend(t,s,c);if(p){const g=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(p)<30;if(g&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=p,this.count===this.numTaps)return this.reset(),p}}}class sp{constructor(){this._zoomIn=new Kl({numTouches:1,numTaps:2}),this._zoomOut=new Kl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,s,c){this._zoomIn.touchstart(t,s,c),this._zoomOut.touchstart(t,s,c)}touchmove(t,s,c){this._zoomIn.touchmove(t,s,c),this._zoomOut.touchmove(t,s,c)}touchend(t,s,c){const p=this._zoomIn.touchend(t,s,c),g=this._zoomOut.touchend(t,s,c);return p?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(p)},{originalEvent:t})}):g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(g)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ap={0:1,2:2};class Fa{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}reset(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton}_correctButton(t,s){return!1}_move(t,s){return{}}mousedown(t,s){if(this._lastPoint)return;const c=q.mouseButton(t);this._correctButton(t,c)&&(this._lastPoint=s,this._eventButton=c)}mousemoveWindow(t,s){const c=this._lastPoint;if(c){if(t.preventDefault(),function(p,g){const x=ap[g];return p.buttons===void 0||(p.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(s.dist(c)<this._clickTolerance))return this._moved=!0,this._lastPoint=s,this._move(c,s)}}mouseupWindow(t){this._lastPoint&&q.mouseButton(t)===this._eventButton&&(this._moved&&q.suppressClick(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ks extends Fa{mousedown(t,s){super.mousedown(t,s),this._lastPoint&&(this._active=!0)}_correctButton(t,s){return s===0&&!t.ctrlKey}_move(t,s){return{around:s,panDelta:s.sub(t)}}}class Mi extends Fa{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=.8*(s.x-t.x);if(c)return this._active=!0,{bearingDelta:c}}contextmenu(t){t.preventDefault()}}class Ke extends Fa{_correctButton(t,s){return s===0&&t.ctrlKey||s===2}_move(t,s){const c=-.5*(s.y-t.y);if(c)return this._active=!0,{pitchDelta:c}}contextmenu(t){t.preventDefault()}}class Wc{constructor(t,s){this._minTouches=t.cooperativeGestures?2:1,this._clickTolerance=t.clickTolerance||1,this._map=s,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(t,s,c){return this._calculateTransform(t,s,c)}touchmove(t,s,c){if(this._map._cooperativeGestures&&(this._minTouches===2&&c.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(t,!1,c.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(c.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,s,c)}touchend(t,s,c){this._calculateTransform(t,s,c),this._active&&c.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,s,c){c.length>0&&(this._active=!0);const p=Ai(c,s),g=new u.pointGeometry(0,0),x=new u.pointGeometry(0,0);let S=0;for(const k in p){const A=p[k],D=this._touches[k];D&&(g._add(A),x._add(A.sub(D)),S++,p[k]=A)}if(this._touches=p,S<this._minTouches||!x.mag())return;const E=x.div(S);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:g.div(S),panDelta:E}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class yo{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(t){}_move(t,s,c){return{}}touchstart(t,s,c){this._firstTwoTouches||c.length<2||(this._firstTwoTouches=[c[0].identifier,c[1].identifier],this._start([s[0],s[1]]))}touchmove(t,s,c){if(!this._firstTwoTouches)return;t.preventDefault();const[p,g]=this._firstTwoTouches,x=Ki(c,s,p),S=Ki(c,s,g);if(!x||!S)return;const E=this._aroundCenter?null:x.add(S).div(2);return this._move([x,S],E,t)}touchend(t,s,c){if(!this._firstTwoTouches)return;const[p,g]=this._firstTwoTouches,x=Ki(c,s,p),S=Ki(c,s,g);x&&S||(this._active&&q.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ki(h,t,s){for(let c=0;c<h.length;c++)if(h[c].identifier===s)return t[c]}function Yl(h,t){return Math.log(h/t)/Math.LN2}class Ue extends yo{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,s){const c=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Yl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Yl(this._distance,c),pinchAround:s}}}function Oa(h,t){return 180*h.angleWith(t)/Math.PI}class lp extends yo{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,s){const c=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Oa(this._vector,c),pinchAround:s}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const s=25/(Math.PI*this._minDiameter)*360,c=Oa(t,this._startVector);return Math.abs(c)<s}}function Jl(h){return Math.abs(h.y)>Math.abs(h.x)}class Ql extends yo{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(t,s,c){super.touchstart(t,s,c),this._currentTouchCount=c.length}_start(t){this._lastPoints=t,Jl(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,s,c){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const p=t[0].sub(this._lastPoints[0]),g=t[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(p,g,c.timeStamp),this._valid?(this._lastPoints=t,this._active=!0,{pitchDelta:(p.y+g.y)/2*-.5}):void 0}gestureBeginsVertically(t,s,c){if(this._valid!==void 0)return this._valid;const p=t.mag()>=2,g=s.mag()>=2;if(!p&&!g)return;if(!p||!g)return this._firstMove===void 0&&(this._firstMove=c),c-this._firstMove<100&&void 0;const x=t.y>0==s.y>0;return Jl(t)&&Jl(s)&&x}}const Xc={panStep:100,bearingStep:15,pitchStep:10};class Hc{constructor(){const t=Xc;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let s=0,c=0,p=0,g=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:s=1;break;case 189:case 109:case 173:s=-1;break;case 37:t.shiftKey?c=-1:(t.preventDefault(),g=-1);break;case 39:t.shiftKey?c=1:(t.preventDefault(),g=1);break;case 38:t.shiftKey?p=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?p=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(c=0,p=0),{cameraAnimation:S=>{const E=S.getZoom();S.easeTo({duration:300,easeId:"keyboardHandler",easing:up,zoom:s?Math.round(E)+s*(t.shiftKey?2:1):E,bearing:S.getBearing()+c*this._bearingStep,pitch:S.getPitch()+p*this._pitchStep,offset:[-g*this._panStep,-x*this._panStep],center:S.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function up(h){return h*(2-h)}const Kc=4.000244140625;class eu{constructor(t,s){this._map=t,this._el=t.getCanvasContainer(),this._handler=s,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&t.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!this._map._metaPress)return;t.preventDefault()}let s=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const c=u.exported.now(),p=c-(this._lastWheelEventTime||0);this._lastWheelEventTime=c,s!==0&&s%Kc==0?this._type="wheel":s!==0&&Math.abs(s)<4?this._type="trackpad":p>400?(this._type=null,this._lastValue=s,this._timeout=setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(p*s)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,s+=this._lastValue)),t.shiftKey&&s&&(s/=4),this._type&&(this._lastWheelEvent=t,this._delta-=s,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const s=q.mousePos(this._el,t);this._around=u.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(s)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;if(this._delta!==0){const S=this._type==="wheel"&&Math.abs(this._delta)>Kc?this._wheelZoomRate:this._defaultZoomRate;let E=2/(1+Math.exp(-Math.abs(this._delta*S)));this._delta<0&&E!==0&&(E=1/E);const k=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):t.scale;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(k*E))),this._type==="wheel"&&(this._startZoom=t.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const s=typeof this._targetZoom=="number"?this._targetZoom:t.zoom,c=this._startZoom,p=this._easing;let g,x=!1;if(this._type==="wheel"&&c&&p){const S=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),E=p(S);g=u.number(c,s,E),S<1?this._frameId||(this._frameId=!0):x=!0}else g=s,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:g-t.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let s=u.ease;if(this._prevEase){const c=this._prevEase,p=(u.exported.now()-c.start)/c.duration,g=c.easing(p+.01)-c.easing(p),x=.27/Math.sqrt(g*g+1e-4)*.01,S=Math.sqrt(.0729-x*x);s=u.bezier(x,S,.25,1)}return this._prevEase={start:u.exported.now(),duration:t,easing:s},s}reset(){this._active=!1}}class tu{constructor(t,s){this._clickZoom=t,this._tapZoom=s}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class nu{constructor(){this.reset()}reset(){this._active=!1}dblclick(t,s){return t.preventDefault(),{cameraAnimation:c=>{c.easeTo({duration:300,zoom:c.getZoom()+(t.shiftKey?-1:1),around:c.unproject(s)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ru{constructor(){this._tap=new Kl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(t,s,c){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?c.length>0&&(this._swipePoint=s[0],this._swipeTouch=c[0].identifier):this._tap.touchstart(t,s,c))}touchmove(t,s,c){if(this._tapTime){if(this._swipePoint){if(c[0].identifier!==this._swipeTouch)return;const p=s[0],g=p.y-this._swipePoint.y;return this._swipePoint=p,t.preventDefault(),this._active=!0,{zoomDelta:g/128}}}else this._tap.touchmove(t,s,c)}touchend(t,s,c){this._tapTime?this._swipePoint&&c.length===0&&this.reset():this._tap.touchend(t,s,c)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class gr{constructor(t,s,c){this._el=t,this._mousePan=s,this._touchPan=c}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan","mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Yi{constructor(t,s,c){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=s,this._mousePitch=c}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Yc{constructor(t,s,c,p){this._el=t,this._touchZoom=s,this._touchRotate=c,this._tapDragZoom=p,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate","mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const es=h=>h.zoom||h.drag||h.pitch||h.rotate;class iu extends u.Event{}function Ys(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Jc{constructor(t,s){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zc(t),this._bearingSnap=s.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(s),u.bindAll(["handleEvent","handleWindowEvent"],this);const c=this._el;this._listeners=[[c,"touchstart",{passive:!0}],[c,"touchmove",{passive:!1}],[c,"touchend",void 0],[c,"touchcancel",void 0],[c,"mousedown",void 0],[c,"mousemove",void 0],[c,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[c,"mouseover",void 0],[c,"mouseout",void 0],[c,"dblclick",void 0],[c,"click",void 0],[c,"keydown",{capture:!1}],[c,"keyup",void 0],[c,"wheel",{passive:!1}],[c,"contextmenu",void 0],[window,"blur",void 0]];for(const[p,g,x]of this._listeners)q.addEventListener(p,g,p===document?this.handleWindowEvent:this.handleEvent,x)}destroy(){for(const[t,s,c]of this._listeners)q.removeEventListener(t,s,t===document?this.handleWindowEvent:this.handleEvent,c)}_addDefaultHandlers(t){const s=this._map,c=s.getCanvasContainer();this._add("mapEvent",new op(s,t));const p=s.boxZoom=new qc(s,t);this._add("boxZoom",p);const g=new sp,x=new nu;s.doubleClickZoom=new tu(x,g),this._add("tapZoom",g),this._add("clickZoom",x);const S=new ru;this._add("tapDragZoom",S);const E=s.touchPitch=new Ql(s);this._add("touchPitch",E);const k=new Mi(t),A=new Ke(t);s.dragRotate=new Yi(t,k,A),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",A,["mouseRotate"]);const D=new Ks(t),R=new Wc(t,s);s.dragPan=new gr(c,D,R),this._add("mousePan",D),this._add("touchPan",R,["touchZoom","touchRotate"]);const G=new lp,$=new Ue;s.touchZoomRotate=new Yc(c,$,G,S),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]);const j=s.scrollZoom=new eu(s,this);this._add("scrollZoom",j,["mousePan"]);const ee=s.keyboard=new Hc;this._add("keyboard",ee),this._add("blockableMapEvent",new Hi(s));for(const ie of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[ie]&&s[ie].enable(t[ie])}_add(t,s,c){this._handlers.push({handlerName:t,handler:s,allowed:c}),this._handlersById[t]=s}stop(t){if(!this._updatingCamera){for(const{handler:s}of this._handlers)s.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return Boolean(es(this._eventsInProgress))||this.isZooming()}_blockedByActive(t,s,c){for(const p in t)if(p!==c&&(!s||s.indexOf(p)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const s=[];for(const c of t)this._el.contains(c.target)&&s.push(c);return s}handleEvent(t,s){if(t.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const c=t.type==="renderFrame"?void 0:t,p={needsRenderFrame:!1},g={},x={},S=t.touches,E=S?this._getMapTouches(S):void 0,k=E?q.touchPos(this._el,E):q.mousePos(this._el,t);for(const{handlerName:R,handler:G,allowed:$}of this._handlers){if(!G.isEnabled())continue;let j;this._blockedByActive(x,$,R)?G.reset():G[s||t.type]&&(j=G[s||t.type](t,k,E),this.mergeHandlerResult(p,g,j,R,c),j&&j.needsRenderFrame&&this._triggerRenderFrame()),(j||G.isActive())&&(x[R]=G)}const A={};for(const R in this._previousActiveHandlers)x[R]||(A[R]=c);this._previousActiveHandlers=x,(Object.keys(A).length||Ys(p))&&(this._changes.push([p,g,A]),this._triggerRenderFrame()),(Object.keys(x).length||Ys(p))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:D}=p;D&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],D(this._map))}mergeHandlerResult(t,s,c,p,g){if(!c)return;u.extend(t,c);const x={handlerName:p,originalEvent:c.originalEvent||g};c.zoomDelta!==void 0&&(s.zoom=x),c.panDelta!==void 0&&(s.drag=x),c.pitchDelta!==void 0&&(s.pitch=x),c.bearingDelta!==void 0&&(s.rotate=x)}_applyChanges(){const t={},s={},c={};for(const[p,g,x]of this._changes)p.panDelta&&(t.panDelta=(t.panDelta||new u.pointGeometry(0,0))._add(p.panDelta)),p.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+p.zoomDelta),p.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+p.bearingDelta),p.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+p.pitchDelta),p.around!==void 0&&(t.around=p.around),p.pinchAround!==void 0&&(t.pinchAround=p.pinchAround),p.noInertia&&(t.noInertia=p.noInertia),u.extend(s,g),u.extend(c,x);this._updateMapTransform(t,s,c),this._changes=[]}_updateMapTransform(t,s,c){const p=this._map,g=p.transform,x=p.style&&p.style.terrain;if(!(Ys(t)||x&&this._drag))return this._fireEvents(s,c,!0);let{panDelta:S,zoomDelta:E,bearingDelta:k,pitchDelta:A,around:D,pinchAround:R}=t;R!==void 0&&(D=R),p._stop(!0),D=D||p.transform.centerPoint;const G=g.pointLocation(S?D.sub(S):D);k&&(g.bearing+=k),A&&(g.pitch+=A),E&&(g.zoom+=E),x?s.drag&&!this._drag?(this._drag={center:g.centerPoint,lngLat:g.pointLocation(D),point:D,handlerName:s.drag.handlerName},p.fire(new u.Event("freezeElevation",{freeze:!0}))):this._drag&&c[this._drag.handlerName]?(p.fire(new u.Event("freezeElevation",{freeze:!1})),this._drag=null):s.drag&&this._drag&&(g.center=g.pointLocation(g.centerPoint.sub(S))):g.setLocationAtPoint(G,D),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(s,c,!0)}_fireEvents(t,s,c){const p=es(this._eventsInProgress),g=es(t),x={};for(const A in t){const{originalEvent:D}=t[A];this._eventsInProgress[A]||(x[`${A}start`]=D),this._eventsInProgress[A]=t[A]}!p&&g&&this._fireEvent("movestart",g.originalEvent);for(const A in x)this._fireEvent(A,x[A]);g&&this._fireEvent("move",g.originalEvent);for(const A in t){const{originalEvent:D}=t[A];this._fireEvent(A,D)}const S={};let E;for(const A in this._eventsInProgress){const{handlerName:D,originalEvent:R}=this._eventsInProgress[A];this._handlersById[D].isActive()||(delete this._eventsInProgress[A],E=s[D]||R,S[`${A}end`]=E)}for(const A in S)this._fireEvent(A,S[A]);const k=es(this._eventsInProgress);if(c&&(p||g)&&!k){this._updatingCamera=!0;const A=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),D=R=>R!==0&&-this._bearingSnap<R&&R<this._bearingSnap;A?(D(A.bearing||this._map.getBearing())&&(A.bearing=0),this._map.easeTo(A,{originalEvent:E})):(this._map.fire(new u.Event("moveend",{originalEvent:E})),D(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,s){this._map.fire(new u.Event(t,s?{originalEvent:s}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{delete this._frameId,this.handleEvent(new iu("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const $r={extend:(h,...t)=>u.extend(h,...t),run(h){h()},logToElement(h,t=!1,s="log"){const c=window.document.getElementById(s);c&&(t&&(c.innerHTML=""),c.innerHTML+=`<br>${h}`)}};class rn extends u.Evented{constructor(t,s){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=s.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,s){return this.jumpTo({center:t},s)}panBy(t,s,c){return t=u.pointGeometry.convert(t).mult(-1),this.panTo(this.transform.center,u.extend({offset:t},s),c)}panTo(t,s,c){return this.easeTo(u.extend({center:t},s),c)}getZoom(){return this.transform.zoom}setZoom(t,s){return this.jumpTo({zoom:t},s),this}zoomTo(t,s,c){return this.easeTo(u.extend({zoom:t},s),c)}zoomIn(t,s){return this.zoomTo(this.getZoom()+1,t,s),this}zoomOut(t,s){return this.zoomTo(this.getZoom()-1,t,s),this}getBearing(){return this.transform.bearing}setBearing(t,s){return this.jumpTo({bearing:t},s),this}getPadding(){return this.transform.padding}setPadding(t,s){return this.jumpTo({padding:t},s),this}rotateTo(t,s,c){return this.easeTo(u.extend({bearing:t},s),c)}resetNorth(t,s){return this.rotateTo(0,u.extend({duration:1e3},t),s),this}resetNorthPitch(t,s){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},t),s),this}snapToNorth(t,s){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,s):this}getPitch(){return this.transform.pitch}setPitch(t,s){return this.jumpTo({pitch:t},s),this}cameraForBounds(t,s){t=u.LngLatBounds.convert(t);const c=s&&s.bearing||0;return this._cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),c,s)}_cameraForBoxAndBearing(t,s,c,p){const g={top:0,bottom:0,right:0,left:0};if(typeof(p=u.extend({padding:g,offset:[0,0],maxZoom:this.transform.maxZoom},p)).padding=="number"){const he=p.padding;p.padding={top:he,bottom:he,right:he,left:he}}p.padding=u.extend(g,p.padding);const x=this.transform,S=x.padding,E=x.project(u.LngLat.convert(t)),k=x.project(u.LngLat.convert(s)),A=E.rotate(-c*Math.PI/180),D=k.rotate(-c*Math.PI/180),R=new u.pointGeometry(Math.max(A.x,D.x),Math.max(A.y,D.y)),G=new u.pointGeometry(Math.min(A.x,D.x),Math.min(A.y,D.y)),$=R.sub(G),j=(x.width-(S.left+S.right+p.padding.left+p.padding.right))/$.x,ee=(x.height-(S.top+S.bottom+p.padding.top+p.padding.bottom))/$.y;if(ee<0||j<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const ie=Math.min(x.scaleZoom(x.scale*Math.min(j,ee)),p.maxZoom),ce=u.pointGeometry.convert(p.offset),W=new u.pointGeometry((p.padding.left-p.padding.right)/2,(p.padding.top-p.padding.bottom)/2).rotate(c*Math.PI/180),pe=ce.add(W).mult(x.scale/x.zoomScale(ie));return{center:x.unproject(E.add(k).div(2).sub(pe)),zoom:ie,bearing:c}}fitBounds(t,s,c){return this._fitInternal(this.cameraForBounds(t,s),s,c)}fitScreenCoordinates(t,s,c,p,g){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.pointGeometry.convert(t)),this.transform.pointLocation(u.pointGeometry.convert(s)),c,p),p,g)}_fitInternal(t,s,c){return t?(delete(s=u.extend(t,s)).padding,s.linear?this.easeTo(s,c):this.flyTo(s,c)):this}jumpTo(t,s){this.stop();const c=this.transform;let p=!1,g=!1,x=!1;return"zoom"in t&&c.zoom!==+t.zoom&&(p=!0,c.zoom=+t.zoom),t.center!==void 0&&(c.center=u.LngLat.convert(t.center)),"bearing"in t&&c.bearing!==+t.bearing&&(g=!0,c.bearing=+t.bearing),"pitch"in t&&c.pitch!==+t.pitch&&(x=!0,c.pitch=+t.pitch),t.padding==null||c.isPaddingEqual(t.padding)||(c.padding=t.padding),this.fire(new u.Event("movestart",s)).fire(new u.Event("move",s)),p&&this.fire(new u.Event("zoomstart",s)).fire(new u.Event("zoom",s)).fire(new u.Event("zoomend",s)),g&&this.fire(new u.Event("rotatestart",s)).fire(new u.Event("rotate",s)).fire(new u.Event("rotateend",s)),x&&this.fire(new u.Event("pitchstart",s)).fire(new u.Event("pitch",s)).fire(new u.Event("pitchend",s)),this.fire(new u.Event("moveend",s))}calculateCameraOptionsFromTo(t,s,c,p=0){const g=u.MercatorCoordinate.fromLngLat(t,s),x=u.MercatorCoordinate.fromLngLat(c,p),S=x.x-g.x,E=x.y-g.y,k=x.z-g.z,A=Math.hypot(S,E,k);if(A===0)throw new Error("Can't calculate camera options with same From and To");const D=Math.hypot(S,E),R=this.transform.scaleZoom(this.transform.cameraToCenterDistance/A/this.transform.tileSize),G=180*Math.atan2(S,-E)/Math.PI;let $=180*Math.acos(D/A)/Math.PI;return $=k<0?90-$:90+$,{center:x.toLngLat(),zoom:R,pitch:$,bearing:G}}easeTo(t,s){this._stop(!1,t.easeId),((t=u.extend({offset:[0,0],duration:500,easing:u.ease},t)).animate===!1||!t.essential&&u.exported.prefersReducedMotion)&&(t.duration=0);const c=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),S=this.getPadding(),E="zoom"in t?+t.zoom:p,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,A="pitch"in t?+t.pitch:x,D="padding"in t?t.padding:c.padding,R=u.pointGeometry.convert(t.offset);let G=c.centerPoint.add(R);const $=c.pointLocation(G),j=u.LngLat.convert(t.center||$);this._normalizeCenter(j);const ee=c.project($),ie=c.project(j).sub(ee),ce=c.zoomScale(E-p);let W,pe;t.around&&(W=u.LngLat.convert(t.around),pe=c.locationPoint(W));const he={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||E!==p,this._rotating=this._rotating||g!==k,this._pitching=this._pitching||A!==x,this._padding=!c.isPaddingEqual(D),this._easeId=t.easeId,this._prepareEase(s,t.noMoveStart,he),this._ease(_e=>{if(this._zooming&&(c.zoom=u.number(p,E,_e)),this._rotating&&(c.bearing=u.number(g,k,_e)),this._pitching&&(c.pitch=u.number(x,A,_e)),this._padding&&(c.interpolatePadding(S,D,_e),G=c.centerPoint.add(R)),W)c.setLocationAtPoint(W,pe);else{const ve=c.zoomScale(c.zoom-p),Te=E>p?Math.min(2,ce):Math.max(.5,ce),ye=Math.pow(Te,1-_e),Ze=c.unproject(ee.add(ie.mult(_e*ye)).mult(ve));c.setLocationAtPoint(c.renderWorldCopies?Ze.wrap():Ze,G)}this._fireMoveEvents(s)},_e=>{this._afterEase(s,_e)},t),this}_prepareEase(t,s,c={}){this._moving=!0,this.fire(new u.Event("freezeElevation",{freeze:!0})),s||c.moving||this.fire(new u.Event("movestart",t)),this._zooming&&!c.zooming&&this.fire(new u.Event("zoomstart",t)),this._rotating&&!c.rotating&&this.fire(new u.Event("rotatestart",t)),this._pitching&&!c.pitching&&this.fire(new u.Event("pitchstart",t))}_fireMoveEvents(t){this.fire(new u.Event("move",t)),this._zooming&&this.fire(new u.Event("zoom",t)),this._rotating&&this.fire(new u.Event("rotate",t)),this._pitching&&this.fire(new u.Event("pitch",t))}_afterEase(t,s){if(this._easeId&&s&&this._easeId===s)return;delete this._easeId,this.fire(new u.Event("freezeElevation",{freeze:!1}));const c=this._zooming,p=this._rotating,g=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,c&&this.fire(new u.Event("zoomend",t)),p&&this.fire(new u.Event("rotateend",t)),g&&this.fire(new u.Event("pitchend",t)),this.fire(new u.Event("moveend",t))}flyTo(t,s){if(!t.essential&&u.exported.prefersReducedMotion){const rt=u.pick(t,["center","zoom","bearing","pitch","around"]);return this.jumpTo(rt,s)}this.stop(),t=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},t);const c=this.transform,p=this.getZoom(),g=this.getBearing(),x=this.getPitch(),S=this.getPadding(),E="zoom"in t?u.clamp(+t.zoom,c.minZoom,c.maxZoom):p,k="bearing"in t?this._normalizeBearing(t.bearing,g):g,A="pitch"in t?+t.pitch:x,D="padding"in t?t.padding:c.padding,R=c.zoomScale(E-p),G=u.pointGeometry.convert(t.offset);let $=c.centerPoint.add(G);const j=c.pointLocation($),ee=u.LngLat.convert(t.center||j);this._normalizeCenter(ee);const ie=c.project(j),ce=c.project(ee).sub(ie);let W=t.curve;const pe=Math.max(c.width,c.height),he=pe/R,_e=ce.mag();if("minZoom"in t){const rt=u.clamp(Math.min(t.minZoom,p,E),c.minZoom,c.maxZoom),Ft=pe/c.zoomScale(rt-p);W=Math.sqrt(Ft/_e*2)}const ve=W*W;function Te(rt){const Ft=(he*he-pe*pe+(rt?-1:1)*ve*ve*_e*_e)/(2*(rt?he:pe)*ve*_e);return Math.log(Math.sqrt(Ft*Ft+1)-Ft)}function ye(rt){return(Math.exp(rt)-Math.exp(-rt))/2}function Ze(rt){return(Math.exp(rt)+Math.exp(-rt))/2}const Re=Te(0);let We=function(rt){return Ze(Re)/Ze(Re+W*rt)},mt=function(rt){return pe*((Ze(Re)*(ye(Ft=Re+W*rt)/Ze(Ft))-ye(Re))/ve)/_e;var Ft},_t=(Te(1)-Re)/W;if(Math.abs(_e)<1e-6||!isFinite(_t)){if(Math.abs(pe-he)<1e-6)return this.easeTo(t,s);const rt=he<pe?-1:1;_t=Math.abs(Math.log(he/pe))/W,mt=function(){return 0},We=function(Ft){return Math.exp(rt*W*Ft)}}return t.duration="duration"in t?+t.duration:1e3*_t/("screenSpeed"in t?+t.screenSpeed/W:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0),this._zooming=!0,this._rotating=g!==k,this._pitching=A!==x,this._padding=!c.isPaddingEqual(D),this._prepareEase(s,!1),this._ease(rt=>{const Ft=rt*_t,Ot=1/We(Ft);c.zoom=rt===1?E:p+c.scaleZoom(Ot),this._rotating&&(c.bearing=u.number(g,k,rt)),this._pitching&&(c.pitch=u.number(x,A,rt)),this._padding&&(c.interpolatePadding(S,D,rt),$=c.centerPoint.add(G));const Tt=rt===1?ee:c.unproject(ie.add(ce.mult(mt(Ft))).mult(Ot));c.setLocationAtPoint(c.renderWorldCopies?Tt.wrap():Tt,$),this._fireMoveEvents(s)},()=>this._afterEase(s),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,s){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const c=this._onEaseEnd;delete this._onEaseEnd,c.call(this,s)}if(!t){const c=this.handlers;c&&c.stop(!1)}return this}_ease(t,s,c){c.animate===!1||c.duration===0?(t(1),s()):(this._easeStart=u.exported.now(),this._easeOptions=c,this._onEaseFrame=t,this._onEaseEnd=s,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,s){t=u.wrap(t,-180,180);const c=Math.abs(t-s);return Math.abs(t-360-s)<c&&(t-=360),Math.abs(t+360-s)<c&&(t+=360),t}_normalizeCenter(t){const s=this.transform;if(!s.renderWorldCopies||s.lngRange)return;const c=t.lng-s.center.lng;t.lng+=c>180?-360:c<-180?360:0}}class Js{constructor(t={}){this.options=t,u.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){return this._map=t,this._compact=this.options&&this.options.compact,this._container=q.create("details","maplibregl-ctrl maplibregl-ctrl-attrib mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=q.create("summary","maplibregl-ctrl-attrib-button mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=q.create("div","maplibregl-ctrl-attrib-inner mapboxgl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){q.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(t,s){const c=this._map._getUIString(`AttributionControl.${s}`);t.title=c,t.setAttribute("aria-label",c)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")):(this._container.classList.add("maplibregl-compact-show","mapboxgl-compact-show"),this._container.removeAttribute("open")))}_updateData(t){!t||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility"&&t.dataType!=="style"&&t.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map(p=>typeof p!="string"?"":p)):typeof this.options.customAttribution=="string"&&t.push(this.options.customAttribution)),this._map.style.stylesheet){const p=this._map.style.stylesheet;this.styleOwner=p.owner,this.styleId=p.id}const s=this._map.style.sourceCaches;for(const p in s){const g=s[p];if(g.used||g.usedForTerrain){const x=g.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t=t.filter(p=>String(p).trim()),t.sort((p,g)=>p.length-g.length),t=t.filter((p,g)=>{for(let x=g+1;x<t.length;x++)if(t[x].indexOf(p)>=0)return!1;return!0});const c=t.join(" | ");c!==this._attribHTML&&(this._attribHTML=c,t.length?(this._innerContainer.innerHTML=c,this._container.classList.remove("maplibregl-attrib-empty","mapboxgl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty","mapboxgl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","mapboxgl-compact","maplibregl-compact-show","mapboxgl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show","mapboxgl-compact","mapboxgl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show","mapboxgl-compact-show")}}class Na{constructor(t={}){this.options=t,u.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(t){this._map=t,this._compact=this.options&&this.options.compact,this._container=q.create("div","maplibregl-ctrl mapboxgl-ctrl");const s=q.create("a","maplibregl-ctrl-logo mapboxgl-ctrl-logo");return s.target="_blank",s.rel="noopener nofollow",s.href="https://maplibre.org/",s.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),s.setAttribute("rel","noopener nofollow"),this._container.appendChild(s),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){q.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const t=this._container.children;if(t.length){const s=t[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&s.classList.add("maplibregl-compact","mapboxgl-compact"):s.classList.remove("maplibregl-compact","mapboxgl-compact")}}}class Qc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const s=++this._id;return this._queue.push({callback:t,id:s,cancelled:!1}),s}remove(t){const s=this._currentlyRunning,c=s?this._queue.concat(s):this._queue;for(const p of c)if(p.id===t)return void(p.cancelled=!0)}run(t=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const s=this._currentlyRunning=this._queue;this._queue=[];for(const c of s)if(!c.cancelled&&(c.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const eh={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"},th={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,fadeDuration:300,crossSourceCollisions:!0},cp={showCompass:!0,showZoom:!0,visualizePitch:!1};class di{constructor(t,s,c=!1){this._clickTolerance=10,this.element=s,this.mouseRotate=new Mi({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,c&&(this.mousePitch=new Ke({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),q.addEventListener(s,"mousedown",this.mousedown),q.addEventListener(s,"touchstart",this.touchstart,{passive:!1}),q.addEventListener(s,"touchmove",this.touchmove),q.addEventListener(s,"touchend",this.touchend),q.addEventListener(s,"touchcancel",this.reset)}down(t,s){this.mouseRotate.mousedown(t,s),this.mousePitch&&this.mousePitch.mousedown(t,s),q.disableDrag()}move(t,s){const c=this.map,p=this.mouseRotate.mousemoveWindow(t,s);if(p&&p.bearingDelta&&c.setBearing(c.getBearing()+p.bearingDelta),this.mousePitch){const g=this.mousePitch.mousemoveWindow(t,s);g&&g.pitchDelta&&c.setPitch(c.getPitch()+g.pitchDelta)}}off(){const t=this.element;q.removeEventListener(t,"mousedown",this.mousedown),q.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),q.removeEventListener(t,"touchmove",this.touchmove),q.removeEventListener(t,"touchend",this.touchend),q.removeEventListener(t,"touchcancel",this.reset),this.offTemp()}offTemp(){q.enableDrag(),q.removeEventListener(window,"mousemove",this.mousemove),q.removeEventListener(window,"mouseup",this.mouseup)}mousedown(t){this.down(u.extend({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),q.mousePos(this.element,t)),q.addEventListener(window,"mousemove",this.mousemove),q.addEventListener(window,"mouseup",this.mouseup)}mousemove(t){this.move(t,q.mousePos(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=q.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=q.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Qs(h,t,s){if(h=new u.LngLat(h.lng,h.lat),t){const c=new u.LngLat(h.lng-360,h.lat),p=new u.LngLat(h.lng+360,h.lat),g=s.locationPoint(h).distSqr(t);s.locationPoint(c).distSqr(t)<g?h=c:s.locationPoint(p).distSqr(t)<g&&(h=p)}for(;Math.abs(h.lng-s.center.lng)>180;){const c=s.locationPoint(h);if(c.x>=0&&c.y>=0&&c.x<=s.width&&c.y<=s.height)break;h.lng>s.center.lng?h.lng-=360:h.lng+=360}return h}const et={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function lt(h,t,s){const c=h.classList;for(const p in et)c.remove(`maplibregl-${s}-anchor-${p}`,`mapboxgl-${s}-anchor-${p}`);c.add(`maplibregl-${s}-anchor-${t}`,`mapboxgl-${s}-anchor-${t}`)}class ts extends u.Evented{constructor(t,s){if(super(),(t instanceof HTMLElement||s)&&(t=u.extend({element:t},s)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=t&&t.anchor||"center",this._color=t&&t.color||"#3FB1CE",this._scale=t&&t.scale||1,this._draggable=t&&t.draggable||!1,this._clickTolerance=t&&t.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=t&&t.rotation||0,this._rotationAlignment=t&&t.rotationAlignment||"auto",this._pitchAlignment=t&&t.pitchAlignment&&t.pitchAlignment!=="auto"?t.pitchAlignment:this._rotationAlignment,t&&t.element)this._element=t.element,this._offset=u.pointGeometry.convert(t&&t.offset||[0,0]);else{this._defaultMarker=!0,this._element=q.create("div"),this._element.setAttribute("aria-label","Map marker");const c=q.createNS("http://www.w3.org/2000/svg","svg"),p=41,g=27;c.setAttributeNS(null,"display","block"),c.setAttributeNS(null,"height",`${p}px`),c.setAttributeNS(null,"width",`${g}px`),c.setAttributeNS(null,"viewBox",`0 0 ${g} ${p}`);const x=q.createNS("http://www.w3.org/2000/svg","g");x.setAttributeNS(null,"stroke","none"),x.setAttributeNS(null,"stroke-width","1"),x.setAttributeNS(null,"fill","none"),x.setAttributeNS(null,"fill-rule","evenodd");const S=q.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"fill-rule","nonzero");const E=q.createNS("http://www.w3.org/2000/svg","g");E.setAttributeNS(null,"transform","translate(3.0, 29.0)"),E.setAttributeNS(null,"fill","#000000");const k=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const ce of k){const W=q.createNS("http://www.w3.org/2000/svg","ellipse");W.setAttributeNS(null,"opacity","0.04"),W.setAttributeNS(null,"cx","10.5"),W.setAttributeNS(null,"cy","5.80029008"),W.setAttributeNS(null,"rx",ce.rx),W.setAttributeNS(null,"ry",ce.ry),E.appendChild(W)}const A=q.createNS("http://www.w3.org/2000/svg","g");A.setAttributeNS(null,"fill",this._color);const D=q.createNS("http://www.w3.org/2000/svg","path");D.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),A.appendChild(D);const R=q.createNS("http://www.w3.org/2000/svg","g");R.setAttributeNS(null,"opacity","0.25"),R.setAttributeNS(null,"fill","#000000");const G=q.createNS("http://www.w3.org/2000/svg","path");G.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),R.appendChild(G);const $=q.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const j=q.createNS("http://www.w3.org/2000/svg","g");j.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ee=q.createNS("http://www.w3.org/2000/svg","circle");ee.setAttributeNS(null,"fill","#000000"),ee.setAttributeNS(null,"opacity","0.25"),ee.setAttributeNS(null,"cx","5.5"),ee.setAttributeNS(null,"cy","5.5"),ee.setAttributeNS(null,"r","5.4999962");const ie=q.createNS("http://www.w3.org/2000/svg","circle");ie.setAttributeNS(null,"fill","#FFFFFF"),ie.setAttributeNS(null,"cx","5.5"),ie.setAttributeNS(null,"cy","5.5"),ie.setAttributeNS(null,"r","5.4999962"),j.appendChild(ee),j.appendChild(ie),S.appendChild(E),S.appendChild(A),S.appendChild(R),S.appendChild($),S.appendChild(j),c.appendChild(S),c.setAttributeNS(null,"height",p*this._scale+"px"),c.setAttributeNS(null,"width",g*this._scale+"px"),this._element.appendChild(c),this._offset=u.pointGeometry.convert(t&&t.offset||[0,-14])}this._element.classList.add("maplibregl-marker","mapboxgl-marker"),this._element.addEventListener("dragstart",c=>{c.preventDefault()}),this._element.addEventListener("mousedown",c=>{c.preventDefault()}),lt(this._element,this._anchor,"marker"),this._popup=null}addTo(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),q.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=u.LngLat.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const p=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[p,-1*(38.1-13.5+p)],"bottom-right":[-p,-1*(38.1-13.5+p)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(t){const s=t.code,c=t.charCode||t.keyCode;s!=="Space"&&s!=="Enter"&&c!==32&&c!==13||this.togglePopup()}_onMapClick(t){const s=t.originalEvent.target,c=this._element;this._popup&&(s===c||c.contains(s))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this}_update(t){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let s="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?s=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(s=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let c="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?c="rotateX(0deg)":this._pitchAlignment==="map"&&(c=`rotateX(${this._map.getPitch()}deg)`),t&&t.type!=="moveend"||(this._pos=this._pos.round()),q.setTransform(this._element,`${et[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${c} ${s}`),this._map.style&&this._map.style.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const p=this._map.unproject(this._pos),g=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=p.distanceTo(this._lngLat)>20*g?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(t){return this._offset=u.pointGeometry.convert(t),this._update(),this}_onMove(t){if(!this._isDragging){const s=this._clickTolerance||this._map._clickTolerance;this._isDragging=t.point.dist(this._pointerdownPos)>=s}this._isDragging&&(this._pos=t.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&t!=="auto"?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const ou={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Ji,qn=0,Qi=!1;const pi={maxWidth:100,unit:"metric"};function nh(h,t,s){const c=s&&s.maxWidth||100,p=h._container.clientHeight/2,g=h.unproject([0,p]),x=h.unproject([c,p]),S=g.distanceTo(x);if(s&&s.unit==="imperial"){const E=3.2808*S;E>5280?eo(t,c,E/5280,h._getUIString("ScaleControl.Miles")):eo(t,c,E,h._getUIString("ScaleControl.Feet"))}else s&&s.unit==="nautical"?eo(t,c,S/1852,h._getUIString("ScaleControl.NauticalMiles")):S>=1e3?eo(t,c,S/1e3,h._getUIString("ScaleControl.Kilometers")):eo(t,c,S,h._getUIString("ScaleControl.Meters"))}function eo(h,t,s,c){const p=function(g){const x=Math.pow(10,`${Math.floor(g)}`.length-1);let S=g/x;return S=S>=10?10:S>=5?5:S>=3?3:S>=2?2:S>=1?1:function(E){const k=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*k)/k}(S),x*S}(s);h.style.width=t*(p/s)+"px",h.innerHTML=`${p}&nbsp;${c}`}const fn={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Cn=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function su(h){if(h){if(typeof h=="number"){const t=Math.round(Math.sqrt(.5*Math.pow(h,2)));return{center:new u.pointGeometry(0,0),top:new u.pointGeometry(0,h),"top-left":new u.pointGeometry(t,t),"top-right":new u.pointGeometry(-t,t),bottom:new u.pointGeometry(0,-h),"bottom-left":new u.pointGeometry(t,-t),"bottom-right":new u.pointGeometry(-t,-t),left:new u.pointGeometry(h,0),right:new u.pointGeometry(-h,0)}}if(h instanceof u.pointGeometry||Array.isArray(h)){const t=u.pointGeometry.convert(h);return{center:t,top:t,"top-left":t,"top-right":t,bottom:t,"bottom-left":t,"bottom-right":t,left:t,right:t}}return{center:u.pointGeometry.convert(h.center||[0,0]),top:u.pointGeometry.convert(h.top||[0,0]),"top-left":u.pointGeometry.convert(h["top-left"]||[0,0]),"top-right":u.pointGeometry.convert(h["top-right"]||[0,0]),bottom:u.pointGeometry.convert(h.bottom||[0,0]),"bottom-left":u.pointGeometry.convert(h["bottom-left"]||[0,0]),"bottom-right":u.pointGeometry.convert(h["bottom-right"]||[0,0]),left:u.pointGeometry.convert(h.left||[0,0]),right:u.pointGeometry.convert(h.right||[0,0])}}return su(new u.pointGeometry(0,0))}const _o={supported:O,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends rn{constructor(h){var t;if(u.PerformanceUtils.mark(u.PerformanceMarkers.create),(h=u.extend({},th,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Gs(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),{bearingSnap:h.bearingSnap}),this._interactive=h.interactive,this._cooperativeGestures=h.cooperativeGestures,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._crossSourceCollisions=h.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=h.collectResourceTiming,this._renderTaskQueue=new Qc,this._controls=[],this._mapId=u.uniqueId(),this._locale=u.extend({},eh,h.locale),this._clickTolerance=h.clickTolerance,this._pixelRatio=(t=h.pixelRatio)!==null&&t!==void 0?t:devicePixelRatio,this._requestManager=new Ae(h.transformRequest),typeof h.container=="string"){if(this._container=document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(h.maxBounds&&this.setMaxBounds(h.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),typeof window<"u"&&(addEventListener("online",this._onWindowOnline,!1),addEventListener("resize",this._onWindowResize,!1),addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new Jc(this,h),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=h.hash&&new Vc(typeof h.hash=="string"&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,u.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localIdeographFontFamily:h.localIdeographFontFamily}),h.attributionControl&&this.addControl(new Js({customAttribution:h.customAttribution})),h.maplibreLogo&&this.addControl(new Na,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",s=>{this._update(s.dataType==="style"),this.fire(new u.Event(`${s.dataType}data`,s))}),this.on("dataloading",s=>{this.fire(new u.Event(`${s.dataType}dataloading`,s))}),this.on("dataabort",s=>{this.fire(new u.Event("sourcedataabort",s))})}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const s=h.onAdd(this);this._controls.push(h);const c=this._controlPositions[t];return t.indexOf("bottom")!==-1?c.insertBefore(s,c.firstChild):c.appendChild(s),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}calculateCameraOptionsFromTo(h,t,s,c){return c==null&&this.style.terrain&&(c=this.transform.getElevation(s,this.style.terrain)),super.calculateCameraOptionsFromTo(h,t,s,c)}resize(h){const t=this._containerDimensions(),s=t[0],c=t[1];this._resizeCanvas(s,c,this.getPixelRatio()),this.transform.resize(s,c),this.painter.resize(s,c,this.getPixelRatio());const p=!this._moving;return p&&(this.stop(),this.fire(new u.Event("movestart",h)).fire(new u.Event("move",h))),this.fire(new u.Event("resize",h)),p&&this.fire(new u.Event("moveend",h)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(h){const[t,s]=this._containerDimensions();this._pixelRatio=h,this._resizeCanvas(t,s,h),this.painter.resize(t,s,h)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(h){return this.transform.setMaxBounds(u.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h&&this.setZoom(h),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h&&this.setZoom(h),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h&&this.setPitch(h),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h&&this.setPitch(h),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this._update()}project(h){return this.transform.locationPoint(u.LngLat.convert(h),this.style&&this.style.terrain)}unproject(h){return this.transform.pointLocation(u.pointGeometry.convert(h),this.style&&this.style.terrain)}isMoving(){return this._moving||this.handlers.isMoving()}isZooming(){return this._zooming||this.handlers.isZooming()}isRotating(){return this._rotating||this.handlers.isRotating()}_createDelegatedListener(h,t,s){if(h==="mouseenter"||h==="mouseover"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:g=>{const x=this.getLayer(t)?this.queryRenderedFeatures(g.point,{layers:[t]}):[];x.length?c||(c=!0,s.call(this,new Ir(h,this,g.originalEvent,{features:x}))):c=!1},mouseout:()=>{c=!1}}}}if(h==="mouseleave"||h==="mouseout"){let c=!1;return{layer:t,listener:s,delegates:{mousemove:x=>{(this.getLayer(t)?this.queryRenderedFeatures(x.point,{layers:[t]}):[]).length?c=!0:c&&(c=!1,s.call(this,new Ir(h,this,x.originalEvent)))},mouseout:x=>{c&&(c=!1,s.call(this,new Ir(h,this,x.originalEvent)))}}}}{const c=p=>{const g=this.getLayer(t)?this.queryRenderedFeatures(p.point,{layers:[t]}):[];g.length&&(p.features=g,s.call(this,p),delete p.features)};return{layer:t,listener:s,delegates:{[h]:c}}}}on(h,t,s){if(s===void 0)return super.on(h,t);const c=this._createDelegatedListener(h,t,s);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(c);for(const p in c.delegates)this.on(p,c.delegates[p]);return this}once(h,t,s){if(s===void 0)return super.once(h,t);const c=this._createDelegatedListener(h,t,s);for(const p in c.delegates)this.once(p,c.delegates[p]);return this}off(h,t,s){return s===void 0?super.off(h,t):(this._delegatedListeners&&this._delegatedListeners[h]&&(c=>{const p=this._delegatedListeners[h];for(let g=0;g<p.length;g++){const x=p[g];if(x.layer===t&&x.listener===s){for(const S in x.delegates)this.off(S,x.delegates[S]);return p.splice(g,1),this}}})(),this)}queryRenderedFeatures(h,t){if(!this.style)return[];let s;if(t!==void 0||h===void 0||h instanceof u.pointGeometry||Array.isArray(h)||(t=h,h=void 0),t=t||{},(h=h||[[0,0],[this.transform.width,this.transform.height]])instanceof u.pointGeometry||typeof h[0]=="number")s=[u.pointGeometry.convert(h)];else{const c=u.pointGeometry.convert(h[0]),p=u.pointGeometry.convert(h[1]);s=[c,new u.pointGeometry(p.x,c.y),p,new u.pointGeometry(c.x,p.y),c]}return this.style.queryRenderedFeatures(s,t,this.transform)}querySourceFeatures(h,t){return this.style.querySourceFeatures(h,t)}setStyle(h,t){return(t=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},t)).diff!==!1&&t.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&h?(this._diffStyle(h,t),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._updateStyle(h,t))}setTransformRequest(h){return this._requestManager.setTransformRequest(h),this}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){return this.style&&(this.style.setEventedParent(null),this.style._remove()),h?(this.style=new Qn(this,t||{}),this.style.setEventedParent(this,{style:this.style}),typeof h=="string"?this.style.loadURL(h):this.style.loadJSON(h),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new Qn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,t){if(typeof h=="string"){const s=this._requestManager.transformRequest(h,u.ResourceType.Style);u.getJSON(s,(c,p)=>{c?this.fire(new u.ErrorEvent(c)):p&&this._updateDiff(p,t)})}else typeof h=="object"&&this._updateDiff(h,t)}_updateDiff(h,t){try{this.style.setState(h)&&this._update(!0)}catch(s){u.warnOnce(`Unable to perform style diff: ${s.message||s.error||s}.  Rebuilding the style from scratch.`),this._updateStyle(h,t)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(h,t){return this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)}isSourceLoaded(h){const t=this.style&&this.style.sourceCaches[h];if(t!==void 0)return t.loaded();this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${h}'`)))}setTerrain(h){return this.style.setTerrain(h),this}getTerrain(){return this.style.terrain&&this.style.terrain.options}areTilesLoaded(){const h=this.style&&this.style.sourceCaches;for(const t in h){const s=h[t]._tiles;for(const c in s){const p=s[c];if(p.state!=="loaded"&&p.state!=="errored")return!1}}return!0}addSourceType(h,t,s){return this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,s)}removeSource(h){return this.style.removeSource(h),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,t,{pixelRatio:s=1,sdf:c=!1,stretchX:p,stretchY:g,content:x}={}){if(this._lazyInitEmptyStyle(),t instanceof HTMLImageElement||u.isImageBitmap(t)){const{width:S,height:E,data:k}=u.exported.getImageData(t);this.style.addImage(h,{data:new u.RGBAImage({width:S,height:E},k),pixelRatio:s,stretchX:p,stretchY:g,content:x,sdf:c,version:0})}else{if(t.width===void 0||t.height===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:S,height:E,data:k}=t,A=t;this.style.addImage(h,{data:new u.RGBAImage({width:S,height:E},new Uint8Array(k)),pixelRatio:s,stretchX:p,stretchY:g,content:x,sdf:c,version:0,userImage:A}),A.onAdd&&A.onAdd(this,h)}}}updateImage(h,t){const s=this.style.getImage(h);if(!s)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const c=t instanceof HTMLImageElement||u.isImageBitmap(t)?u.exported.getImageData(t):t,{width:p,height:g,data:x}=c;if(p===void 0||g===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(p!==s.data.width||g!==s.data.height)return this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const S=!(t instanceof HTMLImageElement||u.isImageBitmap(t));s.data.replace(x,S),this.style.updateImage(h,s)}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,t){u.getImage(this._requestManager.transformRequest(h,u.ResourceType.Image),t)}listImages(){return this.style.listImages()}addLayer(h,t){return this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)}moveLayer(h,t){return this.style.moveLayer(h,t),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,t,s){return this.style.setLayerZoomRange(h,t,s),this._update(!0)}setFilter(h,t,s={}){return this.style.setFilter(h,t,s),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,t,s,c={}){return this.style.setPaintProperty(h,t,s,c),this._update(!0)}getPaintProperty(h,t){return this.style.getPaintProperty(h,t)}setLayoutProperty(h,t,s,c={}){return this.style.setLayoutProperty(h,t,s,c),this._update(!0)}getLayoutProperty(h,t){return this.style.getLayoutProperty(h,t)}setLight(h,t={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,t),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(h,t){return this.style.setFeatureState(h,t),this._update()}removeFeatureState(h,t){return this.style.removeFeatureState(h,t),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let h=0,t=0;return this._container&&(h=this._container.clientWidth||400,t=this._container.clientHeight||300),[h,t]}_setupContainer(){const h=this._container;h.classList.add("maplibregl-map","mapboxgl-map");const t=this._canvasContainer=q.create("div","maplibregl-canvas-container mapboxgl-canvas-container",h);this._interactive&&t.classList.add("maplibregl-interactive","mapboxgl-interactive"),this._canvas=q.create("canvas","maplibregl-canvas mapboxgl-canvas",t),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const s=this._containerDimensions();this._resizeCanvas(s[0],s[1],this.getPixelRatio());const c=this._controlContainer=q.create("div","maplibregl-control-container mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(g=>{p[g]=q.create("div",`maplibregl-ctrl-${g} mapboxgl-ctrl-${g}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_setupCooperativeGestures(){const h=this._container;this._metaPress=!1,this._cooperativeGesturesScreen=q.create("div","maplibregl-cooperative-gesture-screen",h);let t="Control",s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(s=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map",t="Meta"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${s}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,document.addEventListener("keydown",c=>{c.key===t&&(this._metaPress=!0)}),document.addEventListener("keyup",c=>{c.key===t&&(this._metaPress=!1)}),this._canvasContainer.addEventListener("wheel",c=>{this._onCooperativeGesture(c,this._metaPress,1)},!1),this._canvasContainer.classList.remove("mapboxgl-touch-drag-pan","maplibregl-touch-drag-pan")}_resizeCanvas(h,t,s){this._canvas.width=s*h,this._canvas.height=s*t,this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_setupPainter(){const h=u.extend({},O.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);t?(this.painter=new Hl(t,this.transform),u.exported$1.testSupport(t)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(h,t,s){return!t&&s<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_render(h){let t,s=0;const c=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(t=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,t),s=u.exported.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(h),this._removed)return;let p=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,S=u.exported.now();this.style.zoomHistory.update(x,S);const E=new u.EvaluationParameters(x,{now:S,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),k=E.crossFadingFactor();k===1&&k===this._crossFadingFactor||(p=!0,this._crossFadingFactor=k),this.style.update(E)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.style.terrain&&this.style.terrain.sourceCache.update(this.transform,this.style.terrain),this.transform.updateElevation(this.style.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.load),this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||p)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const x=u.exported.now()-s;c.endQueryEXT(c.TIME_ELAPSED_EXT,t),setTimeout(()=>{const S=c.getQueryObjectEXT(t,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(t),this.fire(new u.Event("gpu-timing-frame",{cpuTime:x,gpuTime:S}))},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const S=this.painter.queryGpuTimers(x);this.fire(new u.Event("gpu-timing-layer",{layerTimes:S}))},50)}const g=this._sourcesDirty||this._styleDirty||this._placementDirty;return g||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.Event("idle")),!this._loaded||this._fullyLoaded||g||(this._fullyLoaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&(removeEventListener("resize",this._onWindowResize,!1),removeEventListener("orientationchange",this._onWindowResize,!1),removeEventListener("online",this._onWindowOnline,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),q.remove(this._canvasContainer),q.remove(this._controlContainer),this._cooperativeGestures&&q.remove(this._cooperativeGesturesScreen),this._container.classList.remove("maplibregl-map","mapboxgl-map"),u.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=u.exported.frame(h=>{u.PerformanceUtils.frame(h),this._frame=null,this._render(h)}))}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}_setCacheLimits(h,t){u.setCacheLimits(h,t)}get version(){return"2.4.0"}},NavigationControl:class{constructor(h){this.options=u.extend({},cp,h),this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in mapboxgl-ctrl-zoom-in",t=>this._map.zoomIn({},{originalEvent:t})),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out mapboxgl-ctrl-zoom-out",t=>this._map.zoomOut({},{originalEvent:t})),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass mapboxgl-ctrl-compass",t=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:t}):this._map.resetNorth({},{originalEvent:t})}),this._compassIcon=q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map.getZoom(),t=h===this._map.getMaxZoom(),s=h===this._map.getMinZoom();this._zoomInButton.disabled=t,this._zoomOutButton.disabled=s,this._zoomInButton.setAttribute("aria-disabled",t.toString()),this._zoomOutButton.setAttribute("aria-disabled",s.toString())}_rotateCompassArrow(){const h=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=h}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new di(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){q.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(h,t){const s=q.create("button",h,this._container);return s.type="button",s.addEventListener("click",t),s}_setButtonTitle(h,t){const s=this._map._getUIString(`NavigationControl.${t}`);h.title=s,h.setAttribute("aria-label",s)}},GeolocateControl:class extends u.Evented{constructor(h){super(),this.options=u.extend({},ou,h),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(h){var t;return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),t=this._setupUI,Ji!==void 0?t(Ji):window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(s=>{Ji=s.state!=="denied",t(Ji)}):(Ji=!!window.navigator.geolocation,t(Ji)),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),q.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,qn=0,Qi=!1}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),s=h.coords;return t&&(s.longitude<t.getWest()||s.longitude>t.getEast()||s.latitude<t.getSouth()||s.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",h)),this._finish()}}_updateCamera(h){const t=new u.LngLat(h.coords.longitude,h.coords.latitude),s=h.coords.accuracy,c=this._map.getBearing(),p=u.extend({bearing:c},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(s),p,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new u.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map._container.clientHeight/2,t=this._map.unproject([0,h]),s=this._map.unproject([1,h]),c=t.distanceTo(s),p=Math.ceil(2*this._accuracy/c);this._circleElement.style.width=`${p}px`,this._circleElement.style.height=`${p}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(h){if(this._map){if(this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&Qi)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale","mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=q.create("button","maplibregl-ctrl-geolocate mapboxgl-ctrl-geolocate",this._container),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=t,this._geolocateButton.setAttribute("aria-label",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=q.create("div","maplibregl-user-location-dot mapboxgl-user-location-dot"),this._userLocationDotMarker=new ts(this._dotElement),this._circleElement=q.create("div","maplibregl-user-location-accuracy-circle mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ts({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":qn--,Qi=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error","mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error","mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background","mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active","mapboxgl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),qn++,qn>1?(h={maximumAge:6e5,timeout:0},Qi=!0):(h=this.options.positionOptions,Qi=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,h)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting","mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Js,LogoControl:Na,ScaleControl:class{constructor(h){this.options=u.extend({},pi,h),u.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){nh(this._map,this._container,this.options)}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-scale mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){q.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(h){this.options.unit=h,nh(this._map,this._container,this.options)}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){q.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!!(document.fullscreenEnabled||document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=q.create("button","maplibregl-ctrl-fullscreen mapboxgl-ctrl-fullscreen",this._controlContainer);q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen&&window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},TerrainControl:class{constructor(h){this.options=h,u.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(h){return this._map=h,this._container=q.create("div","maplibregl-ctrl maplibregl-ctrl-group mapboxgl-ctrl mapboxgl-ctrl-group"),this._terrainButton=q.create("button","maplibregl-ctrl-terrain mapboxgl-ctrl-terrain",this._container),q.create("span","maplibregl-ctrl-icon mapboxgl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){q.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._map.style.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled","mapboxgl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain","mapboxgl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends u.Evented{constructor(h){super(),this.options=u.extend(Object.create(fn),h),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&q.remove(this._content),this._container&&(q.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){return this._lngLat=u.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer","mapboxgl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer","mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),s=document.createElement("body");let c;for(s.innerHTML=h;c=s.firstChild,c;)t.appendChild(c);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=q.create("div","maplibregl-popup-content mapboxgl-popup-content",this._container);return this._content.appendChild(h),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(h){this._container&&this._container.classList.add(h)}removeClassName(h){this._container&&this._container.classList.remove(h)}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){if(this._container)return this._container.classList.toggle(h)}_createCloseButton(){this.options.closeButton&&(this._closeButton=q.create("button","maplibregl-popup-close-button mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(h){this._update(h.point)}_onMouseMove(h){this._update(h.point)}_onDrag(h){this._update(h.point)}_update(h){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=q.create("div","maplibregl-popup mapboxgl-popup",this._map.getContainer()),this._tip=q.create("div","maplibregl-popup-tip mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(g=>this._container.classList.add(g)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer","mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Qs(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!h))return;const t=this._pos=this._trackPointer&&h?h:this._map.project(this._lngLat);let s=this.options.anchor;const c=su(this.options.offset);if(!s){const g=this._container.offsetWidth,x=this._container.offsetHeight;let S;S=t.y+c.bottom.y<x?["top"]:t.y>this._map.transform.height-x?["bottom"]:[],t.x<g/2?S.push("left"):t.x>this._map.transform.width-g/2&&S.push("right"),s=S.length===0?"bottom":S.join("-")}const p=t.add(c[s]).round();q.setTransform(this._container,`${et[s]} translate(${p.x}px,${p.y}px)`),lt(this._container,s,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(Cn);h&&h.focus()}_onClose(){this.remove()}},Marker:ts,Style:Qn,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,Evented:u.Evented,AJAXError:u.AJAXError,config:u.config,CanvasSource:Pt,GeoJSONSource:Tn,ImageSource:st,RasterDEMTileSource:ot,RasterTileSource:Kn,VectorTileSource:yn,VideoSource:ut,prewarm:function(){Yr().acquire(Yt)},clearPrewarmedResources:function(){const h=mr;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Yt),mr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return"2.4.0"},get workerCount(){return Mn.workerCount},set workerCount(h){Mn.workerCount=h},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){u.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){u.clearTileCache(h)},workerUrl:"",addProtocol(h,t){u.config.REGISTERED_PROTOCOLS[h]=t},removeProtocol(h){delete u.config.REGISTERED_PROTOCOLS[h]}};return $r.extend(_o,{isSafari:u.isSafari,getPerformanceMetrics:u.PerformanceUtils.getPerformanceMetrics}),_o});var C=_;return C})})(DS);const LS=Sm;var Em={},RS={get exports(){return Em},set exports(n){Em=n}},I0={};/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var El=qe;function BS(n,o){return n===o&&(n!==0||1/n===1/o)||n!==n&&o!==o}var FS=typeof Object.is=="function"?Object.is:BS,OS=El.useState,NS=El.useEffect,US=El.useLayoutEffect,VS=El.useDebugValue;function $S(n,o){var l=o(),f=OS({inst:{value:l,getSnapshot:o}}),_=f[0].inst,v=f[1];return US(function(){_.value=l,_.getSnapshot=o,Sf(_)&&v({inst:_})},[n,l,o]),NS(function(){return Sf(_)&&v({inst:_}),n(function(){Sf(_)&&v({inst:_})})},[n]),VS(l),l}function Sf(n){var o=n.getSnapshot;n=n.value;try{var l=o();return!FS(n,l)}catch{return!0}}function jS(n,o){return o()}var GS=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?jS:$S;I0.useSyncExternalStore=El.useSyncExternalStore!==void 0?El.useSyncExternalStore:GS;(function(n){n.exports=I0})(RS);const Ao=new WeakMap,dv={},ms=()=>{},Vi=ms(),Ef=Object,xn=n=>n===Vi,Mo=n=>typeof n=="function",ks=(n,o)=>({...n,...o}),kg="undefined",Gd=typeof window!=kg,Tm=typeof document!=kg,ZS=()=>Gd&&typeof window.requestAnimationFrame!=kg,z0=(n,o)=>{const l=Ao.get(n);return[()=>n.get(o)||dv,f=>{const _=n.get(o);l[5](o,ks(_,f),_||dv)},l[6]]},jh=new WeakMap;let qS=0;const hc=n=>{const o=typeof n,l=n&&n.constructor,f=l==Date;let _,v;if(Ef(n)===n&&!f&&l!=RegExp){if(_=jh.get(n),_)return _;if(_=++qS+"~",jh.set(n,_),l==Array){for(_="@",v=0;v<n.length;v++)_+=hc(n[v])+",";jh.set(n,_)}if(l==Ef){_="#";const C=Ef.keys(n).sort();for(;!xn(v=C.pop());)xn(n[v])||(_+=v+":"+hc(n[v])+",");jh.set(n,_)}}else _=f?n.toJSON():o=="symbol"?n.toString():o=="string"?JSON.stringify(n):""+n;return _};let km=!0;const WS=()=>km,[Cm,Im]=Gd&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ms,ms],XS=()=>{const n=Tm&&document.visibilityState;return xn(n)||n!=="hidden"},HS=n=>(Tm&&document.addEventListener("visibilitychange",n),Cm("focus",n),()=>{Tm&&document.removeEventListener("visibilitychange",n),Im("focus",n)}),KS=n=>{const o=()=>{km=!0,n()},l=()=>{km=!1};return Cm("online",o),Cm("offline",l),()=>{Im("online",o),Im("offline",l)}},YS={isOnline:WS,isVisible:XS},JS={initFocus:HS,initReconnect:KS},pv=!Lm.useId,dc=!Gd||"Deno"in window,QS=n=>ZS()?window.requestAnimationFrame(n):setTimeout(n,1),Tf=dc?qe.useEffect:qe.useLayoutEffect,kf=typeof navigator<"u"&&navigator.connection,fv=!dc&&kf&&(["slow-2g","2g"].includes(kf.effectiveType)||kf.saveData),Cg=n=>{if(Mo(n))try{n=n()}catch{n=""}const o=n;return n=typeof n=="string"?n:(Array.isArray(n)?n.length:n)?hc(n):"",[n,o]};let eE=0;const zm=()=>++eE,A0=0,M0=1,P0=2;var Cf={__proto__:null,FOCUS_EVENT:A0,RECONNECT_EVENT:M0,MUTATE_EVENT:P0};async function D0(...n){const[o,l,f,_]=n,v=ks({populateCache:!0,throwOnError:!0},typeof _=="boolean"?{revalidate:_}:_||{});let C=v.populateCache;const u=v.rollbackOnError;let O=v.optimisticData;const Z=v.revalidate!==!1,ue=Ae=>typeof u=="function"?u(Ae):u!==!1,te=v.throwOnError;if(Mo(l)){const Ae=l,Ce=[],we=o.keys();for(let xt=we.next();!xt.done;xt=we.next()){const se=xt.value;!se.startsWith("$inf$")&&Ae(o.get(se)._k)&&Ce.push(se)}return Promise.all(Ce.map(q))}return q(l);async function q(Ae){const[Ce]=Cg(Ae);if(!Ce)return;const[we,xt]=z0(o,Ce),[se,Q,ae]=Ao.get(o),ke=se[Ce],Me=()=>Z&&(delete ae[Ce],ke&&ke[0])?ke[0](P0).then(()=>we().data):we().data;if(n.length<3)return Me();let ze=f,je;const He=zm();Q[Ce]=[He,0];const Mt=!xn(O),ht=we(),Wt=ht.data,En=ht._c,yn=xn(En)?Wt:En;if(Mt&&(O=Mo(O)?O(yn):O,xt({data:O,_c:yn})),Mo(ze))try{ze=ze(yn)}catch(_n){je=_n}if(ze&&Mo(ze.then))if(ze=await ze.catch(_n=>{je=_n}),He!==Q[Ce][0]){if(je)throw je;return ze}else je&&Mt&&ue(je)&&(C=!0,ze=yn,xt({data:ze,_c:Vi}));C&&(je||(Mo(C)&&(ze=C(ze,yn)),xt({data:ze,_c:Vi}))),Q[Ce][1]=zm();const Kn=await Me();if(xt({_c:Vi}),je){if(te)throw je;return}return C?Kn:ze}}const mv=(n,o)=>{for(const l in n)n[l][0]&&n[l][0](o)},tE=(n,o)=>{if(!Ao.has(n)){const l=ks(JS,o),f={},_=D0.bind(Vi,n);let v=ms;const C={},u=(ue,te)=>{const q=C[ue]||[];return C[ue]=q,q.push(te),()=>q.splice(q.indexOf(te),1)},O=(ue,te,q)=>{n.set(ue,te);const Ae=C[ue];if(Ae)for(let Ce=Ae.length;Ce--;)Ae[Ce](q,te)},Z=()=>{if(!Ao.has(n)&&(Ao.set(n,[f,{},{},{},_,O,u]),!dc)){const ue=l.initFocus(setTimeout.bind(Vi,mv.bind(Vi,f,A0))),te=l.initReconnect(setTimeout.bind(Vi,mv.bind(Vi,f,M0)));v=()=>{ue&&ue(),te&&te(),Ao.delete(n)}}};return Z(),[n,_,Z,v]}return[n,Ao.get(n)[4]]},nE=(n,o,l,f,_)=>{const v=l.errorRetryCount,C=_.retryCount,u=~~((Math.random()+.5)*(1<<(C<8?C:8)))*l.errorRetryInterval;!xn(v)&&C>v||setTimeout(f,u,_)},rE=(n,o)=>hc(n)==hc(o),[L0,iE]=tE(new Map),oE=ks({onLoadingSlow:ms,onSuccess:ms,onError:ms,onErrorRetry:nE,onDiscarded:ms,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:fv?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:fv?5e3:3e3,compare:rE,isPaused:()=>!1,cache:L0,mutate:iE,fallback:{}},YS),sE=(n,o)=>{const l=ks(n,o);if(o){const{use:f,fallback:_}=n,{use:v,fallback:C}=o;f&&v&&(l.use=f.concat(v)),_&&C&&(l.fallback=ks(_,C))}return l},aE=qe.createContext({}),R0=Gd&&window.__SWR_DEVTOOLS_USE__,lE=R0?window.__SWR_DEVTOOLS_USE__:[],uE=()=>{R0&&(window.__SWR_DEVTOOLS_REACT__=Lm)},cE=n=>Mo(n[1])?[n[0],n[1],n[2]||{}]:[n[0],null,(n[1]===null?n[2]:n[1])||{}],hE=()=>ks(oE,qe.useContext(aE)),dE=n=>(o,l,f)=>n(o,l&&((...v)=>{const C=Cg(o)[0],[,,,u]=Ao.get(L0),O=u[C];return O?(delete u[C],O):l(...v)}),f),pE=lE.concat(dE),fE=n=>function(...l){const f=hE(),[_,v,C]=cE(l),u=sE(f,C);let O=n;const{use:Z}=u,ue=(Z||[]).concat(pE);for(let te=ue.length;te--;)O=ue[te](O);return O(_,v||u.fetcher||null,u)},mE=(n,o,l)=>{const f=o[n]||(o[n]=[]);return f.push(l),()=>{const _=f.indexOf(l);_>=0&&(f[_]=f[f.length-1],f.pop())}};uE();const If={dedupe:!0},gE=(n,o,l)=>{const{cache:f,compare:_,suspense:v,fallbackData:C,revalidateOnMount:u,refreshInterval:O,refreshWhenHidden:Z,refreshWhenOffline:ue,keepPreviousData:te}=l,[q,Ae,Ce]=Ao.get(f),[we,xt]=Cg(n),se=qe.useRef(!1),Q=qe.useRef(!1),ae=qe.useRef(we),ke=qe.useRef(o),Me=qe.useRef(l),ze=()=>Me.current,je=()=>ze().isVisible()&&ze().isOnline(),[He,Mt,ht]=z0(f,we),Wt=qe.useRef({}).current,En=xn(C)?l.fallback[we]:C,yn=(Ut,Rt)=>{let Kt=!0;for(const un in Wt){const Yt=un;_(Rt[Yt],Ut[Yt])||Yt==="data"&&xn(Ut[Yt])&&_(Rt[Yt],Pt)||(Kt=!1)}return Kt},Kn=qe.useMemo(()=>{const Ut=(()=>!we||!o?!1:xn(u)?!(ze().isPaused()||v):u)(),Rt=()=>{const un=He(),Yt=ks(un);return delete Yt._k,Ut?{isValidating:!0,isLoading:!0,...Yt}:Yt};let Kt=Rt();return()=>{const un=Rt();return yn(un,Kt)?Kt:Kt=un}},[f,we]),_n=Em.useSyncExternalStore(qe.useCallback(Ut=>ht(we,(Rt,Kt)=>{yn(Rt,Kt)||Ut()}),[f,we]),Kn,Kn),ot=!se.current,Tn=_n.data,Ne=xn(Tn)?En:Tn,st=_n.error,ut=qe.useRef(Ne),Pt=te?xn(Tn)?ut.current:Tn:Ne,qt=(()=>ot&&!xn(u)?u:ze().isPaused()?!1:v?xn(Ne)?!1:l.revalidateIfStale:xn(Ne)||l.revalidateIfStale)(),fr=!!(we&&o&&ot&&qt),Yn=xn(_n.isValidating)?fr:_n.isValidating,Jn=xn(_n.isLoading)?fr:_n.isLoading,pn=qe.useCallback(async Ut=>{const Rt=ke.current;if(!we||!Rt||Q.current||ze().isPaused())return!1;let Kt,un,Yt=!0;const Mn=Ut||{},Nr=!Ce[we]||!Mn.dedupe,mr=()=>pv?!Q.current&&we===ae.current&&se.current:we===ae.current,Yr={isValidating:!1,isLoading:!1},Ti=()=>{Mt(Yr)},qi=()=>{const cn=Ce[we];cn&&cn[1]===un&&delete Ce[we]},St={isValidating:!0};xn(He().data)&&(St.isLoading=!0);try{if(Nr&&(Mt(St),l.loadingTimeout&&xn(He().data)&&setTimeout(()=>{Yt&&mr()&&ze().onLoadingSlow(we,l)},l.loadingTimeout),Ce[we]=[Rt(xt),zm()]),[Kt,un]=Ce[we],Kt=await Kt,Nr&&setTimeout(qi,l.dedupingInterval),!Ce[we]||Ce[we][1]!==un)return Nr&&mr()&&ze().onDiscarded(we),!1;Yr.error=Vi;const cn=Ae[we];if(!xn(cn)&&(un<=cn[0]||un<=cn[1]||cn[1]===0))return Ti(),Nr&&mr()&&ze().onDiscarded(we),!1;const Bn=He().data;Yr.data=_(Bn,Kt)?Bn:Kt,Nr&&mr()&&ze().onSuccess(Kt,we,l)}catch(cn){qi();const Bn=ze(),{shouldRetryOnError:Ur}=Bn;Bn.isPaused()||(Yr.error=cn,Nr&&mr()&&(Bn.onError(cn,we,Bn),(Ur===!0||Mo(Ur)&&Ur(cn))&&je()&&Bn.onErrorRetry(cn,we,Bn,pn,{retryCount:(Mn.retryCount||0)+1,dedupe:!0})))}return Yt=!1,Ti(),!0},[we,f]),sr=qe.useCallback((...Ut)=>D0(f,ae.current,...Ut),[]);if(Tf(()=>{ke.current=o,Me.current=l,xn(Tn)||(ut.current=Tn)}),Tf(()=>{if(!we)return;const Ut=pn.bind(Vi,If);let Rt=0;const un=mE(we,q,Yt=>{if(Yt==Cf.FOCUS_EVENT){const Mn=Date.now();ze().revalidateOnFocus&&Mn>Rt&&je()&&(Rt=Mn+ze().focusThrottleInterval,Ut())}else if(Yt==Cf.RECONNECT_EVENT)ze().revalidateOnReconnect&&je()&&Ut();else if(Yt==Cf.MUTATE_EVENT)return pn()});return Q.current=!1,ae.current=we,se.current=!0,Mt({_k:xt}),qt&&(xn(Ne)||dc?Ut():QS(Ut)),()=>{Q.current=!0,un()}},[we]),Tf(()=>{let Ut;function Rt(){const un=Mo(O)?O(Ne):O;un&&Ut!==-1&&(Ut=setTimeout(Kt,un))}function Kt(){!He().error&&(Z||ze().isVisible())&&(ue||ze().isOnline())?pn(If).then(Rt):Rt()}return Rt(),()=>{Ut&&(clearTimeout(Ut),Ut=-1)}},[O,Z,ue,we]),qe.useDebugValue(Pt),v&&xn(Ne)&&we)throw!pv&&dc?new Error("Fallback data is required when using suspense in SSR."):(ke.current=o,Me.current=l,Q.current=!1,xn(st)?pn(If):st);return{mutate:sr,get data(){return Wt.data=!0,Pt},get error(){return Wt.error=!0,st},get isValidating(){return Wt.isValidating=!0,Yn},get isLoading(){return Wt.isLoading=!0,Jn}}};var yE=fE(gE);const _E="_marker_1bpm6_1",vE={marker:_E};function xE({Location:n,Name:o}){const l=JSON.parse(n),f={type:"Polygon",coordinates:[l.Polygon]};return Hw(IS,{type:"geojson",data:f,children:[$i(PS,{...{type:"line",layout:{"line-join":"round","line-cap":"round"},paint:{"line-color":"#fff","line-width":3}}}),$i(vS,{longitude:l.Center[0],latitude:l.Center[1],anchor:"center",children:$i("div",{className:vE.marker,children:o})})]})}function wE(){const n=(_,v)=>fetch(_,v).then(C=>C.json()),{data:o,error:l,isLoading:f}=yE("http://agro.energomera.ru:3060/api/field?lastChangeDate=2022-01-01T10:00:00.000&skip=0&take=100",n);return l?$i("div",{children:"Ошибка загрузки полигонов"}):f?$i("div",{children:"Загрузка полигонов..."}):$i(Tg,{mapLib:LS,initialViewState:{longitude:45.3385364852744,latitude:42.50865653359858,zoom:12},style:{width:900,height:600},mapStyle:"https://api.maptiler.com/maps/hybrid/style.json?key=pvnX1lv9PvnrVVyVnoLX",children:o.map(_=>$i(xE,{..._},_.$id))})}function bE(){return $i("div",{className:"App",children:$i(wE,{})})}zf.createRoot(document.getElementById("root")).render($i(Lm.StrictMode,{children:$i(bE,{})}));
